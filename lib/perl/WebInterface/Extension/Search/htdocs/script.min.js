$(document).ready(function(){function e(){var e=$("#fileListTable");$("#apps .action.search").toggleClass("disabled",e.hasClass("unselectable-yes")||e.hasClass("isreadable-no"))}function n(e){$(".action.search").addClass("disabled"),$.MyPost(window.location.pathname,{action:"getSearchForm",files:e},function(e){var t=$(e);s(t);var n=$(window);$(".search.resultcontentpane",t).css("max-height",n.height()*.85+"px"),t.dialog({width:n.width()*.8,height:"auto",closeText:$("#close").html(),dialogClass:"search",beforeClose:function(){$("#flt").off("fileListChanged",null,t.fileListChangedHandler),i(t)}}),$(".action.search").removeClass("disabled"),t.MyTooltip(),$(".contexthelp").MyContextHelp()})}function r(e,t){t?$("input.search.start,input.search.query",e).removeAttr("disabled"):$("input.search.start,input.search.query",e).attr("disabled","disabled"),$("input.search.start",e).button("option","disabled",!t)}function i(e){e.data("completed",1),e.data("resultpoll")&&(window.clearTimeout(e.data("resultpoll")),e.removeData("resultpoll")),e.data("postXHR")&&(e.data("postXHR").abort(),e.removeData("postXHR")),$("input.search.cancel",e).attr("disabled","disabled").button("option","disabled",!0),r(e,!0),e.removeClass("searchinprogress")}function s(e){$("input[type=submit], input[type=button]",e).button(),e.fileListChangedHandler=function(){var t=$("#fileListTable");r(e,!t.hasClass("unselectable-yes")&&!t.hasClass("isreadable-no"))},$("#flt").on("fileListChanged",e.fileListChangedHandler),$("input.search.cancel",e).attr("disabled","disabled").button("option","disabled",!0).click(function(){$(".search.statusbar",e).html($(".msg.search.aborted").html()),e.data("postXHR").abort()}),$(".search.moreoptionscollapser",e).click(function(){$(".search.moreoptions",e).toggle(),$(this).toggleClass("uncollapsed",$(".search.moreoptions",e).is(":visible")),$(this).attr("aria-expanded",$(".search.moreoptions",e).is(":visible"))}).MyKeyboardEventHandler(),$("form",e).submit(function(){var t=$(this);e.data("completed",0);var n=t.serialize();return $("input.search.cancel",e).removeAttr("disabled").button("option","disabled",!1),r(e,!1),$(".search.statusbar",e).html($(".msg.search.inprogress").html()),$(".search.resultcontentpane",e).html(""),e.addClass("searchinprogress"),o(e),e.data("postXHR",$.ajax({type:"POST",url:window.location.pathname,data:n,success:function(t){u(t,e)},error:function(t,n,r){u({error:n},e)},complete:function(){i(e)}})),!1});if($.QueryString.action=="search"&&!$("#fileListTable").hasClass("unselectable-yes")){e.find("input[name=query]").val($.QueryString.query);var t=$.QueryString.searchin=="content"?"content":"filename";e.find("input[name=searchin][value="+t+"]:enabled").attr("checked","checked"),e.find("form").submit()}$(".search-result-thumb-view-toggle-button",e).on("click",function(){$(".search.resultpanel").toggleClass("search-result-thumb-view"),$(this).toggleClass("ai-flt-view-thumbs").toggleClass("ai-flt-view-list")}),e.find(".search-reset-button").on("click",function(){e.find("input.search.query").val("")})}function o(e){e.data("resultpoll",window.setTimeout(function(){$.MyPost(window.location.pathname,{action:"getSearchResult",searchid:$("input.search.id",e).val()},function(t){e.data("completed")||(u(t,e),o(e))},!0)},2e3))}function u(e,t){if(e.error)return;ToolBox.handleJSONResponse(e);if(e.data){var n=$(e.data);$(".search.resultcontentpane",t).html(n),a(n)}e.status&&$(".search.statusbar",t).html($("<div/>").text(e.status).html())}function a(e){$(".entry-info.folder,.parent.folder",e).click(function(){ToolBox.changeUri($(this).attr("data-href"))}).MyKeyboardEventHandler(),$(".entry-info.file",e).click(function(e){if(e.target!=this&&$(e.target).hasClass("thumbnail"))return;window.open($(this).attr("data-href"),"_blank")}).MyKeyboardEventHandler(),$("img",e).off("error.search").on("error.search",function(){var e=$(this);e.removeClass("thumbnail").attr("src",$("#emptyimage").attr("src"))}),e.MyTooltip({showtimeout:-1,hidetimeout:-1}),e.find(".icon.thumbnail").attr({"data-fancybox":"searchresultgallery"}).each(function(e,t){var n=$(t);n.data({caption:n.siblings(".label").html(),src:n.attr("src").replace(/\?action=thumb$/,"")})}).fancybox()}$("#flt").on("fileListChanged",e),e();var t=$("#fileListTable");$("#apps .action.search").toggleClass("disabled",t.hasClass("unselectable-yes")||t.hasClass("isreadable-no")),$(".action.search").click(function(e){if($(this).hasClass("disabled"))return;n(ToolBox.getSelectedFiles(this))}),$.QueryString.action=="search"&&!$("#fileListTable").hasClass("unselectable-yes")&&n()});

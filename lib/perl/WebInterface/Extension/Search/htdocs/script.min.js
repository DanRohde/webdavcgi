$(document).ready(function(){function d(){var j=$("#fileListTable");$("#apps .action.search").toggleClass("disabled",j.hasClass("unselectable-yes")||j.hasClass("isreadable-no"))}$("#flt").on("fileListChanged",d);d();var g=$("#fileListTable");$("#apps .action.search").toggleClass("disabled",g.hasClass("unselectable-yes")||g.hasClass("isreadable-no"));$(".action.search").click(function(j){ToolBox.preventDefault(j);if($(this).hasClass("disabled")){return}i(ToolBox.getSelectedFiles(this))});if($.QueryString.action=="search"&&!$("#fileListTable").hasClass("unselectable-yes")){i()}function i(j){$(".action.search").addClass("disabled");$.get(window.location.pathname,{action:"getSearchForm",files:j},function(k){var l=$(k);c(l);l.dialog({width:"auto",height:"auto",maxWidth:$(window).width()-100,closeText:$("#close").html(),dialogClass:"search",beforeClose:function(){$("#flt").off("fileListChanged",null,l.fileListChangedHandler);f(l)}});$(".action.search").removeClass("disabled");l.MyTooltip();$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1})})}function b(k,j){if(j){$("input.search.start,input.search.query",k).removeAttr("disabled")}else{$("input.search.start,input.search.query",k).attr("disabled","disabled")}$("input.search.start",k).button("option","disabled",!j)}function f(j){j.data("completed",1);if(j.data("resultpoll")){window.clearTimeout(j.data("resultpoll"));j.removeData("resultpoll")}if(j.data("postXHR")){j.data("postXHR").abort();j.removeData("postXHR")}$("input.search.cancel",j).attr("disabled","disabled").button("option","disabled",true);b(j,true);j.removeClass("searchinprogress")}function c(j){$("input[type=submit], input[type=button]",j).button();j.fileListChangedHandler=function(){var l=$("#fileListTable");b(j,!l.hasClass("unselectable-yes")&&!l.hasClass("isreadable-no"))};$(".search.resultcontentpane",j).css("max-height",($(window).height()-310>310?$(window).height()-310:350)+"px");$("#flt").on("fileListChanged",j.fileListChangedHandler);$("input.search.cancel",j).attr("disabled","disabled").button("option","disabled",true).click(function(){$(".search.statusbar",j).html($(".msg.search.aborted").html());j.data("postXHR").abort()});$(".search.moreoptionscollapser",j).click(function(){$(".search.moreoptions",j).toggle();$(this).toggleClass("uncollapsed",$(".search.moreoptions",j).is(":visible"))});$("form",j).submit(function(){var m=$(this);j.data("completed",0);var l=m.serialize();$("input.search.cancel",j).removeAttr("disabled").button("option","disabled",false);b(j,false);$(".search.statusbar",j).html($(".msg.search.inprogress").html());$(".search.resultcontentpane",j).html("");j.addClass("searchinprogress");e(j);j.data("postXHR",$.ajax({type:"POST",url:window.location.pathname,data:l,success:function(n){h(n,j)},error:function(n,p,o){h({error:p},j)},complete:function(){f(j)}}));return false});if($.QueryString.action=="search"&&!$("#fileListTable").hasClass("unselectable-yes")){j.find("input[name=query]").val($.QueryString.query);var k=$.QueryString.searchin=="content"?"content":"filename";j.find("input[name=searchin][value="+k+"]:enabled").attr("checked","checked");j.find("form").submit()}}function e(j){j.data("resultpoll",window.setTimeout(function(){$.get(window.location.pathname,{action:"getSearchResult",searchid:$("input.search.id",j).val()},function(k){if(!j.data("completed")){h(k,j);e(j)}})},2000))}function h(j,k){if(j.error){return}ToolBox.handleJSONResponse(j);if(j.data){var l=$(j.data);$(".search.resultcontentpane",k).html(l);a(l)}if(j.status){$(".search.statusbar",k).html($("<div/>").text(j.status).html())}}function a(j){$(".entry-info.folder,.parent.folder",j).click(function(){ToolBox.changeUri($(this).attr("data-href"))});$(".entry-info.file",j).click(function(){window.open($(this).attr("data-href"),"_blank")});$("img",j).off("error.search").on("error.search",function(){var k=$(this);k.removeClass("thumbnail").attr("src",$("#emptyimage").attr("src"))});j.MyTooltip({showtimeout:-1,hidetimeout:-1})}});
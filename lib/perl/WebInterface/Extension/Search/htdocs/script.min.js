$(document).ready(function(){function b(){var i=$("#fileListTable");$("#apps .action.search").toggleClass("disabled",i.hasClass("unselectable-yes")||i.hasClass("isreadable-no"))}$("#flt").on("fileListChanged",b);b();var h=$("#fileListTable");$("#apps .action.search").toggleClass("disabled",h.hasClass("unselectable-yes")||h.hasClass("isreadable-no"));$(".action.search").click(function(i){ToolBox.preventDefault(i);if($(this).hasClass("disabled")){return}$(".action.search").addClass("disabled");$.get(window.location.pathname,{ajax:"getSearchForm",files:ToolBox.getSelectedFiles(this)},function(j){var k=$(j);e(k);k.dialog({width:"auto",height:"auto",maxWidth:$(window).width()-100,beforeClose:function(){$("#flt").off("fileListChanged",null,k.fileListChangedHandler);d(k)}});$(".action.search").removeClass("disabled")})});function g(j,i){if(i){$("input.search.start,input.search.query",j).removeAttr("disabled")}else{$("input.search.start,input.search.query",j).attr("disabled","disabled")}}function d(i){i.data("completed",1);if(i.data("resultpuller")){window.clearInterval(i.data("resultpuller"));i.removeData("resultpuller")}if(i.data("postXHR")){i.data("postXHR").abort();i.removeData("postXHR")}$("input.search.cancel",i).attr("disabled","disabled");g(i,true);i.removeClass("searchinprogress")}function e(i){i.fileListChangedHandler=function(){var j=$("#fileListTable");g(i,!j.hasClass("unselectable-yes")&&!j.hasClass("isreadable-no"))};$(".search.resultcontentpane",i).css("max-height",($(window).height()-310>310?$(window).height()-310:350)+"px");$("#flt").on("fileListChanged",i.fileListChangedHandler);$("input.search.cancel",i).attr("disabled","disabled").click(function(){$(".search.statusbar",i).html($(".msg.search.aborted").html());i.data("postXHR").abort()});$(".search.moreoptionscollapser",i).click(function(){$(".search.moreoptions",i).toggle();$(this).toggleClass("uncollapsed",$(".search.moreoptions",i).is(":visible"))});$("form",i).submit(function(){var k=$(this);i.data("completed",0);var j=k.serialize();$("input.search.cancel",i).removeAttr("disabled");g(i,false);$(".search.statusbar",i).html($(".msg.search.inprogress").html());$(".search.resultcontentpane",i).html("");i.addClass("searchinprogress");c(i);i.data("postXHR",$.ajax({type:"POST",url:window.location.pathname,data:j,success:function(l){f(l,i)},error:function(l,n,m){f({error:n},i)},complete:function(){d(i)},}));return false})}function c(i){i.data("resultpuller",window.setInterval(function(){$.get(window.location.pathname,{ajax:"getSearchResult",searchid:$("input.search.id",i).val()},function(j){if(!i.data("completed")){f(j,i)}})},2000))}function f(i,j){if(i.error){return}ToolBox.handleJSONResponse(i);if(i.data){var k=$(i.data);$(".search.resultcontentpane",j).html(k);a(k)}if(i.status){$(".search.statusbar",j).html($("<div/>").text(i.status).html())}}function a(i){$("a.search.result.entry.folder",i).click(function(j){ToolBox.preventDefault(j);ToolBox.changeUri($(this).attr("href"));return false});$("a.search.result.entry",i).hover(function(){var j=$(this);if(j.data("timeout")){window.clearTimeout(j.data("timeout"))}$(".search.result.fileuri",j.parent()).show()},function(){var j=$(this);window.clearTimeout(j.data("timeout"));j.data("timeout",window.setTimeout(function(){$(".search.result.fileuri",j.parent()).hide(500)},5000))})}});
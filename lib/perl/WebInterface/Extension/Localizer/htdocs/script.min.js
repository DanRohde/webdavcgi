$(document).ready(function(){$(".action.localizer").on("click",function(){$.MyPost(window.location.href,{action:"getLocalizerDialog"},function(f){ToolBox.handleJSONResponse(f);b($(f))})});function b(g){$(".contexthelp",g).MyContextHelp();$(".localizer-lang-required",g).prop("disabled",true);$(".localizer-select-lang",g).on("change",function(){var h=$(this);var j=h.val();$(".localizer-lang-required",g).prop("disabled",j=="");var i=$(".localizer-select-extension",g);if(j!=""&&i.val()!=""){i.trigger("change")}});$(".localizer-add-new-lang",g).on("change keyup",function(){var h=$(this);var j=h.val().trim();var i=j.match(/^[a-z]{2}(_[a-z]{2})?$/i)!=null;$(".localizer-lang-required",g).prop("disabled",!i);$(".localizer-select-lang",g).prop("disabled",i)});$(".localizer-select-extension",g).on("change",function(){$.MyPost(window.location.href,{action:"getLocaleEditor",extension:$(this).val(),localizerlang:a(g)},function(h){ToolBox.handleJSONResponse(h);c(g,$(h.editor))})});$(".localizer-edit-uilocale",g).on("click",function(){$(".localizer-select-extension",g).prop("selectedIndex",0);$.MyPost(window.location.href,{action:"getLocaleEditor",localizerlang:a(g)},function(h){ToolBox.handleJSONResponse(h);c(g,$(h.editor))})});$(".localizer-download-all",g).on("click",function(){ToolBox.postAction({action:"downloadAllLocaleFiles",localizerlang:a(g)})});var f=$(window);g.dialog({width:f.width()*0.8,maxHeight:f.height()*0.8,dialogClass:"localizerdialog",closeOnEscape:false})}function a(f){var g=$(".localizer-select-lang",f);return g.prop("disabled")?$(".localizer-add-new-lang",f).val().trim():g.val()}function c(f,g){g.find(".localizer-locale-editor-entry-translation").on("click",function(){var h=$(this);h.closest("tr").addClass("localizer-locale-editor-entry-active");$.MyInplaceEditor({editorTarget:h,spellcheck:true,lang:$(".localizer-editor-lang",g).val(),allowtab:true,defaultValue:h.text(),changeEvent:function(i){h.text(i.value);h.closest("tr").nextAll(":has(.localizer-locale-editor-entry-translation):first").find(".localizer-locale-editor-entry-translation").focus().click()},checkAllowedValue:function(){return true},canvelEvent:function(){h.focus()},finalEvent:function(){h.closest("tr").removeClass("localizer-locale-editor-entry-active")}})}).MyKeyboardEventHandler();g.find(".localizer-locale-editor-button-save").on("click",function(){$.MyPost(window.location.href,d(g,"saveLocalization"),function(h){ToolBox.handleJSONResponse(h)})});g.find(".localizer-locale-editor-button-download").on("click",function(){ToolBox.postAction(d(g,"downloadLocalization"))});$(".localizer-editor-pane",f).empty().append(g)}function d(f,g){return{action:g,localizerlang:f.find(".localizer-editor-lang").val(),localizertype:f.find(".localizer-editor-type").val(),localizertypeval:f.find(".localizer-editor-typeval").val(),localization:e(f)}}function e(f){var g={};f.find(".localizer-locale-editor-entry-translation").each(function(k,j){var h=$(j);if(h.text().match(/^\s*$/)==null){g[h.data("key")]=h.text()}});return JSON.stringify(g)}});
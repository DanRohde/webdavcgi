$(document).ready(function(){$(".action.localizer").on("click",function(){$.MyPost(window.location.href,{action:"getLocalizerDialog"},function(i){ToolBox.handleJSONResponse(i);d($(i))})});function a(i,k,j){if(!c(i)){$.MyPost(window.location.href,k,j)}}function d(j){$(".contexthelp",j).MyContextHelp();$(".localizer-lang-required",j).prop("disabled",true).trigger("property-changed");$(".localizer-extension-required",j).prop("disabled",true).trigger("property-changed");$(".localizer-select-lang",j).on("change",function(){var k=$(this);var l=k.val();$(".localizer-lang-required",j).prop("disabled",l=="").prop("selectedIndex",0).val("").trigger("property-changed");$(".localizer-lang-notrequired",j).prop("disabled",l!="").prop("selectedIndex",0).val("").trigger("propery-changed")});$(".localizer-add-new-lang",j).on("change keyup",function(){var k=$(this);var m=k.val().trim();var l=m.match(/^[a-z]{2}(_[a-z]{2})?$/i)!=null;$(".localizer-lang-required",j).prop("disabled",!l).trigger("property-changed");$(".localizer-select-lang",j).prop("disabled",l).trigger("property-changed")});$(".localizer-select-extension",j).on("change click property-changed",function(){$(".localizer-extension-required",j).prop("disabled",$(this).val().trim()==""||$(this).prop("disabled")).trigger("property-changed")});$(".localizer-edit-extension-locale",j).on("click",function(){var k=$(".localizer-select-extension",j);if(k.val().trim()==""){return}a(j,{action:"getLocaleEditor",extension:k.val(),localizerlang:b(j)},function(l){ToolBox.handleJSONResponse(l);e(j,$(l.editor))})});$(".localizer-edit-uilocale",j).on("click",function(){a(j,{action:"getLocaleEditor",localizerlang:b(j)},function(k){$(".localizer-select-extension",j).prop("selectedIndex",0);ToolBox.handleJSONResponse(k);e(j,$(k.editor))})});$(".localizer-edit-help",j).on("click",function(){a(j,{action:"getHelpEditor",extension:$(".localizer-select-extension",j).val(),localizerlang:b(j)},function(k){ToolBox.handleJSONResponse(k);g(j,$(k.editor))})});$(".localizer-download-all",j).on("click",function(){if(!c(j)){ToolBox.postAction({action:"downloadAllLocaleFiles",localizerlang:b(j)})}});c(j,false);$(".localizer-protect-unsaved-changes",j).on("click change keydown",function(k){if(c(j)){$.MyPreventDefault(k);return false}return true});var i=$(window);j.dialog({width:i.width()*0.8,maxHeight:i.height()*0.8,dialogClass:"localizerdialog",closeOnEscape:false,beforeClose:function(){return !c(j)}})}function c(j,i){if(i===undefined){if(j.data("unsavedchanges")&&window.confirm($(".localizer-unsafed-changes-message",j).data("message"))){j.data("unsavedchanges",false)}}else{j.data("unsavedchanges",i)}$(".localizer-unsaved-changes-listener",j).toggleClass("localizer-unsaved-changes",j.data("unsavedchanges"));return j.data("unsavedchanges")}function b(i){var j=$(".localizer-select-lang",i);return j.prop("disabled")?$(".localizer-add-new-lang",i).val().trim():j.val()}function g(i,j){j.find(".accordion").accordion({heightStyle:"content",collapsible:true,active:false});$(".localizer-download-helpfile, .localizer-save-helpfile",j).click(function(){var k=$(this);var m=k.hasClass("localizer-download-helpfile")?"downloadHelpFile":"saveHelpFile";var l={action:m,source:$(k.data("source")).val(),extension:k.data("extension"),filename:k.data("filename")};if(m=="saveHelpFile"){$.MyPost(window.location.href,l,function(n){ToolBox.handleJSONResponse(n);if(!n.error&&!n.warn){c(i,false)}})}else{c(i,false);ToolBox.postAction(l)}});$(".localizer-preview",j).click(function(){var k=$(this);var l=$(k.data("source"),j);var n=$(k.data("preview"),j);l.toggle();n.toggle();if(n.is(":visible")){if(!k.data("backuptext")){k.data("backuptext",k.html())}k.html(k.data("buttontext"))}else{k.html(k.data("backuptext"))}var o=l.val().replace(/<head>/,'<head><base href="'+k.data("docbase")+'">');var m=(n[0].contentWindow||n[0].contentDocument).document;m.open();m.write(o);m.close()});$(".localizer-source",j).on("keyup",function(){c(i,true)});$(".localizer-editor-pane",i).empty().append(j)}function e(i,j){j.find(".localizer-locale-editor-entry").on("click",function(m){var k=$(this);var l=k.find(".localizer-locale-editor-entry-translation");k.addClass("localizer-locale-editor-entry-active");$.MyInplaceEditor({editorTarget:l,spellcheck:true,lang:$(".localizer-editor-lang",j).val(),allowtab:true,defaultValue:l.text(),changeEvent:function(n){l.text(n.value);k.nextAll(":focusable").first().focus().click();c(i,true)},checkAllowedValue:function(){return true},canvelEvent:function(){k.focus()},finalEvent:function(){k.removeClass("localizer-locale-editor-entry-active")}})}).MyKeyboardEventHandler();j.find(".localizer-locale-editor-button-save").on("click",function(){$.MyPost(window.location.href,f(j,"saveLocalization"),function(k){ToolBox.handleJSONResponse(k);if(!k.error&&!k.warn){c(i,false)}})});j.find(".localizer-locale-editor-button-download").on("click",function(){c(i,false);ToolBox.postAction(f(j,"downloadLocalization"))});$(".localizer-editor-pane",i).empty().append(j)}function f(i,j){return{action:j,localization:h(i)}}function h(i){var j={};i.find(".localizer-locale-editor-entry-translation").each(function(m,l){var k=$(l);if(k.text().match(/^\s*$/)==null){j[k.data("key")]=k.text()}});return JSON.stringify(j)}});
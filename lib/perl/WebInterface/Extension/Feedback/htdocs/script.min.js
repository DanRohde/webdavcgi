$(document).ready(function(){$(".action.feedback").on("click",function(a){ToolBox.preventDefault(a);if($(this).hasClass("disabled")){return false}$(".action.feedback").addClass("disabled");ToolBox.getDialog({action:"feedback"},function(c){var b=$(c);$("#feedback_screenshot_reset",b).button().hide().on("click",function(){$("#feedback_screenshot_reset",b).hide();$("#feedback_screenshot_img",b).val("");var d=$("#feedback_screenshot_preview",b);d.attr("src",d.data("src"));$("#feedback_screenshot_preview_link",b).attr({href:"#",tabindex:-1});$("#feedback_take_screenshot",b).show().focus()});$("#feedback_take_screenshot",b).button().on("click",function(){var d=$(this);d.attr("disabled",true);$(".feedbackdialog").hide();$("body").append($("<div/>").addClass("feedback-wait"));$(".feedback-shutter").prop("currentTime",0).trigger("play");html2canvas(document.body,{onrendered:function(e){$(".feedbackdialog").show();var f=e.toDataURL();$("#feedback_screenshot_preview",b).attr("src",f);$("#feedback_screenshot_preview_link",b).attr({href:f,tabindex:0});$("#feedback_screenshot_img",b).val(f);$("#feedback_screenshot_reset",b).show().focus();$("#feedback_take_screenshot",b).hide();d.attr("disabled",false);$(".feedback-wait").addClass("flash");window.setTimeout(function(){$(".feedback-wait").remove()},250)}})});$("#feedback_cancel",b).button().on("click",function(){b.dialog("close");$(".action.feedback").removeClass("disabled")});$("#feedback_submit",b).button().on("click",function(){if($("#feedbackmsg",b).val().match(/^\s*$/)){ToolBox.notifyError($("#feedback_missing_message").html());$("#feedbackmsg",b).addClass("missing").focus();return}$.post(window.location.pathname,$("#feedbackform").serialize(),function(d){ToolBox.handleJSONResponse(d);if(!d.error&&!d.message){ToolBox.notifyError($("#feedback_error").html())}else{if(!d.error){b.dialog("close")}}if(d.required){$("#feedbackmsg",b).addClass("missing").focus()}})});b.dialog({width:"auto",height:"auto",dialogClass:"feedbackdialog",closeText:$("#close").html(),beforeClose:function(){$(".action.feedback").removeClass("disabled")},open:function(){b.MyTooltip(500)},close:function(){b.dialog("destroy")}})});return false})});
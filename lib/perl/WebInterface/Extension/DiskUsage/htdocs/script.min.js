$(document).ready(function(){$("body").on("fileActionEvent",function(h,i){if(i.obj.hasClass("disabled")){return}if(i.obj.hasClass("diskusage")&&i.obj.hasClass("listaction")){var f=$("#fileList tr.selected.is-dir:visible");var g=f.length>0?$.map(f,function(k,j){return $(k).attr("data-file")}):new Array(!i.file?"":i.file);d(g)}else{if(i.obj.hasClass("diskusage")){d(new Array(i.file))}}});function c(){var f=$("#fileListTable");$("#apps .listaction.diskusage").toggleClass("disabled",f.hasClass("unselectable-yes")||f.hasClass("isreadable-no"))}$("#flt").on("fileListChanged",c);c();function d(f){$(".action.diskusage").addClass("disabled");var h=ToolBox.blockPage();var g=$.post($("#fileList").attr("data-uri"),{action:"diskusage",file:f},function(i){if(i.error){h.remove();ToolBox.handleJSONResponse(i);return}var j=$(i);h.remove();var k=function(l){window.location.href=$("a",$(this)).attr("href")};$("tr.diskusage.entry",j).dblclick(k).click(k);j.dialog({modal:true,width:"auto",height:"auto",maxWidth:$(window).width()-100,resizable:true,open:function(){a(j);b(j);e(j)},close:function(){j.dialog("destroy")}});$(".action.diskusage").removeClass("disabled")});ToolBox.renderAbortDialog(g)}function e(f){$(".accordion",f).accordion({collapsible:true,active:false,heightStyle:"content",activate:function(h,g){$(this).trigger("MyActivate",[h,g])}})}function a(g){var f=new Array();f.color1=[{val:0,color:"#aa0000"},{val:0.2,color:"#00aaaa"},{val:0.4,color:"#aaaa00"},{val:0.6,color:"#00aa00"},{val:0.8,color:"#0000aa"},{val:1,color:"#000000"}];f.color2=[{val:0,color:"#404040"},{val:0.2,color:"#909090"},{val:0.4,color:"#333333"},{val:0.6,color:"#404040"},{val:0.8,color:"#989898"},{val:1,color:"#000000"}];f.color3=[{val:0,color:"#000040"},{val:0.2,color:"#000090"},{val:0.4,color:"#000033"},{val:0.6,color:"#000040"},{val:0.8,color:"#0000ff"},{val:1,color:"#000000"}];$(".treemappanel",g).each(function(l,k){var m=ToolBox.stripSlash(window.location.pathname);var j=new Array();$(k).treemap({dimensions:$(".treemap.dimensions.active",g).data("dimensions"),nodeData:$(k).data("mapdata"),nodeBorderWidth:1,colorStops:f[$(".treemap.color.active",g).data("color")],leafNodeBodyGradient:function(o,r,q){var p=Math.min(r[2],r[3])*0.05;var n=Math.max(r[2],r[3]);var i=r[0]+r[2]*0.95;var t=r[1]+r[3]*Math.random();var s=o.createRadialGradient(i,t,p,i,t,n);s.addColorStop(0,TreemapUtils.lighterColor(TreemapUtils.rgb2hex(q),0.8));s.addColorStop(1,TreemapUtils.darkerColor(TreemapUtils.rgb2hex(q),0.1));return s}}).on("treemapclick",function(i,n){ToolBox.changeUri(m+"/"+n.nodes[0].uri)}).on("treemapmousemove",function(n,t){var o;if(j.el){o=j.el}else{o=$("<div/>").appendTo(g).addClass("diskusage treemap tooltip");j.el=o}if(t.nodes[0].title){window.clearTimeout(j.timeout);var i=t.nodes[0].id;if(i.length>30){i=i.match(/.{30}/g).join("\\<br/>")}o.html(i+": "+t.nodes[0].val+"<br/>"+t.nodes[0].title.split(", ").join("<br/>"));var s=g.offset();var x=o.width();var u=o.height();var p=n.pageX-s.left+4;var v=n.pageY-s.top+4;var r=$(k).width();var w=$(k).height();var q=$(k).offset();if(n.pageX+x+4>q.left+r){p-=x+8}if(n.pageY+u+4>q.top+w){v-=u+8}o.css({position:"absolute",top:v+"px",left:p+"px"}).show()}}).on("mouseout",function(){window.clearTimeout(j.timeout);j.timeout=window.setTimeout(function(){j.el.hide(200)},1000)});function h(i,n){$("."+n+".active",g).removeClass("active");i.addClass("active")}$(".treemap.byfoldersize",$(k).parent()).button().on("click",function(){h($(this),"sort");$(k).treemap("option","sizeOption",0);$(k).treemap("option","colorOption",0)});$(".treemap.byfilecount",$(k).parent()).button().on("click",function(){h($(this),"sort");$(k).treemap("option","sizeOption",1);$(k).treemap("option","colorOption",1)});$(".treemap.byfilesize",$(k).parent()).button().on("click",function(){h($(this),"sort");$(k).treemap("option","sizeOption",2);$(k).treemap("option","colorOption",2)});$(".treemap.dimensions",$(k).parent()).button().on("click",function(){h($(this),"dimensions");$(this).addClass("active");$(k).treemap("option","dimensions",$(this).data("dimensions"))});$(".treemap.color",$(k).parent()).button().on("click",function(){h($(this),"color");$(k).treemap("option","colorStops",f[$(this).data("color")])})})}function b(f){$(".diskusage.statistics.piechart",f).each(function(k,j){var h=$(j);$.jqplot(h.attr("id"),[h.data("json").data],{seriesDefaults:{renderer:$.jqplot.PieRenderer,rendererOptions:{showDataLabels:true,}},legend:{show:true,rendererOptions:{numberRows:2},location:"s"}});h.bind("jqplotDataHighlight",function(m,i,l,n){var o=n[0]+": "+(h.hasClass("size")?ToolBox.renderByteSize(n[1]):n[1]);$(this).attr("title",o);$("#"+h.attr("id")+"-info").html(o)}).bind("jqplotDataUnhighlight",function(m,i,l,n){$(this).attr("title","");$("#"+h.attr("id")+"-info").html("")})});var g=$(".diskusage.histograms.accordion",f);g.on("MyActivate",function(k,j){console.log(j);for(var h in g.data("plots")){g.data("plots")[h].redraw()}});g.data("plots",new Array());$(".diskusage.statistics.barchart",f).each(function(l,j){var h=$(j);var k=h.data("json");g.data("plots").push($.jqplot(h.attr("id"),[k.data],{title:{text:h.attr("title")},height:700,width:300,seriesDefaults:{renderer:$.jqplot.BarRenderer,rendererOptions:{fillToZero:true},pointLabels:{show:true,location:"s"}},axes:{xaxis:{label:h.data("xlabel"),renderer:$.jqplot.CategoryAxisRenderer},yaxis:{label:h.data("ylabel"),labelRenderer:$.jqplot.CanvasAxisLabelRenderer,min:0}}}))})}});
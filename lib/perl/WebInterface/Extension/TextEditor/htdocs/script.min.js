$(document).ready(function(){$("body").on("fileActionEvent",function(c,d){if(d.obj.hasClass("edit")){a(d.row)}});function b(g,f){f.trigger("editsubmit");var e=ToolBox.blockPage();var c=g.data("file");var d=$.post(ToolBox.addMissingSlash($("#fileList").attr("data-uri")),{action:"savetextdata",filename:c,textdata:f.val()},function(h){if(!h.error&&h.message){f.data("response",f.val());e.remove();ToolBox.refreshFileListEntry(c);if(ToolBox.cookie("settings.texteditor.backup")!="no"&&g.data("size")!=0){ToolBox.refreshFileListEntry(c+".backup")}}else{updateFileList()}ToolBox.handleJSONResponse(h)}).always(function(){e.remove()});ToolBox.renderAbortDialog(d)}function a(e){var d=ToolBox.blockPage();var c=$.get($("#fileList").attr("data-uri"),{action:"edit",filename:e.attr("data-file")},function(f){d.remove();if(f.message||f.error){ToolBox.handleJSONResponse(f)}else{var g=$(f);var h=$(".textdata",g);h.data("response",h.val());g.find(".action.savetextdata").button().off("click").click(function(i){ToolBox.preventDefault(i);if(ToolBox.cookie("settings.confirm.save")!="no"){ToolBox.confirmDialog($("#confirmsavetextdata").html().replace(/%s/,e.attr("data-file")),{confirm:function(){b(e,h)},setting:"settings.confirm.save"})}else{b(e,h)}});g.find(".action.cancel-edit").button().off("click").click(function(i){ToolBox.preventDefault(i);h.trigger("editsubmit");g.dialog("close")});$(window).on("unload.handleFileEdit beforeunload.handleFileEdit",function(i){h.trigger("editsubmit");if(h.data("response")==h.val()){return}return $("#beforeunload").html().replace(/%s/,e.attr("data-file"))});g.dialog({modal:true,width:"auto",height:"auto",title:e.attr("data-file"),closeText:$("#close").html(),open:function(){h.trigger("editstart")},close:function(i){h.trigger("editdone")},beforeClose:function(i,j){$(window).off("unload.handleFileEdit beforeunload.handleFileEdit");return h.val()==h.data("response")||window.confirm($("#canceledit").html())}})}});ToolBox.renderAbortDialog(c)}});
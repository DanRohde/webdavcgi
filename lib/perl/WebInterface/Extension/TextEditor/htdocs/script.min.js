$(document).ready(function(){$("body").on("fileActionEvent",function(c,d){if(d.obj.hasClass("edit")){a(d.row)}});function b(e,c,g,d){g.trigger("editsubmit");var f=$.MyPost(ToolBox.addMissingSlash(e),{action:"savetextdata",filename:c,textdata:g.val()},function(h){if(!h.error&&h.message){g.data("response",g.val());if($("#fileList").attr("data-uri")==e){ToolBox.refreshFileListEntry(c);if(ToolBox.cookie("settings.texteditor.backup")!="no"&&d!=0){ToolBox.refreshFileListEntry(c+".backup")}}}else{updateFileList()}ToolBox.handleJSONResponse(h)});ToolBox.renderAbortDialog(f)}function a(g){var e=$("#fileList").attr("data-uri");var c=g.attr("data-file");var d=g.data("size");var f=$.MyPost(e,{action:"edit",filename:c},function(h){if(h.message||h.error){ToolBox.handleJSONResponse(h)}else{var i=$(h);var j=$(".textdata",i);j.data("response",j.val());i.find(".action.savetextdata").button().off("click").click(function(k){$.MyPreventDefault(k);if(ToolBox.cookie("settings.confirm.save")!="no"){ToolBox.confirmDialog($("#confirmsavetextdata").html().replace(/%s/,ToolBox.quoteWhiteSpaces(g.attr("data-file"))),{confirm:function(){b(e,c,j,d)},setting:"settings.confirm.save"})}else{b(e,c,j,d)}});i.find(".action.cancel-edit").button().off("click").click(function(k){$.MyPreventDefault(k);j.trigger("editsubmit");i.dialog("close")});$(window).on("unload.handleFileEdit beforeunload.handleFileEdit",function(k){j.trigger("editsubmit");if(j.data("response")==j.val()){return}return $("#beforeunload").html().replace(/%s/,ToolBox.quoteWhiteSpaces(g.attr("data-file")))});i.dialog({modal:true,width:"auto",height:"auto",dialogClass:"edittextdata",title:g.attr("data-file"),closeText:$("#close").html(),open:function(){j.trigger("editstart")},close:function(k){j.trigger("editdone");i.dialog("destroy")},resize:function(k){j.trigger("editresize")},beforeClose:function(k,l){$(window).off("unload.handleFileEdit beforeunload.handleFileEdit");return j.val()==j.data("response")||window.confirm($("#canceledit").html())}})}});ToolBox.renderAbortDialog(f)}});
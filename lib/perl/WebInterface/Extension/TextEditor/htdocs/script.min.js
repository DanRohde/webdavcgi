$(document).ready(function(){$("body").on("fileActionEvent",function(c,d){if(d.obj.hasClass("edit")){a(d.row)}});function b(e,c,h,d){h.trigger("editsubmit");var g=ToolBox.blockPage();var f=$.post(ToolBox.addMissingSlash(e),{action:"savetextdata",filename:c,textdata:h.val()},function(i){if(!i.error&&i.message){h.data("response",h.val());g.remove();if($("#fileList").attr("data-uri")==e){ToolBox.refreshFileListEntry(c);if(ToolBox.cookie("settings.texteditor.backup")!="no"&&d!=0){ToolBox.refreshFileListEntry(c+".backup")}}}else{updateFileList()}ToolBox.handleJSONResponse(i)}).always(function(){g.remove()});ToolBox.renderAbortDialog(f)}function a(h){var g=ToolBox.blockPage();var e=$("#fileList").attr("data-uri");var c=h.attr("data-file");var d=h.data("size");var f=$.get(e,{action:"edit",filename:c},function(i){g.remove();if(i.message||i.error){ToolBox.handleJSONResponse(i)}else{var j=$(i);var k=$(".textdata",j);k.data("response",k.val());j.find(".action.savetextdata").button().off("click").click(function(l){ToolBox.preventDefault(l);if(ToolBox.cookie("settings.confirm.save")!="no"){ToolBox.confirmDialog($("#confirmsavetextdata").html().replace(/%s/,h.attr("data-file")),{confirm:function(){b(e,c,k,d)},setting:"settings.confirm.save"})}else{b(e,c,k,d)}});j.find(".action.cancel-edit").button().off("click").click(function(l){ToolBox.preventDefault(l);k.trigger("editsubmit");j.dialog("close")});$(window).on("unload.handleFileEdit beforeunload.handleFileEdit",function(l){k.trigger("editsubmit");if(k.data("response")==k.val()){return}return $("#beforeunload").html().replace(/%s/,h.attr("data-file"))});j.dialog({modal:true,width:"auto",height:"auto",title:h.attr("data-file"),closeText:$("#close").html(),open:function(){k.trigger("editstart")},close:function(l){k.trigger("editdone")},beforeClose:function(l,m){$(window).off("unload.handleFileEdit beforeunload.handleFileEdit");return k.val()==k.data("response")||window.confirm($("#canceledit").html())}})}});ToolBox.renderAbortDialog(f)}});
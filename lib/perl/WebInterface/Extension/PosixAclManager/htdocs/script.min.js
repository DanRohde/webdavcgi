$(document).ready(function(){new PosixAclManager()});function PosixAclManager(){this.init()}PosixAclManager.prototype={dialog:null,files:null,init:function(){var b=this;function a(){var c=$("#fileListTable");$("#apps .action.pacl").toggleClass("disabled",c.hasClass("unselectable-yes")||c.hasClass("isreadable-no"))}$("#flt").on("fileListChanged",a);a();$("body").on("fileActionEvent",function(d,e){if(e.obj.hasClass("disabled")){return}if(e.obj.hasClass("pacl")){var c=$("#fileList tr.selected:visible");b.files=c.length>0?$.map(c,function(g,f){return $(g).attr("data-file")}):new Array(!e.file?"":e.file);b.show()}})},show:function(){var a=this;$.post($("#fileList").data("uri"),{ajax:"getPosixAclManager",files:a.files},function(b){a.dialog=$(b);a.initFormHandler();a.dialog.dialog({modal:true,width:"auto",height:"auto",dialogClass:"posixaclmngr",closeText:$("#close").html(),resizable:true,close:function(){a.dialog.dialog("destroy");$(".action.refresh:first").trigger("click")}})})},initFormHandler:function(){var a=this;$("form",a.dialog).on("submit",function(b){return a.handleSubmit(b)});$("input.permissions",a.dialog).change(function(b){if($(this).is(":checked")){$('input.permissions[name="'+$(this).attr("name")+'"][value'+($(this).val()=="---"?"!=":"=")+'"---"]:checked',a.dialog).attr("checked",false)}});$("input[name=pacl_update]",a.dialog).button();$("input.pacl.newacl",a.dialog).autocomplete({minLength:8,source:function(c,b){$.post($("#fileList").data("uri"),{ajax:"searchUserOrGroupEntry",term:c.term},function(d){b(d.result?d.result:[])})}})},handleSubmit:function(e){var b=this;var d=$(".pacl.form",b.dialog);var a=$("input.pacl.newacl");if(a.val()!=""){a.removeClass("error");$(".pacl.newaclpermissions").removeClass("error");if(!a.val().match(/^(user|u|group|g|default|d):/)){a.addClass("error");window.alert($("#pacl_msg_err_usergroup").html());a.focus().select();return false}var c=$('input.permissions[name="newaclpermissions"]:checked');if(c.length==0){$(".pacl.newaclpermissions").addClass("error");window.alert($("#pacl_msg_err_perm").html());return false}}var g=b.blockPage();var f=$.post(d.attr("action"),d.serialize(),function(i){var h=$(i);if(noty){if(i.error){noty({text:i.error.replace(/\r?\n/,"<br/>"),type:"error",layout:"topCenter",timeout:30000})}else{if(i.msg){noty({text:i.msg,type:"info",layout:"topCenter",timeout:30000})}}}g.remove();$.post($("#fileList").data("uri"),{ajax:"getPosixAclManager",files:b.files},function(j){b.dialog.html($(j).unwrap());b.initFormHandler()})});return false},blockPage:function(){return $("<div></div>").prependTo("body").addClass("overlay")}};
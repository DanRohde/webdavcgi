$(document).ready(function(){$(".action.afsgroupmngr").click(a);function a(e){ToolBox.preventDefault(e);var d=$(this).attr("data-template");var f=$("#fileList").attr("data-uri");if($(this).hasClass("disabled")){return false}var c=this;$(".action.afsgroupmngr").addClass("disabled");$.get(f,{ajax:"getAFSGroupManager",template:d},function(g){var h=$(g);b(h,d,f);h.dialog({modal:false,width:"auto",height:"auto",dialogClass:"afsgroupmngr",closeText:$("#close").html(),close:function(){$(".action.afsgroupmngr").removeClass("disabled");h.remove()}}).show()})}function b(e,d,f){var h;var g;h=function(i){if(g){g.remove()}e.html($(i).unwrap());b(e,d,f)};var c=function(i){ToolBox.preventDefault(i);g=ToolBox.blockPage();var j=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:$(this).closest("li").attr("data-group")},h);ToolBox.renderAbortDialog(j)};$("#afsgrouplist li[data-group='"+$("#afsmemberlist").attr("data-afsgrp")+"']").addClass("selected");$("#afsgrouplist .afsgroupdelete",e).hide();$("#afsgrouplist li",e).click(c).hover(function(){$(".afsgroupdelete",$(this)).show()},function(){$(".afsgroupdelete",$(this)).hide()});$(".afsgroupdelete",e).click(function(i){ToolBox.preventDefault(i);var j=$(this).closest("li").attr("data-group");ToolBox.confirmDialog($("#afsconfirmdeletegrp").html(),{confirm:function(){g=ToolBox.blockPage();var k=$.post(f,{afsdeletegrp:1,afsgrp:j},function(l){ToolBox.handleJSONResponse(l);var m=$.get(f,{ajax:"getAFSGroupManager",template:d},h);ToolBox.renderAbortDialog(m)});ToolBox.renderAbortDialog(k)}})});$("input[name='afsnewgrp']",e).focus(function(i){$(this).val($(this).attr("data-user")+":").select()}).keypress(function(i){if(i.keyCode==13){var j=$(this).val();g=ToolBox.blockPage();var k=$.post(f,{afscreatenewgrp:"1",afsnewgrp:j},function(l){ToolBox.handleJSONResponse(l);var m=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:j},h);ToolBox.renderAbortDialog(m)});ToolBox.renderAbortDialog(k)}});$(".afscreatenewgrp",e).click(function(i){ToolBox.preventDefault(i);g=ToolBox.blockPage();var j=$("input[name='afsnewgrp']",e).val();var k=$.post(f,{afscreatenewgrp:"1",afsnewgrp:j},function(l){ToolBox.handleJSONResponse(l);var m=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:l.error?"":j},h);ToolBox.renderAbortDialog(m)});ToolBox.renderAbortDialog(k)});$("input[name='afsaddusers']",e).keypress(function(j){if(j.keyCode==13){g=ToolBox.blockPage();var i=$(this).val();var k=$(this).attr("data-afsgrp");var l=$.post(f,{afsaddusr:1,afsaddusers:i,afsselgrp:k},function(m){ToolBox.handleJSONResponse(m);var n=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:k},h);ToolBox.renderAbortDialog(n)});ToolBox.renderAbortDialog(l)}});$(".afsaddusr",e).click(function(j){g=ToolBox.blockPage();var i=$("input[name='afsaddusers']",e).val();var k=$("input[name='afsaddusers']",e).attr("data-afsgrp");var l=$.post(f,{afsaddusr:1,afsaddusers:i,afsselgrp:k},function(m){ToolBox.handleJSONResponse(m);var n=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:k},h);ToolBox.renderAbortDialog(n)});ToolBox.renderAbortDialog(l)});$(".afsmemberdelete",e).click(function(i){var j=$("#afsmemberlist",e).attr("data-afsgrp");var k=$(this).closest("li").attr("data-member");ToolBox.preventDefault(i);ToolBox.confirmDialog($("#afsconfirmremoveuser").html(),{confirm:function(){g=ToolBox.blockPage();var l=$.post(f,{afsremoveusr:1,afsselgrp:j,afsusr:k},function(m){ToolBox.handleJSONResponse(m);var n=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:j},h);ToolBox.renderAbortDialog(n)});ToolBox.renderAbortDialog(l)}})});$(".afsremoveselectedmembers",e).toggleClass("disabled",$("#afsmemberlist li.selected",e).length==0).click(function(j){ToolBox.preventDefault(j);if($(this).hasClass("disabled")){return}var i=$.map($("#afsmemberlist li.selected",e),function(m,l){return $(m).attr("data-member")});var k=$("#afsmemberlist").attr("data-afsgrp");ToolBox.confirmDialog($("#afsconfirmremoveuser").html(),{confirm:function(){g=ToolBox.blockPage();var l=$.post(f,{afsremoveusr:1,afsselgrp:k,afsusr:i},function(m){ToolBox.handleJSONResponse(m);var n=$.get(f,{ajax:"getAFSGroupManager",template:d,afsgrp:k},h);ToolBox.renderAbortDialog(n)});ToolBox.renderAbortDialog(l)}})});$("#afsmemberlist li .afsmemberdelete",e).hide();$("#afsmemberlist li",e).click(function(i){$(this).toggleClass("selected");$(".afsremoveselectedmembers",e).toggleClass("disabled",$("#afsmemberlist li.selected").length==0)}).hover(function(){$(".afsmemberdelete",$(this)).show()},function(){$(".afsmemberdelete",$(this)).hide()});$("#afsgroupmanager",e).submit(function(i){return false})}});
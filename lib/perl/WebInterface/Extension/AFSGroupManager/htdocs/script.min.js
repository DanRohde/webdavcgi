(function(d){d(".action.afsgroupmngr").click(b);function b(f){d.MyPreventDefault(f);var e=d(this).attr("data-template");var g=d("#fileList").attr("data-uri");if(d(this).hasClass("disabled")){return false}d(".action.afsgroupmngr").addClass("disabled");d.MyPost(g,{ajax:"getAFSGroupManager",template:e},function(h){var i=d(h);c(i,g,e);i.dialog({modal:false,width:"auto",height:"auto",dialogClass:"afsgroupmngr",closeText:d("#close").html(),close:function(){d(".action.afsgroupmngr").removeClass("disabled");i.remove()}}).show()});return true}function a(g,i,f,j){var h=d.extend({ajax:"getAFSGroupManager",template:f},j);var e=d.MyPost(i,h,function(k){g.html(d(k).unwrap());c(g,i,f)});ToolBox.renderAbortDialog(e)}function c(g,h,f){var e=function(i){d.MyPreventDefault(i);a(g,h,f,{afsgrp:d(this).closest("li").attr("data-group")})};d("#afsgrouplist li[data-group='"+d("#afsmemberlist").attr("data-afsgrp")+"']").addClass("selected");d("#afsgrouplist .afsgroupdelete",g).hide();d("#afsgrouplist li",g).click(e).hover(function(){d(".afsgroupdelete",d(this)).show()},function(){d(".afsgroupdelete",d(this)).hide()});d(".afsgroupdelete",g).click(function(i){d.MyPreventDefault(i);var j=d(this).closest("li").attr("data-group");ToolBox.confirmDialog(d("#afsconfirmdeletegrp").html(),{confirm:function(){var k=d.MyPost(h,{afsdeletegrp:1,afsgrp:j},function(l){ToolBox.handleJSONResponse(l);a(g,h,f)});ToolBox.renderAbortDialog(k)}})});d("input[name='afsnewgrp']",g).focus(function(){d(this).val(d(this).attr("data-user")+":").select()}).keypress(function(i){if(i.keyCode===13){var j=d(this).val();var k=d.MyPost(h,{afscreatenewgrp:1,afsnewgrp:j},function(l){ToolBox.handleJSONResponse(l);a(g,h,f,{afsgrp:j})});ToolBox.renderAbortDialog(k)}});d(".afscreatenewgrp",g).click(function(i){d.MyPreventDefault(i);var j=d("input[name='afsnewgrp']",g).val();var k=d.MyPost(h,{afscreatenewgrp:"1",afsnewgrp:j},function(l){ToolBox.handleJSONResponse(l);a(g,h,f,{afsgrp:l.error?"":j})});ToolBox.renderAbortDialog(k)});d("input[name='afsaddusers']",g).keypress(function(j){if(j.keyCode==13){var i=d(this).val();var k=d(this).attr("data-afsgrp");var l=d.MyPost(h,{afsaddusr:1,afsaddusers:i,afsselgrp:k},function(m){ToolBox.handleJSONResponse(m);a(g,h,f,{afsgrp:k})});ToolBox.renderAbortDialog(l)}});d(".afsaddusr",g).click(function(){var i=d("input[name='afsaddusers']",g).val();var j=d("input[name='afsaddusers']",g).attr("data-afsgrp");var k=d.MyPost(h,{afsaddusr:1,afsaddusers:i,afsselgrp:j},function(l){ToolBox.handleJSONResponse(l);a(g,h,f,{afsgrp:j})});ToolBox.renderAbortDialog(k)});d(".afsmemberdelete",g).click(function(i){d.MyPreventDefault(i);var j=d("#afsmemberlist",g).attr("data-afsgrp");var k=d(this).closest("li").attr("data-member");ToolBox.confirmDialog(d("#afsconfirmremoveuser").html(),{confirm:function(){var l=d.MyPost(h,{afsremoveusr:1,afsselgrp:j,afsusr:k},function(m){ToolBox.handleJSONResponse(m);a(g,h,f,{afsgrp:j})});ToolBox.renderAbortDialog(l)}})});d(".afsremoveselectedmembers",g).toggleClass("disabled",d("#afsmemberlist li.selected",g).length===0).click(function(j){d.MyPreventDefault(j);if(d(this).hasClass("disabled")){return}var i=d.map(d("#afsmemberlist li.selected",g),function(l){return d(l).data("member")});var k=d("#afsmemberlist").attr("data-afsgrp");ToolBox.confirmDialog(d("#afsconfirmremoveuser").html(),{confirm:function(){var l=d.MyPost(h,{afsremoveusr:1,afsselgrp:k,afsusr:i},function(m){ToolBox.handleJSONResponse(m);a(g,h,f,{afsgrp:k})});ToolBox.renderAbortDialog(l)}})});d("#afsmemberlist li .afsmemberdelete",g).hide();d("#afsmemberlist li",g).click(function(){d(this).toggleClass("selected");d(".afsremoveselectedmembers",g).toggleClass("disabled",d("#afsmemberlist li.selected").length===0)}).hover(function(){d(".afsmemberdelete",d(this)).show()},function(){d(".afsmemberdelete",d(this)).hide()});d("#afsgroupmanager",g).submit(function(){return false})}}(jQuery));
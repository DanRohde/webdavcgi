$(document).ready(function(){$(".action.markcolorpicker").iris({hide:true,palettes:true,color:"#ff0000",change:function(l,k){var j=$(this);if(j.data("quiet")){j.data("quiet",false);return}i(ToolBox.getSelectedRows(j),j.data("style"),k.color.toString());window.clearTimeout(j.data("timeout"));j.data("timeout",window.setTimeout(function(){h(ToolBox.getSelectedRows(j),j.data("style"),k.color.toString());f(ToolBox.getSelectedFiles(j),j.data("style"),k.color.toString())},2000))}});$(".action.mark").on("click",function(m){ToolBox.preventDefault(m);var j=$(this);var l=ToolBox.getSelectedFiles(this);var o=ToolBox.getSelectedRows(this);var k=j.data("style");var n=j.data("value");i(o,k,n);h(o,k,n);f(l,k,n)});$(".action.removemarks").on("click",function(n){ToolBox.preventDefault(n);var j=$(this);var m=ToolBox.getSelectedFiles(this);var o=ToolBox.getSelectedRows(this);var l=j.data("styles").split(",");for(var k=0;k<l.length;k++){i(o,l[k],"");g(o,l[k])}$.post(window.location.pathname,{action:"removemarks",styles:j.data("styles"),files:m},a)});$(".action.markcolorpicker").on("click",function(j){ToolBox.preventDefault(j);$(this).iris("toggle")});$(".action.replacemarks").on("click",function(o){ToolBox.preventDefault(o);var k=$(this);var n=ToolBox.getSelectedFiles(this);var q=ToolBox.getSelectedRows(this);var p=$(window).data("highlighter.transfer");if(p){$(".action.replacemarks").removeClass("active");var m=k.data("styles").split(",");for(var l=0;l<m.length;l++){i(q,m[l],"");g(q,m[l])}for(var j in p){h(q,j,p[j]);i(q,j,p[j])}$.post(window.location.pathname,{action:"replacemarks",files:n,style:JSON.stringify(p)},a);$(window).removeData("highlighter.transfer")}else{$(".action.replacemarks").addClass("active");$(window).data("highlighter.transfer",c(q))}});$(".action.savemarksaspreset").on("click",function(l){ToolBox.preventDefault(l);var j=$(this);var m=ToolBox.getSelectedRows(this);var k=window.prompt(j.data("name"));if(k&&k.trim()!=""){var n=ToolBox.blockPage();$.post(window.location.pathname,{action:"savemarksaspreset",name:k,data:JSON.stringify(c(m))},function(o){n.remove();a(o);d()})}});b();$("#flt").on("fileListChanged",e);e();$("#flt").on("popupmenu",function(j,k){if($(k).hasClass("highlighter-highlighted")){$(".action.markcolorpicker").each(function(m,l){color=$($(k).data("highlighter")).attr($(l).data("style"));if(color){$(l).data("quiet",true);$(l).iris("option","color",color)}})}});function b(){$(".action.markwithpreset").on("click",function(n){ToolBox.preventDefault(n);var j=$(this);var o=ToolBox.getSelectedRows(this);var m=$(".highlighter-popup .removemarks").last().data("styles").split(",");for(var k=0;k<m.length;k++){i(o,m[k],"");g(o,m[k])}m=j.data("style");for(var l in m){h(o,l,m[l]);i(o,l,m[l])}$.post(window.location.pathname,{action:"replacemarks",style:JSON.stringify(j.data("style")),files:ToolBox.getSelectedFiles(this)},a)});$(".action.managepresets").on("click",function(k){ToolBox.preventDefault(k);var s=$(this);var n=$(s.data("template"));var j=$("#highlighter-preset-manager-preset-template",n).html();var m=s.data("presets");var p=Object.keys(m).sort();for(var l=0;l<p.length;l++){var q=p[l];var r=m[q];var o=$(j);$(".highlighter-preset-entry-name",o).text(q).attr("title",q+": "+r).css(JSON.parse(r));$(".highlighter-preset-entry-delete",o).attr("data-preset",q).on("click",function(v){ToolBox.preventDefault(v);var t=$(this);var u=t.data("preset");ToolBox.confirmDialog(t.data("confirm").replace("%s",u),{confirm:function(){var w=ToolBox.blockPage();t.parent(".highlighter-preset-entry").remove();$.post(window.location.href,{action:"deletepreset",preset:u},function(x){w.remove();a(x);if(x.error){window.location.reload(true)}else{n.data("changes",true)}})}})});$("#highlighter-preset-manager-entries",n).append(o)}n.dialog({modal:true,width:"auto",dialogClass:"highlighter-preset-manager-dialog",closeText:$("#close").html(),dialogClass:"managepresets",close:function(){if(n.data("changes")){d()}}});n.MyTooltip(500)})}function d(){$.get(window.location.pathname,{},function(j){$(".toolbar .highlighter.subpreset").html($(".toolbar .highlighter.subpreset",j).html());$("#popupmenu .highlighter.subpreset").html($("#popupmenu .highlighter.subpreset",j).html());b()})}function c(k){var j=Object();k.filter(".highlighter-highlighted").each(function(n,m){var o=$(m);var p=o.data("highlighter");for(var l in p){j[l]=p[l]}});return j}function i(l,j,k){if(j=="background"){l.css(j,k)}else{if(j=="transform"){$("td",l).css(j,k)}else{$("td",l.css(j,k)).css(j,k)}}return l}function e(){$(".highlighter-highlighted").each(function(m,l){var k=$(l);var n=k.data("highlighter");for(var j in n){i(k,j,n[j])}})}function a(j){ToolBox.handleJSONResponse(j);if(j.error){ToolBox.updateFileList()}}function g(k,j){var l=k.data("highlighter");if(!l){return false}delete l[j];k.data("highlighter",l);return true}function h(l,k,j){var m=l.data("highlighter");if(!m){m=new Object()}m[k]=j;l.data("highlighter",m).addClass("highlighter-highlighted")}function f(k,j,l){$.post(window.location.pathname,{action:"mark",style:j,value:l,files:k},a)}});
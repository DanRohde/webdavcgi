$(document).ready(function(){$(".action.markcolorpicker").iris({hide:true,palettes:true,color:"#ff0000",change:function(i,h){var g=$(this);if(g.data("quiet")){g.data("quiet",false);return}$("td,a.changeuri",ToolBox.getSelectedRows(g)).css(g.data("style"),h.color.toString());window.clearTimeout(g.data("timeout"));g.data("timeout",window.setTimeout(function(){e(ToolBox.getSelectedRows(g),g.data("style"),h.color.toString());a(ToolBox.getSelectedFiles(g),g.data("style"),h.color.toString())},2000))}});$("body").on("fileActionEvent",function(k,m){var v=$(m.obj);if(m.obj.hasClass("mark")){var l=ToolBox.getSelectedFiles(m.obj);var w=ToolBox.getSelectedRows(m.obj);$("td,a.changeuri",w).css(v.data("style"),v.data("value"));ToolBox.hidePopupMenu();e(w,v.data("style"),v.data("value"));a(l,v.data("style"),v.data("value"))}else{if(m.obj.hasClass("removemarks")){var l=ToolBox.getSelectedFiles(m.obj);var w=ToolBox.getSelectedRows(m.obj);var u=v.data("styles").split(",");for(var n=0;n<u.length;n++){$("td,a.changeuri",w).css(u[n],"");f(w,u[n])}ToolBox.hidePopupMenu();$.post(window.location.pathname,{action:"removemarks",styles:v.data("styles"),files:l},c)}else{if(m.obj.hasClass("markcolorpicker")){m.obj.iris("toggle")}else{if(m.obj.hasClass("transfermarks")){var l=ToolBox.getSelectedFiles(m.obj);var w=ToolBox.getSelectedRows(m.obj);var m=$(window).data("highlighter.transfer");ToolBox.hidePopupMenu();if(m){$(".action.transfermarks").removeClass("active");var u=v.data("styles").split(",");for(var n=0;n<u.length;n++){$("td,a.changeuri",w).css(u[n],"");f(w,u[n])}for(var q in m){e(w,q,m[q]);$("td,a.changeuri",w).css(q,m[q])}$.post(window.location.pathname,{action:"transfermarks",files:l,style:JSON.stringify(m)},c);$(window).removeData("highlighter.transfer")}else{$(".action.transfermarks").addClass("active");$(window).data("highlighter.transfer",b(w))}}else{if(m.obj.hasClass("savemarksaspreset")){var w=ToolBox.getSelectedRows(m.obj);var j=window.prompt(v.data("name"));if(j&&j.trim()!=""){$.post(window.location.pathname,{action:"savemarksaspreset",name:j,data:JSON.stringify(b(w))},function(i){c(i);window.location.reload(true)})}}else{if(m.obj.hasClass("markwithpreset")){var w=ToolBox.getSelectedRows(m.obj);var u=v.data("style");for(var h in u){e(w,h,u[h]);$("td,a.changeuri",w).css(h,u[h])}$.post(window.location.pathname,{action:"transfermarks",style:JSON.stringify(v.data("style")),files:ToolBox.getSelectedFiles(m.obj)},c)}else{if(m.obj.hasClass("managepresets")){var p=$(v.data("template"));var g=$("#highlighter-preset-manager-preset-template",p).html();var o=v.data("presets");var s=Object.keys(o).sort();for(var n=0;n<s.length;n++){var t=s[n];var u=o[t];var r=$(g);$(".highlighter-preset-entry-name",r).text(t).attr("title",t+": "+u).css(JSON.parse(u));$(".highlighter-preset-entry-delete",r).attr("data-preset",t).on("click",function(y){ToolBox.preventDefault(y);var i=$(this);var x=i.data("preset");ToolBox.confirmDialog(i.data("confirm").replace("%s",x),{confirm:function(){i.parent(".highlighter-preset-entry").remove();$.post(window.location.href,{action:"deletepreset",preset:x},function(z){c(z);if(z.error){window.location.reload(true)}else{p.data("changes",true)}})}})});$("#highlighter-preset-manager-entries",p).append(r)}p.dialog({modal:true,width:"auto",dialogClass:"highlighter-preset-manager-dialog",closeText:$("#close").html(),dialogClass:"managepresets",close:function(){if(p.data("changes")){window.location.reload(true)}}});p.MyTooltip(500)}}}}}}}});$("#flt").on("fileListChanged",d);d();$("#flt").on("popupmenu",function(g,h){if($(h).hasClass("highlighter-highlighted")){$(".action.markcolorpicker").each(function(k,j){color=$($(h).data("highlighter")).attr($(j).data("style"));if(color){$(j).data("quiet",true);$(j).iris("option","color",color)}})}});function b(h){var g=Object();h.filter(".highlighter-highlighted").each(function(l,k){var m=$(k);var n=m.data("highlighter");for(var j in n){g[j]=n[j]}});return g}function d(){$(".highlighter-highlighted").each(function(k,j){var h=$(j);var l=h.data("highlighter");for(var g in l){$("td,a.changeuri",h).css(g,l[g])}})}function c(g){ToolBox.handleJSONResponse(g);if(g.error){ToolBox.updateFileList()}}function f(h,g){var i=h.data("highlighter");if(!i){return false}delete i[g];h.data("highlighter",i);return true}function e(i,h,g){var j=i.data("highlighter");if(!j){j=new Object()}j[h]=g;i.data("highlighter",j).addClass("highlighter-highlighted")}function a(h,g,i){$.post(window.location.pathname,{action:"mark",style:g,value:i,files:h},c)}});
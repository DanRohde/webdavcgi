$(document).ready(function(){$(".action.markcolorpicker").iris({hide:true,palettes:true,color:"#ff0000",change:function(j,i){var h=$(this);if(h.data("quiet")){h.data("quiet",false);return}$("td,a.changeuri",ToolBox.getSelectedRows(h)).css(h.data("style"),i.color.toString());window.clearTimeout(h.data("timeout"));h.data("timeout",window.setTimeout(function(){e(ToolBox.getSelectedRows(h),h.data("style"),i.color.toString());a(ToolBox.getSelectedFiles(h),h.data("style"),i.color.toString())},2000))}});$("body").on("fileActionEvent",function(l,o){var x=$(o.obj);if(o.obj.hasClass("mark")){var m=ToolBox.getSelectedFiles(o.obj);var y=ToolBox.getSelectedRows(o.obj);$("td,a.changeuri",y).css(x.data("style"),x.data("value"));e(y,x.data("style"),x.data("value"));a(m,x.data("style"),x.data("value"))}else{if(o.obj.hasClass("removemarks")){var m=ToolBox.getSelectedFiles(o.obj);var y=ToolBox.getSelectedRows(o.obj);var w=x.data("styles").split(",");for(var p=0;p<w.length;p++){$("td,a.changeuri",y).css(w[p],"");g(y,w[p])}$.post(window.location.pathname,{action:"removemarks",styles:x.data("styles"),files:m},c)}else{if(o.obj.hasClass("markcolorpicker")){o.obj.iris("toggle")}else{if(o.obj.hasClass("replacemarks")){var m=ToolBox.getSelectedFiles(o.obj);var y=ToolBox.getSelectedRows(o.obj);var o=$(window).data("highlighter.transfer");if(o){$(".action.replacemarks").removeClass("active");var w=x.data("styles").split(",");for(var p=0;p<w.length;p++){$("td,a.changeuri",y).css(w[p],"");g(y,w[p])}for(var s in o){e(y,s,o[s]);$("td,a.changeuri",y).css(s,o[s])}$.post(window.location.pathname,{action:"replacemarks",files:m,style:JSON.stringify(o)},c);$(window).removeData("highlighter.transfer")}else{$(".action.replacemarks").addClass("active");$(window).data("highlighter.transfer",b(y))}}else{if(o.obj.hasClass("savemarksaspreset")){var y=ToolBox.getSelectedRows(o.obj);var k=window.prompt(x.data("name"));if(k&&k.trim()!=""){var n=ToolBox.blockPage();$.post(window.location.pathname,{action:"savemarksaspreset",name:k,data:JSON.stringify(b(y))},function(i){n.remove();c(i);f()})}}else{if(o.obj.hasClass("markwithpreset")){var y=ToolBox.getSelectedRows(o.obj);var w=$(".highlighter-popup .removemarks").data("styles").split(",");for(var p=0;p<w.length;p++){$("td,a.changeuri",y).css(w[p],"");g(y,w[p])}w=x.data("style");for(var j in w){e(y,j,w[j]);$("td,a.changeuri",y).css(j,w[j])}$.post(window.location.pathname,{action:"replacemarks",style:JSON.stringify(x.data("style")),files:ToolBox.getSelectedFiles(o.obj)},c)}else{if(o.obj.hasClass("managepresets")){var r=$(x.data("template"));var h=$("#highlighter-preset-manager-preset-template",r).html();var q=x.data("presets");var u=Object.keys(q).sort();for(var p=0;p<u.length;p++){var v=u[p];var w=q[v];var t=$(h);$(".highlighter-preset-entry-name",t).text(v).attr("title",v+": "+w).css(JSON.parse(w));$(".highlighter-preset-entry-delete",t).attr("data-preset",v).on("click",function(A){ToolBox.preventDefault(A);var i=$(this);var z=i.data("preset");ToolBox.confirmDialog(i.data("confirm").replace("%s",z),{confirm:function(){var B=ToolBox.blockPage();i.parent(".highlighter-preset-entry").remove();$.post(window.location.href,{action:"deletepreset",preset:z},function(C){B.remove();c(C);if(C.error){window.location.reload(true)}else{r.data("changes",true)}})}})});$("#highlighter-preset-manager-entries",r).append(t)}r.dialog({modal:true,width:"auto",dialogClass:"highlighter-preset-manager-dialog",closeText:$("#close").html(),dialogClass:"managepresets",close:function(){if(r.data("changes")){f()}}});r.MyTooltip(500)}}}}}}}});$("#flt").on("fileListChanged",d);d();$("#flt").on("popupmenu",function(h,i){if($(i).hasClass("highlighter-highlighted")){$(".action.markcolorpicker").each(function(k,j){color=$($(i).data("highlighter")).attr($(j).data("style"));if(color){$(j).data("quiet",true);$(j).iris("option","color",color)}})}});function f(){$.get(window.location.pathname,{},function(h){$(".highlighter.preset").html($(".highlighter.preset",h).html());ToolBox.initPopupMenu()})}function b(i){var h=Object();i.filter(".highlighter-highlighted").each(function(l,k){var m=$(k);var n=m.data("highlighter");for(var j in n){h[j]=n[j]}});return h}function d(){$(".highlighter-highlighted").each(function(l,k){var j=$(k);var m=j.data("highlighter");for(var h in m){$("td,a.changeuri",j).css(h,m[h])}})}function c(h){ToolBox.handleJSONResponse(h);if(h.error){ToolBox.updateFileList()}}function g(i,h){var j=i.data("highlighter");if(!j){return false}delete j[h];i.data("highlighter",j);return true}function e(j,i,h){var k=j.data("highlighter");if(!k){k=new Object()}k[i]=h;j.data("highlighter",k).addClass("highlighter-highlighted")}function a(i,h,j){$.post(window.location.pathname,{action:"mark",style:h,value:j,files:i},c)}});
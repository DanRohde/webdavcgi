$(document).ready(function(){$(".action.markcolorpicker").iris({hide:true,palettes:true,color:"#ff0000",change:function(h,g){var f=$(this);if(f.data("quiet")){f.data("quiet",false);return}$("td,a.changeuri",ToolBox.getSelectedRows(f)).css(f.data("style"),g.color.toString());window.clearTimeout(f.data("timeout"));f.data("timeout",window.setTimeout(function(){d(ToolBox.getSelectedRows(f),f.data("style"),g.color.toString());a(ToolBox.getSelectedFiles(f),f.data("style"),g.color.toString())},2000))}});$("body").on("fileActionEvent",function(l,n){if(n.obj.hasClass("mark")){var g=$(n.obj);var k=ToolBox.getSelectedFiles(n.obj);var m=ToolBox.getSelectedRows(n.obj);$("td,a.changeuri",m).css(g.data("style"),g.data("value"));ToolBox.hidePopupMenu();d(m,g.data("style"),g.data("value"));a(k,g.data("style"),g.data("value"))}else{if(n.obj.hasClass("removemarks")){var g=$(n.obj);var k=ToolBox.getSelectedFiles(n.obj);var m=ToolBox.getSelectedRows(n.obj);var j=g.data("styles").split(",");for(var h=0;h<j.length;h++){$("td,a.changeuri",m).css(j[h],"");e(m,j[h])}ToolBox.hidePopupMenu();$.post(window.location.pathname,{action:"removemarks",styles:g.data("styles"),files:k},b)}else{if(n.obj.hasClass("markcolorpicker")){n.obj.iris("toggle")}else{if(n.obj.hasClass("transfermarks")){var g=$(n.obj);var k=ToolBox.getSelectedFiles(n.obj);var m=ToolBox.getSelectedRows(n.obj);var n=$(window).data("highlighter.transfer");ToolBox.hidePopupMenu();if(n){$(".action.transfermarks").removeClass("active");var j=g.data("styles").split(",");for(var h=0;h<j.length;h++){$("td,a.changeuri",m).css(j[h],"");e(m,j[h])}for(var f in n){d(m,f,n[f]);$("td,a.changeuri",m).css(f,n[f])}$.post(window.location.pathname,{action:"transfermarks",files:k,data:JSON.stringify(n)},b);$(window).removeData("highlighter.transfer")}else{n=new Object();$(".action.transfermarks").addClass("active");m.filter(".highlighter-highlighted").each(function(q,p){var r=$(p);var t=r.data("highlighter");for(var o in t){n[o]=t[o]}});$(window).data("highlighter.transfer",n)}}}}}});$("#flt").on("fileListChanged",c);c();$("#flt").on("popupmenu",function(f,g){if($(g).hasClass("highlighter-highlighted")){$(".action.markcolorpicker").each(function(j,h){color=$($(g).data("highlighter")).attr($(h).data("style"));if(color){$(h).data("quiet",true);$(h).iris("option","color",color)}})}});function c(){$(".highlighter-highlighted").each(function(j,h){var g=$(h);var k=g.data("highlighter");for(var f in k){$("td,a.changeuri",g).css(f,k[f])}})}function b(f){ToolBox.handleJSONResponse(f);if(f.error){ToolBox.updateFileList()}}function e(g,f){var h=g.data("highlighter");if(!h){return false}delete h[f];g.data("highlighter",h);return true}function d(h,g,f){var i=h.data("highlighter");if(!i){i=new Object()}i[g]=f;h.data("highlighter",i).addClass("highlighter-highlighted")}function a(g,f,h){$.post(window.location.pathname,{action:"mark",style:f,value:h,files:g},b)}});
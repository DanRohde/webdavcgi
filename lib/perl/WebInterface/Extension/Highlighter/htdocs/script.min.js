$(document).ready(function(){$(".action.markcolorpicker").iris({hide:true,palettes:true,color:"#ff0000",change:function(k,j){var i=$(this);if(i.data("quiet")){i.data("quiet",false);return}$("td,a.changeuri",ToolBox.getSelectedRows(i)).css(i.data("style"),j.color.toString());window.clearTimeout(i.data("timeout"));i.data("timeout",window.setTimeout(function(){e(ToolBox.getSelectedRows(i),i.data("style"),j.color.toString());a(ToolBox.getSelectedFiles(i),i.data("style"),j.color.toString())},2000))}});$(".action.mark").on("click",function(l){var i=$(this);var k=ToolBox.getSelectedFiles(this);var n=ToolBox.getSelectedRows(this);var j=i.data("style");var m=i.data("value");$("td,a.changeuri",n).css(j,m);e(n,j,m);a(k,j,m)});$(".action.removemarks").on("click",function(n){var j=$(this);var m=ToolBox.getSelectedFiles(this);var o=ToolBox.getSelectedRows(this);var l=j.data("styles").split(",");for(var k=0;k<l.length;k++){$("td,a.changeuri",o).css(l[k],"");h(o,l[k])}$.post(window.location.pathname,{action:"removemarks",styles:j.data("styles"),files:m},c)});$(".action.markcolorpicker").on("click",function(i){ToolBox.preventDefault(i);console.log("markcolorpicker");$(this).iris("toggle")});$(".action.replacemarks").on("click",function(o){var k=$(this);var n=ToolBox.getSelectedFiles(this);var q=ToolBox.getSelectedRows(this);var p=$(window).data("highlighter.transfer");if(p){$(".action.replacemarks").removeClass("active");var m=k.data("styles").split(",");for(var l=0;l<m.length;l++){$("td,a.changeuri",q).css(m[l],"");h(q,m[l])}for(var j in p){e(q,j,p[j]);$("td,a.changeuri",q).css(j,p[j])}$.post(window.location.pathname,{action:"replacemarks",files:n,style:JSON.stringify(p)},c);$(window).removeData("highlighter.transfer")}else{$(".action.replacemarks").addClass("active");$(window).data("highlighter.transfer",b(q))}});$(".action.savemarksaspreset").on("click",function(k){var i=$(this);var l=ToolBox.getSelectedRows(this);var j=window.prompt(i.data("name"));if(j&&j.trim()!=""){var m=ToolBox.blockPage();$.post(window.location.pathname,{action:"savemarksaspreset",name:j,data:JSON.stringify(b(l))},function(n){m.remove();c(n);g()})}});f();$("#flt").on("fileListChanged",d);d();$("#flt").on("popupmenu",function(i,j){if($(j).hasClass("highlighter-highlighted")){$(".action.markcolorpicker").each(function(l,k){color=$($(j).data("highlighter")).attr($(k).data("style"));if(color){$(k).data("quiet",true);$(k).iris("option","color",color)}})}});function f(){$(".action.markwithpreset").on("click",function(n){var j=$(this);var o=ToolBox.getSelectedRows(this);var m=$(".highlighter-popup .removemarks").last().data("styles").split(",");for(var k=0;k<m.length;k++){$("td,a.changeuri",o).css(m[k],"");h(o,m[k])}m=j.data("style");for(var l in m){e(o,l,m[l]);$("td,a.changeuri",o).css(l,m[l])}$.post(window.location.pathname,{action:"replacemarks",style:JSON.stringify(j.data("style")),files:ToolBox.getSelectedFiles(this)},c)});$(".action.managepresets").on("click",function(k){var s=$(this);var n=$(s.data("template"));var j=$("#highlighter-preset-manager-preset-template",n).html();var m=s.data("presets");var p=Object.keys(m).sort();for(var l=0;l<p.length;l++){var q=p[l];var r=m[q];var o=$(j);$(".highlighter-preset-entry-name",o).text(q).attr("title",q+": "+r).css(JSON.parse(r));$(".highlighter-preset-entry-delete",o).attr("data-preset",q).on("click",function(u){ToolBox.preventDefault(u);var i=$(this);var t=i.data("preset");ToolBox.confirmDialog(i.data("confirm").replace("%s",t),{confirm:function(){var v=ToolBox.blockPage();i.parent(".highlighter-preset-entry").remove();$.post(window.location.href,{action:"deletepreset",preset:t},function(w){v.remove();c(w);if(w.error){window.location.reload(true)}else{n.data("changes",true)}})}})});$("#highlighter-preset-manager-entries",n).append(o)}n.dialog({modal:true,width:"auto",dialogClass:"highlighter-preset-manager-dialog",closeText:$("#close").html(),dialogClass:"managepresets",close:function(){if(n.data("changes")){g()}}});n.MyTooltip(500)})}function g(){$.get(window.location.pathname,{},function(i){$("#popupmenu .highlighter.preset").html($("#popupmenu .highlighter.preset",i).html());$(".toolbar .highlighter.preset").html($(".toolbar .highlighter.preset",i).html());f()})}function b(j){var i=Object();j.filter(".highlighter-highlighted").each(function(m,l){var n=$(l);var o=n.data("highlighter");for(var k in o){i[k]=o[k]}});return i}function d(){$(".highlighter-highlighted").each(function(m,l){var k=$(l);var n=k.data("highlighter");for(var j in n){$("td,a.changeuri",k).css(j,n[j])}})}function c(i){ToolBox.handleJSONResponse(i);if(i.error){ToolBox.updateFileList()}}function h(j,i){var k=j.data("highlighter");if(!k){return false}delete k[i];j.data("highlighter",k);return true}function e(k,j,i){var l=k.data("highlighter");if(!l){l=new Object()}l[j]=i;k.data("highlighter",l).addClass("highlighter-highlighted")}function a(j,i,k){$.post(window.location.pathname,{action:"mark",style:i,value:k,files:j},c)}});
$(document).ready(function(){$(".action.markcolorpicker").iris({hide:true,palettes:true,color:"#ff0000",change:function(h,g){var f=$(this);if(f.data("quiet")){f.data("quiet",false);return}$("td,a.changeuri",ToolBox.getSelectedRows(f)).css(f.data("style"),g.color.toString());window.clearTimeout(f.data("timeout"));f.data("timeout",window.setTimeout(function(){d(ToolBox.getSelectedRows(f),f.data("style"),g.color.toString());a(ToolBox.getSelectedFiles(f),f.data("style"),g.color.toString())},2000))}});$("body").on("fileActionEvent",function(h,j){if(j.obj.hasClass("mark")){var f=$(j.obj);var g=ToolBox.getSelectedFiles(j.obj);var i=ToolBox.getSelectedRows(j.obj);$("td,a.changeuri",i).css(f.data("style"),f.data("value"));ToolBox.hidePopupMenu();d(i,f.data("style"),f.data("value"));a(g,f.data("style"),f.data("value"))}else{if(j.obj.hasClass("removemark")){var f=$(j.obj);var g=ToolBox.getSelectedFiles(j.obj);var i=ToolBox.getSelectedRows(j.obj);$("td,a.changeuri",i).css(f.data("style"),"");if(e(i,f.data("style"))){ToolBox.hidePopupMenu();$.post(window.location.pathname,{action:"removemark",style:f.data("style"),files:g},b)}}else{if(j.obj.hasClass("markcolorpicker")){j.obj.iris("toggle")}}}});$("#flt").on("fileListChanged",c);c();$("#flt").on("popupmenu",function(f,g){if($(g).hasClass("highlighter-highlighted")){$(".action.markcolorpicker").each(function(j,h){color=$($(g).data("highlighter")).attr($(h).data("style"));if(color){$(h).data("quiet",true);$(h).iris("option","color",color)}})}});function c(){$(".highlighter-highlighted").each(function(j,h){var g=$(h);var k=g.data("highlighter");for(var f in k){$("td,a.changeuri",g).css(f,k[f])}})}function b(f){ToolBox.handleJSONResponse(f);if(f.error){ToolBox.updateFileList()}}function e(g,f){var h=g.data("highlighter");if(!h){return false}delete h[f];g.data("highlighter",h);return true}function d(h,g,f){var i=h.data("highlighter");if(!i){i=new Object()}i[g]=f;h.data("highlighter",i).addClass("highlighter-highlighted")}function a(g,f,h){$.post(window.location.pathname,{action:"mark",style:f,value:h,files:g},b)}});
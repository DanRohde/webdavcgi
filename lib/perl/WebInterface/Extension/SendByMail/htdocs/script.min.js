$(document).ready(function(){function b(f,e){d(e);$("input[name="+f+"]",e).addClass("error").focus()}function d(e){$("#inputfailure",e).show(1000);window.setTimeout(function(){$("#inputfailure",e).hide(800)},5000)}function c(f,e){if($("input[name="+f+"],textarea[name="+f+"]",e).val().trim()==""){b(f,e);return false}return true}function a(e,g){var f;for(f=0;f<e.length;f++){if(!c(e[f],g)){return false}}return true}$("body").on("fileActionEvent",function(e,f){if(f.obj.hasClass("disabled")){return}if(!f.obj.hasClass("sendbymail")){return}var h=window.location.pathname;var g=ToolBox.blockPage();$(".action.sendbymail").addClass("disabled");$.post(h,{action:"sendbymail",ajax:"preparemail",files:f.selected},function(i){var j=$(i);g.remove();$(".action.sendbymail").removeClass("disabled");$("input[name=download]",j).click(function(l){l.preventDefault();j.dialog("close");$("form",j).off("submit").append('<input type="hidden" name="download" value="yes"/>').submit();return false});var k=$("input[name=to],textarea[name=to]",j).autosize().autocomplete({minLength:4,autoFocus:true,source:function(o,m){var l=o.term.split(/\s*,\s*/);var n=l.pop().trim();if(n!=""&&n.length>3){$.post(window.location.pathname,{action:"sendbymail",ajax:"addressbooksearch",query:n},function(p){m(p.result?p.result:new Array())})}else{m(new Array())}},select:function(n,m){ToolBox.preventDefault(n);var l=k.val().split(/\s*,\s*/);l.pop();l.push(m.item.value);k.val(l.join(",\r\n")+"\r\n");return false},focus:function(m,l){ToolBox.preventDefault(m);return false}});$("input",j).on("keydown",function(l){$(this).next("input").focus();return l.which!==13});$("input[name=zipfilename]",j).prop("disabled",true);$("input[name=zip]",j).change(function(){if($(".sendbymail.files.dir",j).length>0){$(this).prop("checked",true)}$("input[name=zipfilename]",j).prop("disabled",!$(this).is(":checked"))});if($(".sendbymail.files.dir",j).length>0){$("input[name=zip]",j).prop("checked",true).trigger("change")}if($(".sendbymail.remove",j).length==1){$(".sendbymail.remove",j).remove()}$(".sendbymail.remove",j).click(function(){$(".sendbymail.sumfilesizes").remove();$(this).parent().remove();if($(".sendbymail.remove",j).length==1){$(".sendbymail.remove",j).remove()}});$("form.sendbymail",j).submit(function(){$("input.error",j).removeClass("error");if(!a(new Array("from","to","subject"),j)){return false}$("input[type=submit]",j).prop("disabled",true);var m=ToolBox.blockPage();var l=$.post(h,$(this).serialize(),function(p){m.remove();var n="info",o=p.msg;if(p.error){n="error";o=p.error;if(p.field){b(p.field,j)}}noty({text:o,type:n,layout:"topCenter",timeout:30000});if(!p.error){j.dialog("close")}else{$("input[type=submit]",j).prop("disabled",false)}});ToolBox.renderAbortDialog(l);return false});j.dialog({modal:true,width:"auto",height:"auto",closeText:$("#close").html()});j.MyTooltip(500)})})});
/*!
Autosize v1.18.9 - 2014-05-27
Automatically adjust textarea height based on user input.
(c) 2014 Jack Moore - http://www.jacklmoore.com/autosize
license: http://www.opensource.org/licenses/mit-license.php
*/
(function(d){var b,f={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},a='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',g=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],c=d(a).data("autosize",!0)[0];c.style.lineHeight="99px","99px"===d(c).css("lineHeight")&&g.push("lineHeight"),c.style.lineHeight="",d.fn.autosize=function(e){return this.length?(e=d.extend({},f,e||{}),c.parentNode!==document.body&&d(document.body).append(c),this.each(function(){function k(){var h,l=window.getComputedStyle?window.getComputedStyle(D,null):!1;l?(h=D.getBoundingClientRect().width,(0===h||"number"!=typeof h)&&(h=parseInt(l.width,10)),d.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(p,o){h-=parseInt(l[o],10)})):h=j.width(),c.style.width=Math.max(h,0)+"px"}function B(){var h={};if(b=D,c.className=e.className,c.id=e.id,t=parseInt(j.css("maxHeight"),10),d.each(g,function(p,o){h[o]=j.css(o)}),d(c).css(h).attr("wrap",j.attr("wrap")),k(),window.chrome){var l=D.style.width;D.style.width="0px",D.offsetWidth,D.style.width=l}}function i(){var h,l;b!==D?B():k(),c.value=!D.value&&e.placeholder?(j.attr("placeholder")||"")+e.append:D.value+e.append,c.style.overflowY=D.style.overflowY,l=parseInt(D.style.height,10),c.scrollTop=0,c.scrollTop=90000,h=c.scrollTop,t&&h>t?(D.style.overflowY="scroll",h=t):(D.style.overflowY="hidden",x>h&&(h=x)),h+=C,l!==h&&(D.style.height=h+"px",s&&e.callback.call(D,D))}function m(){clearTimeout(n),n=setTimeout(function(){var h=j.width();h!==q&&(q=h,i())},parseInt(e.resizeDelay,10))}var t,x,n,D=this,j=d(D),C=0,s=d.isFunction(e.callback),v={height:D.style.height,overflow:D.style.overflow,overflowY:D.style.overflowY,wordWrap:D.style.wordWrap,resize:D.style.resize},q=j.width(),A=j.css("resize");j.data("autosize")||(j.data("autosize",!0),("border-box"===j.css("box-sizing")||"border-box"===j.css("-moz-box-sizing")||"border-box"===j.css("-webkit-box-sizing"))&&(C=j.outerHeight()-j.height()),x=Math.max(parseInt(j.css("minHeight"),10)-C||0,j.height()),j.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===A?j.css("resize","none"):"both"===A&&j.css("resize","horizontal"),"onpropertychange" in D?"oninput" in D?j.on("input.autosize keyup.autosize",i):j.on("propertychange.autosize",function(){"value"===event.propertyName&&i()}):j.on("input.autosize",i),e.resizeDelay!==!1&&d(window).on("resize.autosize",m),j.on("autosize.resize",i),j.on("autosize.resizeIncludeStyle",function(){b=null,i()}),j.on("autosize.destroy",function(){b=null,clearTimeout(n),d(window).off("resize",m),j.off("autosize").off(".autosize").css(v).removeData("autosize")}),i())})):this}})(window.jQuery||window.$);
$(document).ready(function(){function e(e,n){$(".error",n).removeClass("error"),t(n);var r=e.split(",");r.forEach(function(e){$("input[name="+e+"],textarea[name="+e+"]",n).addClass("error")}),$("input[name="+r[0]+"]",n).focus()}function t(e){$("#inputfailure",e).show(1e3),window.setTimeout(function(){$("#inputfailure",e).hide(800)},5e3)}function n(t,n){return $("input[name="+t+"],textarea[name="+t+"]",n).val().trim()==""?(e(t,n),!1):!0}function r(e,t){var r;for(r=0;r<e.length;r++)if(!n(e[r],t))return!1;return!0}$("body").on("fileActionEvent",function(t,n){if(n.obj.hasClass("disabled"))return;if(!n.obj.hasClass("sendbymail"))return;var i=window.location.pathname;$(".action.sendbymail").addClass("disabled"),$.MyPost(i,{action:"sendbymail",ajax:"preparemail",files:n.selected},function(t){var n=$(t);$(".action.sendbymail").removeClass("disabled"),$("input[name=download]",n).click(function(e){return $.MyPreventDefault(e),n.dialog("close"),$("form",n).off("submit").append('<input type="hidden" name="download" value="yes"/>').submit(),!1}),$("input[name=to],textarea[name=to],textarea[name=cc],textarea[name=bcc]",n).autosize().autocomplete({minLength:4,autoFocus:!0,source:function(e,t){var n=e.term.split(/\s*,\s*/),r=n.pop().trim();r!=""&&r.length>3?$.MyPost(window.location.pathname,{action:"sendbymail",ajax:"addressbooksearch",query:r},function(e){t(e.result?e.result:[])},!0):t([])},select:function(e,t){var n=$(this);$.MyPreventDefault(e);var r=n.val().split(/\s*,\s*/);return r.pop(),r.push(t.item.value),n.val(r.join(",\r\n")+"\r\n"),!1},focus:function(e,t){return $.MyPreventDefault(e),!1}}),$("input",n).on("keydown",function(e){return $(this).next("input").focus(),e.which!==13}),$("input[name=zipfilename]",n).prop("disabled",!0),$("input[name=zip]",n).change(function(){$(".sendbymail.files.dir",n).length>0&&$(this).prop("checked",!0),$("input[name=zipfilename]",n).prop("disabled",!$(this).is(":checked"))}),$(".sendbymail.files.dir",n).length>0&&$("input[name=zip]",n).prop("checked",!0).trigger("change"),$(".sendbymail.remove",n).length==1&&$(".sendbymail.remove",n).remove(),$(".sendbymail.remove",n).click(function(){$(".sendbymail.sumfilesizes").remove(),$(this).parent().remove(),$(".sendbymail.remove",n).length==1&&$(".sendbymail.remove",n).remove()}),$("form.sendbymail",n).submit(function(){$("input.error",n).removeClass("error");if(!r(new Array("from","to","subject"),n))return!1;$("input[type=submit]",n).prop("disabled",!0);var t=$.MyPost(i,$(this).serialize(),function(t){var r="info",i=t.msg;t.error&&(r="error",i=t.error,t.field&&e(t.field,n)),noty({text:i,type:r,layout:"topCenter",timeout:3e4}),t.error?$("input[type=submit]",n).prop("disabled",!1):n.dialog("close")});return ToolBox.renderAbortDialog(t),!1}),$("input[type=submit]",n).button(),$(".sendbymail.addcc,.sendbymail.addbcc",n).button().on("click",function(){var e=$(this);e.hasClass("addcc")&&$("form.sendbymail").addClass("showcc").focus(),e.hasClass("addbcc")&&$("form.sendbymail").addClass("showbcc").focus()}),n.dialog({modal:!0,width:"auto",height:"auto",dialogClass:"sendbymail",closeText:$("#close").html()}),n.MyTooltip(500)})})}),
/*!
Autosize v1.18.9 - 2014-05-27
Automatically adjust textarea height based on user input.
(c) 2014 Jack Moore - http://www.jacklmoore.com/autosize
license: http://www.opensource.org/licenses/mit-license.php
*/
function(e){var t,n={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},r='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',i=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],s=e(r).data("autosize",!0)[0];s.style.lineHeight="99px","99px"===e(s).css("lineHeight")&&i.push("lineHeight"),s.style.lineHeight="",e.fn.autosize=function(r){return this.length?(r=e.extend({},n,r||{}),s.parentNode!==document.body&&e(document.body).append(s),this.each(function(){function n(){var t,n=window.getComputedStyle?window.getComputedStyle(h,null):!1;n?(t=h.getBoundingClientRect().width,(0===t||"number"!=typeof t)&&(t=parseInt(n.width,10)),e.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(e,r){t-=parseInt(n[r],10)})):t=p.width(),s.style.width=Math.max(t,0)+"px"}function o(){var o={};if(t=h,s.className=r.className,s.id=r.id,f=parseInt(p.css("maxHeight"),10),e.each(i,function(e,t){o[t]=p.css(t)}),e(s).css(o).attr("wrap",p.attr("wrap")),n(),window.chrome){var u=h.style.width;h.style.width="0px",h.offsetWidth,h.style.width=u}}function u(){var e,i;t!==h?o():n(),s.value=!h.value&&r.placeholder?(p.attr("placeholder")||"")+r.append:h.value+r.append,s.style.overflowY=h.style.overflowY,i=parseInt(h.style.height,10),s.scrollTop=0,s.scrollTop=9e4,e=s.scrollTop,f&&e>f?(h.style.overflowY="scroll",e=f):(h.style.overflowY="hidden",l>e&&(e=l)),e+=d,i!==e&&(h.style.height=e+"px",v&&r.callback.call(h,h))}function a(){clearTimeout(c),c=setTimeout(function(){var e=p.width();e!==g&&(g=e,u())},parseInt(r.resizeDelay,10))}var f,l,c,h=this,p=e(h),d=0,v=e.isFunction(r.callback),m={height:h.style.height,overflow:h.style.overflow,overflowY:h.style.overflowY,wordWrap:h.style.wordWrap,resize:h.style.resize},g=p.width(),y=p.css("resize");p.data("autosize")||(p.data("autosize",!0),("border-box"===p.css("box-sizing")||"border-box"===p.css("-moz-box-sizing")||"border-box"===p.css("-webkit-box-sizing"))&&(d=p.outerHeight()-p.height()),l=Math.max(parseInt(p.css("minHeight"),10)-d||0,p.height()),p.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===y?p.css("resize","none"):"both"===y&&p.css("resize","horizontal"),"onpropertychange"in h?"oninput"in h?p.on("input.autosize keyup.autosize",u):p.on("propertychange.autosize",function(){"value"===event.propertyName&&u()}):p.on("input.autosize",u),r.resizeDelay!==!1&&e(window).on("resize.autosize",a),p.on("autosize.resize",
u),p.on("autosize.resizeIncludeStyle",function(){t=null,u()}),p.on("autosize.destroy",function(){t=null,clearTimeout(c),e(window).off("resize",a),p.off("autosize").off(".autosize").css(m).removeData("autosize")}),u())})):this}}(window.jQuery||window.$);

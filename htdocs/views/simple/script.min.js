var ToolBox={};$(function(){bd();at();Z();aG();P();i();an();aB();v();U();aX();ab();aK();aL();bf();g();f();E();L();aS();r();T();al();aC();e();a1();a7();c();aW();bb();be();am();ah();$.ajaxSetup({traditional:true});$(document).ajaxError(function(bm,bn,bl,bk){console.log(bm);console.log(bn);console.log(bl);console.log(bk);if(bn&&bn.statusText&&bn.statusText!="abort"){bc(bn.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(bk,bm,bl){bk.cache=true});aD($("#flt").attr("data-uri"));function am(bk){if(!bk){bk=$(document)}$(".tabsel",bk).on("click keyup",function(bn){if(bn.type=="keyup"&&bn.keyCode!=32&&bn.keyCode!=13){return}G(bn);var bl=$(this);$(".tabsel.activetabsel",bk).removeClass("activetabsel");bl.addClass("activetabsel");$(".tab.showtab",bk).removeClass("showtab");var bm=$(".tab."+bl.data("group"),bk).addClass("showtab");$(":focusable:visible:first",bm).focus()})}function be(){if(!ak("settings.show.statusbar")){ak("settings.show.statusbar","no");ak("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",ak("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(bl){$(this).prop("checked",true);G(bl)});function bk(){var bm=$("#fileListTable");var bl=$("#statusbar");$(".filecount",bl).html(bm.attr("data-filecounter"));$(".dircount",bl).html(bm.attr("data-dircounter"));$(".sum",bl).html(bm.attr("data-sumcounter"));$(".foldersize",bl).attr("title",aJ(bm.data("foldersize"))).html(a(bm.data("foldersize")));$(".selfilecount",bl).html(bm.attr("data-fileselcounter"));$(".seldircount",bl).html(bm.attr("data-dirselcounter"));$(".selsum",bl).html(bm.attr("data-sumselcounter"));$(".selfoldersize",bl).attr("title",aJ(bm.attr("data-folderselsize"))).html(a(bm.attr("data-folderselsize")));$(".selected-files-stats",bl).toggle(bm.attr("data-fileselcounter")!==0||bm.attr("data-dirselcounter")!==0)}bk();$("#flt").on("counterUpdated",bk).on("fileListChanged",bk).on("selectionCounterUpdated",bk);$("body").on("notify",function(bl,bm){$("#statusbar .notify").attr("title",bm.msg).removeClass("error message warning").addClass(bm.type).html(bm.msg).MyTooltip()});$("body").on("settingchanged",function(bl,bm){if(bm.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",bm.value)}});$("#statusbar").MyTooltip()}function aW(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function a1(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(bm){var bl=this.tabIndex||1;var bk=$(this);if(bk.is(":focus")){if(bm.keyCode==32){Y.call(this,bm)}else{if(bm.keyCode==13){N(l($("#fileList").attr("data-uri"),encodeURIComponent(d(bk.attr("data-file")))),bk.attr("data-type")=="file")}else{if(bm.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(W(bk)){Q(bk)}}else{af()}}else{if(bm.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(bm.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(bm.keyCode==45){$(".paste").trigger("click")}}}}}}}if(bm.keyCode==38&&bl>-1){G(bm);if(W(bk)&&(bm.shiftKey||bm.altKey||bm.ctrlKey||bm.metaKey)){bg(bk,true);$("#flt").trigger("fileListSelChanged")}bk.prevAll(":focusable:first").focus();ap()}else{if(bm.keyCode==40){G(bm);if(W(bk)&&(bm.shiftKey||bm.altKey||bm.ctrlKey||bm.metaKey)){bg(bk,true);$("#flt").trigger("fileListSelChanged")}bk.nextAll(":focusable:first").focus();ap()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",s);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function e(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(bm){G(bm);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var bl=$("#flt").data("TableConfigDialog");if(bl){k($(bl))}else{if($("#tableconfigdialogtemplate").length>0){var bk=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",bk);k($(bk))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(bn){if(bn.error){S(bn)}$("#flt").data("TableConfigDialog",bn);k($(bn))})}}}).MyKeyboardEventHandler()})}function k(bl){var bn=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(bq,bp){return $(bq).attr("data-name")});$.each(bn,function(bp,bq){bl.find("input[name='visiblecolumn'][value='"+bq+"']").prop("checked",true)});bl.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bp){G(bp)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bp,bq){bl.find("input[name='sortingcolumn'][value='"+$(bq).attr("data-name")+"']").prop("disabled",true).click(function(br){G(br)}).closest("li").addClass("disabled")});var bo=ak("order")?ak("order").split("_"):"name_asc".split("_");var bm=bo[0];var bk=bo[1]||"asc";bl.find("input[name='sortingcolumn'][value='"+bm+"']").prop("checked",true);bl.find("input[name='sortingorder'][value='"+bk+"']").prop("checked",true);bl.find("input[value='fileactions']").closest("li").hide();bl.find("input[name='save']").button().click(function(bq){var bv=bn.slice(0);var by=$.map($("input[name='visiblecolumn']:checked"),function(bA,bz){return $(bA).attr("value")});var bx=[];for(var bt=bv.length-1;bt>=0;bt--){if($.inArray(bv[bt],by)==-1){bx.push(bv[bt]);bv.splice(bt,1)}}var br=[];$.each(by,function(bz,bA){if($.inArray(bA,bv)==-1){br.push(bA);bv.push(bA)}});ak("visibletablecolumns",bv.join(","),1);var bw=bl.find("input[name='sortingcolumn']:checked").attr("value");var bs=bl.find("input[name='sortingorder']:checked").attr("value");ak("order",bw+(bs=="desc"?"_desc":""),1);if(by.sort().join(",")!=bn.sort().join(",")){$.each(br,function(bA,bB){var bz=$("#fileListTable th[data-name='"+bB+"']").removeClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bD,bC){$("td",$(bC)).eq(bz).show()})});$.each(bx,function(bA,bB){var bz=$("#fileListTable th[data-name='"+bB+"']").addClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bD,bC){$("td",$(bC)).eq(bz).hide()})})}else{if(bw!=bm||bs!=bk){var bp=$("#fileListTable th[data-name='"+bw+"']");var bu=bs=="desc"?-1:1;m(bp.prop("cellIndex"),bu);if(bp.length>0){w(bp.attr("data-sorttype")||"string",bp.attr("data-sort"),bu,bp.prop("cellIndex"),"data-file")}}}bl.dialog("close")});bl.find("input[name='cancel']").button().click(function(bp){G(bp);bl.dialog("close");return false});bl.find("#tableconfigform").submit(function(bp){return false});bl.dialog({modal:true,width:"auto",title:bl.attr("data-title")||bl.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");bl.dialog("destroy")}})}function a0(bk){if(bk){G(bk)}var bm=$(this).hasClass("collapsed");var bl=$(this).hasClass("iconsonly");if(!bm&&!bl){bl=true}else{if(bl){bl=false;bm=true}else{bm=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",bm).toggleClass("sidebar-iconsonly",bl);$(".action.collapse-sidebar").toggleClass("collapsed",bm).toggleClass("iconsonly",bl);if(!bl&&!bm){ax("sidebar")}else{ak("sidebar",bl?"iconsonly":bm?"false":"true")}x()}function aC(){$(".action.collapse-sidebar").click(a0).MyKeyboardEventHandler().MyTooltip();if(ak("sidebar")&&ak("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ak("sidebar")=="false").toggleClass("sidebar-iconsonly",ak("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",ak("sidebar")=="false").toggleClass("iconsonly",ak("sidebar")=="iconsonly");x()}$(".action.collapse-head").click(function(bk){G(bk);$(".action.collapse-head").toggleClass("collapsed");var bl=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!bl);$(".collapse-head-listener").toggleClass("head-collapsed",bl);B("head","false",bl,1);x()}).MyTooltip().MyKeyboardEventHandler();if(ak("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function al(){$(".action.autorefreshmenu").dblclick(function(bk){G(bk);aD()});aR($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aR($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aR($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(ak("autorefresh")!==""&&parseInt(ak("autorefresh"))>0){a4(parseInt(ak("autorefresh")))}});$(".action.setautorefresh").click(function(bk){G(bk);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){aD();return}ak("autorefresh",$(this).attr("data-value"));a4(parseInt($(this).attr("data-value")))}).on("keyup",function(bk){if(bk.keyCode==32||bk.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(bk){G(bk);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ax("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bk){if(bk.keyCode==32||bk.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(bl){G(bl);if($(this).hasClass("disabled")){return}var bk=$("#autorefresh");if(bk.data("timer")!=null){window.clearInterval(bk.data("timer"));bk.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{a4(bk.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bk){if(bk.keyCode==32||bk.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(bl,bk){ak("autorefreshtimerpos",JSON.stringify(ad("#autorefreshtimer",bk.offset)))}});if(ak("autorefreshtimerpos")){ad("#autorefreshtimer",JSON.parse(ak("autorefreshtimerpos")))}}function ad(bo,bk){var bn=$(bo);var bl=$(window);var bm={left:Math.min(Math.max(bk.left,0),bl.width()-bn.outerWidth()+bl.scrollLeft()),top:Math.min(Math.max(bk.top,0),bl.height()-bn.outerHeight()+bl.scrollTop())};bn.offset(bm);return bm}function ac(bk){var bm=$(".autorefreshtimer");var bn=bm.attr("data-template")||"%sm %ss";var bl=Math.floor(bk/60);var bo=bk%60;if(bo<10){bo="0"+bo}bm.html(bn.replace("%s",bl).replace("%s",bo))}function a4(bl){var bk=$("#autorefresh");if(bk.data("timer")!=null){window.clearInterval(bk.data("timer"))}bk.data("timeout",bl);ac(bl);bk.data("timer",window.setInterval(function(){var bm=bk.data("timeout")-1;ac(bm);bk.data("timeout",bm);if(bm<0){window.clearInterval(bk.data("timer"));bk.data("timer",null);ac(0);bk.trigger("stopped");aD()}},1000));bk.trigger("started")}function T(){var bk=$("#settings");bk.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",bk).each(function(bm,bl){$(bl).prop("checked",ak($(bl).prop("name"))!="no").click(function(bn){if(ak($(this).prop("name")+".keep")){ak($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{B($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",bk).change(function(){if($(this).prop("name")=="settings.lang"){ak($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{ak($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(bn,bl){var bo=$(bl);var bm=bo.prop("name");if(bm=="settings.lang"){bm=bm.replace(/^settings\./,"")}$("option[value='"+ak(bm)+"']",bo).prop("selected",true)})}})}function bd(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(bk){if(bk.keyCode==13||bk.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(bk){G(bk);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function r(){$("#flt").on("fileListChanged",x).on("fileListViewChanged",x);$(window).resize(x);x()}function x(){var bk=$(window).width()-$("#nav").width();$("#content").width(bk);$("#controls").width(bk);$("body").trigger("windowResized")}function L(){$(".action.changeuri").off(".changeuri").on("click.changeuri",bj);$(".action.refresh").off(".refresh").on("click.refresh",function(bk){G(bk);aD();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",bj);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var bk=$(this);if(!bk.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=bk.data("href")?bk.data("href"):bk.attr("href")}})})}function bj(bk){G(bk);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){N($(this).data("href")||$(this).attr("href"))}return false}function E(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(bk){$("#fileList tr:not(:hidden).unselectable-no").each(function(bl,bm){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(bk){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(bk){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function f(){var bl=$("#clock");if(bl.length===0){return}var bk=bl.attr("data-format");if(!bk){bk="%I:%M:%S"}window.setInterval(function(){function bm(bp){return bp<10?"0"+bp:bp}var bo=new Date();var bn=bk;bn=bn.replace(/\%(H|k)/,bm(bo.getHours())).replace(/\%(I|l)/,bm(bo.getHours()%12===0?12:bo.getHours()%12)).replace(/\%M/,bm(bo.getMinutes())).replace(/\%S/,bm(bo.getSeconds()));bl.html(bn)},bk.match(/%S/)?1000:60000)}function aG(){$("#flt").on("bookmarksChanged",t).on("bookmarksChanged",A).on("fileListChanged",function(){t();A()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aU)}function aR(bk,bl){$.each(bk,function(bo,bn){var bm=$(bn);if(bm.hasClass("hideit")){bm.toggle(!bl)}if(bm.hasClass("button")){bm.button("option","disabled",bl)}if(!bm.hasClass("notab")){bm.attr("tabindex",bl?-1:0)}bm.toggleClass("disabled",bl)})}function A(){var bo=l($("#flt").attr("data-uri"),"/");var bk=false;var bn=0;var bm=0;while(ak("bookmark"+bm)!=null){if(ak("bookmark"+bm)==bo){bk=true}if(ak("bookmark"+bm)!="-"){bn++}bm++}$(".action.addbookmark").button("option","disabled",bk);aR($(".action.rmbookmark"),!bk);aR($(".action.bookmarksortpath"),bn<2);aR($(".action.bookmarksorttime"),bn<2);aR($(".action.rmallbookmarks"),bn===0);var bl=ak("bookmarksort")==null?"time-desc":ak("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(bl=="path"||bl=="path-desc"||bl=="time"||bl=="time-desc"){$("#bookmarks .action.bookmarksort"+bl.replace(/-desc/,"")+" ."+bl).show()}}function t(){var bp=l($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(bq,br){$(br).remove()});var bo=[];var bm=0;while(ak("bookmark"+bm)!=null){if(ak("bookmark"+bm)!="-"){bo.push({path:ak("bookmark"+bm),time:parseInt(ak("bookmark"+bm+"time"))})}bm++}var bn=ak("bookmarksort")?ak("bookmarksort"):"time-desc";var bk=1;if(bn.indexOf("-desc")>0){bk=-1;bn=bn.replace(/-desc/,"")}bo.sort(function(br,bq){if(bn=="path"){return bk*br[bn].localeCompare(bq[bn])}else{return bk*(bq[bn]-br[bn])}});var bl=$("#bookmarktemplate").html();$.each(bo,function(bq,bs){var br=unescape(bs.path);$("<li>"+bl.replace(/\$bookmarkpath/g,bs.path).replace(/\$bookmarktext/,ag(aa(aV(br,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aU).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",bs.path).attr("title",aa(br)+" ("+(new Date(parseInt(bs.time)))+")").attr("tabindex",bs.path==bp?-1:0).toggleClass("disabled",bs.path==bp).find(".action.rmsinglebookmark").click(aU).MyKeyboardEventHandler()})}function n(bl){var bk=0;while(ak("bookmark"+bk)!=null&&ak("bookmark"+bk)!=bl){bk++}if(ak("bookmark"+bk)==bl){ak("bookmark"+bk,"-",1)}$("#flt").trigger("bookmarksChanged")}function aU(bn){G(bn);if($(this).hasClass("disabled")){return}var bk=$(this);var bm=$("#fileList").attr("data-uri");if(bk.hasClass("addbookmark")){var bl=0;while(ak("bookmark"+bl)!=null&&ak("bookmark"+bl)!="-"&&ak("bookmark"+bl)!=""&&ak("bookmark"+bl)!=bm){bl++}ak("bookmark"+bl,bm,1);ak("bookmark"+bl+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(bk.hasClass("dyn-bookmark")){N(bk.attr("data-bookmark"));bk.closest("ul").hide()}else{if(bk.hasClass("rmbookmark")){n(bm)}else{if(bk.hasClass("rmallbookmarks")){var bl=0;while(ak("bookmark"+bl)!=null){ax("bookmark"+bl,"bookmark"+bl+"time");bl++}$("#flt").trigger("bookmarksChanged")}else{if(bk.hasClass("rmsinglebookmark")){n($(this).attr("data-bookmark"))}else{if(bk.hasClass("bookmarksortpath")){ak("bookmarksort",ak("bookmarksort")=="path"||ak("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(bk.hasClass("bookmarksorttime")){ak("bookmarksort",ak("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aL(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",ay).on("fileListViewChanged",ay)}function ay(){var bm=$("#selstats");var bk=bm.data("selstats");var bl=aT();$("#fileListTable").attr("data-fileselcounter",bl.fileselcounter).attr("data-dirselcounter",bl.dirselcounter).attr("data-folderselsize",bl.folderselsize).attr("data-sumselcounter",bl.sumselcounter);$("#flt").trigger("selectionCounterUpdated");bm.html(bk.replace(/\$filecount/g,bl.fileselcounter).replace(/\$dircount/g,bl.dirselcounter).replace(/\$sum/g,bl.sumselcounter).replace(/\$folderselsizes/g,aJ(bl.folderselsize)).replace(/\$folderselsize/g,a(bl.folderselsize))).attr("title",aJ(bl.folderselsize)).MyTooltip()}function aX(){$("#pathinputform").submit(function(bk){return false});$("#pathinputform input[name='uri']").keydown(function(bk){if(bk.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(bk.keyCode==13){G(bk);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();N($(this).val())}}});$(".action.changedir").button().click(function(bk){G(bk);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(bk){G(bk);$("#pathinput").hide();$("#quicknav").show();N($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function ab(){$("form#filterbox").submit(function(bk){return false});$("form#filterbox input").keyup(C).change(C).autocomplete({minLength:1,select:C,close:C});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(bk){G(bk);$("form#filterbox input").val("");C();$(this).addClass("invisible")});$("#flt").on("fileListChanged",C).on("fileListChanged",function(){var bk=$.map($("#fileList tr"),function(bm,bl){return $(bm).attr("data-file")});$("form#filterbox input").autocomplete({source:function(bm,bl){try{var bo=new RegExp(bm.term);bl($.grep(bk,function(bp){return bo.test(bp)}))}catch(bn){bl($.grep(bk,function(bp){return bp.indexOf(bm.term)>-1}))}}})})}function C(){var bk=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var bm=new RegExp(bk,"i");if(bk===""||$(this).attr("data-file").match(bm)){$(this).show()}else{$(this).hide()}}catch(bl){if(bk===""||$(this).attr("data-file").toLowerCase().indexOf(bk.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function z(bl,bm){if(!bm){bm=bl}var bk=bm.loaded/bm.total*100;$("#progress .bar").css("width",bk.toFixed(2)+"%").html(parseInt(bk)+"% ("+a(bm.loaded)+"/"+a(bm.total)+"); "+bl.done+"/"+bl.uploads)}function aw(bm,bo,bl,bn){$("#flt").on("fileListChanged",function(){bm.fileupload("option","url",$("#fileList").attr("data-uri"))});var bk={aborted:false,transports:[],done:0,failed:0,uploads:0};bm.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:bn,singleFileUploads:true,autoUpload:false,add:function(bs,br){if(!bk.aborted){var bt=br.submit();var bq=br.files[0].name;bk.transports.push(bt);var bp=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+bq).addClass("fileprogress");$("<div></div>").click(function(bu){G(bu);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bp).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:bq,transport:bt});$("<div></div>").appendTo(bp).addClass("fileprogressbar running").html(br.files[0].name+" ("+a(br.files[0].size)+"): 0%");bk.uploads++;return true}return false},done:function(bq,bp){$("#progress [id='fpb"+bp.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bp.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bp.result.message?"done":"failed").css("width","100%").html(bp.result&&bp.result.error?bp.result.error:bp.result.message?bp.result.message:bp.files[0].name);if(bp.result.message){bk.done++}else{bk.failed++}z(bk)},fail:function(bq,bp){$("#progress [id='fpb"+bp.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bp.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bp.textStatus+": "+$.map(bp.files,function(br,bs){return br.name}).join(", "));bk.failed++;z(bk);console.log(bp)},stop:function(bq,bp){z(bk);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){aD()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(bq,bp){bk.transports=[];bk.aborted=false;bk.files=[];bk.uploads=0;bk.failed=0;bk.done=0;return true},start:function(br,bq){var bp=[];bp.push({text:$("#close").html(),disabled:true});bp.push({text:$("#cancel").html(),click:function(){if(bk.aborted){return}bk.aborted=true;$.each(bk.transports,function(bs,bt){if(bt&&bt.abort){bt.abort($("#uploadaborted").html())}});bk.transports=[]}});$("#progress").dialog({modal:true,title:bl,height:370,width:500,buttons:bp,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(br,bq){var bp=parseInt(bq.loaded/bq.total*100)+"%";$("div[id='fpb"+bq.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bp).html(bq.files[0].name+" ("+a(bq.files[0].size)+"): "+bp)},progressall:function(bq,bp){bk.total=bp.total;bk.loaded=bp.loaded;z(bk,bp)},submit:function(bq,bp){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",ak("settings.confirm.upload")=="no"||!X(bp)||window.confirm(bo))}$("#file-upload-form-relapath").val(bp.files[0].relativePath||(bp.files[0].webkitRelativePath&&bp.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function X(bl){for(var bk=0;bk<bl.files.length;bk++){var bm;if(bl.files[bk].relativePath&&bl.files[bk].relativePath!=""){bm=bl.files[bk].relativePath.split(/[\\\/]/)[0]+"/"}else{if(bl.files[bk].webkitRelativePath&&bl.files[bk].webkitRelativePath!=""){bm=bl.files[bk].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(bm&&$("#fileList tr[data-file='"+aa(bm)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+aa(bl.files[bk].name)+"']").length>0){return true}}}return false}function aK(){aw($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(bk){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(bk){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(bk){$("#fileList").addClass("draghover")}).on("dragleave",function(bk){$("#fileList").removeClass("draghover")}).on("drop",function(bk){$("#fileList").removeClass("hover")})}function M(bm,bk){var bl;if(bk.setting){bm+='<div class="confirmdialogsetting"><input type="checkbox" name="'+bk.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";bl=ak(bk.setting)}$("#confirmdialog").html(bm).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(bk.setting){B(bk.setting,bl,bl&&bl!=="",1)}$("#confirmdialog").dialog("close");if(bk.cancel){bk.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(bk.confirm){bk.confirm()}}}],open:function(){if(bk.setting){$("input[name='"+bk.setting+"']",$(this)).click(function(bn){B(bk.setting,"no",!$(this).is(":checked"),1)}).prop("checked",ak(bk.setting)!="no")}},close:function(){if(bk.cancel){bk.cancel()}}}).show()}function bh(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function p(bl){var bk=$("#fileList tr.selected:visible");if(bk.length==0){bk=$(bl).closest("tr[data-file]")}if(bk.length==0){bk=$("#fileList tr:visible:focus")}return bk}function aN(bk){return $.map(p(bk),function(bl,bm){return $(bl).attr("data-file")})}function a5(bl){G(bl);var bk=$(this);if(bk.hasClass("disabled")){return}var bm=bk.closest("tr");if(bk.hasClass("rename")){a2(bm)}else{if(bk.hasClass("delete")){Q(bm)}else{$("body").trigger("fileActionEvent",{obj:bk,event:bl,file:bm.attr("data-file"),selected:[bm.data("file")],row:bm})}}}function i(){$("#fileactions").on("click dblclick",function(bk){G(bk);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",a5).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",aA).on("mouseleave.fileAction",o)}).on("beforeFileListChange",o);j();$("body").on("settingchanged",j)}function j(bk,bl){$("#fileactions").toggleClass("hidefileactions",ak("settings.show.fileactions")=="no").toggleClass("hidelabels",ak("settings.show.fileactionlabels")=="no").toggleClass("showalways",ak("settings.show.fileactionalways")=="no")}function aA(bl){var bk=$(this);if($("#fileactions",bk).length===0){$(".action.changeuri.filename",bk).after($("#fileactions"))}}function o(bk){$("#fileactions").appendTo($(".template"))}function aS(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(bm,bl){var bk=$(bl);if(!bk.attr("href")){bk.data("fancybox-href",bk.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(bk){return(bk.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(bm,bl){var bk=$(bl);if(!bk.attr("href")){bk.data("fancybox-href",bk.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function aE(){var bl=$("#fileListTable");var bk=$("#fileList");ai();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",Y).off("dblclick.initFileList").on("dblclick.initFileList",function(bm){N(l($("#fileList").attr("data-uri"),encodeURIComponent(d($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:F,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:bh,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(bn){var bm=$(bn.currentTarget);return $(bn.currentTarget).clone().width(bm.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:O,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bp,bm){var bn=$(bm);$("<div/>").prependTo(bn).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(bn).html("&nbsp;").addClass("columnResizeHandle right");bn.data("origWidth",bn.width());var bq=ak(bn.prop("id")+".width");if(bq){bn.width(parseFloat(bq))}var bo=0;$(bm).on("click.initFileList",function(bs){var br=$(this);bo++;if(bo==1){window.setTimeout(function(){if(bo==1){if(!br.hasClass("sorter-false")){aQ.call(br,bs)}}else{var bt=br.width()==br.data("origWidth")?1:br.data("origWidth");br.width(bt);B(br.prop("id")+".width",bt,bt!=br.data("origWidth"),1)}bo=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(bm,bn){startPos=parseInt(bn.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(bm,bn){$(this).removeAttr("style");ak(column.attr("id")+".width",column.width(),1)},drag:function(bm,bn){if(handlePos=="right"){column.width(startWidth+bn.offset.left-startPos)}else{column.width(startWidth+startPos-bn.offset.left)}}});ap();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function ap(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var bk=window.getSelection();if(bk&&bk.removeAllRanges){bk.removeAllRanges()}}}}function O(bl,bm){var bo=bm.draggable.prop("cellIndex");var bk=$(this).prop("cellIndex");if(bo+1==bk){return false}var bn=$("#fileListTable thead th");bn.eq(bo).detach().insertBefore(bn.eq(bk));$.each($("#fileList tr"),function(){var bp=$(this).children("td");bp.eq(bo).detach().insertBefore(bp.eq(bk))});ak("visibletablecolumns",$.map($("#fileListTable thead th[data-name]:not(.hidden):not(:last)"),function(bp){return $(bp).attr("data-name")}).join(","),1);return true}function ai(){if(ak("order")){var bq=ak("order").split("_");var bl=bq[0];var bm=bq[1]&&bq[1]=="desc"?-1:1;var bo=$("#fileListTable thead th[data-name='"+bl+"']:not(.sorter-false)");if(bo.length>0){var bp=bo.attr("data-sort");var bn=bo.attr("data-sorttype")||"string";var bk=bo.prop("cellIndex");m(bk,bm);w(bn,bp,bm,bk,"data-file")}}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aQ)}function aQ(bn){var bq=$("#fileListTable");var bo=bq.data("tablesorter-lastclickedcolumn");var bl=bq.data("tablesorter-sortorder");var bm=$(this).attr("data-sorttype")||"string";var bp=$(this).attr("data-sort");var bk=$(this).prop("cellIndex");if(!bl){bl=-1}if(bo==bk){bl=-bl}ak("order",$(this).attr("data-name")+(bl==-1?"_desc":""),1);m(bk,bl);w(bm,bp,bl,bk,"data-file")}function m(bk,bl){var bm=$("#fileListTable");bm.data("tablesorter-lastclickedcolumn",bk);bm.data("tablesorter-sortorder",bl);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(bk).addClass(bl==1?"tablesorter-up":"tablesorter-down")}function w(bm,bo,bl,bk,bn){$("#fileListTable tbody").each(function(bp,bs){var br=$(bs).children("tr").get();br.sort(function(bw,bu){var bz=0;var bv=$(bw);var bt=$(bu);var by=bv.attr(bo)?(bm=="number"?parseInt(bv.attr(bo)):bv.attr(bo)):bw.cells.item(bk).innerHTML.toLowerCase();var bx=bt.attr(bo)?(bm=="number"?parseInt(bt.attr(bo)):bt.attr(bo)):bu.cells.item(bk).innerHTML.toLowerCase();if(bv.attr("data-file").match(/^\.\.?$/)){return -1}if(bt.attr("data-file").match(/^\.\.?$/)){return 1}if(bv.attr("data-type")=="dir"&&bt.attr("data-type")!="dir"){return -1}if(bv.attr("data-type")!="dir"&&bt.attr("data-type")=="dir"){return 1}if(bm=="number"){bz=by-bx}else{if(by.localeCompare){bz=by.localeCompare(bx)}else{bz=(by<bx?-1:(by==bx?0:1))}}if(bz===0&&bo!=bn){if(by.localeCompare){bz=bv.attr(bn).localeCompare(bt.attr(bn))}else{bz=bv.attr(bn)<bt.attr(bn)?-1:bv.attr(bn)>bt.attr(bn)?1:0}}return bl*bz});for(var bq=0;bq<br.length;bq++){$(bs).append(br[bq])}})}function l(bl,bk){return(u(bl)+bk).replace(/\/\//g,"/").replace(/\/[^\/]+\/\.\.\//g,"/")}function u(bk){return(bk+"/").replace(/\/\//g,"/")}function Q(bk){bk.fadeTo("slow",0.5);M($("#deletefileconfirm").html().replace(/%s/,ag(aa(bk.attr("data-displayname")))),{confirm:function(){var bl=bk.attr("data-file");J(bk);var bn=az();var bm=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:bl},function(bo){bn.remove();if(bo.error){aD()}S(bo)});K(bm)},cancel:function(){bk.fadeTo("fast",1)}})}function S(bk){if(bk.error){bc(bk.error)}if(bk.warn){a6(bk.warn)}if(bk.message){b(bk.message)}if(bk.quicknav){$("#quicknav").html(bk.quicknav).MyTooltip();$("#quicknav a").click(function(bl){G(bl);N($(this).attr("href"))})}}function y(bo,bl,bk){var bn=az();var bm=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:bk,file:bl},function(bp){bo.find(".renamefield").remove();bo.find("td.filename div.hidden div.filename").unwrap();if(bp.message){var bq=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:bk,template:$("#fileList").attr("data-entrytemplate")},function(br){try{var bs=$(br);var bu=$("tr[data-file='"+bk+"']");if(bu.length>0){bu.remove()}bo.replaceWith(bs);bo=bs;aE()}catch(bt){aD()}bn.remove()});K(bq)}else{bn.remove()}S(bp)});K(bm)}function a2(bn){var bm=bn.find("td.filename");var bk=bn.attr("data-displayname");if($(".renamefield",bm).length>0){return}renamefield=$("#renamefield").html();bm.wrapInner('<div class="hidden"/>').prepend(renamefield);var bl=bm.find(".renamefield input[type=text]");$("#flt").enableSelection();bl.attr("value",bl.attr("value").replace(/\$filename/,bk).replace(/\/$/,"")).focus().select();bl.off("click").on("click",function(bo){G(bo);$(this).focus()}).off("dblclick").on("dblclick",function(bo){G(bo)});bl.keydown(function(bq){var br=$(this).closest("tr");var bp=$(this).closest("tr").attr("data-file");var bo=$(this).val();if(bq.keyCode==13&&bp!=bo){G(bq);if(ak("settings.confirm.rename")!="no"){M($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,ag(bp)).replace(/%s/,ag(bo)),{confirm:function(){y(br,bp,bo)},setting:"settings.confirm.rename"})}else{y(br,bp,bo)}}else{if(bq.keyCode==27||(bq.keyCode==13&&bp==bo)){G(bq);br.find(".renamefield").remove();br.find("td.filename div.hidden div.filename").unwrap();$("#flt").disableSelection();br.focus()}}});bl.focusout(function(bo){bn.find(".renamefield").remove();bn.find("td.filename div.hidden div.filename").unwrap();$("#flt").disableSelection()})}function aZ(bk,bl){console.log("notify["+bk+"]: "+bl);if(ak("settings.messages."+bk)=="no"){return}noty({text:bl,type:bk,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:bk,msg:bl})}function bc(bk){aZ("error",bk)}function b(bk){aZ("message",bk)}function a6(bk){aZ("warning",bk)}function bg(bl,bk){if(!bl){return}bl.toggleClass("selected",bk);bl.find(".selectbutton").prop("checked",bl.hasClass("selected"))}function W(bk){return bk.attr("data-file")!=".."&&!bk.hasClass("unselectable-yes")}function Y(bm){var bq=$("#fileListTable");if(W($(this))){var bp=this.rowIndex;var bk=bp;if((bm.shiftKey||bm.metaKey||bm.altKey)&&bq.data("lastSelectedRowIndex")){bk=bq.data("lastSelectedRowIndex");if(bk<bp){var bo=bk;bk=bp;bp=bo}for(var bl=bp+1;bl<bk;bl++){var bn=$("#fileList tr:visible").filter(function(){return this.rowIndex==bl});if(bn.length===0){continue}bg(bn);bn=bn.next()}}bg($(this));bq.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function bf(){$(".dialog.action").click(aO)}function aO(bl){G(bl);if($(this).hasClass("disabled")){return}var bk=$(this);bk.addClass("disabled");var bm=$("#"+bk.attr("data-action"));if(bm.attr("title")){bm.data("title",bm.attr("title"))}bm.attr("title",bm.data("title"));bm.dialog({modal:true,width:"auto",open:function(){if(bm.data("initHandler")){bm.data("initHandler").init()}},close:function(){bk.removeClass("disabled")},dialogClass:bk.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function P(){bi();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",ba).on("fileListViewChanged",ba)}function bi(){aR($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function ba(){var bl=aT();var bm=$("#fileListTable");var bk=bm.hasClass("iswriteable-no")?":not(.access-writeable)":"";bk+=bm.hasClass("isreadable-no")?":not(.access-readable)":"";bk+=bm.hasClass("unselectable-no")?":not(.access-selectable)":"";aR($(".access-writeable"),bm.hasClass("iswriteable-no"));aR($(".access-readable"),bm.hasClass("isreadable-no"));aR($(".access-selectable"),bm.hasClass("unselectable-yes"));aR($(".sel-none"+bk),bl.sumselcounter!==0);aR($(".sel-one"+bk),bl.sumselcounter!=1);aR($(".sel-multi"+bk),bl.sumselcounter===0);aR($(".sel-noneorone"+bk),bl.sumselcounter>1);aR($(".sel-none.sel-dir"+bk),bl.fileselcounter!==0);aR($(".sel-one.sel-dir"+bk),bl.fileselcounter>0||bl.dirselcounter!=1);aR($(".sel-multi.sel-dir"+bk),bl.fileselcounter>0||bl.dirselcounter===0);aR($(".sel-noneorone.sel-dir"+bk),bl.fileselcounter>0||bl.dirselcounter>1);aR($(".sel-noneormulti.sel-dir"+bk),bl.fileselcounter>0);aR($(".sel-none.sel-file"+bk),bl.fileselcounter!==0);aR($(".sel-one.sel-file"+bk),bl.dirselcounter>0||bl.fileselcounter!=1);aR($(".sel-multi.sel-file"+bk),bl.dirselcounter>0||bl.fileselcounter===0);aR($(".sel-noneorone.sel-file"+bk),bl.dirselcounter>0||bl.fileselcounter>1);aR($(".sel-noneormulti.sel-file"+bk),bl.dirselcounter>0)}function aB(){$("#flt").on("fileListChanged",ao).on("fileListViewChanged",ao)}function H(bk){if(!bk){bk=$("#fileListTable")}if(bk&&bk.attr){bk.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aM(){var bl=$("#fileListTable");H(bl);var bk=aT();bl.attr("data-dircounter",bk.dircounter);bl.attr("data-filecounter",bk.filecounter);bl.attr("data-foldersize",bk.foldersize);bl.attr("data-sumcounter",bk.sumcounter);$("#flt").trigger("counterUpdated")}function aT(){var bl=[];bl.dircounter=$("#fileList tr.is-subdir-yes:visible").length;bl.filecounter=$("#fileList tr.is-file:visible").length;bl.sumcounter=bl.dircounter+bl.filecounter;bl.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;bl.fileselcounter=$("#fileList tr.selected.is-file:visible").length;bl.sumselcounter=bl.dirselcounter+bl.fileselcounter;var bk=0;var bm=0;$("#fileList tr:visible").each(function(bo,bp){var bn=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){bm+=bn}bk+=bn});bl.foldersize=bk;bl.folderselsize=bm;return bl}function ao(){var bm=$("#headerName");var bn=$("#fileListTable");var bl=$("#headerSize");aM();if(bm.length>0&&!bm.attr("data-title")){bm.attr("data-title",bm.attr("title"))}if(bl.length>0&&!bl.attr("data-title")){bl.attr("data-title",bl.attr("title"))}if(bm.length>0){bm.attr("title",bm.attr("data-title").replace(/\$filecount/,bn.attr("data-filecounter")).replace(/\$dircount/,bn.attr("data-dircounter")).replace(/\$sum/,parseInt(bn.attr("data-dircounter"))+parseInt(bn.attr("data-filecounter"))))}var bk=parseInt(bn.attr("data-foldersize"));if(bl.length>0){bl.attr("title",bl.attr("data-title").replace(/\$foldersize/,aJ(bk)))}}function aa(bk){return $("<div/>").text(bk).html()}function bb(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var bk=history.location||document.location;aD(bk.pathname)})}function N(bl,bk){try{if(!bk){if(window.history.pushState){window.history.pushState({path:bl},"",bl);aD(bl)}else{aD(bl)}return}}catch(bm){console.log(bm)}if(!bk){az()}window.location.href=bl}function aD(bk,bm){if(!bk){bk=$("#fileList").attr("data-uri")}if(!bk){bk=window.location.href}if(!bm){bm={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var bl=$.now();$("#flt").data("timestamp",bl);$.get(bk,bm,function(bn){if($("#flt").data("timestamp")!=bl){return}$("#flt").trigger("beforeFileListChange").show().html(bn.content).attr("data-uri",bk);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+bk.replace(/\/[^\/]+\/\.\.$/,"/"));aE();S(bn)})}function J(bk){$("#flt").trigger("beforeFileListChange");bk.remove();$("#flt").trigger("fileListChanged")}function D(bm,bk,bn,bl){var bp=az();var bo=$.post(bn,{srcuri:bk,action:bm,files:bl.join("@/@")},function(bq){if(bq.message&&bm=="cut"){J($("#fileList tr[data-file='"+bl.join("'],#fileList tr[data-file='")+"']"))}bp.remove();if(bq.error){aD()}S(bq)});K(bo)}function F(bn,bp){var bk=bp.draggable.closest("tr");var bq=l($("#fileList").attr("data-uri"),encodeURIComponent(d($(this).attr("data-file")))+"/");var bl=l($("#fileList").attr("data-uri"),"/");if(bq==l(bl,encodeURIComponent(d(bk.attr("data-file"))))+"/"){return}var bo=bn.shiftKey||bn.altKey||bn.ctrlKey||bn.metaKey?"copy":"cut";var bm=bk.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bt,bs){return $(bt).attr("data-file")}):new Array(bk.attr("data-file"));if(ak("settings.confirm.dnd")!="no"){var br=$("#paste"+bo+"confirm").html();br=br.replace(/%files%/g,ag(h(bm.join(", ")))).replace(/%srcuri%/g,ag(h(bl))).replace(/%dsturi%/g,ag(h(bq))).replace(/\\n/g,"<br/>");M(br,{confirm:function(){D(bo,bl,bq,bm)},setting:"settings.confirm.dnd"})}else{D(bo,bl,bq,bm)}}function az(){return $("<div></div>").prependTo("body").addClass("overlay")}function d(bk){return bk.replace(/\/$/,"")}function av(bn,bo,bm){for(var bl in bo){var bk=bo[bl];if(typeof bk==="object"){av(bn,bk,bl)}else{if(bm){bn.append($("<input/>").prop("name",bm).prop("value",bk).prop("type","hidden"))}else{bn.append($("<input/>").prop("name",bl).prop("value",bk).prop("type","hidden"))}}}return bn}function a8(bl){var bk=$("<form/>").appendTo("body");bk.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");av(bk,bl);bk.submit();bk.remove()}function af(bm){var bl=$(this);var bk=p(this);bk.fadeTo("slow",0.5);M(bk.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,ag(aa(bk.first().attr("data-file")))),{confirm:function(){var bo=az();if(bk.length===0){bk=bl.closest("tr")}var bn=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(bk,function(bp,bq){return $(bp).attr("data-file")})},function(bp){bo.remove();J(bk);aq();if(bp.error){aD()}S(bp)});K(bn)},cancel:function(){bk.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function aq(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function ae(bm,bk,bn,bl){var bp=az();var bo=$.post(bn,{action:bm,files:bl,srcuri:bk},function(bq){if(ak("clpaction")=="cut"){ax("clpfiles","clpaction","clpuri")}bp.remove();aD();S(bq)});K(bo)}function I(bk){G(bk);var br=$(this);if(br.hasClass("disabled")){return}if(br.hasClass("delete")){af.call(this,bk)}else{if(br.hasClass("rename")){a2(br.closest("tr"))}else{if(br.hasClass("cut")||br.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var bn=$.map(p(br),function(bu,bt){return $(bu).attr("data-file")});ak("clpfiles",bn.join("@/@"));ak("clpaction",br.hasClass("cut")?"cut":"copy");ak("clpuri",l($("#fileList").attr("data-uri"),"/"));if(br.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}V();aq()}else{if(br.hasClass("paste")){var bl=ak("clpfiles");var bo=ak("clpaction");var bq=ak("clpuri");var bp=l($("#fileList").attr("data-uri"),"/");if(ak("settings.confirm.paste")!="no"){var bm=$("#paste"+bo+"confirm").html().replace(/%srcuri%/g,h(bq)).replace(/%dsturi%/g,h(bp)).replace(/\\n/g,"<br/>").replace(/%files%/g,h(bl.split("@/@").join(", ")));M(bm,{confirm:function(){ae(bo,bq,bp,bl)},setting:"settings.confirm.paste"})}else{ae(bo,bq,bp,bl)}}else{if(br.attr("href")!==undefined&&br.attr("href")!="#"){window.location.href=br.attr("href")}else{if(br.attr("data-href")!==undefined&&br.attr("data-href")!="#"){window.location.href=br.attr("data-href")}else{var bs=br.closest("tr");$("body").trigger("fileActionEvent",{obj:br,event:bk,file:bs.attr("data-file"),row:bs,selected:aN(this)})}}}}}}}function h(bk){return aa(decodeURIComponent(bk))}function ak(bm,bn,bk){var bl=new Date();bl.setTime(bl.getTime()+315360000000);if(bn){return Cookies.set(bm,bn,{path:$("#flt").attr("data-baseuri"),secure:true,expires:bk?bl:undefined})}return Cookies.get(bm)}function ax(){for(var bk=0;bk<arguments.length;bk++){Cookies.remove(arguments[bk],{path:$("#flt").attr("data-baseuri"),secure:true})}}function B(bm,bn,bk,bl){if(bk){ak(bm,bn,bl)}else{ax(bm)}}function aJ(bl){var bm="";bm+=bl+" Byte(s)";var bk=bl/1024;if(bk.toFixed(2)>0){bm+=" = "+bk.toFixed(2)+"KB"}bk=bk/1024;if(bk.toFixed(2)>0){bm+=" = "+bk.toFixed(2)+"MB"}bk=bk/1024;if(bk.toFixed(2)>0){bm+=" = "+bk.toFixed(2)+"GB"}bk=bk/1024;if(bk.toFixed(2)>0){bm+=" = "+bk.toFixed(2)+"TB"}return bm}function a(bl){var bm=bl+" Byte(s)";var bk=bl/1024;if(bk.toFixed(2)>0&&bk>1){bm=bk.toFixed(2)+"KB"}bk=bk/1024;if(bk.toFixed(2)>0&&bk>1){bm=bk.toFixed(2)+"MB"}bk=bk/1024;if(bk.toFixed(2)>0&&bk>1){bm=bk.toFixed(2)+"GB"}bk=bk/1024;if(bk.toFixed(2)>0&&bk>1){bm=bk.toFixed(2)+"TB"}return bm}function an(){V();$("#flt").on("fileListChanged",V)}function V(){var bo=ak("clpaction");var bk=l($("#fileList").attr("data-uri"),"/");var bm=ak("clpuri");var bn=ak("clpfiles");var bl=(!bn||bn===""||bm==bk||$("#fileListTable").hasClass("iswriteable-no"));aR($(".action.paste"),bl);if(bm==bk&&bo=="cut"){$.each(bn.split("@/@"),function(bp,bq){$("[data-file='"+bq+"']").addClass("cutted").fadeTo("fast",0.5)})}}function R(bl,bk){bl.click(function(bo){G(bo);var bn=$(this);bn.closest("ul:hidden").show();if(bn.hasClass("disabled")){return}if(bn.data("is-active")){return}bn.data("is-active",true);bn.data("orig-html",bl.html());inplace=$('<div class="inplace"><form method="post" action="#"><input class="inplace input"/></form></div>');var bm=inplace.find("input");inplace.off("click").on("click",function(bp){G(bp);$(this).focus()}).off("dblclick").on("dblclick",function(bp){preventDefeault(bp)});if(bk){bm.val(bk)}$("#flt").enableSelection();bm.keydown(function(bp){if(bp.keyCode==13){G(bp);$("#flt").disableSelection();bn.data("is-active",false);bn.html(bn.data("orig-html"));if((bk&&bm.val()==bk)||(bm.val()==="")){bn.data("value",bm.val()).focus().trigger("unchanged")}else{bn.data("value",bm.val()).trigger("changed")}}else{if(bp.keyCode==27){G(bp);bn.data("is-active",false);$("#flt").disableSelection();bn.html(bn.data("orig-html")).focus();bn.trigger("canceled");bn.data("input-canceled",true)}}}).focusout(function(bp){bn.data("is-active",false);$("#flt").disableSelection();bn.html(bn.data("orig-html"));bn.trigger("canceled")});bn.html(inplace);bm.focus()});return bl}function U(){$("#nav .action").click(I).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function v(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(I).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});R($(".action.create-folder")).on("changed",function(bl){var bk=$(this);bk.closest("ul").hide();$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:bk.data("value")},function(bm){if(!bm.error&&bm.message){ar(bk.data("value"))}S(bm)})});R($(".action.create-file")).on("changed",function(bl){var bk=$(this);bk.closest("ul").hide();$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:bk.data("value")},function(bm){if(!bm.error&&bm.message){ar(bk.data("value"))}S(bm)})});R($(".action.create-symlink")).on("changed",function(bk){$(this).closest("ul").hide();var bl=p(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:$(this).data("value"),file:bl.attr("data-file")},function(bm){if(!bm.error&&bm.message){aD()}S(bm)})})}function G(bk){if(bk.preventDefault){bk.preventDefault()}else{bk.returnValue=false}if(bk.stopPropagation){bk.stopPropagation()}}function aF(bk){G(bk);if(bk.stopImmediatePropagation){bk.stopImmediatePropagation()}}function aV(bl,bk){if(bl.length>bk){bl=bl.substr(0,4)+"..."+bl.substr(bl.length-bk+7,bk-7)}return bl}function g(){$(".action.viewfilter").click(function(bm){G(bm);if($(this).hasClass("disabled")){return}var bk=$(this);$(".action.viewfilter").addClass("disabled");var bn=$("#fileList").attr("data-uri");var bl=bk.attr("data-template");$.get(bn,{ajax:"getViewFilterDialog",template:bl},function(bo){var bp=$(bo);$("input[name='filter.size.val']",bp).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bp).button().click(function(br){G(br);B("filter.name",$("select[name='filter.name.op'] option:selected",bp).val()+" "+$("input[name='filter.name.val']",bp).val(),$("input[name='filter.name.val']",bp).val()!=="");B("filter.size",$("select[name='filter.size.op'] option:selected",bp).val()+$("input[name='filter.size.val']",bp).val()+$("select[name='filter.size.unit'] option:selected",bp).val(),$("input[name='filter.size.val']",bp).val()!=="");if($("input[name='filter.types']:checked",bp).length>0){var bq="";$("input[name='filter.types']:checked",bp).each(function(bs,bt){bq+=$(bt).val()});ak("filter.types",bq)}else{ax("filter.types")}bp.dialog("close");aD()});$(".filter-reset",bp).button().click(function(bq){G(bq);ax("filter.name","filter.size","filter.types");bp.dialog("close");aD()});bp.submit(function(){return false});bp.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:bk.attr("title")||bk.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bp.remove()}}).show()})})}function K(bn,bm,bl){$("#abortdialog").remove();var bk=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",bk).button().click(function(bo){if(bn.readyState!=4){bn.abort()}bk.hide().remove();if(bl){bl.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(bn.readyState>2){return}bk.appendTo($("body")).show();var bo=window.setInterval(function(){if(bn.readyState==4){bk.hide().remove();window.clearInterval(bo)}},200);$("body").data("abortdialoginterval",bo)},bm||2500));return bk}function a3(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function s(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var bm="";var bk=$("*[accesskey]").get().sort(function(bo,bn){var bp=$(bo).attr("accesskey");var bq=$(bn).attr("accesskey");return bp<bq?-1:bp>bq?1:0});var bl=[];$.each(bk,function(bo,bn){var bp=$(bn);var bq=bp.attr("accesskey");if(!bl[bq]){bm+='<li tabindex="0" role="definition">'+bq+": "+(bp.attr("aria-label")||bp.attr("title")||bp.attr("data-tooltip")||bp.html())+"</li>";bl[bq]=true}else{console.log("found accesskey "+bq+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+bm+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function a9(){$("#popupmenu li.popup").MyPopup("close")}function Z(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",function(bk){I.call(this,bk)}).on("dblclick.popupmenu",function(bk){G(bk)}).MyKeyboardEventHandler();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){a9()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"})});$("body").off(".popupmenu").on("click.popupmenu",function(){a9()}).on("keydown.popupmenu",function(bk){if(bk.which==27){a9()}});$("#filler").on("contextmenu",function(){a9()})}function ar(bk){var bl=$("#fileList");return $.get(u(bl.data("uri")),{ajax:"getFileListEntry",template:bl.data("entrytemplate"),file:bk},function(bm){try{var bn=$(bm);row=$("tr[data-file='"+aa(bk)+"']",bl);if(row.length>0){row.replaceWith(bn)}else{bn.appendTo(bl)}aE()}catch(bo){aD()}})}function a7(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(bl,bk){if(bk.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!bk.value);$("#flt").trigger("fileListViewChanged")}else{if(bk.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!bk.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",ak("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",ak("settings.show.dotfolders")=="no")}function aY(){var bk=ak("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bo,bn){var bm=$(this);if(bm.data("thumb")!=bm.data("icon")){var bl=bm.data("thumb");var bp=bm.data("icon");var bq=$("#emptyimage").attr("src");bm.attr("src",bk?(bl===""?bq:bl):(bp===""?bq:bp));bm.toggleClass("thumbnail",bk)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(bl,bk){if(bk.setting=="settings.enable.thumbnails"){aY()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var bk=$(this);var bl=bk.data("icon");bk.removeClass("thumbnail").attr("src",bl!==""?bl:$("#emptyimage").attr("src"))})})}function ag(bk){return bk.replace(/( {2,})/g,'<span class="ws">$1</span>')}function aI(bk){var bl=document.documentElement;if(bk){if(bl.requestFullScreen){bl.requestFullScreen()}else{if(bl.mozRequestFullScreen){bl.mozRequestFullScreen()}else{if(bl.webkitRequestFullscreen){bl.webkitRequestFullscreen()}else{if(bl.webkitRequestFullScreen){bl.webkitRequestFullScreen()}else{if(bl.msRequestFullscreen){bl.msRequestFullscreen()}}}}}}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.webkitCancelFullscreen){document.webkitCancelFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}}}}}}}function aj(bk){$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",bk)}function au(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?true:false}function q(bl,bk){var bn=az();var bm=$.get(window.location.pathname,bl,function(bo){bn.remove();S(bo);bk(bo)});K(bm)}function aH(bl,bk){var bn=az();var bm=$.post(window.location.pathname,bl,function(bo){bn.remove();S(bo);bk(bo)});K(bm)}function ah(){ToolBox={addFullscreenChangeListener:aj,addMissingSlash:u,blockPage:az,changeUri:N,concatUri:l,confirmDialog:M,cookie:ak,fixElementPosition:ad,getDialog:q,getDialogByPost:aH,getSelectedFiles:aN,getSelectedRows:p,handleJSONResponse:S,handleWindowResize:x,hidePopupMenu:a9,initFileList:aE,initPopupMenu:Z,initTabs:am,initUpload:aw,isFullscreen:au,notify:aZ,notifyError:bc,notifyInfo:b,notifyWarn:a6,preventDefault:G,preventDefaultImmediatly:aF,postAction:a8,quoteWhiteSpaces:ag,refreshFileListEntry:ar,removeAbortDialog:a3,renderAbortDialog:K,renderByteSize:a,renderByteSizes:aJ,rmcookies:ax,simpleEscape:aa,stripSlash:d,togglecookie:B,toggleFullscreen:aI,toggleRowSelection:bg,uncheckSelectedRows:aq,updateFileList:aD}}function at(){$.fn.MyTooltip.defaults.helphandler=aP;$(".action.guide").click(function(){aP.call(this,$(this).data("help"))})}function aP(bl){var bk=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:bl,width:"99%",height:"99%"}).text(bl)).dialog({width:bk.width()/2,height:bk.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
var ToolBox={};$(function(){aV();Q();aq();H();g();aa();am();q();L();aE();R();at();au();aX();f();e();y();E();aA();n();K();Y();an();d();aJ();aP();c();aD();aT();aW();Z();W();af();$.ajaxSetup({traditional:true});$(document).ajaxError(function(a4,a5,a3,a2){console.log(a4);console.log(a5);console.log(a3);console.log(a2);if(a5&&a5.statusText&&a5.statusText!="abort"){aU(a5.statusText)}$("div.overlay").remove()}).ajaxSuccess(function(a3,a5,a2,a4){if(a5.getResponseHeader("X-Login-Required")){window.alert($("#login-session").text());window.location.href=a5.getResponseHeader("X-Login-Required")}});$.ajaxPrefilter("script",function(a2,a4,a3){a2.cache=true});ao($("#flt").attr("data-uri"));function Z(a2){if(!a2){a2=$(document)}$(".tabsel",a2).on("click keyup",function(a5){if(a5.type=="keyup"&&a5.keyCode!=32&&a5.keyCode!=13){return}$.MyPreventDefault(a5);var a3=$(this);$(".tabsel.activetabsel",a2).removeClass("activetabsel");a3.addClass("activetabsel");$(".tab.showtab",a2).removeClass("showtab");var a4=$(".tab."+a3.data("group"),a2).addClass("showtab");$(":focusable:visible:first",a4).focus()})}function aW(){if(!X("settings.show.statusbar")){X("settings.show.statusbar","no");X("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",X("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(a3){$(this).prop("checked",true);$.MyPreventDefault(a3)});function a2(){var a4=$("#fileListTable");var a3=$("#statusbar");$(".filecount",a3).html(a4.attr("data-filecounter"));$(".dircount",a3).html(a4.attr("data-dircounter"));$(".sum",a3).html(a4.attr("data-sumcounter"));$(".foldersize",a3).attr("title",$.MyStringHelper.renderByteSizes(a4.data("foldersize"))).html($.MyStringHelper.renderByteSize(a4.data("foldersize")));$(".selfilecount",a3).html(a4.attr("data-fileselcounter"));$(".seldircount",a3).html(a4.attr("data-dirselcounter"));$(".selsum",a3).html(a4.attr("data-sumselcounter"));$(".selfoldersize",a3).attr("title",$.MyStringHelper.renderByteSizes(a4.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(a4.attr("data-folderselsize")));$(".selected-files-stats",a3).toggle(a4.attr("data-fileselcounter")!==0||a4.attr("data-dirselcounter")!==0)}a2();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",a2);$("body").on("notify",function(a3,a4){$("#statusbar .notify").attr("title",a4.msg).removeClass("error message warning").addClass(a4.type).html(a4.msg).MyTooltip()});$("body").on("settingchanged",function(a3,a4){if(a4.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",a4.value)}});$("#statusbar").MyTooltip()}function aD(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aJ(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(a4){var a3=this.tabIndex||1;var a2=$(this);if(a2.is(":focus")){if(a4.keyCode==32){P.call(this,a4)}else{if(a4.keyCode==13){G($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(a2.attr("data-file")))),a2.attr("data-type")=="file")}else{if(a4.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(N(a2)){I(a2)}}else{V()}}else{if(a4.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(a4.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(a4.keyCode==45){$(".paste").trigger("click")}}}}}}}if(a4.keyCode==38&&a3>-1){$.MyPreventDefault(a4);if(N(a2)&&(a4.shiftKey||a4.altKey||a4.ctrlKey||a4.metaKey)){aY(a2,true);$("#flt").trigger("fileListSelChanged")}a2.prevAll(":focusable:first").focus();ac()}else{if(a4.keyCode==40){$.MyPreventDefault(a4);if(N(a2)&&(a4.shiftKey||a4.altKey||a4.ctrlKey||a4.metaKey)){aY(a2,true);$("#flt").trigger("fileListSelChanged")}a2.nextAll(":focusable:first").focus();ac()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",o);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(a4){$.MyPreventDefault(a4);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var a3=$("#flt").data("TableConfigDialog");if(a3){i($(a3))}else{if($("#tableconfigdialogtemplate").length>0){var a2=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",a2);i($(a2))}else{$.MyPost($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(a5){if(a5.error){J(a5)}$("#flt").data("TableConfigDialog",a5);i($(a5))})}}}).MyKeyboardEventHandler()})}function i(a3){var a5=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(a8,a7){return $(a8).attr("data-name")});$.each(a5,function(a7,a8){a3.find("input[name='visiblecolumn'][value='"+a8+"']").prop("checked",true)});a3.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(a7){$.MyPreventDefault(a7)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(a7,a8){a3.find("input[name='sortingcolumn'][value='"+$(a8).attr("data-name")+"']").prop("disabled",true).click(function(a9){$.MyPreventDefault(a9)}).closest("li").addClass("disabled")});var a6=X("order")?X("order").split("_"):"name_asc".split("_");var a4=a6[0];var a2=a6[1]||"asc";a3.find("input[name='sortingcolumn'][value='"+a4+"']").prop("checked",true);a3.find("input[name='sortingorder'][value='"+a2+"']").prop("checked",true);a3.find("input[value='fileactions']").closest("li").hide();a3.find("input[name='save']").button().click(function(a7){var bb=a5.slice(0);var bf=$.map($("input[name='visiblecolumn']:checked"),function(bh,bg){return $(bh).attr("value")});var be=[];for(var ba=bb.length-1;ba>=0;ba--){if($.inArray(bb[ba],bf)==-1){be.push(bb[ba]);bb.splice(ba,1)}}var a8=[];$.each(bf,function(bg,bh){if($.inArray(bh,bb)==-1){a8.push(bh);bb.push(bh)}});var bc=a3.find("input[name='sortingcolumn']:checked").attr("value");var a9=a3.find("input[name='sortingorder']:checked").attr("value");var bd=$("#fileListTable");if(bf.sort().join(",")!=a5.sort().join(",")){$.each(a8,function(bg,bh){$.MyTableManager.toggleTableColumn(bd,bh,true)});$.each(be,function(bg,bh){$.MyTableManager.toggleTableColumn(bd,bh,false)})}$.MyTableManager.sortTable(bd,bc,a9=="desc"?-1:1);a3.dialog("close")});a3.find("input[name='cancel']").button().click(function(a7){$.MyPreventDefault(a7);a3.dialog("close");return false});a3.find("#tableconfigform").submit(function(a7){return false});a3.dialog({modal:true,width:"auto",title:a3.attr("data-title")||a3.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");a3.dialog("destroy")}})}function aI(a2){if(a2){$.MyPreventDefault(a2)}var a4=$(this).hasClass("collapsed");var a3=$(this).hasClass("iconsonly");if(!a4&&!a3){a3=true}else{if(a3){a3=false;a4=true}else{a4=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",a4).toggleClass("sidebar-iconsonly",a3);$(".action.collapse-sidebar").toggleClass("collapsed",a4).toggleClass("iconsonly",a3);if(!a3&&!a4){ai("sidebar")}else{X("sidebar",a3?"iconsonly":a4?"false":"true")}r()}function an(){$(".action.collapse-sidebar").click(aI).MyKeyboardEventHandler().MyTooltip();if(X("sidebar")&&X("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",X("sidebar")=="false").toggleClass("sidebar-iconsonly",X("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",X("sidebar")=="false").toggleClass("iconsonly",X("sidebar")=="iconsonly");r()}$(".action.collapse-head").click(function(a2){$.MyPreventDefault(a2);$(".action.collapse-head").toggleClass("collapsed");var a3=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!a3);$(".collapse-head-listener").toggleClass("head-collapsed",a3);v("head","false",a3,1);r()}).MyTooltip().MyKeyboardEventHandler();if(X("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function Y(){$(".action.autorefreshmenu").dblclick(function(a2){$.MyPreventDefault(a2);ao()});az($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){az($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){az($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(X("autorefresh")!==""&&parseInt(X("autorefresh"))>0){aM(parseInt(X("autorefresh")))}});$(".action.setautorefresh").click(function(a2){$.MyPreventDefault(a2);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){ao();return}X("autorefresh",$(this).attr("data-value"));aM(parseInt($(this).attr("data-value")))}).on("keyup",function(a2){if(a2.keyCode==32||a2.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(a2){$.MyPreventDefault(a2);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ai("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(a2){if(a2.keyCode==32||a2.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(a3){$.MyPreventDefault(a3);if($(this).hasClass("disabled")){return}var a2=$("#autorefresh");if(a2.data("timer")!=null){window.clearInterval(a2.data("timer"));a2.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{aM(a2.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(a2){if(a2.keyCode==32||a2.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(a3,a2){X("autorefreshtimerpos",JSON.stringify(T("#autorefreshtimer",a2.offset)))}});if(X("autorefreshtimerpos")){T("#autorefreshtimer",JSON.parse(X("autorefreshtimerpos")))}}function T(a6,a2){var a5=$(a6);var a3=$(window);var a4={left:Math.min(Math.max(a2.left,0),a3.width()-a5.outerWidth()+a3.scrollLeft()),top:Math.min(Math.max(a2.top,0),a3.height()-a5.outerHeight()+a3.scrollTop())};a5.offset(a4);return a4}function S(a2){var a4=$(".autorefreshtimer");var a5=a4.attr("data-template")||"%sm %ss";var a3=Math.floor(a2/60);var a6=a2%60;if(a6<10){a6="0"+a6}a4.html(a5.replace("%s",a3).replace("%s",a6))}function aM(a3){var a2=$("#autorefresh");if(a2.data("timer")!=null){window.clearInterval(a2.data("timer"))}a2.data("timeout",a3);S(a3);a2.data("timer",window.setInterval(function(){var a4=a2.data("timeout")-1;S(a4);a2.data("timeout",a4);if(a4<0){window.clearInterval(a2.data("timer"));a2.data("timer",null);S(0);a2.trigger("stopped");ao()}},1000));a2.trigger("started")}function K(){var a2=$("#settings");a2.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",a2).each(function(a4,a3){$(a3).prop("checked",X($(a3).prop("name"))!="no").click(function(a5){if(X($(this).prop("name")+".keep")){X($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{v($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",a2).change(function(){if($(this).prop("name")=="settings.lang"){X($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{X($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(a5,a3){var a6=$(a3);var a4=a6.prop("name");if(a4=="settings.lang"){a4=a4.replace(/^settings\./,"")}$("option[value='"+X(a4)+"']",a6).prop("selected",true)})}})}function aV(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(a2){if(a2.keyCode==13||a2.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(a2){$.MyPreventDefault(a2);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function n(){$("#flt").on("fileListChanged",r).on("fileListViewChanged",r);$(window).resize(r);r()}function r(){var a2=$(window).width()-$("#nav").width();$("#content").width(a2);$("#controls").width(a2);$("body").trigger("windowResized")}function E(){$(".home-button[data-href], .logout-button[data-href], .contact-button[data-href], .link-button[data-href], .help-button[data-href]").off("click").attr("tabindex",0).on("click",function(){window.open($(this).data("href"),$(this).data("target")||"_self")});$(".action.changeuri").off(".changeuri").on("click.changeuri",a1);$(".action.refresh").off(".refresh").on("click.refresh",function(a2){$.MyPreventDefault(a2);ao();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",a1);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var a2=$(this);if(!a2.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=a2.data("href")?a2.data("href"):a2.attr("href")}})})}function a1(a2){$.MyPreventDefault(a2);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){G($(this).data("href")||$(this).attr("href")||$(this).data("uri"))}return false}function y(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(a2){$("#fileList tr:not(:hidden).unselectable-no").each(function(a3,a4){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(a2){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(a2){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function aq(){$("#flt").on("bookmarksChanged",p).on("bookmarksChanged",u).on("fileListChanged",function(){p();u()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aC)}function az(a2,a3){$.each(a2,function(a6,a5){var a4=$(a5);if(a4.hasClass("hideit")){a4.toggle(!a3)}if(a4.hasClass("button")){a4.button("option","disabled",a3)}if(!a4.hasClass("notab")){a4.attr("tabindex",a3?-1:0)}a4.toggleClass("disabled",a3)})}function u(){var a6=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var a2=false;var a5=0;var a4=0;while(X("bookmark"+a4)!=null){if(X("bookmark"+a4)==a6){a2=true}if(X("bookmark"+a4)!="-"){a5++}a4++}$(".action.addbookmark").button("option","disabled",a2);az($(".action.rmbookmark"),!a2);az($(".action.bookmarksortpath"),a5<2);az($(".action.bookmarksorttime"),a5<2);az($(".action.rmallbookmarks"),a5===0);var a3=X("bookmarksort")==null?"time-desc":X("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(a3=="path"||a3=="path-desc"||a3=="time"||a3=="time-desc"){$("#bookmarks .action.bookmarksort"+a3.replace(/-desc/,"")+" ."+a3).show()}}function p(){var a7=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(a8,a9){$(a9).remove()});var a6=[];var a4=0;while(X("bookmark"+a4)!=null){if(X("bookmark"+a4)!="-"){a6.push({path:X("bookmark"+a4),time:parseInt(X("bookmark"+a4+"time"))})}a4++}var a5=X("bookmarksort")?X("bookmarksort"):"time-desc";var a2=1;if(a5.indexOf("-desc")>0){a2=-1;a5=a5.replace(/-desc/,"")}a6.sort(function(a9,a8){if(a5=="path"){return a2*a9[a5].localeCompare(a8[a5])}else{return a2*(a8[a5]-a9[a5])}});var a3=$("#bookmarktemplate").html();$.each(a6,function(a8,ba){var a9=unescape(ba.path);$("<li>"+a3.replace(/\$bookmarkpath/g,ba.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(a9,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aC).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",ba.path).attr("data-htmltooltip",$.MyStringHelper.simpleEscape(a9)+"%0D"+(new Date(parseInt(ba.time)))).attr("tabindex",ba.path==a7?-1:0).toggleClass("disabled",ba.path==a7).find(".action.rmsinglebookmark").click(aC).MyKeyboardEventHandler()})}function j(a3){var a2=0;while(X("bookmark"+a2)!=null&&X("bookmark"+a2)!=a3){a2++}if(X("bookmark"+a2)==a3){X("bookmark"+a2,"-",1)}$("#flt").trigger("bookmarksChanged")}function aC(a5){$.MyPreventDefault(a5);if($(this).hasClass("disabled")){return}var a2=$(this);var a4=$("#fileList").attr("data-uri");if(a2.hasClass("addbookmark")){var a3=0;while(X("bookmark"+a3)!=null&&X("bookmark"+a3)!="-"&&X("bookmark"+a3)!=""&&X("bookmark"+a3)!=a4){a3++}X("bookmark"+a3,a4,1);X("bookmark"+a3+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(a2.hasClass("dyn-bookmark")){G(a2.attr("data-bookmark"));a2.closest("ul").hide()}else{if(a2.hasClass("rmbookmark")){j(a4)}else{if(a2.hasClass("rmallbookmarks")){var a3=0;while(X("bookmark"+a3)!=null){ai("bookmark"+a3,"bookmark"+a3+"time");a3++}$("#flt").trigger("bookmarksChanged")}else{if(a2.hasClass("rmsinglebookmark")){j($(this).attr("data-bookmark"))}else{if(a2.hasClass("bookmarksortpath")){X("bookmarksort",X("bookmarksort")=="path"||X("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(a2.hasClass("bookmarksorttime")){X("bookmarksort",X("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function au(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",aj).on("fileListViewChanged",aj)}function aj(){var a4=$("#selstats");var a2=a4.data("selstats");var a3=aB();$("#fileListTable").attr("data-fileselcounter",a3.fileselcounter).attr("data-dirselcounter",a3.dirselcounter).attr("data-folderselsize",a3.folderselsize).attr("data-sumselcounter",a3.sumselcounter);$("#flt").trigger("selectionCounterUpdated");a4.html(a2.replace(/\$filecount/g,a3.fileselcounter).replace(/\$dircount/g,a3.dirselcounter).replace(/\$sum/g,a3.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(a3.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(a3.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(a3.folderselsize)).MyTooltip()}function aE(){$("#pathinputform").submit(function(a2){return false});$("#pathinputform input[name='uri']").keydown(function(a2){if(a2.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(a2.keyCode==13){$.MyPreventDefault(a2);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();G($(this).val())}}});$(".action.changedir").button().click(function(a2){$.MyPreventDefault(a2);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(a2){$.MyPreventDefault(a2);$("#pathinput").hide();$("#quicknav").show();G($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function R(){$("form#filterbox").submit(function(a2){return false});$("form#filterbox input").keyup(w).change(w).autocomplete({minLength:1,select:w,close:w});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(a2){$.MyPreventDefault(a2);$("form#filterbox input").val("");w();$(this).addClass("invisible")});$("#flt").on("fileListChanged",w).on("fileListChanged",function(){var a2=$.map($("#fileList tr"),function(a4,a3){return $(a4).attr("data-file")});$("form#filterbox input").autocomplete({source:function(a4,a3){try{var a6=new RegExp(a4.term);a3($.grep(a2,function(a7){return a6.test(a7)}))}catch(a5){a3($.grep(a2,function(a7){return a7.indexOf(a4.term)>-1}))}}})})}function w(){var a2=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var a4=new RegExp(a2,"i");if(a2===""||$(this).attr("data-file").match(a4)){$(this).show()}else{$(this).hide()}}catch(a3){if(a2===""||$(this).attr("data-file").toLowerCase().indexOf(a2.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function t(a3,a4){if(!a4){a4=a3}var a2=a4.loaded/a4.total*100;$("#progress .bar").css("width",a2.toFixed(2)+"%").html(parseInt(a2)+"% ("+$.MyStringHelper.renderByteSize(a4.loaded)+"/"+$.MyStringHelper.renderByteSize(a4.total)+"); "+a3.done+"/"+a3.uploads)}function ah(a4,a6,a3,a5){$("#flt").on("fileListChanged",function(){a4.fileupload("option","url",$("#fileList").attr("data-uri"))});var a2={aborted:false,transports:[],done:0,failed:0,uploads:0};a4.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:a5,singleFileUploads:true,autoUpload:false,add:function(ba,a9){if(!a2.aborted){var bb=a9.submit();var a8=a9.files[0].name;a2.transports.push(bb);var a7=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+a8).addClass("fileprogress");$("<div></div>").click(function(bc){$.MyPreventDefault(bc);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(a7).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:a8,transport:bb});$("<div></div>").appendTo(a7).addClass("fileprogressbar running").html(a9.files[0].name+" ("+$.MyStringHelper.renderByteSize(a9.files[0].size)+"): 0%");a2.uploads++;return true}return false},done:function(a8,a7){$("#progress [id='fpb"+a7.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a7.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(a7.result.message?"done":"failed").css("width","100%").html(a7.result&&a7.result.error?a7.result.error:a7.result.message?a7.result.message:a7.files[0].name);if(a7.result.message){a2.done++}else{a2.failed++}t(a2)},fail:function(a8,a7){$("#progress [id='fpb"+a7.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a7.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(a7.textStatus+": "+$.map(a7.files,function(a9,ba){return a9.name}).join(", "));a2.failed++;t(a2);console.log(a7)},stop:function(a8,a7){t(a2);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){ao()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(a8,a7){a2.transports=[];a2.aborted=false;a2.files=[];a2.uploads=0;a2.failed=0;a2.done=0;return true},start:function(a9,a8){var a7=[];a7.push({text:$("#close").html(),disabled:true});a7.push({text:$("#cancel").html(),click:function(){if(a2.aborted){return}a2.aborted=true;$.each(a2.transports,function(ba,bb){if(bb&&bb.abort){bb.abort($("#uploadaborted").html())}});a2.transports=[]}});$("#progress").dialog({modal:true,title:a3,height:370,width:500,buttons:a7,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(a9,a8){var a7=parseInt(a8.loaded/a8.total*100)+"%";$("div[id='fpb"+a8.files[0].name+"'] .fileprogressbar","#progress .info").css("width",a7).html(a8.files[0].name+" ("+$.MyStringHelper.renderByteSize(a8.files[0].size)+"): "+a7)},progressall:function(a8,a7){a2.total=a7.total;a2.loaded=a7.loaded;t(a2,a7)},submit:function(a8,a7){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",X("settings.confirm.upload")=="no"||!O(a7)||window.confirm(a6))}$("#file-upload-form-relapath").val(a7.files[0].relativePath||(a7.files[0].webkitRelativePath&&a7.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function O(a3){for(var a2=0;a2<a3.files.length;a2++){var a4;if(a3.files[a2].relativePath&&a3.files[a2].relativePath!=""){a4=a3.files[a2].relativePath.split(/[\\\/]/)[0]+"/"}else{if(a3.files[a2].webkitRelativePath&&a3.files[a2].webkitRelativePath!=""){a4=a3.files[a2].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(a4&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(a4)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(a3.files[a2].name)+"']").length>0){return true}}}return false}function at(){ah($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(a2){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(a2){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(a2){$("#fileList").addClass("draghover")}).on("dragleave",function(a2){$("#fileList").removeClass("draghover")}).on("drop",function(a2){$("#fileList").removeClass("hover")})}function F(a4,a2){var a3;if(a2.setting){a4+='<div class="confirmdialogsetting"><input type="checkbox" name="'+a2.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";a3=X(a2.setting)}$("#confirmdialog").html(a4).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(a2.setting){v(a2.setting,a3,a3&&a3!=="",1)}$("#confirmdialog").dialog("close");if(a2.cancel){a2.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(a2.confirm){a2.confirm()}}}],open:function(){if(a2.setting){$("input[name='"+a2.setting+"']",$(this)).click(function(a5){v(a2.setting,"no",!$(this).is(":checked"),1)}).prop("checked",X(a2.setting)!="no")}},close:function(){if(a2.cancel){a2.cancel()}}}).show()}function aZ(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function l(a3){var a2=$("#fileList tr.selected:visible");if(a2.length==0){a2=$(a3).closest("tr[data-file]")}if(a2.length==0){a2=$("#fileList tr:visible:focus")}return a2}function aw(a2){return $.map(l(a2),function(a3,a4){return $(a3).attr("data-file")})}function aN(a3){$.MyPreventDefault(a3);var a2=$(this);if(a2.hasClass("disabled")){return}var a4=a2.closest("tr");if(a2.hasClass("rename")){aK(a4)}else{if(a2.hasClass("delete")){I(a4)}else{$("body").trigger("fileActionEvent",{obj:a2,event:a3,file:a4.attr("data-file"),selected:[a4.data("file")],row:a4})}}}function g(){$("#fileactions").on("click dblclick",function(a2){$.MyPreventDefault(a2);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aN).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",al).on("mouseleave.fileAction",k)}).on("beforeFileListChange replaceRow",k);h();$("body").on("settingchanged",h)}function h(a2,a3){$("#fileactions").toggleClass("hidefileactions",X("settings.show.fileactions")=="no").toggleClass("hidelabels",X("settings.show.fileactionlabels")=="no").toggleClass("showalways",X("settings.show.fileactionalways")=="no")}function al(a3){var a2=$(this);if($("#fileactions",a2).length===0){$(".action.changeuri.filename",a2).after($("#fileactions"))}}function k(a2){$("#fileactions").appendTo($(".template"))}function aA(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(a4,a3){var a2=$(a3);if(!a2.attr("href")){a2.data("fancybox-href",a2.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(a2){return(a2.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(a4,a3){var a2=$(a3);if(!a2.attr("href")){a2.data("fancybox-href",a2.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function ap(){var a3=$("#fileListTable");var a2=$("#fileList");$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",P).off("dblclick.initFileList").on("dblclick.initFileList",function(a4){G($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:z,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:aZ,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable").MyTableManager();ac();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function ac(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var a2=window.getSelection();if(a2&&a2.removeAllRanges){a2.removeAllRanges()}}}}function I(a2){a2.fadeTo("slow",0.5);F($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(a2.attr("data-displayname")))),{confirm:function(){var a3=a2.attr("data-file");C(a2);var a4=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:a3},function(a5){if(a5.error){ao()}J(a5)});D(a4)},cancel:function(){a2.fadeTo("fast",1)}})}function J(a2){if(a2.error){aU(a2.error)}if(a2.warn){aO(a2.warn)}if(a2.message){b(a2.message)}if(a2.quicknav){$("#quicknav").html(a2.quicknav).MyTooltip();$("#quicknav a").click(function(a3){$.MyPreventDefault(a3);G($(this).attr("href"))})}}function s(a5,a3,a2){var a4=$.MyPost($("#fileList").attr("data-uri"),{rename:"yes",newname:a2,file:a3},function(a6){if(a6.message){var a7=$.MyPost($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:a2,template:$("#fileList").attr("data-entrytemplate")},function(a8){try{var a9=$(a8);var bb=$("tr[data-file='"+a2+"']");if(bb.length>0){bb.remove()}$("#flt").trigger("replaceRow",{row:a5,newrow:a9});a5.replaceWith(a9);a5=a9;ap();a9.focus()}catch(ba){ao()}},1);D(a7)}J(a6)});D(a4)}function aK(a4){var a3=a4.closest("tr[data-file]").data("file");var a2=a3.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:a4.find("td.filename"),defaultValue:a2,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(a6){var a5=a6.value.replace(/\//g,"");if(a5==a2){return}if(X("settings.confirm.rename")!="no"){F($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(a3)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(a5)),{confirm:function(){s(a4,a3,a5)},setting:"settings.confirm.rename"})}else{s(a4,a3,a5)}}})}function aG(a2,a3){console.log("notify["+a2+"]: "+a3);if(X("settings.messages."+a2)=="no"){return}noty({text:a3,type:a2,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:a2,msg:a3})}function aU(a2){aG("error",a2)}function b(a2){aG("message",a2)}function aO(a2){aG("warning",a2)}function aY(a3,a2){if(!a3){return}a3.toggleClass("selected",a2);a3.find(".selectbutton").prop("checked",a3.hasClass("selected"))}function N(a2){return a2.attr("data-file")!=".."&&!a2.hasClass("unselectable-yes")}function P(a4){var a8=$("#fileListTable");if(N($(this))){var a7=this.rowIndex;var a2=a7;if((a4.shiftKey||a4.metaKey||a4.altKey)&&a8.data("lastSelectedRowIndex")){a2=a8.data("lastSelectedRowIndex");if(a2<a7){var a6=a2;a2=a7;a7=a6}for(var a3=a7+1;a3<a2;a3++){var a5=$("#fileList tr:visible").filter(function(){return this.rowIndex==a3});if(a5.length===0){continue}aY(a5);a5=a5.next()}}aY($(this));a8.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function aX(){$(".dialog.action").click(ax)}function ax(a3){$.MyPreventDefault(a3);if($(this).hasClass("disabled")){return}var a2=$(this);a2.addClass("disabled");var a4=$("#"+a2.attr("data-action"));if(a4.attr("title")){a4.data("title",a4.attr("title"))}a4.attr("title",a4.data("title"));a4.dialog({modal:true,width:"auto",open:function(){if(a4.data("initHandler")){a4.data("initHandler").init()}},close:function(){a2.removeClass("disabled")},dialogClass:a2.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function H(){a0();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",aS).on("fileListViewChanged",aS)}function a0(){az($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function aS(){var a3=aB();var a4=$("#fileListTable");var a2=a4.hasClass("iswriteable-no")?":not(.access-writeable)":"";a2+=a4.hasClass("isreadable-no")?":not(.access-readable)":"";a2+=a4.hasClass("unselectable-no")?":not(.access-selectable)":"";az($(".access-writeable"),a4.hasClass("iswriteable-no"));az($(".access-readable"),a4.hasClass("isreadable-no"));az($(".access-selectable"),a4.hasClass("unselectable-yes"));az($(".sel-none"+a2),a3.sumselcounter!==0);az($(".sel-one"+a2),a3.sumselcounter!=1);az($(".sel-multi"+a2),a3.sumselcounter===0);az($(".sel-noneorone"+a2),a3.sumselcounter>1);az($(".sel-none.sel-dir"+a2),a3.fileselcounter!==0);az($(".sel-one.sel-dir"+a2),a3.fileselcounter>0||a3.dirselcounter!=1);az($(".sel-multi.sel-dir"+a2),a3.fileselcounter>0||a3.dirselcounter===0);az($(".sel-noneorone.sel-dir"+a2),a3.fileselcounter>0||a3.dirselcounter>1);az($(".sel-noneormulti.sel-dir"+a2),a3.fileselcounter>0);az($(".sel-none.sel-file"+a2),a3.fileselcounter!==0);az($(".sel-one.sel-file"+a2),a3.dirselcounter>0||a3.fileselcounter!=1);az($(".sel-multi.sel-file"+a2),a3.dirselcounter>0||a3.fileselcounter===0);az($(".sel-noneorone.sel-file"+a2),a3.dirselcounter>0||a3.fileselcounter>1);az($(".sel-noneormulti.sel-file"+a2),a3.dirselcounter>0)}function am(){$("#flt").on("fileListChanged",ab).on("fileListViewChanged",ab)}function A(a2){if(!a2){a2=$("#fileListTable")}if(a2&&a2.attr){a2.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function av(){var a3=$("#fileListTable");A(a3);var a2=aB();a3.attr("data-dircounter",a2.dircounter);a3.attr("data-filecounter",a2.filecounter);a3.attr("data-foldersize",a2.foldersize);a3.attr("data-sumcounter",a2.sumcounter);$("#flt").trigger("counterUpdated")}function aB(){var a3=[];a3.dircounter=$("#fileList tr.is-subdir-yes:visible").length;a3.filecounter=$("#fileList tr.is-file:visible").length;a3.sumcounter=a3.dircounter+a3.filecounter;a3.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;a3.fileselcounter=$("#fileList tr.selected.is-file:visible").length;a3.sumselcounter=a3.dirselcounter+a3.fileselcounter;var a2=0;var a4=0;$("#fileList tr:visible").each(function(a6,a7){var a5=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){a4+=a5}a2+=a5});a3.foldersize=a2;a3.folderselsize=a4;return a3}function ab(){var a4=$("#headerName");var a5=$("#fileListTable");var a3=$("#headerSize");av();if(a4.length>0&&!a4.attr("data-title")){a4.attr("data-title",a4.attr("title"))}if(a3.length>0&&!a3.attr("data-title")){a3.attr("data-title",a3.attr("title"))}if(a4.length>0){a4.attr("title",a4.attr("data-title").replace(/\$filecount/,a5.attr("data-filecounter")).replace(/\$dircount/,a5.attr("data-dircounter")).replace(/\$sum/,parseInt(a5.attr("data-dircounter"))+parseInt(a5.attr("data-filecounter"))))}var a2=parseInt(a5.attr("data-foldersize"));if(a3.length>0){a3.attr("title",a3.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(a2)))}}function aT(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var a2=history.location||document.location;ao(a2.pathname)})}function G(a3,a2){try{if(!a2){if(window.history.pushState){window.history.pushState({path:a3},"",a3);ao(a3)}else{ao(a3)}return}}catch(a4){console.log(a4)}if(!a2){ak()}window.location.href=a3}function ao(a2,a4){if(!a2){a2=$("#fileList").attr("data-uri")}if(!a2){a2=window.location.href}if(!a4){a4={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var a3=$.now();$("#flt").data("timestamp",a3);$.MyPost(a2,a4,function(a5){if($("#flt").data("timestamp")!=a3){return}$("#flt").trigger("beforeFileListChange").show().html(a5.content).attr("data-uri",a2);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+a2.replace(/\/[^\/]+\/\.\.$/,"/"));ap();J(a5)},true)}function C(a2){$("#flt").trigger("beforeFileListChange");a2.remove();$("#flt").trigger("fileListChanged")}function x(a4,a2,a5,a3){var a6=$.MyPost(a5,{srcuri:a2,action:a4,files:a3.join("@/@")},function(a7){if(a7.message&&a4=="cut"){C($("#fileList tr[data-file='"+a3.join("'],#fileList tr[data-file='")+"']"))}if(a7.error){ao()}J(a7)});D(a6)}function z(a5,a7){var a2=a7.draggable.closest("tr");var a8=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var a3=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(a8==$.MyStringHelper.concatUri(a3,encodeURIComponent($.MyStringHelper.stripSlash(a2.attr("data-file"))))+"/"){return}var a6=a5.shiftKey||a5.altKey||a5.ctrlKey||a5.metaKey?"copy":"cut";var a4=a2.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bb,ba){return $(bb).attr("data-file")}):new Array(a2.attr("data-file"));if(X("settings.confirm.dnd")!="no"){var a9=$("#paste"+a6+"confirm").html();a9=a9.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a4.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a3))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a8))).replace(/\\n/g,"<br/>");F(a9,{confirm:function(){x(a6,a3,a8,a4)},setting:"settings.confirm.dnd"})}else{x(a6,a3,a8,a4)}}function ak(){return $("<div></div>").prependTo("body").addClass("overlay")}function ag(a5,a6,a4){for(var a3 in a6){var a2=a6[a3];if(typeof a2==="object"){ag(a5,a2,a3)}else{if(a4){a5.append($("<input/>").prop("name",a4).prop("value",a2).prop("type","hidden"))}else{a5.append($("<input/>").prop("name",a3).prop("value",a2).prop("type","hidden"))}}}return a5}function aQ(a3){var a2=$("<form/>").appendTo("body");a2.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");ag(a2,a3);a2.submit();a2.remove()}function V(a4){var a3=$(this);var a2=l(this);a2.fadeTo("slow",0.5);F(a2.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(a2.first().attr("data-file")))),{confirm:function(){if(a2.length===0){a2=a3.closest("tr")}var a5=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(a2,function(a6,a7){return $(a6).attr("data-file")})},function(a6){C(a2);ad();if(a6.error){ao()}J(a6)});D(a5)},cancel:function(){a2.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ad(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function U(a4,a2,a5,a3){var a6=$.MyPost(a5,{action:a4,files:a3,srcuri:a2},function(a7){if(X("clpaction")=="cut"){ai("clpfiles","clpaction","clpuri")}ao();J(a7)});D(a6)}function B(a2){$.MyPreventDefault(a2);var a9=$(this);if(a9.hasClass("disabled")){return}if(a9.hasClass("delete")){V.call(this,a2)}else{if(a9.hasClass("rename")){aK(a9.closest("tr"))}else{if(a9.hasClass("cut")||a9.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var a5=$.map(l(a9),function(bc,bb){return $(bc).attr("data-file")});X("clpfiles",a5.join("@/@"));X("clpaction",a9.hasClass("cut")?"cut":"copy");X("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(a9.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}M();ad()}else{if(a9.hasClass("paste")){var a3=X("clpfiles");var a6=X("clpaction");var a8=X("clpuri");var a7=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(X("settings.confirm.paste")!="no"){var a4=$("#paste"+a6+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(a8)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(a7)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(a3.split("@/@").join(", ")));F(a4,{confirm:function(){U(a6,a8,a7,a3)},setting:"settings.confirm.paste"})}else{U(a6,a8,a7,a3)}}else{if(a9.attr("href")!==undefined&&a9.attr("href")!="#"){window.open(a9.attr("href"),a9.attr("target")||"_self")}else{var ba=a9.closest("tr");$("body").trigger("fileActionEvent",{obj:a9,event:a2,file:ba.attr("data-file"),row:ba,selected:aw(this)})}}}}}}function X(a4,a5,a2){var a3=new Date();a3.setTime(a3.getTime()+315360000000);if(a5){return Cookies.set(a4,a5,{path:$("#flt").attr("data-baseuri"),secure:true,expires:a2?a3:undefined})}return Cookies.get(a4)}function ai(){for(var a2=0;a2<arguments.length;a2++){Cookies.remove(arguments[a2],{path:$("#flt").attr("data-baseuri"),secure:true})}}function v(a4,a5,a2,a3){if(a2){X(a4,a5,a3)}else{ai(a4)}}function aa(){M();$("#flt").on("fileListChanged",M)}function M(){var a6=X("clpaction");var a2=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var a4=X("clpuri");var a5=X("clpfiles");var a3=(!a5||a5===""||a4==a2||$("#fileListTable").hasClass("iswriteable-no"));az($(".action.paste"),a3);if(a4==a2&&a6=="cut"){$.each(a5.split("@/@"),function(a7,a8){$("[data-file='"+a8+"']").addClass("cutted").fadeTo("fast",0.5)})}}function L(){$("#nav .action").click(B).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function q(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(B).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var a2={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(a3){$("#flt").disableSelection();if(a3){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(a2,{changeEvent:function(a4){var a3=$(this);$.MyPost($("#fileList").attr("data-uri"),{mkcol:"yes",colname:a4.value},function(a5){if(!a5.error&&a5.message){ae(a4.value)}J(a5)})}}));$(".action.create-file").MyInplaceEditor($.extend(a2,{changeEvent:function(a4){var a3=$(this);$.MyPost($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:a4.value},function(a5){if(!a5.error&&a5.message){ae(a4.value)}J(a5)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(a2,{changeEvent:function(a3){var a4=l(this);$.MyPost($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:a3.value,file:a4.attr("data-file")},function(a5){if(!a5.error&&a5.message){ae(a3.value)}J(a5)})}}))}function f(){$(".action.viewfilter").click(function(a4){$.MyPreventDefault(a4);if($(this).hasClass("disabled")){return}var a2=$(this);$(".action.viewfilter").addClass("disabled");var a5=$("#fileList").attr("data-uri");var a3=a2.attr("data-template");$.MyPost(a5,{ajax:"getViewFilterDialog",template:a3},function(a6){var a7=$(a6);$("input[name='filter.size.val']",a7).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",a7).button().click(function(a9){$.MyPreventDefault(a9);v("filter.name",$("select[name='filter.name.op'] option:selected",a7).val()+" "+$("input[name='filter.name.val']",a7).val(),$("input[name='filter.name.val']",a7).val()!=="");v("filter.size",$("select[name='filter.size.op'] option:selected",a7).val()+$("input[name='filter.size.val']",a7).val()+$("select[name='filter.size.unit'] option:selected",a7).val(),$("input[name='filter.size.val']",a7).val()!=="");if($("input[name='filter.types']:checked",a7).length>0){var a8="";$("input[name='filter.types']:checked",a7).each(function(ba,bb){a8+=$(bb).val()});X("filter.types",a8)}else{ai("filter.types")}a7.dialog("close");ao()});$(".filter-reset",a7).button().click(function(a8){$.MyPreventDefault(a8);ai("filter.name","filter.size","filter.types");a7.dialog("close");ao()});a7.submit(function(){return false});a7.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:a2.attr("title")||a2.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");a7.remove()}}).show()})})}function D(a5,a4,a3){$("#abortdialog").remove();var a2=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",a2).button().click(function(a6){if(a5.readyState!=4){a5.abort()}a2.hide().remove();if(a3){a3.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(a5.readyState>2){return}a2.appendTo($("body")).show();var a6=window.setInterval(function(){if(a5.readyState==4){a2.hide().remove();window.clearInterval(a6)}},200);$("body").data("abortdialoginterval",a6)},a4||2500));return a2}function aL(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function o(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var a4="";var a2=$("*[accesskey]").get().sort(function(a6,a5){var a7=$(a6).attr("accesskey");var a8=$(a5).attr("accesskey");return a7<a8?-1:a7>a8?1:0});var a3=[];$.each(a2,function(a6,a5){var a7=$(a5);var a8=a7.attr("accesskey");if(!a3[a8]){a4+='<li tabindex="0" role="definition">'+a8+": "+(a7.attr("aria-label")||a7.attr("title")||a7.attr("data-tooltip")||a7.html())+"</li>";a3[a8]=true}else{console.log("found accesskey "+a8+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+a4+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function aR(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(a4){$.MyPreventDefault(a4);var a2=$(this);if(a2.hasClass("disabled")){return}if(a2.hasClass("table-sort")){var a3=$.MyTableManager.getLastTableSort();$.MyTableManager.sortTable(a2.closest("table"),a2.data("name"),a3.name==a2.data("name")?-a3.sortorder:1)}else{if(a2.hasClass("table-sort-this-asc")){$.MyTableManager.sortTable(a2.closest("table"),a2.closest("th").data("name"),1)}else{if(a2.hasClass("table-sort-this-desc")){$.MyTableManager.sortTable(a2.closest("table"),a2.closest("th").data("name"),-1)}else{if(a2.hasClass("table-column-hide-this")){$.MyTableManager.toggleTableColumn(a2.closest("table"),a2.closest("th:not(.table-column-not-hide)").data("name"),false)}else{if(a2.hasClass("table-column")){$.MyTableManager.toggleTableColumn(a2.closest("table"),a2.data("name"))}else{if(a2.hasClass("table-column-width-default")){$.MyTableManager.setTableColumnWidth(a2.closest("th"),"default")}else{if(a2.hasClass("table-column-width-minimum")){$.MyTableManager.setTableColumnWidth(a2.closest("th"),"minimum")}}}}}}}}function aH(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable th[data-name].sorter-false").each(function(a4,a3){$(".action.table-sort."+$(a3).data("name")).addClass("hidden").hide()});$(".action.table-sort.fileactions").hide()});a2();function a2(){var a3=$.MyTableManager.getLastTableSort();$(".action.table-sort .symbol").removeClass("descending ascending");$(".action.table-sort."+a3.name+" .symbol").addClass(a3.sortorder==1?"descending":"ascending");$(".action.table-column .symbol").removeClass("column-hidden");$(".action.table-column").addClass("hidden disabled");$("#fileListTable th[data-name]").each(function(a5,a4){$(".action.table-column."+$(a4).data("name")).removeClass("hidden").toggleClass("disabled",$(a4).hasClass("table-column-not-hide")).find(".symbol").toggleClass("column-hidden",$(a4).is(":not(:visible)"))})}$("body").on("settingchanged",function(a3,a4){if(a4.setting=="order"||a4.setting=="visibletablecolumns"){a2()}})}function Q(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",B).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();aH();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){aR()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content",contextmenuAnchorElement:true})});$("body").off(".popupmenu").on("click.popupmenu",function(){aR()}).on("keydown.popupmenu",function(a2){if(a2.which==27){aR()}});$("#filler").on("contextmenu",function(a2){if(a2.which==3){if(a2.originalEvent.detail===1){$.MyPreventDefault(a2)}aR()}})}function ae(a2){var a3=$("#fileList");return $.MyPost($.MyStringHelper.addMissingSlash(a3.data("uri")),{ajax:"getFileListEntry",template:a3.data("entrytemplate"),file:a2},function(a4){try{var a5=$(a4);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(a2)+"']",a3);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:a5});row.replaceWith(a5)}else{a5.appendTo(a3)}ap();a5.focus()}catch(a6){ao()}},true)}function aP(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(a3,a2){if(a2.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!a2.value);$("#flt").trigger("fileListViewChanged")}else{if(a2.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!a2.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",X("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",X("settings.show.dotfolders")=="no")}function aF(){var a2=X("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(a6,a5){var a4=$(this);if(a4.data("thumb")!=a4.data("icon")){var a3=a4.data("thumb");var a7=a4.data("icon");var a8=$("#emptyimage").attr("src");a4.attr("src",a2?(a3===""?a8:a3):(a7===""?a8:a7));a4.toggleClass("thumbnail",a2)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(a3,a2){if(a2.setting=="settings.enable.thumbnails"){aF()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var a2=$(this);var a3=a2.data("icon");a2.removeClass("thumbnail").attr("src",a3!==""?a3:$("#emptyimage").attr("src"))})})}function m(a3,a2){var a4=$.MyGet(window.location.pathname,a3,function(a5){J(a5);a2(a5)});D(a4)}function ar(a3,a2){var a4=$.MyPost(window.location.pathname,a3,function(a5){J(a5);a2(a5)});D(a4)}function W(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:ak,changeUri:G,concatUri:$.MyStringHelper.concatUri,confirmDialog:F,cookie:X,fixElementPosition:T,getDialog:m,getDialogByPost:ar,getSelectedFiles:aw,getSelectedRows:l,handleJSONResponse:J,handleWindowResize:r,hidePopupMenu:aR,initFileList:ap,initPopupMenu:Q,initTabs:Z,initUpload:ah,notify:aG,notifyError:aU,notifyInfo:b,notifyWarn:aO,preventDefault:$.MyPreventDefault,preventDefaultImmediatly:$.MyPreventDefaultImmediatly,postAction:aQ,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:ae,removeAbortDialog:aL,renderAbortDialog:D,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:ai,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:v,toggleRowSelection:aY,uncheckSelectedRows:ad,updateFileList:ao}}function af(){$.fn.MyTooltip.defaults.helphandler=ay;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){ay.call(this,$(this).data("help"))})}function ay(a3){var a2=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:a3,width:"99%",height:"99%"}).text(a3)).dialog({width:a2.width()/2,height:a2.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
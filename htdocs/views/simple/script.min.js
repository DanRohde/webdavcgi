var ToolBox={};$(function(){aP();P();al();G();g();X();ah();q();K();az();Q();an();ao();aR();f();e();x();D();av();n();J();V();ai();d();aE();aJ();c();ay();aN();aQ();W();U();ac();$.ajaxSetup({traditional:true});$(document).ajaxError(function(aX,aY,aW,aV){console.log(aX);console.log(aY);console.log(aW);console.log(aV);if(aY&&aY.statusText&&aY.statusText!="abort"){aO(aY.statusText)}$.MyPageBlocker("remove")}).ajaxSuccess(function(aW,aY,aV,aX){if(aY.getResponseHeader("X-Login-Required")){window.alert($("#login-session").text());window.location.href=aY.getResponseHeader("X-Login-Required")}});$.ajaxPrefilter("script",function(aV,aX,aW){aV.cache=true});aj($("#flt").attr("data-uri"));function W(aV){if(!aV){aV=$(document)}$(".tabsel",aV).on("click keyup",function(aY){if(aY.type=="keyup"&&aY.keyCode!=32&&aY.keyCode!=13){return}$.MyPreventDefault(aY);var aW=$(this);$(".tabsel.activetabsel",aV).removeClass("activetabsel");aW.addClass("activetabsel");$(".tab.showtab",aV).removeClass("showtab");var aX=$(".tab."+aW.data("group"),aV).addClass("showtab");$(":focusable:visible:first",aX).focus()})}function aQ(){if(!$.MyCookie("settings.show.statusbar")){$.MyCookie("settings.show.statusbar","no");$.MyCookie("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",$.MyCookie("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(aW){$(this).prop("checked",true);$.MyPreventDefault(aW)});function aV(){var aX=$("#fileListTable");var aW=$("#statusbar");$(".filecount",aW).html(aX.attr("data-filecounter"));$(".dircount",aW).html(aX.attr("data-dircounter"));$(".sum",aW).html(aX.attr("data-sumcounter"));$(".foldersize",aW).attr("title",$.MyStringHelper.renderByteSizes(aX.data("foldersize"))).html($.MyStringHelper.renderByteSize(aX.data("foldersize")));$(".selfilecount",aW).html(aX.attr("data-fileselcounter"));$(".seldircount",aW).html(aX.attr("data-dirselcounter"));$(".selsum",aW).html(aX.attr("data-sumselcounter"));$(".selfoldersize",aW).attr("title",$.MyStringHelper.renderByteSizes(aX.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(aX.attr("data-folderselsize")));$(".selected-files-stats",aW).toggle(aX.attr("data-fileselcounter")!==0||aX.attr("data-dirselcounter")!==0)}aV();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",aV);$("body").on("notify",function(aW,aX){$("#statusbar .notify").attr("title",aX.msg).removeClass("error message warning").addClass(aX.type).html(aX.msg).MyTooltip()});$("body").on("settingchanged",function(aW,aX){if(aX.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",aX.value)}});$("#statusbar").MyTooltip()}function ay(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aE(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(aX){var aW=this.tabIndex||1;var aV=$(this);if(aV.is(":focus")){if(aX.keyCode==32){O.call(this,aX)}else{if(aX.keyCode==13){F($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(aV.attr("data-file")))),aV.attr("data-type")=="file")}else{if(aX.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(M(aV)){H(aV)}}else{T()}}else{if(aX.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(aX.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(aX.keyCode==45){$(".paste").trigger("click")}}}}}}}if(aX.keyCode==38&&aW>-1){$.MyPreventDefault(aX);if(M(aV)&&(aX.shiftKey||aX.altKey||aX.ctrlKey||aX.metaKey)){aS(aV,true);$("#flt").trigger("fileListSelChanged")}aV.prevAll(":focusable:first").focus();Z()}else{if(aX.keyCode==40){$.MyPreventDefault(aX);if(M(aV)&&(aX.shiftKey||aX.altKey||aX.ctrlKey||aX.metaKey)){aS(aV,true);$("#flt").trigger("fileListSelChanged")}aV.nextAll(":focusable:first").focus();Z()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",o);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(aX){$.MyPreventDefault(aX);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var aW=$("#flt").data("TableConfigDialog");if(aW){i($(aW))}else{if($("#tableconfigdialogtemplate").length>0){var aV=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",aV);i($(aV))}else{$.MyPost($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(aY){if(aY.error){I(aY)}$("#flt").data("TableConfigDialog",aY);i($(aY))})}}}).MyKeyboardEventHandler()})}function i(aW){var aY=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(a1,a0){return $(a1).attr("data-name")});$.each(aY,function(a0,a1){aW.find("input[name='visiblecolumn'][value='"+a1+"']").prop("checked",true)});aW.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(a0){$.MyPreventDefault(a0)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(a0,a1){aW.find("input[name='sortingcolumn'][value='"+$(a1).attr("data-name")+"']").prop("disabled",true).click(function(a2){$.MyPreventDefault(a2)}).closest("li").addClass("disabled")});var aZ=$.MyCookie("order")?$.MyCookie("order").split("_"):"name_asc".split("_");var aX=aZ[0];var aV=aZ[1]||"asc";aW.find("input[name='sortingcolumn'][value='"+aX+"']").prop("checked",true);aW.find("input[name='sortingorder'][value='"+aV+"']").prop("checked",true);aW.find("input[value='fileactions']").closest("li").hide();aW.find("input[name='save']").button().click(function(a0){var a4=aY.slice(0);var a8=$.map($("input[name='visiblecolumn']:checked"),function(ba,a9){return $(ba).attr("value")});var a7=[];for(var a3=a4.length-1;a3>=0;a3--){if($.inArray(a4[a3],a8)==-1){a7.push(a4[a3]);a4.splice(a3,1)}}var a1=[];$.each(a8,function(a9,ba){if($.inArray(ba,a4)==-1){a1.push(ba);a4.push(ba)}});var a5=aW.find("input[name='sortingcolumn']:checked").attr("value");var a2=aW.find("input[name='sortingorder']:checked").attr("value");var a6=$("#fileListTable");if(a8.sort().join(",")!=aY.sort().join(",")){$.each(a1,function(a9,ba){$.MyTableManager.toggleTableColumn(a6,ba,true)});$.each(a7,function(a9,ba){$.MyTableManager.toggleTableColumn(a6,ba,false)})}$.MyTableManager.sortTable(a6,a5,a2=="desc"?-1:1);aW.dialog("close")});aW.find("input[name='cancel']").button().click(function(a0){$.MyPreventDefault(a0);aW.dialog("close");return false});aW.find("#tableconfigform").submit(function(a0){return false});aW.dialog({modal:true,width:"auto",title:aW.attr("data-title")||aW.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");aW.dialog("destroy")}})}function aD(aV){if(aV){$.MyPreventDefault(aV)}var aX=$(this).hasClass("collapsed");var aW=$(this).hasClass("iconsonly");if(!aX&&!aW){aW=true}else{if(aW){aW=false;aX=true}else{aX=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",aX).toggleClass("sidebar-iconsonly",aW);$(".action.collapse-sidebar").toggleClass("collapsed",aX).toggleClass("iconsonly",aW);if(!aW&&!aX){$.MyCookie.rmCookies("sidebar")}else{$.MyCookie("sidebar",aW?"iconsonly":aX?"false":"true")}r()}function ai(){$(".action.collapse-sidebar").click(aD).MyKeyboardEventHandler().MyTooltip();if($.MyCookie("sidebar")&&$.MyCookie("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",$.MyCookie("sidebar")=="false").toggleClass("sidebar-iconsonly",$.MyCookie("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",$.MyCookie("sidebar")=="false").toggleClass("iconsonly",$.MyCookie("sidebar")=="iconsonly");r()}$(".action.collapse-head").click(function(aV){$.MyPreventDefault(aV);$(".action.collapse-head").toggleClass("collapsed");var aW=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!aW);$(".collapse-head-listener").toggleClass("head-collapsed",aW);$.MyCookie.toggleCookie("head","false",aW,1);r()}).MyTooltip().MyKeyboardEventHandler();if($.MyCookie("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function V(){$(".autorefreshmenu").on("dblclick",function(){aj()});au($(".action.autorefreshrunning, .autorefreshtimer"),true);$(document).on("mycountdowntimer-started",function(aW,aV){au($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running");R(aV.timeout)}).on("mycountdowntimer-paused",function(aW,aV){R(aV.timeout);$(".action.autorefreshtoggle").removeClass("running")}).on("mycountdowntimer-stopped",function(){au($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")}).on("mycountdowntimer-elapsed",function(aW,aV){R(aV.timeout)}).on("mycountdowntimer-lapsed",function(){R(0);aj()});$("#flt").on("fileListChanged",function(){if($.MyCookie("autorefresh")!==""&&parseInt($.MyCookie("autorefresh"),10)>0){$(document).MyCountdownTimer("start",parseInt($.MyCookie("autorefresh"),10))}});$(".action.setautorefresh").click(function(aV){if($(this).attr("data-value")==="now"){aj();return}$.MyCookie("autorefresh",$(this).attr("data-value"));$(document).MyCountdownTimer("start",parseInt($(this).data("value"),10))});$(".action.autorefreshclear").click(function(aV){if($(this).hasClass("disabled")){return}$(document).MyCountdownTimer("stop");$.MyCookie.rmCookies("autorefresh")});$(".action.autorefreshtoggle").click(function(aV){if($(this).hasClass("disabled")){return}$(document).MyCountdownTimer("toggle")});$("#autorefreshtimer").MyFixedElementDragger()}function R(aV){var aX=$(".autorefreshtimer");var aY=aX.attr("data-template")||"%sm %ss";var aW=Math.floor(aV/60);var aZ=aV%60;if(aZ<10){aZ="0"+aZ}aX.html(aY.replace("%s",aW).replace("%s",aZ))}function J(){var aV=$("#settings");aV.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",aV).each(function(aX,aW){$(aW).prop("checked",$.MyCookie($(aW).prop("name"))!="no").click(function(aY){if($.MyCookie($(this).prop("name")+".keep")){$.MyCookie($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{$.MyCookie.toggleCookie($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",aV).change(function(){if($(this).prop("name")=="settings.lang"){$.MyCookie($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{$.MyCookie($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(aY,aW){var aZ=$(aW);var aX=aZ.prop("name");if(aX=="settings.lang"){aX=aX.replace(/^settings\./,"")}$("option[value='"+$.MyCookie(aX)+"']",aZ).prop("selected",true)})}})}function aP(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(aV){if(aV.keyCode==13||aV.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(aV){$.MyPreventDefault(aV);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function n(){$("#flt").on("fileListChanged",r).on("fileListViewChanged",r);$(window).resize(r);r()}function r(){var aV=$(window).width()-$("#nav").width();$("#content").width(aV);$("#controls").width(aV);$("body").trigger("windowResized")}function D(){$(".home-button[data-href], .logout-button[data-href], .contact-button[data-href], .link-button[data-href], .help-button[data-href]").off("click").attr("tabindex",0).on("click",function(){window.open($(this).data("href"),$(this).data("target")||"_self")});$(".action.changeuri").off(".changeuri").on("click.changeuri",aU);$(".action.refresh").off(".refresh").on("click.refresh",function(aV){$.MyPreventDefault(aV);aj();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",aU);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var aV=$(this);if(!aV.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=aV.data("href")?aV.data("href"):aV.attr("href")}})})}function aU(aV){$.MyPreventDefault(aV);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){F($(this).data("href")||$(this).attr("href")||$(this).data("uri"))}return false}function x(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(aV){$("#fileList tr:not(:hidden).unselectable-no").each(function(aW,aX){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(aV){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(aV){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function al(){$("#flt").on("bookmarksChanged",p).on("bookmarksChanged fileListSelChanged",u).on("fileListChanged",function(){p();u()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(ax)}function au(aV,aW){$.each(aV,function(aZ,aY){var aX=$(aY);if(aX.hasClass("hideit")){aX.toggle(!aW)}if(aX.hasClass("button")){aX.button("option","disabled",aW)}if(!aX.hasClass("notab")){aX.attr("tabindex",aW?-1:0)}aX.toggleClass("disabled",aW)})}function u(){var aZ=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var aV=false;var aY=0;var aX=0;while($.MyCookie("bookmark"+aX)!=null){if($.MyCookie("bookmark"+aX)==aZ){aV=true}if($.MyCookie("bookmark"+aX)!="-"){aY++}aX++}au($(".action.addbookmark"),aV);au($(".action.bookmarksortpath"),aY<2);au($(".action.bookmarksorttime"),aY<2);au($(".action.rmallbookmarks"),aY===0);var aW=$.MyCookie("bookmarksort")==null?"time-desc":$.MyCookie("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(aW=="path"||aW=="path-desc"||aW=="time"||aW=="time-desc"){$(".action.bookmarksort"+aW.replace(/-desc/,"")+" ."+aW).show()}}function p(){var a0=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(a1,a2){$(a2).remove()});var aZ=[];var aX=0;while($.MyCookie("bookmark"+aX)!=null){if($.MyCookie("bookmark"+aX)!="-"){aZ.push({path:$.MyCookie("bookmark"+aX),time:parseInt($.MyCookie("bookmark"+aX+"time"))})}aX++}var aY=$.MyCookie("bookmarksort")?$.MyCookie("bookmarksort"):"time-desc";var aV=1;if(aY.indexOf("-desc")>0){aV=-1;aY=aY.replace(/-desc/,"")}aZ.sort(function(a2,a1){if(aY=="path"){return aV*a2[aY].localeCompare(a1[aY])}else{return aV*(a1[aY]-a2[aY])}});var aW=$(".bookmarktemplate").first().html();$.each(aZ,function(a1,a3){var a2=unescape(a3.path);$("<li>"+aW.replace(/\$bookmarkpath/g,a3.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(a2,20))))+"</li>").clone(false).insertAfter($(".bookmarktemplate")).click(ax).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",a3.path).attr("data-htmltooltip",$.MyStringHelper.simpleEscape(a2)+"%0D"+(new Date(parseInt(a3.time)))).attr("tabindex",a3.path==a0?-1:0).toggleClass("disabled",a3.path==a0).find(".action.rmsinglebookmark").click(ax).MyKeyboardEventHandler()})}function j(aW){var aV=0;while($.MyCookie("bookmark"+aV)!=null&&$.MyCookie("bookmark"+aV)!=aW){aV++}if($.MyCookie("bookmark"+aV)==aW){$.MyCookie("bookmark"+aV,"-",1)}$("#flt").trigger("bookmarksChanged")}function ax(aY){$.MyPreventDefault(aY);if($(this).hasClass("disabled")){return}var aV=$(this);var aX=$("#fileList").attr("data-uri");if(aV.hasClass("addbookmark")){var aW=0;while($.MyCookie("bookmark"+aW)!=null&&$.MyCookie("bookmark"+aW)!="-"&&$.MyCookie("bookmark"+aW)!=""&&$.MyCookie("bookmark"+aW)!=aX){aW++}$.MyCookie("bookmark"+aW,aX,1);$.MyCookie("bookmark"+aW+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(aV.hasClass("dyn-bookmark")){F(aV.attr("data-bookmark"));aV.closest("ul").hide()}else{if(aV.hasClass("rmbookmark")){j(aX)}else{if(aV.hasClass("rmallbookmarks")){var aW=0;while($.MyCookie("bookmark"+aW)!=null){$.MyCookie.rmCookies("bookmark"+aW,"bookmark"+aW+"time");aW++}$("#flt").trigger("bookmarksChanged")}else{if(aV.hasClass("rmsinglebookmark")){j($(this).attr("data-bookmark"))}else{if(aV.hasClass("bookmarksortpath")){$.MyCookie("bookmarksort",$.MyCookie("bookmarksort")=="path"||$.MyCookie("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(aV.hasClass("bookmarksorttime")){$.MyCookie("bookmarksort",$.MyCookie("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function ao(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",af).on("fileListViewChanged",af)}function af(){var aX=$("#selstats");var aV=aX.data("selstats");var aW=aw();$("#fileListTable").attr("data-fileselcounter",aW.fileselcounter).attr("data-dirselcounter",aW.dirselcounter).attr("data-folderselsize",aW.folderselsize).attr("data-sumselcounter",aW.sumselcounter);$("#flt").trigger("selectionCounterUpdated");aX.html(aV.replace(/\$filecount/g,aW.fileselcounter).replace(/\$dircount/g,aW.dirselcounter).replace(/\$sum/g,aW.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(aW.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(aW.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(aW.folderselsize)).MyTooltip()}function az(){$("#pathinputform").submit(function(aV){return false});$("#pathinputform input[name='uri']").keydown(function(aV){if(aV.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(aV.keyCode==13){$.MyPreventDefault(aV);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();F($(this).val())}}});$(".action.changedir").button().click(function(aV){$.MyPreventDefault(aV);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(aV){$.MyPreventDefault(aV);$("#pathinput").hide();$("#quicknav").show();F($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function Q(){$("form#filterbox").submit(function(aV){return false});$("form#filterbox input").keyup(v).change(v).autocomplete({minLength:1,select:v,close:v});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(aV){$.MyPreventDefault(aV);$("form#filterbox input").val("");v();$(this).addClass("invisible")});$("#flt").on("fileListChanged",v).on("fileListChanged",function(){var aV=$.map($("#fileList tr"),function(aX,aW){return $(aX).attr("data-file")});$("form#filterbox input").autocomplete({source:function(aX,aW){try{var aZ=new RegExp(aX.term);aW($.grep(aV,function(a0){return aZ.test(a0)}))}catch(aY){aW($.grep(aV,function(a0){return a0.indexOf(aX.term)>-1}))}}})})}function v(){var aV=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var aX=new RegExp(aV,"i");if(aV===""||$(this).attr("data-file").match(aX)){$(this).show()}else{$(this).hide()}}catch(aW){if(aV===""||$(this).attr("data-file").toLowerCase().indexOf(aV.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function t(aW,aX){if(!aX){aX=aW}var aV=aX.loaded/aX.total*100;$("#progress .bar").css("width",aV.toFixed(2)+"%").html(parseInt(aV)+"% ("+$.MyStringHelper.renderByteSize(aX.loaded)+"/"+$.MyStringHelper.renderByteSize(aX.total)+"); "+aW.done+"/"+aW.uploads)}function ae(aX,aZ,aW,aY){$("#flt").on("fileListChanged",function(){aX.fileupload("option","url",$("#fileList").attr("data-uri"))});var aV={aborted:false,transports:[],done:0,failed:0,uploads:0};aX.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:aY,singleFileUploads:true,autoUpload:false,add:function(a3,a2){if(!aV.aborted){var a4=a2.submit();var a1=a2.files[0].name;aV.transports.push(a4);var a0=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+a1).addClass("fileprogress");$("<div></div>").click(function(a5){$.MyPreventDefault(a5);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(a0).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:a1,transport:a4});$("<div></div>").appendTo(a0).addClass("fileprogressbar running").html(a2.files[0].name+" ("+$.MyStringHelper.renderByteSize(a2.files[0].size)+"): 0%");aV.uploads++;return true}return false},done:function(a1,a0){$("#progress [id='fpb"+a0.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a0.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(a0.result.message?"done":"failed").css("width","100%").html(a0.result&&a0.result.error?a0.result.error:a0.result.message?a0.result.message:a0.files[0].name);if(a0.result.message){aV.done++}else{aV.failed++}t(aV)},fail:function(a1,a0){$("#progress [id='fpb"+a0.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a0.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(a0.textStatus+": "+$.map(a0.files,function(a2,a3){return a2.name}).join(", "));aV.failed++;t(aV);console.log(a0)},stop:function(a1,a0){t(aV);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){aj()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(a1,a0){aV.transports=[];aV.aborted=false;aV.files=[];aV.uploads=0;aV.failed=0;aV.done=0;return true},start:function(a2,a1){var a0=[];a0.push({text:$("#close").html(),disabled:true});a0.push({text:$("#cancel").html(),click:function(){if(aV.aborted){return}aV.aborted=true;$.each(aV.transports,function(a3,a4){if(a4&&a4.abort){a4.abort($("#uploadaborted").html())}});aV.transports=[]}});$("#progress").dialog({modal:true,title:aW,height:370,width:500,buttons:a0,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(a2,a1){var a0=parseInt(a1.loaded/a1.total*100)+"%";$("div[id='fpb"+a1.files[0].name+"'] .fileprogressbar","#progress .info").css("width",a0).html(a1.files[0].name+" ("+$.MyStringHelper.renderByteSize(a1.files[0].size)+"): "+a0)},progressall:function(a1,a0){aV.total=a0.total;aV.loaded=a0.loaded;t(aV,a0)},submit:function(a1,a0){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",$.MyCookie("settings.confirm.upload")=="no"||!N(a0)||window.confirm(aZ))}$("#file-upload-form-relapath").val(a0.files[0].relativePath||(a0.files[0].webkitRelativePath&&a0.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");$("#file-upload-form-token").val($("#token").val());return $(this).data("ask.confirm")}})}function N(aW){for(var aV=0;aV<aW.files.length;aV++){var aX;if(aW.files[aV].relativePath&&aW.files[aV].relativePath!=""){aX=aW.files[aV].relativePath.split(/[\\\/]/)[0]+"/"}else{if(aW.files[aV].webkitRelativePath&&aW.files[aV].webkitRelativePath!=""){aX=aW.files[aV].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(aX&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(aX)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(aW.files[aV].name)+"']").length>0){return true}}}return false}function an(){ae($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(aV){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(aV){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(aV){$("#fileList").addClass("draghover")}).on("dragleave",function(aV){$("#fileList").removeClass("draghover")}).on("drop",function(aV){$("#fileList").removeClass("hover")})}function E(aX,aV){var aW;if(aV.setting){aX+='<div class="confirmdialogsetting"><input type="checkbox" name="'+aV.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";aW=$.MyCookie(aV.setting)}$("#confirmdialog").html(aX).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(aV.setting){$.MyCookie.toggleCookie(aV.setting,aW,aW&&aW!=="",1)}$("#confirmdialog").dialog("close");if(aV.cancel){aV.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(aV.confirm){aV.confirm()}}}],open:function(){if(aV.setting){$("input[name='"+aV.setting+"']",$(this)).click(function(aY){$.MyCookie.toggleCookie(aV.setting,"no",!$(this).is(":checked"),1)}).prop("checked",$.MyCookie(aV.setting)!="no")}},close:function(){if(aV.cancel){aV.cancel()}}}).show()}function aT(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function l(aW){var aV=$("#fileList tr.selected:visible");if(aV.length==0){aV=$(aW).closest("tr[data-file]")}if(aV.length==0){aV=$("#fileList tr:visible:focus")}if(aV.length==0){aV=$("#FileList tr #popup").closest("tr[data-file]")}return aV}function aq(aV){return $.map(l(aV),function(aW,aX){return $(aW).attr("data-file")})}function aH(aW){$.MyPreventDefault(aW);var aV=$(this);if(aV.hasClass("disabled")){return}var aX=aV.closest("tr[data-file]");if(aX.length===0){aX=l(this).shift()}if(aV.hasClass("rename")){aF(aX)}else{if(aV.hasClass("delete")){H(aX)}else{console.log(aX);$("body").trigger("fileActionEvent",{obj:aV,event:aW,file:aX.attr("data-file"),selected:[aX.data("file")],row:aX})}}}function g(){$("#fileactions").on("click dblclick",function(aV){$.MyPreventDefault(aV);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aH).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",ag).on("mouseleave.fileAction",k)}).on("beforeFileListChange replaceRow",k);h();$("body").on("settingchanged",h)}function h(aV,aW){$("#fileactions").toggleClass("hidefileactions",$.MyCookie("settings.show.fileactions")=="no").toggleClass("hidelabels",$.MyCookie("settings.show.fileactionlabels")=="no").toggleClass("showalways",$.MyCookie("settings.show.fileactionalways")=="no")}function ag(aW){var aV=$(this);if($("#fileactions",aV).length===0){$(".action.changeuri.filename",aV).after($("#fileactions"))}}function k(aV){$("#fileactions").appendTo($(".template"))}function av(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(aX,aW){var aV=$(aW);if(!aV.attr("href")){aV.data("fancybox-href",aV.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(aV){return(aV.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(aX,aW){var aV=$(aW);if(!aV.attr("href")){aV.data("fancybox-href",aV.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function ak(){var aW=$("#fileListTable");var aV=$("#fileList");$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",O).off("dblclick.initFileList").on("dblclick.initFileList",function(aX){F($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:y,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:aT,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable").MyTableManager();Z();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function Z(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var aV=window.getSelection();if(aV&&aV.removeAllRanges){aV.removeAllRanges()}}}}function H(aV){aV.fadeTo("slow",0.5);E($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(aV.attr("data-displayname")))),{confirm:function(){var aW=aV.attr("data-file");B(aV);var aX=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:aW},function(aY){if(aY.error){aj()}I(aY)});C(aX)},cancel:function(){aV.fadeTo("fast",1)}})}function I(aV){if(aV.error){aO(aV.error)}if(aV.warn){aI(aV.warn)}if(aV.message){b(aV.message)}if(aV.quicknav){$("#quicknav").html(aV.quicknav).MyTooltip();$("#quicknav a").click(function(aW){$.MyPreventDefault(aW);F($(this).attr("href"))})}}function s(aY,aW,aV){var aX=$.MyPost($("#fileList").attr("data-uri"),{rename:"yes",newname:aV,file:aW},function(aZ){if(aZ.message){$.MyPost($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:aV,template:$("#fileList").attr("data-entrytemplate")},function(a0){try{var a1=$(a0);var a3=$("tr[data-file='"+aV+"']");if(a3.length>0){a3.remove()}$("#flt").trigger("replaceRow",{row:aY,newrow:a1});aY.replaceWith(a1);aY=a1;ak();a1.focus()}catch(a2){aj()}},true)}I(aZ)});C(aX)}function aF(aX){var aW=aX.closest("tr[data-file]").data("file");var aV=aW.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:aX.find("td.filename"),defaultValue:aV,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(aZ){var aY=aZ.value.replace(/\//g,"");if(aY==aV){return}if($.MyCookie("settings.confirm.rename")!="no"){E($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(aW)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(aY)),{confirm:function(){s(aX,aW,aY)},setting:"settings.confirm.rename"})}else{s(aX,aW,aY)}}})}function aB(aV,aW){console.log("notify["+aV+"]: "+aW);if($.MyCookie("settings.messages."+aV)=="no"){return}noty({text:aW,type:aV,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:aV,msg:aW})}function aO(aV){aB("error",aV)}function b(aV){aB("message",aV)}function aI(aV){aB("warning",aV)}function aS(aW,aV){if(!aW){return}aW.toggleClass("selected",aV);aW.find(".selectbutton").prop("checked",aW.hasClass("selected"))}function M(aV){return aV.attr("data-file")!=".."&&!aV.hasClass("unselectable-yes")}function O(aX){var a1=$("#fileListTable");if(M($(this))){var a0=this.rowIndex;var aV=a0;if((aX.shiftKey||aX.metaKey||aX.altKey)&&a1.data("lastSelectedRowIndex")){aV=a1.data("lastSelectedRowIndex");if(aV<a0){var aZ=aV;aV=a0;a0=aZ}for(var aW=a0+1;aW<aV;aW++){var aY=$("#fileList tr:visible").filter(function(){return this.rowIndex==aW});if(aY.length===0){continue}aS(aY);aY=aY.next()}}aS($(this));a1.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function aR(){$(".dialog.action").click(ar)}function ar(aW){$.MyPreventDefault(aW);if($(this).hasClass("disabled")){return}var aV=$(this);aV.addClass("disabled");var aX=$("#"+aV.attr("data-action"));if(aX.attr("title")){aX.data("title",aX.attr("title"))}aX.attr("title",aX.data("title"));aX.dialog({modal:true,width:"auto",open:function(){if(aX.data("initHandler")){aX.data("initHandler").init()}},close:function(){aV.removeClass("disabled")},dialogClass:aV.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function G(){au($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi, .sel-one-mime"),true);$(".action.uibutton").button();$("#flt").on("fileListSelChanged",aM).on("fileListViewChanged",aM)}function aM(){var aW=aw();var aX=$("#fileListTable");var aV=aX.hasClass("iswriteable-no")?":not(.access-writeable)":"";aV+=aX.hasClass("isreadable-no")?":not(.access-readable)":"";aV+=aX.hasClass("unselectable-no")?":not(.access-selectable)":"";au($(".access-writeable"),aX.hasClass("iswriteable-no"));au($(".access-readable"),aX.hasClass("isreadable-no"));au($(".access-selectable"),aX.hasClass("unselectable-yes"));au($(".sel-none"+aV),aW.sumselcounter!==0);au($(".sel-one"+aV),aW.sumselcounter!=1);au($(".sel-multi"+aV),aW.sumselcounter===0);au($(".sel-noneorone"+aV),aW.sumselcounter>1);au($(".sel-none.sel-dir"+aV),aW.fileselcounter!==0);au($(".sel-one.sel-dir"+aV),aW.fileselcounter>0||aW.dirselcounter!=1);au($(".sel-multi.sel-dir"+aV),aW.fileselcounter>0||aW.dirselcounter===0);au($(".sel-noneorone.sel-dir"+aV),aW.fileselcounter>0||aW.dirselcounter>1);au($(".sel-noneormulti.sel-dir"+aV),aW.fileselcounter>0);au($(".sel-none.sel-file"+aV),aW.fileselcounter!==0);au($(".sel-one.sel-file"+aV),aW.dirselcounter>0||aW.fileselcounter!=1);au($(".sel-multi.sel-file"+aV),aW.dirselcounter>0||aW.fileselcounter===0);au($(".sel-noneorone.sel-file"+aV),aW.dirselcounter>0||aW.fileselcounter>1);au($(".sel-noneormulti.sel-file"+aV),aW.dirselcounter>0);if(aW.selectedmimetypes!=""&&aW.sumselcounter===1){$(".sel-one-mime"+aV).each(function(){var aY=$(this);au(aY,aW.sumselcounter===1&&aY.data("mime")!==undefined&&aW.selectedmimetypes.match(aY.data("mime"))===null)})}else{au($(".sel-one-mime"+aV),true)}}function ah(){$("#flt").on("fileListChanged",Y).on("fileListViewChanged",Y)}function z(aV){if(!aV){aV=$("#fileListTable")}if(aV&&aV.attr){aV.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function ap(){var aW=$("#fileListTable");z(aW);var aV=aw();aW.attr("data-dircounter",aV.dircounter);aW.attr("data-filecounter",aV.filecounter);aW.attr("data-foldersize",aV.foldersize);aW.attr("data-sumcounter",aV.sumcounter);$("#flt").trigger("counterUpdated")}function aw(){var aW=[];aW.dircounter=$("#fileList tr.is-subdir-yes:visible").length;aW.filecounter=$("#fileList tr.is-file:visible").length;aW.sumcounter=aW.dircounter+aW.filecounter;aW.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;aW.fileselcounter=$("#fileList tr.selected.is-file:visible").length;aW.sumselcounter=aW.dirselcounter+aW.fileselcounter;aW.selectedmimetypes=$("#fileList tr.selected.is-file:visible").map(function(){return $(this).data("mime")}).get().sort().join(",").replace(/([^,]+)(,\1)*/g,"$1");var aV=0;var aX=0;$("#fileList tr:visible").each(function(aZ,a0){var aY=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){aX+=aY}aV+=aY});aW.foldersize=aV;aW.folderselsize=aX;return aW}function Y(){var aX=$("#headerName");var aY=$("#fileListTable");var aW=$("#headerSize");ap();if(aX.length>0&&!aX.attr("data-title")){aX.attr("data-title",aX.attr("title"))}if(aW.length>0&&!aW.attr("data-title")){aW.attr("data-title",aW.attr("title"))}if(aX.length>0){aX.attr("title",aX.attr("data-title").replace(/\$filecount/,aY.attr("data-filecounter")).replace(/\$dircount/,aY.attr("data-dircounter")).replace(/\$sum/,parseInt(aY.attr("data-dircounter"))+parseInt(aY.attr("data-filecounter"))))}var aV=parseInt(aY.attr("data-foldersize"));if(aW.length>0){aW.attr("title",aW.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(aV)))}}function aN(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var aV=history.location||document.location;aj(aV.pathname)})}function F(aW,aV){try{if(!aV){if(window.history.pushState){window.history.pushState({path:aW},"",aW);aj(aW)}else{aj(aW)}return}}catch(aX){console.log(aX)}if(!aV){$.MyPageBlocker()}window.location.href=aW}function aj(aV,aX){if(!aV){aV=$("#fileList").attr("data-uri")}if(!aV){aV=window.location.href}if(!aX){aX={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var aW=$.now();$("#flt").data("timestamp",aW);$.MyPost(aV,aX,function(aY){if($("#flt").data("timestamp")!=aW){return}$("#flt").trigger("beforeFileListChange").show().html(aY.content).attr("data-uri",aV);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+aV.replace(/\/[^\/]+\/\.\.$/,"/"));ak();I(aY)},true)}function B(aV){$("#flt").trigger("beforeFileListChange");aV.remove();$("#flt").trigger("fileListChanged")}function w(aX,aV,aY,aW){var aZ=$.MyPost(aY,{srcuri:aV,action:aX,files:aW.join("@/@")},function(a0){if(a0.message&&aX=="cut"){B($("#fileList tr[data-file='"+aW.join("'],#fileList tr[data-file='")+"']"))}if(a0.error){aj()}I(a0)});C(aZ)}function y(aY,a0){var aV=a0.draggable.closest("tr");var a1=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var aW=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(a1==$.MyStringHelper.concatUri(aW,encodeURIComponent($.MyStringHelper.stripSlash(aV.attr("data-file"))))+"/"){return}var aZ=aY.shiftKey||aY.altKey||aY.ctrlKey||aY.metaKey?"copy":"cut";var aX=aV.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(a4,a3){return $(a4).attr("data-file")}):new Array(aV.attr("data-file"));if($.MyCookie("settings.confirm.dnd")!="no"){var a2=$("#paste"+aZ+"confirm").html();a2=a2.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(aX.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(aW))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a1))).replace(/\\n/g,"<br/>");E(a2,{confirm:function(){w(aZ,aW,a1,aX)},setting:"settings.confirm.dnd"})}else{w(aZ,aW,a1,aX)}}function ad(aY,aZ,aX){for(var aW in aZ){var aV=aZ[aW];if(typeof aV==="object"){ad(aY,aV,aW)}else{if(aX){aY.append($("<input/>").prop("name",aX).prop("value",aV).prop("type","hidden"))}else{aY.append($("<input/>").prop("name",aW).prop("value",aV).prop("type","hidden"))}}}return aY}function aK(aW){var aV=$("<form/>").appendTo("body");aV.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");ad(aV,aW);aV.submit();aV.remove()}function T(aX){var aW=$(this);var aV=l(this);aV.fadeTo("slow",0.5);E(aV.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(aV.first().attr("data-file")))),{confirm:function(){if(aV.length===0){aV=aW.closest("tr")}var aY=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(aV,function(aZ,a0){return $(aZ).attr("data-file")})},function(aZ){B(aV);aa();if(aZ.error){aj()}I(aZ)});C(aY)},cancel:function(){aV.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function aa(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function S(aX,aV,aY,aW){var aZ=$.MyPost(aY,{action:aX,files:aW,srcuri:aV},function(a0){if($.MyCookie("clpaction")=="cut"){$.MyCookie.rmCookies("clpfiles","clpaction","clpuri")}if(aW.split("@/@").length==1){ab(aW)}else{aj()}I(a0)});C(aZ)}function A(aV){$.MyPreventDefault(aV);var a2=$(this);if(a2.hasClass("disabled")){return}if(a2.hasClass("delete")){T.call(this,aV)}else{if(a2.hasClass("rename")){aF(a2.closest("tr"))}else{if(a2.hasClass("cut")||a2.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var aY=$.map(l(a2),function(a5,a4){return $(a5).attr("data-file")});$.MyCookie("clpfiles",aY.join("@/@"));$.MyCookie("clpaction",a2.hasClass("cut")?"cut":"copy");$.MyCookie("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(a2.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}L();aa()}else{if(a2.hasClass("paste")){var aW=$.MyCookie("clpfiles");var aZ=$.MyCookie("clpaction");var a1=$.MyCookie("clpuri");var a0=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if($.MyCookie("settings.confirm.paste")!="no"){var aX=$("#paste"+aZ+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(a1)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(a0)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(aW.split("@/@").join(", ")));E(aX,{confirm:function(){S(aZ,a1,a0,aW)},setting:"settings.confirm.paste"})}else{S(aZ,a1,a0,aW)}}else{if(a2.attr("href")!==undefined&&a2.attr("href")!="#"){window.open(a2.attr("href"),a2.attr("target")||"_self")}else{var a3=l(a2);$("body").trigger("fileActionEvent",{obj:a2,event:aV,file:a3.attr("data-file"),row:a3,selected:aq(this)})}}}}}}function X(){L();$("#flt").on("fileListChanged",L)}function L(){var aZ=$.MyCookie("clpaction");var aV=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var aX=$.MyCookie("clpuri");var aY=$.MyCookie("clpfiles");var aW=(!aY||aY===""||aX==aV||$("#fileListTable").hasClass("iswriteable-no"));au($(".action.paste"),aW);if(aX==aV&&aZ=="cut"){$.each(aY.split("@/@"),function(a0,a1){$("[data-file='"+a1+"']").addClass("cutted").fadeTo("fast",0.5)})}}function K(){$("#nav .action").click(A).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function q(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(A).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var aV={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(aW){$("#flt").disableSelection();if(aW){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(aV,{changeEvent:function(aX){var aW=$(this);$.MyPost($("#fileList").attr("data-uri"),{mkcol:"yes",colname:aX.value},function(aY){if(!aY.error&&aY.message){ab(aX.value)}I(aY)})}}));$(".action.create-file").MyInplaceEditor($.extend(aV,{changeEvent:function(aX){var aW=$(this);$.MyPost($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:aX.value},function(aY){if(!aY.error&&aY.message){ab(aX.value)}I(aY)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(aV,{changeEvent:function(aW){var aX=l(this);$.MyPost($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:aW.value,file:aX.attr("data-file")},function(aY){if(!aY.error&&aY.message){ab(aW.value)}I(aY)})}}))}function f(){$(".action.viewfilter").click(function(aX){$.MyPreventDefault(aX);if($(this).hasClass("disabled")){return}var aV=$(this);$(".action.viewfilter").addClass("disabled");var aY=$("#fileList").attr("data-uri");var aW=aV.attr("data-template");$.MyPost(aY,{ajax:"getViewFilterDialog",template:aW},function(aZ){var a0=$(aZ);$("input[name='filter.size.val']",a0).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",a0).button().click(function(a2){$.MyPreventDefault(a2);$.MyCookie.toggleCookie("filter.name",$("select[name='filter.name.op'] option:selected",a0).val()+" "+$("input[name='filter.name.val']",a0).val(),$("input[name='filter.name.val']",a0).val()!=="");$.MyCookie.toggleCookie("filter.size",$("select[name='filter.size.op'] option:selected",a0).val()+$("input[name='filter.size.val']",a0).val()+$("select[name='filter.size.unit'] option:selected",a0).val(),$("input[name='filter.size.val']",a0).val()!=="");if($("input[name='filter.types']:checked",a0).length>0){var a1="";$("input[name='filter.types']:checked",a0).each(function(a3,a4){a1+=$(a4).val()});$.MyCookie("filter.types",a1)}else{$.MyCookie.rmCookies("filter.types")}a0.dialog("close");aj()});$(".filter-reset",a0).button().click(function(a1){$.MyPreventDefault(a1);$.MyCookie.rmCookies("filter.name","filter.size","filter.types");a0.dialog("close");aj()});a0.submit(function(){return false});a0.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:aV.attr("title")||aV.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");a0.remove()}}).show()})})}function C(aY,aX,aW){$("#abortdialog").remove();var aV=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",aV).button().click(function(aZ){if(aY.readyState!=4){aY.abort()}aV.hide().remove();if(aW){aW.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(aY.readyState>2){return}aV.appendTo($("body")).show();var aZ=window.setInterval(function(){if(aY.readyState==4){aV.hide().remove();window.clearInterval(aZ)}},200);$("body").data("abortdialoginterval",aZ)},aX||2500));return aV}function aG(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function o(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var aX="";var aV=$("*[accesskey]").get().sort(function(aZ,aY){var a0=$(aZ).attr("accesskey");var a1=$(aY).attr("accesskey");return a0<a1?-1:a0>a1?1:0});var aW=[];$.each(aV,function(aZ,aY){var a0=$(aY);var a1=a0.attr("accesskey");if(!aW[a1]){aX+='<li tabindex="0" role="definition">'+a1+": "+(a0.attr("aria-label")||a0.attr("title")||a0.attr("data-tooltip")||a0.html())+"</li>";aW[a1]=true}else{console.log("found accesskey "+a1+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+aX+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function aL(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(aX){$.MyPreventDefault(aX);var aV=$(this);if(aV.hasClass("disabled")){return}if(aV.hasClass("table-sort")){var aW=$.MyTableManager.getLastTableSort();$.MyTableManager.sortTable(aV.closest("table"),aV.data("name"),aW.name==aV.data("name")?-aW.sortorder:1)}else{if(aV.hasClass("table-sort-this-asc")){$.MyTableManager.sortTable(aV.closest("table"),aV.closest("th").data("name"),1)}else{if(aV.hasClass("table-sort-this-desc")){$.MyTableManager.sortTable(aV.closest("table"),aV.closest("th").data("name"),-1)}else{if(aV.hasClass("table-column-hide-this")){$.MyTableManager.toggleTableColumn(aV.closest("table"),aV.closest("th:not(.table-column-not-hide)").data("name"),false)}else{if(aV.hasClass("table-column")){$.MyTableManager.toggleTableColumn(aV.closest("table"),aV.data("name"))}else{if(aV.hasClass("table-column-width-default")){$.MyTableManager.setTableColumnWidth(aV.closest("th"),"default")}else{if(aV.hasClass("table-column-width-minimum")){$.MyTableManager.setTableColumnWidth(aV.closest("th"),"minimum")}}}}}}}}function aC(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable th[data-name].sorter-false").each(function(aX,aW){$(".action.table-sort."+$(aW).data("name")).addClass("hidden").hide()});$(".action.table-sort.fileactions").hide()});aV();function aV(){var aW=$.MyTableManager.getLastTableSort();$(".action.table-sort .symbol").removeClass("descending ascending");$(".action.table-sort."+aW.name+" .symbol").addClass(aW.sortorder==1?"descending":"ascending");$(".action.table-column .symbol").removeClass("column-hidden");$(".action.table-column").addClass("hidden disabled");$("#fileListTable th[data-name]").each(function(aY,aX){$(".action.table-column."+$(aX).data("name")).removeClass("hidden").toggleClass("disabled",$(aX).hasClass("table-column-not-hide")).find(".symbol").toggleClass("column-hidden",$(aX).is(":not(:visible)"))})}$("body").on("settingchanged",function(aW,aX){if(aX.setting=="order"||aX.setting=="visibletablecolumns"){aV()}})}function P(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",A).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();aC();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){aL()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content",contextmenuAnchorElement:true})});$("body").off(".popupmenu").on("click.popupmenu",function(){aL()}).on("keydown.popupmenu",function(aV){if(aV.which==27){aL()}});$("#filler").on("contextmenu",function(aV){if(aV.which==3){if(aV.originalEvent.detail===1){$.MyPreventDefault(aV)}aL()}})}function ab(aV){var aW=$("#fileList");return $.MyPost($.MyStringHelper.addMissingSlash(aW.data("uri")),{ajax:"getFileListEntry",template:aW.data("entrytemplate"),file:aV},function(aX){try{var aY=$(aX);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(aV)+"']",aW);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:aY});row.replaceWith(aY)}else{aY.appendTo(aW)}ak();aY.focus()}catch(aZ){aj()}},true)}function aJ(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(aW,aV){if(aV.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!aV.value);$("#flt").trigger("fileListViewChanged")}else{if(aV.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!aV.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",$.MyCookie("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",$.MyCookie("settings.show.dotfolders")=="no")}function aA(){var aV=$.MyCookie("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(aZ,aY){var aX=$(this);if(aX.data("thumb")!=aX.data("icon")){var aW=aX.data("thumb");var a0=aX.data("icon");var a1=$("#emptyimage").attr("src");aX.attr("src",aV?(aW===""?a1:aW):(a0===""?a1:a0));aX.toggleClass("thumbnail",aV)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(aW,aV){if(aV.setting=="settings.enable.thumbnails"){aA()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var aV=$(this);var aW=aV.data("icon");aV.removeClass("thumbnail").attr("src",aW!==""?aW:$("#emptyimage").attr("src"))})})}function m(aW,aV){var aX=$.MyGet(window.location.pathname,aW,function(aY){I(aY);aV(aY)});C(aX)}function am(aW,aV){var aX=$.MyPost(window.location.pathname,aW,function(aY){I(aY);aV(aY)});C(aX)}function U(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:$.MyPageBlocker,changeUri:F,concatUri:$.MyStringHelper.concatUri,confirmDialog:E,cookie:$.MyCookie,getDialog:m,getDialogByPost:am,getSelectedFiles:aq,getSelectedRows:l,handleJSONResponse:I,handleWindowResize:r,hidePopupMenu:aL,initFileList:ak,initPopupMenu:P,initTabs:W,initUpload:ae,notify:aB,notifyError:aO,notifyInfo:b,notifyWarn:aI,preventDefault:$.MyPreventDefault,preventDefaultImmediatly:$.MyPreventDefaultImmediatly,postAction:aK,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:ab,removeAbortDialog:aG,renderAbortDialog:C,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:$.MyCookie.rmCookies,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:$.MyCookie.toggleCookie,toggleRowSelection:aS,uncheckSelectedRows:aa,updateFileList:aj}}function ac(){$.fn.MyTooltip.defaults.helphandler=at;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){at.call(this,$(this).data("help"))})}function at(aW){var aV=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:aW,width:"99%",height:"99%"}).text(aW)).dialog({width:aV.width()/2,height:aV.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
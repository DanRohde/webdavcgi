var ToolBox={};$(function(){a4();V();ay();M();g();ag();at();r();Q();aM();W();aA();aB();a6();f();e();B();I();aI();o();P();ae();au();d();aR();aX();c();aL();a2();a5();af();ab();al();$.ajaxSetup({traditional:true});$(document).ajaxError(function(bd,be,bc,bb){console.log(bd);console.log(be);console.log(bc);console.log(bb);if(be&&be.statusText&&be.statusText!="abort"){a3(be.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(bb,bd,bc){bb.cache=true});av($("#flt").attr("data-uri"));function af(bb){if(!bb){bb=$(document)}$(".tabsel",bb).on("click keyup",function(be){if(be.type=="keyup"&&be.keyCode!=32&&be.keyCode!=13){return}D(be);var bc=$(this);$(".tabsel.activetabsel",bb).removeClass("activetabsel");bc.addClass("activetabsel");$(".tab.showtab",bb).removeClass("showtab");var bd=$(".tab."+bc.data("group"),bb).addClass("showtab");$(":focusable:visible:first",bd).focus()})}function a5(){if(!ad("settings.show.statusbar")){ad("settings.show.statusbar","no");ad("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",ad("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(bc){$(this).prop("checked",true);D(bc)});function bb(){var bd=$("#fileListTable");var bc=$("#statusbar");$(".filecount",bc).html(bd.attr("data-filecounter"));$(".dircount",bc).html(bd.attr("data-dircounter"));$(".sum",bc).html(bd.attr("data-sumcounter"));$(".foldersize",bc).attr("title",$.MyStringHelper.renderByteSizes(bd.data("foldersize"))).html($.MyStringHelper.renderByteSize(bd.data("foldersize")));$(".selfilecount",bc).html(bd.attr("data-fileselcounter"));$(".seldircount",bc).html(bd.attr("data-dirselcounter"));$(".selsum",bc).html(bd.attr("data-sumselcounter"));$(".selfoldersize",bc).attr("title",$.MyStringHelper.renderByteSizes(bd.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(bd.attr("data-folderselsize")));$(".selected-files-stats",bc).toggle(bd.attr("data-fileselcounter")!==0||bd.attr("data-dirselcounter")!==0)}bb();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",bb);$("body").on("notify",function(bc,bd){$("#statusbar .notify").attr("title",bd.msg).removeClass("error message warning").addClass(bd.type).html(bd.msg).MyTooltip()});$("body").on("settingchanged",function(bc,bd){if(bd.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",bd.value)}});$("#statusbar").MyTooltip()}function aL(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aR(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(bd){var bc=this.tabIndex||1;var bb=$(this);if(bb.is(":focus")){if(bd.keyCode==32){U.call(this,bd)}else{if(bd.keyCode==13){K($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(bb.attr("data-file")))),bb.attr("data-type")=="file")}else{if(bd.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(S(bb)){N(bb)}}else{aa()}}else{if(bd.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(bd.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(bd.keyCode==45){$(".paste").trigger("click")}}}}}}}if(bd.keyCode==38&&bc>-1){D(bd);if(S(bb)&&(bd.shiftKey||bd.altKey||bd.ctrlKey||bd.metaKey)){a7(bb,true);$("#flt").trigger("fileListSelChanged")}bb.prevAll(":focusable:first").focus();ai()}else{if(bd.keyCode==40){D(bd);if(S(bb)&&(bd.shiftKey||bd.altKey||bd.ctrlKey||bd.metaKey)){a7(bb,true);$("#flt").trigger("fileListSelChanged")}bb.nextAll(":focusable:first").focus();ai()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",p);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(bd){D(bd);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var bc=$("#flt").data("TableConfigDialog");if(bc){i($(bc))}else{if($("#tableconfigdialogtemplate").length>0){var bb=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",bb);i($(bb))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(be){if(be.error){O(be)}$("#flt").data("TableConfigDialog",be);i($(be))})}}}).MyKeyboardEventHandler()})}function i(bc){var be=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(bh,bg){return $(bh).attr("data-name")});$.each(be,function(bg,bh){bc.find("input[name='visiblecolumn'][value='"+bh+"']").prop("checked",true)});bc.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bg){D(bg)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bg,bh){bc.find("input[name='sortingcolumn'][value='"+$(bh).attr("data-name")+"']").prop("disabled",true).click(function(bi){D(bi)}).closest("li").addClass("disabled")});var bf=ad("order")?ad("order").split("_"):"name_asc".split("_");var bd=bf[0];var bb=bf[1]||"asc";bc.find("input[name='sortingcolumn'][value='"+bd+"']").prop("checked",true);bc.find("input[name='sortingorder'][value='"+bb+"']").prop("checked",true);bc.find("input[value='fileactions']").closest("li").hide();bc.find("input[name='save']").button().click(function(bh){var bm=be.slice(0);var bp=$.map($("input[name='visiblecolumn']:checked"),function(br,bq){return $(br).attr("value")});var bo=[];for(var bk=bm.length-1;bk>=0;bk--){if($.inArray(bm[bk],bp)==-1){bo.push(bm[bk]);bm.splice(bk,1)}}var bi=[];$.each(bp,function(bq,br){if($.inArray(br,bm)==-1){bi.push(br);bm.push(br)}});ad("visibletablecolumns",bm.join(","),1);var bn=bc.find("input[name='sortingcolumn']:checked").attr("value");var bj=bc.find("input[name='sortingorder']:checked").attr("value");ad("order",bn+(bj=="desc"?"_desc":""),1);if(bp.sort().join(",")!=be.sort().join(",")){$.each(bi,function(br,bs){var bq=$("#fileListTable th[data-name='"+bs+"']").removeClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bu,bt){$("td",$(bt)).eq(bq).show()})});$.each(bo,function(br,bs){var bq=$("#fileListTable th[data-name='"+bs+"']").addClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bu,bt){$("td",$(bt)).eq(bq).hide()})})}else{if(bn!=bd||bj!=bb){var bg=$("#fileListTable th[data-name='"+bn+"']");var bl=bj=="desc"?-1:1;j(bg.prop("cellIndex"),bl);if(bg.length>0){s(bg.attr("data-sorttype")||"string",bg.attr("data-sort"),bl,bg.prop("cellIndex"),"data-file")}}}bc.dialog("close")});bc.find("input[name='cancel']").button().click(function(bg){D(bg);bc.dialog("close");return false});bc.find("#tableconfigform").submit(function(bg){return false});bc.dialog({modal:true,width:"auto",title:bc.attr("data-title")||bc.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");bc.dialog("destroy")}})}function aQ(bb){if(bb){D(bb)}var bd=$(this).hasClass("collapsed");var bc=$(this).hasClass("iconsonly");if(!bd&&!bc){bc=true}else{if(bc){bc=false;bd=true}else{bd=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",bd).toggleClass("sidebar-iconsonly",bc);$(".action.collapse-sidebar").toggleClass("collapsed",bd).toggleClass("iconsonly",bc);if(!bc&&!bd){ao("sidebar")}else{ad("sidebar",bc?"iconsonly":bd?"false":"true")}t()}function au(){$(".action.collapse-sidebar").click(aQ).MyKeyboardEventHandler().MyTooltip();if(ad("sidebar")&&ad("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ad("sidebar")=="false").toggleClass("sidebar-iconsonly",ad("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",ad("sidebar")=="false").toggleClass("iconsonly",ad("sidebar")=="iconsonly");t()}$(".action.collapse-head").click(function(bb){D(bb);$(".action.collapse-head").toggleClass("collapsed");var bc=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!bc);$(".collapse-head-listener").toggleClass("head-collapsed",bc);y("head","false",bc,1);t()}).MyTooltip().MyKeyboardEventHandler();if(ad("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function ae(){$(".action.autorefreshmenu").dblclick(function(bb){D(bb);av()});aH($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aH($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aH($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(ad("autorefresh")!==""&&parseInt(ad("autorefresh"))>0){aU(parseInt(ad("autorefresh")))}});$(".action.setautorefresh").click(function(bb){D(bb);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){av();return}ad("autorefresh",$(this).attr("data-value"));aU(parseInt($(this).attr("data-value")))}).on("keyup",function(bb){if(bb.keyCode==32||bb.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(bb){D(bb);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ao("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bb){if(bb.keyCode==32||bb.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(bc){D(bc);if($(this).hasClass("disabled")){return}var bb=$("#autorefresh");if(bb.data("timer")!=null){window.clearInterval(bb.data("timer"));bb.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{aU(bb.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bb){if(bb.keyCode==32||bb.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(bc,bb){ad("autorefreshtimerpos",JSON.stringify(Y("#autorefreshtimer",bb.offset)))}});if(ad("autorefreshtimerpos")){Y("#autorefreshtimer",JSON.parse(ad("autorefreshtimerpos")))}}function Y(bf,bb){var be=$(bf);var bc=$(window);var bd={left:Math.min(Math.max(bb.left,0),bc.width()-be.outerWidth()+bc.scrollLeft()),top:Math.min(Math.max(bb.top,0),bc.height()-be.outerHeight()+bc.scrollTop())};be.offset(bd);return bd}function X(bb){var bd=$(".autorefreshtimer");var be=bd.attr("data-template")||"%sm %ss";var bc=Math.floor(bb/60);var bf=bb%60;if(bf<10){bf="0"+bf}bd.html(be.replace("%s",bc).replace("%s",bf))}function aU(bc){var bb=$("#autorefresh");if(bb.data("timer")!=null){window.clearInterval(bb.data("timer"))}bb.data("timeout",bc);X(bc);bb.data("timer",window.setInterval(function(){var bd=bb.data("timeout")-1;X(bd);bb.data("timeout",bd);if(bd<0){window.clearInterval(bb.data("timer"));bb.data("timer",null);X(0);bb.trigger("stopped");av()}},1000));bb.trigger("started")}function P(){var bb=$("#settings");bb.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",bb).each(function(bd,bc){$(bc).prop("checked",ad($(bc).prop("name"))!="no").click(function(be){if(ad($(this).prop("name")+".keep")){ad($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{y($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",bb).change(function(){if($(this).prop("name")=="settings.lang"){ad($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{ad($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(be,bc){var bf=$(bc);var bd=bf.prop("name");if(bd=="settings.lang"){bd=bd.replace(/^settings\./,"")}$("option[value='"+ad(bd)+"']",bf).prop("selected",true)})}})}function a4(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(bb){if(bb.keyCode==13||bb.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(bb){D(bb);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function o(){$("#flt").on("fileListChanged",t).on("fileListViewChanged",t);$(window).resize(t);t()}function t(){var bb=$(window).width()-$("#nav").width();$("#content").width(bb);$("#controls").width(bb);$("body").trigger("windowResized")}function I(){$(".action.changeuri").off(".changeuri").on("click.changeuri",ba);$(".action.refresh").off(".refresh").on("click.refresh",function(bb){D(bb);av();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",ba);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var bb=$(this);if(!bb.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=bb.data("href")?bb.data("href"):bb.attr("href")}})})}function ba(bb){D(bb);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){K($(this).data("href")||$(this).attr("href"))}return false}function B(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(bb){$("#fileList tr:not(:hidden).unselectable-no").each(function(bc,bd){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(bb){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(bb){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function ay(){$("#flt").on("bookmarksChanged",q).on("bookmarksChanged",x).on("fileListChanged",function(){q();x()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aK)}function aH(bb,bc){$.each(bb,function(bf,be){var bd=$(be);if(bd.hasClass("hideit")){bd.toggle(!bc)}if(bd.hasClass("button")){bd.button("option","disabled",bc)}if(!bd.hasClass("notab")){bd.attr("tabindex",bc?-1:0)}bd.toggleClass("disabled",bc)})}function x(){var bf=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var bb=false;var be=0;var bd=0;while(ad("bookmark"+bd)!=null){if(ad("bookmark"+bd)==bf){bb=true}if(ad("bookmark"+bd)!="-"){be++}bd++}$(".action.addbookmark").button("option","disabled",bb);aH($(".action.rmbookmark"),!bb);aH($(".action.bookmarksortpath"),be<2);aH($(".action.bookmarksorttime"),be<2);aH($(".action.rmallbookmarks"),be===0);var bc=ad("bookmarksort")==null?"time-desc":ad("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(bc=="path"||bc=="path-desc"||bc=="time"||bc=="time-desc"){$("#bookmarks .action.bookmarksort"+bc.replace(/-desc/,"")+" ."+bc).show()}}function q(){var bg=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(bh,bi){$(bi).remove()});var bf=[];var bd=0;while(ad("bookmark"+bd)!=null){if(ad("bookmark"+bd)!="-"){bf.push({path:ad("bookmark"+bd),time:parseInt(ad("bookmark"+bd+"time"))})}bd++}var be=ad("bookmarksort")?ad("bookmarksort"):"time-desc";var bb=1;if(be.indexOf("-desc")>0){bb=-1;be=be.replace(/-desc/,"")}bf.sort(function(bi,bh){if(be=="path"){return bb*bi[be].localeCompare(bh[be])}else{return bb*(bh[be]-bi[be])}});var bc=$("#bookmarktemplate").html();$.each(bf,function(bh,bj){var bi=unescape(bj.path);$("<li>"+bc.replace(/\$bookmarkpath/g,bj.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(bi,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aK).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",bj.path).attr("title",$.MyStringHelper.simpleEscape(bi)+" ("+(new Date(parseInt(bj.time)))+")").attr("tabindex",bj.path==bg?-1:0).toggleClass("disabled",bj.path==bg).find(".action.rmsinglebookmark").click(aK).MyKeyboardEventHandler()})}function k(bc){var bb=0;while(ad("bookmark"+bb)!=null&&ad("bookmark"+bb)!=bc){bb++}if(ad("bookmark"+bb)==bc){ad("bookmark"+bb,"-",1)}$("#flt").trigger("bookmarksChanged")}function aK(be){D(be);if($(this).hasClass("disabled")){return}var bb=$(this);var bd=$("#fileList").attr("data-uri");if(bb.hasClass("addbookmark")){var bc=0;while(ad("bookmark"+bc)!=null&&ad("bookmark"+bc)!="-"&&ad("bookmark"+bc)!=""&&ad("bookmark"+bc)!=bd){bc++}ad("bookmark"+bc,bd,1);ad("bookmark"+bc+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(bb.hasClass("dyn-bookmark")){K(bb.attr("data-bookmark"));bb.closest("ul").hide()}else{if(bb.hasClass("rmbookmark")){k(bd)}else{if(bb.hasClass("rmallbookmarks")){var bc=0;while(ad("bookmark"+bc)!=null){ao("bookmark"+bc,"bookmark"+bc+"time");bc++}$("#flt").trigger("bookmarksChanged")}else{if(bb.hasClass("rmsinglebookmark")){k($(this).attr("data-bookmark"))}else{if(bb.hasClass("bookmarksortpath")){ad("bookmarksort",ad("bookmarksort")=="path"||ad("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(bb.hasClass("bookmarksorttime")){ad("bookmarksort",ad("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aB(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",ap).on("fileListViewChanged",ap)}function ap(){var bd=$("#selstats");var bb=bd.data("selstats");var bc=aJ();$("#fileListTable").attr("data-fileselcounter",bc.fileselcounter).attr("data-dirselcounter",bc.dirselcounter).attr("data-folderselsize",bc.folderselsize).attr("data-sumselcounter",bc.sumselcounter);$("#flt").trigger("selectionCounterUpdated");bd.html(bb.replace(/\$filecount/g,bc.fileselcounter).replace(/\$dircount/g,bc.dirselcounter).replace(/\$sum/g,bc.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(bc.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(bc.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(bc.folderselsize)).MyTooltip()}function aM(){$("#pathinputform").submit(function(bb){return false});$("#pathinputform input[name='uri']").keydown(function(bb){if(bb.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(bb.keyCode==13){D(bb);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();K($(this).val())}}});$(".action.changedir").button().click(function(bb){D(bb);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(bb){D(bb);$("#pathinput").hide();$("#quicknav").show();K($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function W(){$("form#filterbox").submit(function(bb){return false});$("form#filterbox input").keyup(z).change(z).autocomplete({minLength:1,select:z,close:z});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(bb){D(bb);$("form#filterbox input").val("");z();$(this).addClass("invisible")});$("#flt").on("fileListChanged",z).on("fileListChanged",function(){var bb=$.map($("#fileList tr"),function(bd,bc){return $(bd).attr("data-file")});$("form#filterbox input").autocomplete({source:function(bd,bc){try{var bf=new RegExp(bd.term);bc($.grep(bb,function(bg){return bf.test(bg)}))}catch(be){bc($.grep(bb,function(bg){return bg.indexOf(bd.term)>-1}))}}})})}function z(){var bb=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var bd=new RegExp(bb,"i");if(bb===""||$(this).attr("data-file").match(bd)){$(this).show()}else{$(this).hide()}}catch(bc){if(bb===""||$(this).attr("data-file").toLowerCase().indexOf(bb.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function v(bc,bd){if(!bd){bd=bc}var bb=bd.loaded/bd.total*100;$("#progress .bar").css("width",bb.toFixed(2)+"%").html(parseInt(bb)+"% ("+$.MyStringHelper.renderByteSize(bd.loaded)+"/"+$.MyStringHelper.renderByteSize(bd.total)+"); "+bc.done+"/"+bc.uploads)}function an(bd,bf,bc,be){$("#flt").on("fileListChanged",function(){bd.fileupload("option","url",$("#fileList").attr("data-uri"))});var bb={aborted:false,transports:[],done:0,failed:0,uploads:0};bd.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:be,singleFileUploads:true,autoUpload:false,add:function(bj,bi){if(!bb.aborted){var bk=bi.submit();var bh=bi.files[0].name;bb.transports.push(bk);var bg=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+bh).addClass("fileprogress");$("<div></div>").click(function(bl){D(bl);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bg).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:bh,transport:bk});$("<div></div>").appendTo(bg).addClass("fileprogressbar running").html(bi.files[0].name+" ("+$.MyStringHelper.renderByteSize(bi.files[0].size)+"): 0%");bb.uploads++;return true}return false},done:function(bh,bg){$("#progress [id='fpb"+bg.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bg.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bg.result.message?"done":"failed").css("width","100%").html(bg.result&&bg.result.error?bg.result.error:bg.result.message?bg.result.message:bg.files[0].name);if(bg.result.message){bb.done++}else{bb.failed++}v(bb)},fail:function(bh,bg){$("#progress [id='fpb"+bg.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bg.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bg.textStatus+": "+$.map(bg.files,function(bi,bj){return bi.name}).join(", "));bb.failed++;v(bb);console.log(bg)},stop:function(bh,bg){v(bb);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){av()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(bh,bg){bb.transports=[];bb.aborted=false;bb.files=[];bb.uploads=0;bb.failed=0;bb.done=0;return true},start:function(bi,bh){var bg=[];bg.push({text:$("#close").html(),disabled:true});bg.push({text:$("#cancel").html(),click:function(){if(bb.aborted){return}bb.aborted=true;$.each(bb.transports,function(bj,bk){if(bk&&bk.abort){bk.abort($("#uploadaborted").html())}});bb.transports=[]}});$("#progress").dialog({modal:true,title:bc,height:370,width:500,buttons:bg,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(bi,bh){var bg=parseInt(bh.loaded/bh.total*100)+"%";$("div[id='fpb"+bh.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bg).html(bh.files[0].name+" ("+$.MyStringHelper.renderByteSize(bh.files[0].size)+"): "+bg)},progressall:function(bh,bg){bb.total=bg.total;bb.loaded=bg.loaded;v(bb,bg)},submit:function(bh,bg){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",ad("settings.confirm.upload")=="no"||!T(bg)||window.confirm(bf))}$("#file-upload-form-relapath").val(bg.files[0].relativePath||(bg.files[0].webkitRelativePath&&bg.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function T(bc){for(var bb=0;bb<bc.files.length;bb++){var bd;if(bc.files[bb].relativePath&&bc.files[bb].relativePath!=""){bd=bc.files[bb].relativePath.split(/[\\\/]/)[0]+"/"}else{if(bc.files[bb].webkitRelativePath&&bc.files[bb].webkitRelativePath!=""){bd=bc.files[bb].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(bd&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(bd)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(bc.files[bb].name)+"']").length>0){return true}}}return false}function aA(){an($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(bb){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(bb){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(bb){$("#fileList").addClass("draghover")}).on("dragleave",function(bb){$("#fileList").removeClass("draghover")}).on("drop",function(bb){$("#fileList").removeClass("hover")})}function J(bd,bb){var bc;if(bb.setting){bd+='<div class="confirmdialogsetting"><input type="checkbox" name="'+bb.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";bc=ad(bb.setting)}$("#confirmdialog").html(bd).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(bb.setting){y(bb.setting,bc,bc&&bc!=="",1)}$("#confirmdialog").dialog("close");if(bb.cancel){bb.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(bb.confirm){bb.confirm()}}}],open:function(){if(bb.setting){$("input[name='"+bb.setting+"']",$(this)).click(function(be){y(bb.setting,"no",!$(this).is(":checked"),1)}).prop("checked",ad(bb.setting)!="no")}},close:function(){if(bb.cancel){bb.cancel()}}}).show()}function a8(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function m(bc){var bb=$("#fileList tr.selected:visible");if(bb.length==0){bb=$(bc).closest("tr[data-file]")}if(bb.length==0){bb=$("#fileList tr:visible:focus")}return bb}function aD(bb){return $.map(m(bb),function(bc,bd){return $(bc).attr("data-file")})}function aV(bc){D(bc);var bb=$(this);if(bb.hasClass("disabled")){return}var bd=bb.closest("tr");if(bb.hasClass("rename")){aS(bd)}else{if(bb.hasClass("delete")){N(bd)}else{$("body").trigger("fileActionEvent",{obj:bb,event:bc,file:bd.attr("data-file"),selected:[bd.data("file")],row:bd})}}}function g(){$("#fileactions").on("click dblclick",function(bb){D(bb);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aV).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",ar).on("mouseleave.fileAction",l)}).on("beforeFileListChange replaceRow",l);h();$("body").on("settingchanged",h)}function h(bb,bc){$("#fileactions").toggleClass("hidefileactions",ad("settings.show.fileactions")=="no").toggleClass("hidelabels",ad("settings.show.fileactionlabels")=="no").toggleClass("showalways",ad("settings.show.fileactionalways")=="no")}function ar(bc){var bb=$(this);if($("#fileactions",bb).length===0){$(".action.changeuri.filename",bb).after($("#fileactions"))}}function l(bb){$("#fileactions").appendTo($(".template"))}function aI(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(bd,bc){var bb=$(bc);if(!bb.attr("href")){bb.data("fancybox-href",bb.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(bb){return(bb.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(bd,bc){var bb=$(bc);if(!bb.attr("href")){bb.data("fancybox-href",bb.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function aw(){var bc=$("#fileListTable");var bb=$("#fileList");ac();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",U).off("dblclick.initFileList").on("dblclick.initFileList",function(bd){K($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:C,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:a8,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(be){var bd=$(be.currentTarget);return $(be.currentTarget).clone().width(bd.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:L,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bg,bd){var be=$(bd);$("<div/>").prependTo(be).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(be).html("&nbsp;").addClass("columnResizeHandle right");be.data("origWidth",be.width());var bh=ad(be.prop("id")+".width");if(bh){be.width(parseFloat(bh))}var bf=0;$(bd).on("click.initFileList",function(bj){var bi=$(this);bf++;if(bf==1){window.setTimeout(function(){if(bf==1){if(!bi.hasClass("sorter-false")){aG.call(bi,bj)}}else{var bk=bi.width()==bi.data("origWidth")?1:bi.data("origWidth");bi.width(bk);y(bi.prop("id")+".width",bk,bk!=bi.data("origWidth"),1)}bf=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(bd,be){startPos=parseInt(be.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(bd,be){$(this).removeAttr("style");ad(column.attr("id")+".width",column.width(),1)},drag:function(bd,be){if(handlePos=="right"){column.width(startWidth+be.offset.left-startPos)}else{column.width(startWidth+startPos-be.offset.left)}}});ai();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function ai(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var bb=window.getSelection();if(bb&&bb.removeAllRanges){bb.removeAllRanges()}}}}function L(bc,bd){var bf=bd.draggable.prop("cellIndex");var bb=$(this).prop("cellIndex");if(bf+1==bb){return false}var be=$("#fileListTable thead th");be.eq(bf).detach().insertBefore(be.eq(bb));$.each($("#fileList tr"),function(){var bg=$(this).children("td");bg.eq(bf).detach().insertBefore(bg.eq(bb))});ad("visibletablecolumns",$.map($("#fileListTable thead th[data-name]:not(.hidden):not(:last)"),function(bg){return $(bg).attr("data-name")}).join(","),1);return true}function w(bd,bb){var bc=$("#fileListTable thead th[data-name='"+bd+"']:not(.sorter-false)");if(bc.length==0){return}ad("order",bd+(bb==1?"_asc":"_desc"),1);j(bc.prop("cellIndex"),bb);s(bc.data("sorttype")||"string",bc.data("sort"),bb,bc.prop("cellIndex"),"data-file")}function aY(){var bb=ad("order").split("_");if(!bb){return{name:"data-file",sortorder:1}}return{name:bb[0],sortorder:bb[1]&&bb[1]=="desc"?-1:1}}function ac(){if(lts=aY()){w(lts.name,lts.sortorder)}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aG)}function aG(){var bb=aY();w($(this).data("name"),bb.name==$(this).data("name")?-bb.sortorder:1)}function j(bb,bc){var bd=$("#fileListTable");bd.data("tablesorter-lastclickedcolumn",bb);bd.data("tablesorter-sortorder",bc);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(bb).addClass(bc==1?"tablesorter-up":"tablesorter-down")}function s(bd,bf,bc,bb,be){$("#fileListTable tbody").MyFileTableSorter(bd,bf,bc,bb,be)}function N(bb){bb.fadeTo("slow",0.5);J($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(bb.attr("data-displayname")))),{confirm:function(){var bc=bb.attr("data-file");G(bb);var be=aq();var bd=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:bc},function(bf){be.remove();if(bf.error){av()}O(bf)});H(bd)},cancel:function(){bb.fadeTo("fast",1)}})}function O(bb){if(bb.error){a3(bb.error)}if(bb.warn){aW(bb.warn)}if(bb.message){b(bb.message)}if(bb.quicknav){$("#quicknav").html(bb.quicknav).MyTooltip();$("#quicknav a").click(function(bc){D(bc);K($(this).attr("href"))})}}function u(bf,bc,bb){var be=aq();var bd=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:bb,file:bc},function(bg){if(bg.message){var bh=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:bb,template:$("#fileList").attr("data-entrytemplate")},function(bi){try{var bj=$(bi);var bl=$("tr[data-file='"+bb+"']");if(bl.length>0){bl.remove()}$("#flt").trigger("replaceRow",{row:bf,newrow:bj});bf.replaceWith(bj);bf=bj;aw();bj.focus()}catch(bk){av()}be.remove()});H(bh)}else{be.remove()}O(bg)});H(bd)}function aS(bd){var bc=bd.closest("tr[data-file]").data("file");var bb=bc.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:bd.find("td.filename"),defaultValue:bb,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(bf){var be=bf.value.replace(/\//g,"");if(be==bb){return}if(ad("settings.confirm.rename")!="no"){J($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(bc)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(be)),{confirm:function(){u(bd,bc,be)},setting:"settings.confirm.rename"})}else{u(bd,bc,be)}}})}function aO(bb,bc){console.log("notify["+bb+"]: "+bc);if(ad("settings.messages."+bb)=="no"){return}noty({text:bc,type:bb,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:bb,msg:bc})}function a3(bb){aO("error",bb)}function b(bb){aO("message",bb)}function aW(bb){aO("warning",bb)}function a7(bc,bb){if(!bc){return}bc.toggleClass("selected",bb);bc.find(".selectbutton").prop("checked",bc.hasClass("selected"))}function S(bb){return bb.attr("data-file")!=".."&&!bb.hasClass("unselectable-yes")}function U(bd){var bh=$("#fileListTable");if(S($(this))){var bg=this.rowIndex;var bb=bg;if((bd.shiftKey||bd.metaKey||bd.altKey)&&bh.data("lastSelectedRowIndex")){bb=bh.data("lastSelectedRowIndex");if(bb<bg){var bf=bb;bb=bg;bg=bf}for(var bc=bg+1;bc<bb;bc++){var be=$("#fileList tr:visible").filter(function(){return this.rowIndex==bc});if(be.length===0){continue}a7(be);be=be.next()}}a7($(this));bh.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function a6(){$(".dialog.action").click(aE)}function aE(bc){D(bc);if($(this).hasClass("disabled")){return}var bb=$(this);bb.addClass("disabled");var bd=$("#"+bb.attr("data-action"));if(bd.attr("title")){bd.data("title",bd.attr("title"))}bd.attr("title",bd.data("title"));bd.dialog({modal:true,width:"auto",open:function(){if(bd.data("initHandler")){bd.data("initHandler").init()}},close:function(){bb.removeClass("disabled")},dialogClass:bb.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function M(){a9();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",a1).on("fileListViewChanged",a1)}function a9(){aH($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function a1(){var bc=aJ();var bd=$("#fileListTable");var bb=bd.hasClass("iswriteable-no")?":not(.access-writeable)":"";bb+=bd.hasClass("isreadable-no")?":not(.access-readable)":"";bb+=bd.hasClass("unselectable-no")?":not(.access-selectable)":"";aH($(".access-writeable"),bd.hasClass("iswriteable-no"));aH($(".access-readable"),bd.hasClass("isreadable-no"));aH($(".access-selectable"),bd.hasClass("unselectable-yes"));aH($(".sel-none"+bb),bc.sumselcounter!==0);aH($(".sel-one"+bb),bc.sumselcounter!=1);aH($(".sel-multi"+bb),bc.sumselcounter===0);aH($(".sel-noneorone"+bb),bc.sumselcounter>1);aH($(".sel-none.sel-dir"+bb),bc.fileselcounter!==0);aH($(".sel-one.sel-dir"+bb),bc.fileselcounter>0||bc.dirselcounter!=1);aH($(".sel-multi.sel-dir"+bb),bc.fileselcounter>0||bc.dirselcounter===0);aH($(".sel-noneorone.sel-dir"+bb),bc.fileselcounter>0||bc.dirselcounter>1);aH($(".sel-noneormulti.sel-dir"+bb),bc.fileselcounter>0);aH($(".sel-none.sel-file"+bb),bc.fileselcounter!==0);aH($(".sel-one.sel-file"+bb),bc.dirselcounter>0||bc.fileselcounter!=1);aH($(".sel-multi.sel-file"+bb),bc.dirselcounter>0||bc.fileselcounter===0);aH($(".sel-noneorone.sel-file"+bb),bc.dirselcounter>0||bc.fileselcounter>1);aH($(".sel-noneormulti.sel-file"+bb),bc.dirselcounter>0)}function at(){$("#flt").on("fileListChanged",ah).on("fileListViewChanged",ah)}function E(bb){if(!bb){bb=$("#fileListTable")}if(bb&&bb.attr){bb.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aC(){var bc=$("#fileListTable");E(bc);var bb=aJ();bc.attr("data-dircounter",bb.dircounter);bc.attr("data-filecounter",bb.filecounter);bc.attr("data-foldersize",bb.foldersize);bc.attr("data-sumcounter",bb.sumcounter);$("#flt").trigger("counterUpdated")}function aJ(){var bc=[];bc.dircounter=$("#fileList tr.is-subdir-yes:visible").length;bc.filecounter=$("#fileList tr.is-file:visible").length;bc.sumcounter=bc.dircounter+bc.filecounter;bc.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;bc.fileselcounter=$("#fileList tr.selected.is-file:visible").length;bc.sumselcounter=bc.dirselcounter+bc.fileselcounter;var bb=0;var bd=0;$("#fileList tr:visible").each(function(bf,bg){var be=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){bd+=be}bb+=be});bc.foldersize=bb;bc.folderselsize=bd;return bc}function ah(){var bd=$("#headerName");var be=$("#fileListTable");var bc=$("#headerSize");aC();if(bd.length>0&&!bd.attr("data-title")){bd.attr("data-title",bd.attr("title"))}if(bc.length>0&&!bc.attr("data-title")){bc.attr("data-title",bc.attr("title"))}if(bd.length>0){bd.attr("title",bd.attr("data-title").replace(/\$filecount/,be.attr("data-filecounter")).replace(/\$dircount/,be.attr("data-dircounter")).replace(/\$sum/,parseInt(be.attr("data-dircounter"))+parseInt(be.attr("data-filecounter"))))}var bb=parseInt(be.attr("data-foldersize"));if(bc.length>0){bc.attr("title",bc.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(bb)))}}function a2(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var bb=history.location||document.location;av(bb.pathname)})}function K(bc,bb){try{if(!bb){if(window.history.pushState){window.history.pushState({path:bc},"",bc);av(bc)}else{av(bc)}return}}catch(bd){console.log(bd)}if(!bb){aq()}window.location.href=bc}function av(bb,bd){if(!bb){bb=$("#fileList").attr("data-uri")}if(!bb){bb=window.location.href}if(!bd){bd={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var bc=$.now();$("#flt").data("timestamp",bc);$.get(bb,bd,function(be){if($("#flt").data("timestamp")!=bc){return}$("#flt").trigger("beforeFileListChange").show().html(be.content).attr("data-uri",bb);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+bb.replace(/\/[^\/]+\/\.\.$/,"/"));aw();O(be)})}function G(bb){$("#flt").trigger("beforeFileListChange");bb.remove();$("#flt").trigger("fileListChanged")}function A(bd,bb,be,bc){var bg=aq();var bf=$.post(be,{srcuri:bb,action:bd,files:bc.join("@/@")},function(bh){if(bh.message&&bd=="cut"){G($("#fileList tr[data-file='"+bc.join("'],#fileList tr[data-file='")+"']"))}bg.remove();if(bh.error){av()}O(bh)});H(bf)}function C(be,bg){var bb=bg.draggable.closest("tr");var bh=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var bc=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(bh==$.MyStringHelper.concatUri(bc,encodeURIComponent($.MyStringHelper.stripSlash(bb.attr("data-file"))))+"/"){return}var bf=be.shiftKey||be.altKey||be.ctrlKey||be.metaKey?"copy":"cut";var bd=bb.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bk,bj){return $(bk).attr("data-file")}):new Array(bb.attr("data-file"));if(ad("settings.confirm.dnd")!="no"){var bi=$("#paste"+bf+"confirm").html();bi=bi.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bd.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bc))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bh))).replace(/\\n/g,"<br/>");J(bi,{confirm:function(){A(bf,bc,bh,bd)},setting:"settings.confirm.dnd"})}else{A(bf,bc,bh,bd)}}function aq(){return $("<div></div>").prependTo("body").addClass("overlay")}function am(be,bf,bd){for(var bc in bf){var bb=bf[bc];if(typeof bb==="object"){am(be,bb,bc)}else{if(bd){be.append($("<input/>").prop("name",bd).prop("value",bb).prop("type","hidden"))}else{be.append($("<input/>").prop("name",bc).prop("value",bb).prop("type","hidden"))}}}return be}function aZ(bc){var bb=$("<form/>").appendTo("body");bb.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");am(bb,bc);bb.submit();bb.remove()}function aa(bd){var bc=$(this);var bb=m(this);bb.fadeTo("slow",0.5);J(bb.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(bb.first().attr("data-file")))),{confirm:function(){var bf=aq();if(bb.length===0){bb=bc.closest("tr")}var be=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(bb,function(bg,bh){return $(bg).attr("data-file")})},function(bg){bf.remove();G(bb);aj();if(bg.error){av()}O(bg)});H(be)},cancel:function(){bb.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function aj(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function Z(bd,bb,be,bc){var bg=aq();var bf=$.post(be,{action:bd,files:bc,srcuri:bb},function(bh){if(ad("clpaction")=="cut"){ao("clpfiles","clpaction","clpuri")}bg.remove();av();O(bh)});H(bf)}function F(bb){D(bb);var bi=$(this);if(bi.hasClass("disabled")){return}if(bi.hasClass("delete")){aa.call(this,bb)}else{if(bi.hasClass("rename")){aS(bi.closest("tr"))}else{if(bi.hasClass("cut")||bi.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var be=$.map(m(bi),function(bl,bk){return $(bl).attr("data-file")});ad("clpfiles",be.join("@/@"));ad("clpaction",bi.hasClass("cut")?"cut":"copy");ad("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(bi.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}R();aj()}else{if(bi.hasClass("paste")){var bc=ad("clpfiles");var bf=ad("clpaction");var bh=ad("clpuri");var bg=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(ad("settings.confirm.paste")!="no"){var bd=$("#paste"+bf+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(bh)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(bg)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(bc.split("@/@").join(", ")));J(bd,{confirm:function(){Z(bf,bh,bg,bc)},setting:"settings.confirm.paste"})}else{Z(bf,bh,bg,bc)}}else{if(bi.attr("href")!==undefined&&bi.attr("href")!="#"){window.location.href=bi.attr("href")}else{if(bi.attr("data-href")!==undefined&&bi.attr("data-href")!="#"){window.location.href=bi.attr("data-href")}else{var bj=bi.closest("tr");$("body").trigger("fileActionEvent",{obj:bi,event:bb,file:bj.attr("data-file"),row:bj,selected:aD(this)})}}}}}}}function ad(bd,be,bb){var bc=new Date();bc.setTime(bc.getTime()+315360000000);if(be){return Cookies.set(bd,be,{path:$("#flt").attr("data-baseuri"),secure:true,expires:bb?bc:undefined})}return Cookies.get(bd)}function ao(){for(var bb=0;bb<arguments.length;bb++){Cookies.remove(arguments[bb],{path:$("#flt").attr("data-baseuri"),secure:true})}}function y(bd,be,bb,bc){if(bb){ad(bd,be,bc)}else{ao(bd)}}function ag(){R();$("#flt").on("fileListChanged",R)}function R(){var bf=ad("clpaction");var bb=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var bd=ad("clpuri");var be=ad("clpfiles");var bc=(!be||be===""||bd==bb||$("#fileListTable").hasClass("iswriteable-no"));aH($(".action.paste"),bc);if(bd==bb&&bf=="cut"){$.each(be.split("@/@"),function(bg,bh){$("[data-file='"+bh+"']").addClass("cutted").fadeTo("fast",0.5)})}}function Q(){$("#nav .action").click(F).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function r(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(F).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var bb={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(bc){$("#flt").disableSelection();if(bc){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(bb,{changeEvent:function(bd){var bc=$(this);$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:bd.value},function(be){if(!be.error&&be.message){ak(bd.value)}O(be)})}}));$(".action.create-file").MyInplaceEditor($.extend(bb,{changeEvent:function(bd){var bc=$(this);$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:bd.value},function(be){if(!be.error&&be.message){ak(bd.value)}O(be)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(bb,{changeEvent:function(bc){var bd=m(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:bc.value,file:bd.attr("data-file")},function(be){if(!be.error&&be.message){ak(bc.value)}O(be)})}}))}function D(bb){if(bb.preventDefault){bb.preventDefault()}else{bb.returnValue=false}if(bb.stopPropagation){bb.stopPropagation()}}function ax(bb){D(bb);if(bb.stopImmediatePropagation){bb.stopImmediatePropagation()}}function f(){$(".action.viewfilter").click(function(bd){D(bd);if($(this).hasClass("disabled")){return}var bb=$(this);$(".action.viewfilter").addClass("disabled");var be=$("#fileList").attr("data-uri");var bc=bb.attr("data-template");$.get(be,{ajax:"getViewFilterDialog",template:bc},function(bf){var bg=$(bf);$("input[name='filter.size.val']",bg).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bg).button().click(function(bi){D(bi);y("filter.name",$("select[name='filter.name.op'] option:selected",bg).val()+" "+$("input[name='filter.name.val']",bg).val(),$("input[name='filter.name.val']",bg).val()!=="");y("filter.size",$("select[name='filter.size.op'] option:selected",bg).val()+$("input[name='filter.size.val']",bg).val()+$("select[name='filter.size.unit'] option:selected",bg).val(),$("input[name='filter.size.val']",bg).val()!=="");if($("input[name='filter.types']:checked",bg).length>0){var bh="";$("input[name='filter.types']:checked",bg).each(function(bj,bk){bh+=$(bk).val()});ad("filter.types",bh)}else{ao("filter.types")}bg.dialog("close");av()});$(".filter-reset",bg).button().click(function(bh){D(bh);ao("filter.name","filter.size","filter.types");bg.dialog("close");av()});bg.submit(function(){return false});bg.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:bb.attr("title")||bb.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bg.remove()}}).show()})})}function H(be,bd,bc){$("#abortdialog").remove();var bb=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",bb).button().click(function(bf){if(be.readyState!=4){be.abort()}bb.hide().remove();if(bc){bc.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(be.readyState>2){return}bb.appendTo($("body")).show();var bf=window.setInterval(function(){if(be.readyState==4){bb.hide().remove();window.clearInterval(bf)}},200);$("body").data("abortdialoginterval",bf)},bd||2500));return bb}function aT(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function p(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var bd="";var bb=$("*[accesskey]").get().sort(function(bf,be){var bg=$(bf).attr("accesskey");var bh=$(be).attr("accesskey");return bg<bh?-1:bg>bh?1:0});var bc=[];$.each(bb,function(bf,be){var bg=$(be);var bh=bg.attr("accesskey");if(!bc[bh]){bd+='<li tabindex="0" role="definition">'+bh+": "+(bg.attr("aria-label")||bg.attr("title")||bg.attr("data-tooltip")||bg.html())+"</li>";bc[bh]=true}else{console.log("found accesskey "+bh+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+bd+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function a0(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(bd){D(bd);var bb=$(this);if(bb.hasClass("table-sort")){var bc=aY();w(bb.data("name"),bc.name==bb.data("name")?-bc.sortorder:1)}else{if(bb.hasClass("table-sort-this-asc")){w(bb.closest("th").data("name"),1)}else{if(bb.hasClass("table-sort-this-desc")){w(bb.closest("th").data("name"),-1)}else{if(bb.hasClass("table-column-hide-this")){}}}}}function aP(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",D).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable .fileListHead .sorter-false").each(function(bc,bb){var bd=$(bb);if(bd.data("name")!=undefined){$(".action.table-sort."+bd.data("name")).hide()}})})}function V(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",F).on("dblclick.popupmenu",D).MyKeyboardEventHandler();aP();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){a0()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content"})});$("body").off(".popupmenu").on("click.popupmenu",function(){a0()}).on("keydown.popupmenu",function(bb){if(bb.which==27){a0()}});$("#filler").on("contextmenu",function(bb){if(bb.which==3){if(bb.originalEvent.detail===1){D(bb)}a0()}})}function ak(bb){var bc=$("#fileList");return $.get($.MyStringHelper.addMissingSlash(bc.data("uri")),{ajax:"getFileListEntry",template:bc.data("entrytemplate"),file:bb},function(bd){try{var be=$(bd);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(bb)+"']",bc);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:be});row.replaceWith(be)}else{be.appendTo(bc)}aw();be.focus()}catch(bf){av()}})}function aX(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(bc,bb){if(bb.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!bb.value);$("#flt").trigger("fileListViewChanged")}else{if(bb.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!bb.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",ad("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",ad("settings.show.dotfolders")=="no")}function aN(){var bb=ad("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bf,be){var bd=$(this);if(bd.data("thumb")!=bd.data("icon")){var bc=bd.data("thumb");var bg=bd.data("icon");var bh=$("#emptyimage").attr("src");bd.attr("src",bb?(bc===""?bh:bc):(bg===""?bh:bg));bd.toggleClass("thumbnail",bb)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(bc,bb){if(bb.setting=="settings.enable.thumbnails"){aN()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var bb=$(this);var bc=bb.data("icon");bb.removeClass("thumbnail").attr("src",bc!==""?bc:$("#emptyimage").attr("src"))})})}function n(bc,bb){var be=aq();var bd=$.get(window.location.pathname,bc,function(bf){be.remove();O(bf);bb(bf)});H(bd)}function az(bc,bb){var be=aq();var bd=$.post(window.location.pathname,bc,function(bf){be.remove();O(bf);bb(bf)});H(bd)}function ab(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:aq,changeUri:K,concatUri:$.MyStringHelper.concatUri,confirmDialog:J,cookie:ad,fixElementPosition:Y,getDialog:n,getDialogByPost:az,getSelectedFiles:aD,getSelectedRows:m,handleJSONResponse:O,handleWindowResize:t,hidePopupMenu:a0,initFileList:aw,initPopupMenu:V,initTabs:af,initUpload:an,notify:aO,notifyError:a3,notifyInfo:b,notifyWarn:aW,preventDefault:D,preventDefaultImmediatly:ax,postAction:aZ,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:ak,removeAbortDialog:aT,renderAbortDialog:H,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:ao,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:y,toggleRowSelection:a7,uncheckSelectedRows:aj,updateFileList:av}}function al(){$.fn.MyTooltip.defaults.helphandler=aF;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){aF.call(this,$(this).data("help"))})}function aF(bc){var bb=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:bc,width:"99%",height:"99%"}).text(bc)).dialog({width:bb.width()/2,height:bb.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
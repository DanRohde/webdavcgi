var ToolBox={};$(function(){a6();W();az();N();g();ah();au();r();R();aN();X();aB();aC();a8();f();e();C();J();aJ();o();Q();af();av();d();aS();aZ();c();aM();a4();a7();ag();ac();am();$.ajaxSetup({traditional:true});$(document).ajaxError(function(bf,bg,be,bd){console.log(bf);console.log(bg);console.log(be);console.log(bd);if(bg&&bg.statusText&&bg.statusText!="abort"){a5(bg.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(bd,bf,be){bd.cache=true});aw($("#flt").attr("data-uri"));function ag(bd){if(!bd){bd=$(document)}$(".tabsel",bd).on("click keyup",function(bg){if(bg.type=="keyup"&&bg.keyCode!=32&&bg.keyCode!=13){return}E(bg);var be=$(this);$(".tabsel.activetabsel",bd).removeClass("activetabsel");be.addClass("activetabsel");$(".tab.showtab",bd).removeClass("showtab");var bf=$(".tab."+be.data("group"),bd).addClass("showtab");$(":focusable:visible:first",bf).focus()})}function a7(){if(!ae("settings.show.statusbar")){ae("settings.show.statusbar","no");ae("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",ae("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(be){$(this).prop("checked",true);E(be)});function bd(){var bf=$("#fileListTable");var be=$("#statusbar");$(".filecount",be).html(bf.attr("data-filecounter"));$(".dircount",be).html(bf.attr("data-dircounter"));$(".sum",be).html(bf.attr("data-sumcounter"));$(".foldersize",be).attr("title",$.MyStringHelper.renderByteSizes(bf.data("foldersize"))).html($.MyStringHelper.renderByteSize(bf.data("foldersize")));$(".selfilecount",be).html(bf.attr("data-fileselcounter"));$(".seldircount",be).html(bf.attr("data-dirselcounter"));$(".selsum",be).html(bf.attr("data-sumselcounter"));$(".selfoldersize",be).attr("title",$.MyStringHelper.renderByteSizes(bf.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(bf.attr("data-folderselsize")));$(".selected-files-stats",be).toggle(bf.attr("data-fileselcounter")!==0||bf.attr("data-dirselcounter")!==0)}bd();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",bd);$("body").on("notify",function(be,bf){$("#statusbar .notify").attr("title",bf.msg).removeClass("error message warning").addClass(bf.type).html(bf.msg).MyTooltip()});$("body").on("settingchanged",function(be,bf){if(bf.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",bf.value)}});$("#statusbar").MyTooltip()}function aM(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aS(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(bf){var be=this.tabIndex||1;var bd=$(this);if(bd.is(":focus")){if(bf.keyCode==32){V.call(this,bf)}else{if(bf.keyCode==13){L($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(bd.attr("data-file")))),bd.attr("data-type")=="file")}else{if(bf.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(T(bd)){O(bd)}}else{ab()}}else{if(bf.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(bf.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(bf.keyCode==45){$(".paste").trigger("click")}}}}}}}if(bf.keyCode==38&&be>-1){E(bf);if(T(bd)&&(bf.shiftKey||bf.altKey||bf.ctrlKey||bf.metaKey)){a9(bd,true);$("#flt").trigger("fileListSelChanged")}bd.prevAll(":focusable:first").focus();aj()}else{if(bf.keyCode==40){E(bf);if(T(bd)&&(bf.shiftKey||bf.altKey||bf.ctrlKey||bf.metaKey)){a9(bd,true);$("#flt").trigger("fileListSelChanged")}bd.nextAll(":focusable:first").focus();aj()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",p);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(bf){E(bf);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var be=$("#flt").data("TableConfigDialog");if(be){i($(be))}else{if($("#tableconfigdialogtemplate").length>0){var bd=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",bd);i($(bd))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(bg){if(bg.error){P(bg)}$("#flt").data("TableConfigDialog",bg);i($(bg))})}}}).MyKeyboardEventHandler()})}function i(be){var bg=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(bj,bi){return $(bj).attr("data-name")});$.each(bg,function(bi,bj){be.find("input[name='visiblecolumn'][value='"+bj+"']").prop("checked",true)});be.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bi){E(bi)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bi,bj){be.find("input[name='sortingcolumn'][value='"+$(bj).attr("data-name")+"']").prop("disabled",true).click(function(bk){E(bk)}).closest("li").addClass("disabled")});var bh=ae("order")?ae("order").split("_"):"name_asc".split("_");var bf=bh[0];var bd=bh[1]||"asc";be.find("input[name='sortingcolumn'][value='"+bf+"']").prop("checked",true);be.find("input[name='sortingorder'][value='"+bd+"']").prop("checked",true);be.find("input[value='fileactions']").closest("li").hide();be.find("input[name='save']").button().click(function(bn){var bm=bg.slice(0);var bi=$.map($("input[name='visiblecolumn']:checked"),function(br,bq){return $(br).attr("value")});var bk=[];for(var bl=bm.length-1;bl>=0;bl--){if($.inArray(bm[bl],bi)==-1){bk.push(bm[bl]);bm.splice(bl,1)}}var bj=[];$.each(bi,function(bq,br){if($.inArray(br,bm)==-1){bj.push(br);bm.push(br)}});var bp=be.find("input[name='sortingcolumn']:checked").attr("value");var bo=be.find("input[name='sortingorder']:checked").attr("value");if(bi.sort().join(",")!=bg.sort().join(",")){$.each(bj,function(bq,br){aU(br,true)});$.each(bk,function(bq,br){aU(br,false)})}w(bp,bo=="desc"?-1:1);be.dialog("close")});be.find("input[name='cancel']").button().click(function(bi){E(bi);be.dialog("close");return false});be.find("#tableconfigform").submit(function(bi){return false});be.dialog({modal:true,width:"auto",title:be.attr("data-title")||be.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");be.dialog("destroy")}})}function aR(bd){if(bd){E(bd)}var bf=$(this).hasClass("collapsed");var be=$(this).hasClass("iconsonly");if(!bf&&!be){be=true}else{if(be){be=false;bf=true}else{bf=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",bf).toggleClass("sidebar-iconsonly",be);$(".action.collapse-sidebar").toggleClass("collapsed",bf).toggleClass("iconsonly",be);if(!be&&!bf){ap("sidebar")}else{ae("sidebar",be?"iconsonly":bf?"false":"true")}t()}function av(){$(".action.collapse-sidebar").click(aR).MyKeyboardEventHandler().MyTooltip();if(ae("sidebar")&&ae("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ae("sidebar")=="false").toggleClass("sidebar-iconsonly",ae("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",ae("sidebar")=="false").toggleClass("iconsonly",ae("sidebar")=="iconsonly");t()}$(".action.collapse-head").click(function(bd){E(bd);$(".action.collapse-head").toggleClass("collapsed");var be=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!be);$(".collapse-head-listener").toggleClass("head-collapsed",be);z("head","false",be,1);t()}).MyTooltip().MyKeyboardEventHandler();if(ae("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function af(){$(".action.autorefreshmenu").dblclick(function(bd){E(bd);aw()});aI($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aI($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aI($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(ae("autorefresh")!==""&&parseInt(ae("autorefresh"))>0){aW(parseInt(ae("autorefresh")))}});$(".action.setautorefresh").click(function(bd){E(bd);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){aw();return}ae("autorefresh",$(this).attr("data-value"));aW(parseInt($(this).attr("data-value")))}).on("keyup",function(bd){if(bd.keyCode==32||bd.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(bd){E(bd);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ap("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bd){if(bd.keyCode==32||bd.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(be){E(be);if($(this).hasClass("disabled")){return}var bd=$("#autorefresh");if(bd.data("timer")!=null){window.clearInterval(bd.data("timer"));bd.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{aW(bd.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bd){if(bd.keyCode==32||bd.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(be,bd){ae("autorefreshtimerpos",JSON.stringify(Z("#autorefreshtimer",bd.offset)))}});if(ae("autorefreshtimerpos")){Z("#autorefreshtimer",JSON.parse(ae("autorefreshtimerpos")))}}function Z(bh,bd){var bg=$(bh);var be=$(window);var bf={left:Math.min(Math.max(bd.left,0),be.width()-bg.outerWidth()+be.scrollLeft()),top:Math.min(Math.max(bd.top,0),be.height()-bg.outerHeight()+be.scrollTop())};bg.offset(bf);return bf}function Y(bd){var bf=$(".autorefreshtimer");var bg=bf.attr("data-template")||"%sm %ss";var be=Math.floor(bd/60);var bh=bd%60;if(bh<10){bh="0"+bh}bf.html(bg.replace("%s",be).replace("%s",bh))}function aW(be){var bd=$("#autorefresh");if(bd.data("timer")!=null){window.clearInterval(bd.data("timer"))}bd.data("timeout",be);Y(be);bd.data("timer",window.setInterval(function(){var bf=bd.data("timeout")-1;Y(bf);bd.data("timeout",bf);if(bf<0){window.clearInterval(bd.data("timer"));bd.data("timer",null);Y(0);bd.trigger("stopped");aw()}},1000));bd.trigger("started")}function Q(){var bd=$("#settings");bd.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",bd).each(function(bf,be){$(be).prop("checked",ae($(be).prop("name"))!="no").click(function(bg){if(ae($(this).prop("name")+".keep")){ae($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{z($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",bd).change(function(){if($(this).prop("name")=="settings.lang"){ae($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{ae($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(bg,be){var bh=$(be);var bf=bh.prop("name");if(bf=="settings.lang"){bf=bf.replace(/^settings\./,"")}$("option[value='"+ae(bf)+"']",bh).prop("selected",true)})}})}function a6(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(bd){if(bd.keyCode==13||bd.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(bd){E(bd);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function o(){$("#flt").on("fileListChanged",t).on("fileListViewChanged",t);$(window).resize(t);t()}function t(){var bd=$(window).width()-$("#nav").width();$("#content").width(bd);$("#controls").width(bd);$("body").trigger("windowResized")}function J(){$(".action.changeuri").off(".changeuri").on("click.changeuri",bc);$(".action.refresh").off(".refresh").on("click.refresh",function(bd){E(bd);aw();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",bc);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var bd=$(this);if(!bd.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=bd.data("href")?bd.data("href"):bd.attr("href")}})})}function bc(bd){E(bd);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){L($(this).data("href")||$(this).attr("href"))}return false}function C(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(bd){$("#fileList tr:not(:hidden).unselectable-no").each(function(be,bf){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(bd){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(bd){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function az(){$("#flt").on("bookmarksChanged",q).on("bookmarksChanged",x).on("fileListChanged",function(){q();x()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aL)}function aI(bd,be){$.each(bd,function(bh,bg){var bf=$(bg);if(bf.hasClass("hideit")){bf.toggle(!be)}if(bf.hasClass("button")){bf.button("option","disabled",be)}if(!bf.hasClass("notab")){bf.attr("tabindex",be?-1:0)}bf.toggleClass("disabled",be)})}function x(){var bh=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var bd=false;var bg=0;var bf=0;while(ae("bookmark"+bf)!=null){if(ae("bookmark"+bf)==bh){bd=true}if(ae("bookmark"+bf)!="-"){bg++}bf++}$(".action.addbookmark").button("option","disabled",bd);aI($(".action.rmbookmark"),!bd);aI($(".action.bookmarksortpath"),bg<2);aI($(".action.bookmarksorttime"),bg<2);aI($(".action.rmallbookmarks"),bg===0);var be=ae("bookmarksort")==null?"time-desc":ae("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(be=="path"||be=="path-desc"||be=="time"||be=="time-desc"){$("#bookmarks .action.bookmarksort"+be.replace(/-desc/,"")+" ."+be).show()}}function q(){var bi=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(bj,bk){$(bk).remove()});var bh=[];var bf=0;while(ae("bookmark"+bf)!=null){if(ae("bookmark"+bf)!="-"){bh.push({path:ae("bookmark"+bf),time:parseInt(ae("bookmark"+bf+"time"))})}bf++}var bg=ae("bookmarksort")?ae("bookmarksort"):"time-desc";var bd=1;if(bg.indexOf("-desc")>0){bd=-1;bg=bg.replace(/-desc/,"")}bh.sort(function(bk,bj){if(bg=="path"){return bd*bk[bg].localeCompare(bj[bg])}else{return bd*(bj[bg]-bk[bg])}});var be=$("#bookmarktemplate").html();$.each(bh,function(bj,bl){var bk=unescape(bl.path);$("<li>"+be.replace(/\$bookmarkpath/g,bl.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(bk,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aL).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",bl.path).attr("data-htmltooltip",$.MyStringHelper.simpleEscape(bk)+"%0D"+(new Date(parseInt(bl.time)))).attr("tabindex",bl.path==bi?-1:0).toggleClass("disabled",bl.path==bi).find(".action.rmsinglebookmark").click(aL).MyKeyboardEventHandler()})}function k(be){var bd=0;while(ae("bookmark"+bd)!=null&&ae("bookmark"+bd)!=be){bd++}if(ae("bookmark"+bd)==be){ae("bookmark"+bd,"-",1)}$("#flt").trigger("bookmarksChanged")}function aL(bg){E(bg);if($(this).hasClass("disabled")){return}var bd=$(this);var bf=$("#fileList").attr("data-uri");if(bd.hasClass("addbookmark")){var be=0;while(ae("bookmark"+be)!=null&&ae("bookmark"+be)!="-"&&ae("bookmark"+be)!=""&&ae("bookmark"+be)!=bf){be++}ae("bookmark"+be,bf,1);ae("bookmark"+be+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(bd.hasClass("dyn-bookmark")){L(bd.attr("data-bookmark"));bd.closest("ul").hide()}else{if(bd.hasClass("rmbookmark")){k(bf)}else{if(bd.hasClass("rmallbookmarks")){var be=0;while(ae("bookmark"+be)!=null){ap("bookmark"+be,"bookmark"+be+"time");be++}$("#flt").trigger("bookmarksChanged")}else{if(bd.hasClass("rmsinglebookmark")){k($(this).attr("data-bookmark"))}else{if(bd.hasClass("bookmarksortpath")){ae("bookmarksort",ae("bookmarksort")=="path"||ae("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(bd.hasClass("bookmarksorttime")){ae("bookmarksort",ae("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aC(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",aq).on("fileListViewChanged",aq)}function aq(){var bf=$("#selstats");var bd=bf.data("selstats");var be=aK();$("#fileListTable").attr("data-fileselcounter",be.fileselcounter).attr("data-dirselcounter",be.dirselcounter).attr("data-folderselsize",be.folderselsize).attr("data-sumselcounter",be.sumselcounter);$("#flt").trigger("selectionCounterUpdated");bf.html(bd.replace(/\$filecount/g,be.fileselcounter).replace(/\$dircount/g,be.dirselcounter).replace(/\$sum/g,be.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(be.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(be.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(be.folderselsize)).MyTooltip()}function aN(){$("#pathinputform").submit(function(bd){return false});$("#pathinputform input[name='uri']").keydown(function(bd){if(bd.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(bd.keyCode==13){E(bd);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();L($(this).val())}}});$(".action.changedir").button().click(function(bd){E(bd);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(bd){E(bd);$("#pathinput").hide();$("#quicknav").show();L($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function X(){$("form#filterbox").submit(function(bd){return false});$("form#filterbox input").keyup(A).change(A).autocomplete({minLength:1,select:A,close:A});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(bd){E(bd);$("form#filterbox input").val("");A();$(this).addClass("invisible")});$("#flt").on("fileListChanged",A).on("fileListChanged",function(){var bd=$.map($("#fileList tr"),function(bf,be){return $(bf).attr("data-file")});$("form#filterbox input").autocomplete({source:function(bf,be){try{var bh=new RegExp(bf.term);be($.grep(bd,function(bi){return bh.test(bi)}))}catch(bg){be($.grep(bd,function(bi){return bi.indexOf(bf.term)>-1}))}}})})}function A(){var bd=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var bf=new RegExp(bd,"i");if(bd===""||$(this).attr("data-file").match(bf)){$(this).show()}else{$(this).hide()}}catch(be){if(bd===""||$(this).attr("data-file").toLowerCase().indexOf(bd.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function v(be,bf){if(!bf){bf=be}var bd=bf.loaded/bf.total*100;$("#progress .bar").css("width",bd.toFixed(2)+"%").html(parseInt(bd)+"% ("+$.MyStringHelper.renderByteSize(bf.loaded)+"/"+$.MyStringHelper.renderByteSize(bf.total)+"); "+be.done+"/"+be.uploads)}function ao(bf,bh,be,bg){$("#flt").on("fileListChanged",function(){bf.fileupload("option","url",$("#fileList").attr("data-uri"))});var bd={aborted:false,transports:[],done:0,failed:0,uploads:0};bf.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:bg,singleFileUploads:true,autoUpload:false,add:function(bl,bk){if(!bd.aborted){var bm=bk.submit();var bj=bk.files[0].name;bd.transports.push(bm);var bi=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+bj).addClass("fileprogress");$("<div></div>").click(function(bn){E(bn);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bi).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:bj,transport:bm});$("<div></div>").appendTo(bi).addClass("fileprogressbar running").html(bk.files[0].name+" ("+$.MyStringHelper.renderByteSize(bk.files[0].size)+"): 0%");bd.uploads++;return true}return false},done:function(bj,bi){$("#progress [id='fpb"+bi.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bi.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bi.result.message?"done":"failed").css("width","100%").html(bi.result&&bi.result.error?bi.result.error:bi.result.message?bi.result.message:bi.files[0].name);if(bi.result.message){bd.done++}else{bd.failed++}v(bd)},fail:function(bj,bi){$("#progress [id='fpb"+bi.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bi.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bi.textStatus+": "+$.map(bi.files,function(bk,bl){return bk.name}).join(", "));bd.failed++;v(bd);console.log(bi)},stop:function(bj,bi){v(bd);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){aw()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(bj,bi){bd.transports=[];bd.aborted=false;bd.files=[];bd.uploads=0;bd.failed=0;bd.done=0;return true},start:function(bk,bj){var bi=[];bi.push({text:$("#close").html(),disabled:true});bi.push({text:$("#cancel").html(),click:function(){if(bd.aborted){return}bd.aborted=true;$.each(bd.transports,function(bl,bm){if(bm&&bm.abort){bm.abort($("#uploadaborted").html())}});bd.transports=[]}});$("#progress").dialog({modal:true,title:be,height:370,width:500,buttons:bi,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(bk,bj){var bi=parseInt(bj.loaded/bj.total*100)+"%";$("div[id='fpb"+bj.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bi).html(bj.files[0].name+" ("+$.MyStringHelper.renderByteSize(bj.files[0].size)+"): "+bi)},progressall:function(bj,bi){bd.total=bi.total;bd.loaded=bi.loaded;v(bd,bi)},submit:function(bj,bi){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",ae("settings.confirm.upload")=="no"||!U(bi)||window.confirm(bh))}$("#file-upload-form-relapath").val(bi.files[0].relativePath||(bi.files[0].webkitRelativePath&&bi.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function U(be){for(var bd=0;bd<be.files.length;bd++){var bf;if(be.files[bd].relativePath&&be.files[bd].relativePath!=""){bf=be.files[bd].relativePath.split(/[\\\/]/)[0]+"/"}else{if(be.files[bd].webkitRelativePath&&be.files[bd].webkitRelativePath!=""){bf=be.files[bd].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(bf&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(bf)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(be.files[bd].name)+"']").length>0){return true}}}return false}function aB(){ao($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(bd){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(bd){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(bd){$("#fileList").addClass("draghover")}).on("dragleave",function(bd){$("#fileList").removeClass("draghover")}).on("drop",function(bd){$("#fileList").removeClass("hover")})}function K(bf,bd){var be;if(bd.setting){bf+='<div class="confirmdialogsetting"><input type="checkbox" name="'+bd.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";be=ae(bd.setting)}$("#confirmdialog").html(bf).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(bd.setting){z(bd.setting,be,be&&be!=="",1)}$("#confirmdialog").dialog("close");if(bd.cancel){bd.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(bd.confirm){bd.confirm()}}}],open:function(){if(bd.setting){$("input[name='"+bd.setting+"']",$(this)).click(function(bg){z(bd.setting,"no",!$(this).is(":checked"),1)}).prop("checked",ae(bd.setting)!="no")}},close:function(){if(bd.cancel){bd.cancel()}}}).show()}function ba(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function m(be){var bd=$("#fileList tr.selected:visible");if(bd.length==0){bd=$(be).closest("tr[data-file]")}if(bd.length==0){bd=$("#fileList tr:visible:focus")}return bd}function aE(bd){return $.map(m(bd),function(be,bf){return $(be).attr("data-file")})}function aX(be){E(be);var bd=$(this);if(bd.hasClass("disabled")){return}var bf=bd.closest("tr");if(bd.hasClass("rename")){aT(bf)}else{if(bd.hasClass("delete")){O(bf)}else{$("body").trigger("fileActionEvent",{obj:bd,event:be,file:bf.attr("data-file"),selected:[bf.data("file")],row:bf})}}}function g(){$("#fileactions").on("click dblclick",function(bd){E(bd);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aX).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",at).on("mouseleave.fileAction",l)}).on("beforeFileListChange replaceRow",l);h();$("body").on("settingchanged",h)}function h(bd,be){$("#fileactions").toggleClass("hidefileactions",ae("settings.show.fileactions")=="no").toggleClass("hidelabels",ae("settings.show.fileactionlabels")=="no").toggleClass("showalways",ae("settings.show.fileactionalways")=="no")}function at(be){var bd=$(this);if($("#fileactions",bd).length===0){$(".action.changeuri.filename",bd).after($("#fileactions"))}}function l(bd){$("#fileactions").appendTo($(".template"))}function aJ(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(bf,be){var bd=$(be);if(!bd.attr("href")){bd.data("fancybox-href",bd.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(bd){return(bd.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(bf,be){var bd=$(be);if(!bd.attr("href")){bd.data("fancybox-href",bd.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function ax(){var be=$("#fileListTable");var bd=$("#fileList");ad();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",V).off("dblclick.initFileList").on("dblclick.initFileList",function(bf){L($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:D,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:ba,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(bg){var bf=$(bg.currentTarget);return $(bg.currentTarget).clone().width(bf.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:M,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bi,bf){var bg=$(bf);$("<div/>").prependTo(bg).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(bg).html("&nbsp;").addClass("columnResizeHandle right");bg.data("origWidth",bg.width());var bj=ae(bg.prop("id")+".width");if(bj){bg.width(parseFloat(bj))}var bh=0;$(bf).on("click.initFileList",function(bl){var bk=$(this);bh++;if(bh==1){window.setTimeout(function(){if(bh==1){if(!bk.hasClass("sorter-false")){aH.call(bk,bl)}}else{var bm=bk.width()==bk.data("origWidth")?1:bk.data("origWidth");bk.width(bm);z(bk.prop("id")+".width",bm,bm!=bk.data("origWidth"),1)}bh=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(bf,bg){startPos=parseInt(bg.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(bf,bg){$(this).removeAttr("style");ae(column.attr("id")+".width",column.width(),1)},drag:function(bf,bg){if(handlePos=="right"){column.width(startWidth+bg.offset.left-startPos)}else{column.width(startWidth+startPos-bg.offset.left)}}});aj();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function aj(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var bd=window.getSelection();if(bd&&bd.removeAllRanges){bd.removeAllRanges()}}}}function M(be,bf){var bh=bf.draggable.prop("cellIndex");var bd=$(this).prop("cellIndex");if(bh+1==bd){return false}var bg=$("#fileListTable thead th");bg.eq(bh).detach().insertBefore(bg.eq(bd));$("#fileList tr").each(function(){var bi=$(this).children("td");bi.eq(bh).detach().insertBefore(bi.eq(bd))});y();return true}function w(bf,bd){var be=$("#fileListTable thead th[data-name='"+bf+"']:not(.sorter-false)");if(be.length==0){return}ae("order",bf+(bd==1?"_asc":"_desc"),1);j(be.prop("cellIndex"),bd);s(be.data("sorttype")||"string",be.data("sort"),bd,be.prop("cellIndex"),"data-file");$("body").trigger("settingchanged",{setting:"order",value:ae("order")})}function a0(){var bd=ae("order").split("_");if(!bd){return{name:"data-file",sortorder:1}}return{name:bd[0],sortorder:bd[1]&&bd[1]=="desc"?-1:1}}function ad(){if(lts=a0()){w(lts.name,lts.sortorder)}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aH)}function aH(){var bd=a0();w($(this).data("name"),bd.name==$(this).data("name")?-bd.sortorder:1)}function j(bd,be){var bf=$("#fileListTable");bf.data("tablesorter-lastclickedcolumn",bd);bf.data("tablesorter-sortorder",be);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(bd).addClass(be==1?"tablesorter-up":"tablesorter-down")}function s(bf,bh,be,bd,bg){$("#fileListTable tbody").MyFileTableSorter(bf,bh,be,bd,bg)}function O(bd){bd.fadeTo("slow",0.5);K($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(bd.attr("data-displayname")))),{confirm:function(){var be=bd.attr("data-file");H(bd);var bg=ar();var bf=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:be},function(bh){bg.remove();if(bh.error){aw()}P(bh)});I(bf)},cancel:function(){bd.fadeTo("fast",1)}})}function P(bd){if(bd.error){a5(bd.error)}if(bd.warn){aY(bd.warn)}if(bd.message){b(bd.message)}if(bd.quicknav){$("#quicknav").html(bd.quicknav).MyTooltip();$("#quicknav a").click(function(be){E(be);L($(this).attr("href"))})}}function u(bh,be,bd){var bg=ar();var bf=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:bd,file:be},function(bi){if(bi.message){var bj=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:bd,template:$("#fileList").attr("data-entrytemplate")},function(bk){try{var bl=$(bk);var bn=$("tr[data-file='"+bd+"']");if(bn.length>0){bn.remove()}$("#flt").trigger("replaceRow",{row:bh,newrow:bl});bh.replaceWith(bl);bh=bl;ax();bl.focus()}catch(bm){aw()}bg.remove()});I(bj)}else{bg.remove()}P(bi)});I(bf)}function aT(bf){var be=bf.closest("tr[data-file]").data("file");var bd=be.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:bf.find("td.filename"),defaultValue:bd,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(bh){var bg=bh.value.replace(/\//g,"");if(bg==bd){return}if(ae("settings.confirm.rename")!="no"){K($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(be)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(bg)),{confirm:function(){u(bf,be,bg)},setting:"settings.confirm.rename"})}else{u(bf,be,bg)}}})}function aP(bd,be){console.log("notify["+bd+"]: "+be);if(ae("settings.messages."+bd)=="no"){return}noty({text:be,type:bd,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:bd,msg:be})}function a5(bd){aP("error",bd)}function b(bd){aP("message",bd)}function aY(bd){aP("warning",bd)}function a9(be,bd){if(!be){return}be.toggleClass("selected",bd);be.find(".selectbutton").prop("checked",be.hasClass("selected"))}function T(bd){return bd.attr("data-file")!=".."&&!bd.hasClass("unselectable-yes")}function V(bf){var bj=$("#fileListTable");if(T($(this))){var bi=this.rowIndex;var bd=bi;if((bf.shiftKey||bf.metaKey||bf.altKey)&&bj.data("lastSelectedRowIndex")){bd=bj.data("lastSelectedRowIndex");if(bd<bi){var bh=bd;bd=bi;bi=bh}for(var be=bi+1;be<bd;be++){var bg=$("#fileList tr:visible").filter(function(){return this.rowIndex==be});if(bg.length===0){continue}a9(bg);bg=bg.next()}}a9($(this));bj.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function a8(){$(".dialog.action").click(aF)}function aF(be){E(be);if($(this).hasClass("disabled")){return}var bd=$(this);bd.addClass("disabled");var bf=$("#"+bd.attr("data-action"));if(bf.attr("title")){bf.data("title",bf.attr("title"))}bf.attr("title",bf.data("title"));bf.dialog({modal:true,width:"auto",open:function(){if(bf.data("initHandler")){bf.data("initHandler").init()}},close:function(){bd.removeClass("disabled")},dialogClass:bd.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function N(){bb();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",a3).on("fileListViewChanged",a3)}function bb(){aI($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function a3(){var be=aK();var bf=$("#fileListTable");var bd=bf.hasClass("iswriteable-no")?":not(.access-writeable)":"";bd+=bf.hasClass("isreadable-no")?":not(.access-readable)":"";bd+=bf.hasClass("unselectable-no")?":not(.access-selectable)":"";aI($(".access-writeable"),bf.hasClass("iswriteable-no"));aI($(".access-readable"),bf.hasClass("isreadable-no"));aI($(".access-selectable"),bf.hasClass("unselectable-yes"));aI($(".sel-none"+bd),be.sumselcounter!==0);aI($(".sel-one"+bd),be.sumselcounter!=1);aI($(".sel-multi"+bd),be.sumselcounter===0);aI($(".sel-noneorone"+bd),be.sumselcounter>1);aI($(".sel-none.sel-dir"+bd),be.fileselcounter!==0);aI($(".sel-one.sel-dir"+bd),be.fileselcounter>0||be.dirselcounter!=1);aI($(".sel-multi.sel-dir"+bd),be.fileselcounter>0||be.dirselcounter===0);aI($(".sel-noneorone.sel-dir"+bd),be.fileselcounter>0||be.dirselcounter>1);aI($(".sel-noneormulti.sel-dir"+bd),be.fileselcounter>0);aI($(".sel-none.sel-file"+bd),be.fileselcounter!==0);aI($(".sel-one.sel-file"+bd),be.dirselcounter>0||be.fileselcounter!=1);aI($(".sel-multi.sel-file"+bd),be.dirselcounter>0||be.fileselcounter===0);aI($(".sel-noneorone.sel-file"+bd),be.dirselcounter>0||be.fileselcounter>1);aI($(".sel-noneormulti.sel-file"+bd),be.dirselcounter>0)}function au(){$("#flt").on("fileListChanged",ai).on("fileListViewChanged",ai)}function F(bd){if(!bd){bd=$("#fileListTable")}if(bd&&bd.attr){bd.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aD(){var be=$("#fileListTable");F(be);var bd=aK();be.attr("data-dircounter",bd.dircounter);be.attr("data-filecounter",bd.filecounter);be.attr("data-foldersize",bd.foldersize);be.attr("data-sumcounter",bd.sumcounter);$("#flt").trigger("counterUpdated")}function aK(){var be=[];be.dircounter=$("#fileList tr.is-subdir-yes:visible").length;be.filecounter=$("#fileList tr.is-file:visible").length;be.sumcounter=be.dircounter+be.filecounter;be.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;be.fileselcounter=$("#fileList tr.selected.is-file:visible").length;be.sumselcounter=be.dirselcounter+be.fileselcounter;var bd=0;var bf=0;$("#fileList tr:visible").each(function(bh,bi){var bg=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){bf+=bg}bd+=bg});be.foldersize=bd;be.folderselsize=bf;return be}function ai(){var bf=$("#headerName");var bg=$("#fileListTable");var be=$("#headerSize");aD();if(bf.length>0&&!bf.attr("data-title")){bf.attr("data-title",bf.attr("title"))}if(be.length>0&&!be.attr("data-title")){be.attr("data-title",be.attr("title"))}if(bf.length>0){bf.attr("title",bf.attr("data-title").replace(/\$filecount/,bg.attr("data-filecounter")).replace(/\$dircount/,bg.attr("data-dircounter")).replace(/\$sum/,parseInt(bg.attr("data-dircounter"))+parseInt(bg.attr("data-filecounter"))))}var bd=parseInt(bg.attr("data-foldersize"));if(be.length>0){be.attr("title",be.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(bd)))}}function a4(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var bd=history.location||document.location;aw(bd.pathname)})}function L(be,bd){try{if(!bd){if(window.history.pushState){window.history.pushState({path:be},"",be);aw(be)}else{aw(be)}return}}catch(bf){console.log(bf)}if(!bd){ar()}window.location.href=be}function aw(bd,bf){if(!bd){bd=$("#fileList").attr("data-uri")}if(!bd){bd=window.location.href}if(!bf){bf={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var be=$.now();$("#flt").data("timestamp",be);$.get(bd,bf,function(bg){if($("#flt").data("timestamp")!=be){return}$("#flt").trigger("beforeFileListChange").show().html(bg.content).attr("data-uri",bd);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+bd.replace(/\/[^\/]+\/\.\.$/,"/"));ax();P(bg)})}function H(bd){$("#flt").trigger("beforeFileListChange");bd.remove();$("#flt").trigger("fileListChanged")}function B(bf,bd,bg,be){var bi=ar();var bh=$.post(bg,{srcuri:bd,action:bf,files:be.join("@/@")},function(bj){if(bj.message&&bf=="cut"){H($("#fileList tr[data-file='"+be.join("'],#fileList tr[data-file='")+"']"))}bi.remove();if(bj.error){aw()}P(bj)});I(bh)}function D(bg,bi){var bd=bi.draggable.closest("tr");var bj=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var be=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(bj==$.MyStringHelper.concatUri(be,encodeURIComponent($.MyStringHelper.stripSlash(bd.attr("data-file"))))+"/"){return}var bh=bg.shiftKey||bg.altKey||bg.ctrlKey||bg.metaKey?"copy":"cut";var bf=bd.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bm,bl){return $(bm).attr("data-file")}):new Array(bd.attr("data-file"));if(ae("settings.confirm.dnd")!="no"){var bk=$("#paste"+bh+"confirm").html();bk=bk.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bf.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(be))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bj))).replace(/\\n/g,"<br/>");K(bk,{confirm:function(){B(bh,be,bj,bf)},setting:"settings.confirm.dnd"})}else{B(bh,be,bj,bf)}}function ar(){return $("<div></div>").prependTo("body").addClass("overlay")}function an(bg,bh,bf){for(var be in bh){var bd=bh[be];if(typeof bd==="object"){an(bg,bd,be)}else{if(bf){bg.append($("<input/>").prop("name",bf).prop("value",bd).prop("type","hidden"))}else{bg.append($("<input/>").prop("name",be).prop("value",bd).prop("type","hidden"))}}}return bg}function a1(be){var bd=$("<form/>").appendTo("body");bd.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");an(bd,be);bd.submit();bd.remove()}function ab(bf){var be=$(this);var bd=m(this);bd.fadeTo("slow",0.5);K(bd.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(bd.first().attr("data-file")))),{confirm:function(){var bh=ar();if(bd.length===0){bd=be.closest("tr")}var bg=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(bd,function(bi,bj){return $(bi).attr("data-file")})},function(bi){bh.remove();H(bd);ak();if(bi.error){aw()}P(bi)});I(bg)},cancel:function(){bd.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ak(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function aa(bf,bd,bg,be){var bi=ar();var bh=$.post(bg,{action:bf,files:be,srcuri:bd},function(bj){if(ae("clpaction")=="cut"){ap("clpfiles","clpaction","clpuri")}bi.remove();aw();P(bj)});I(bh)}function G(bd){E(bd);var bk=$(this);if(bk.hasClass("disabled")){return}if(bk.hasClass("delete")){ab.call(this,bd)}else{if(bk.hasClass("rename")){aT(bk.closest("tr"))}else{if(bk.hasClass("cut")||bk.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var bg=$.map(m(bk),function(bn,bm){return $(bn).attr("data-file")});ae("clpfiles",bg.join("@/@"));ae("clpaction",bk.hasClass("cut")?"cut":"copy");ae("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(bk.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}S();ak()}else{if(bk.hasClass("paste")){var be=ae("clpfiles");var bh=ae("clpaction");var bj=ae("clpuri");var bi=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(ae("settings.confirm.paste")!="no"){var bf=$("#paste"+bh+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(bj)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(bi)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(be.split("@/@").join(", ")));K(bf,{confirm:function(){aa(bh,bj,bi,be)},setting:"settings.confirm.paste"})}else{aa(bh,bj,bi,be)}}else{if(bk.attr("href")!==undefined&&bk.attr("href")!="#"){window.location.href=bk.attr("href")}else{if(bk.attr("data-href")!==undefined&&bk.attr("data-href")!="#"){window.location.href=bk.attr("data-href")}else{var bl=bk.closest("tr");$("body").trigger("fileActionEvent",{obj:bk,event:bd,file:bl.attr("data-file"),row:bl,selected:aE(this)})}}}}}}}function ae(bf,bg,bd){var be=new Date();be.setTime(be.getTime()+315360000000);if(bg){return Cookies.set(bf,bg,{path:$("#flt").attr("data-baseuri"),secure:true,expires:bd?be:undefined})}return Cookies.get(bf)}function ap(){for(var bd=0;bd<arguments.length;bd++){Cookies.remove(arguments[bd],{path:$("#flt").attr("data-baseuri"),secure:true})}}function z(bf,bg,bd,be){if(bd){ae(bf,bg,be)}else{ap(bf)}}function ah(){S();$("#flt").on("fileListChanged",S)}function S(){var bh=ae("clpaction");var bd=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var bf=ae("clpuri");var bg=ae("clpfiles");var be=(!bg||bg===""||bf==bd||$("#fileListTable").hasClass("iswriteable-no"));aI($(".action.paste"),be);if(bf==bd&&bh=="cut"){$.each(bg.split("@/@"),function(bi,bj){$("[data-file='"+bj+"']").addClass("cutted").fadeTo("fast",0.5)})}}function R(){$("#nav .action").click(G).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function r(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(G).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var bd={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(be){$("#flt").disableSelection();if(be){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(bd,{changeEvent:function(bf){var be=$(this);$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:bf.value},function(bg){if(!bg.error&&bg.message){al(bf.value)}P(bg)})}}));$(".action.create-file").MyInplaceEditor($.extend(bd,{changeEvent:function(bf){var be=$(this);$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:bf.value},function(bg){if(!bg.error&&bg.message){al(bf.value)}P(bg)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(bd,{changeEvent:function(be){var bf=m(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:be.value,file:bf.attr("data-file")},function(bg){if(!bg.error&&bg.message){al(be.value)}P(bg)})}}))}function E(bd){if(bd.preventDefault){bd.preventDefault()}else{bd.returnValue=false}if(bd.stopPropagation){bd.stopPropagation()}}function ay(bd){E(bd);if(bd.stopImmediatePropagation){bd.stopImmediatePropagation()}}function f(){$(".action.viewfilter").click(function(bf){E(bf);if($(this).hasClass("disabled")){return}var bd=$(this);$(".action.viewfilter").addClass("disabled");var bg=$("#fileList").attr("data-uri");var be=bd.attr("data-template");$.get(bg,{ajax:"getViewFilterDialog",template:be},function(bh){var bi=$(bh);$("input[name='filter.size.val']",bi).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bi).button().click(function(bk){E(bk);z("filter.name",$("select[name='filter.name.op'] option:selected",bi).val()+" "+$("input[name='filter.name.val']",bi).val(),$("input[name='filter.name.val']",bi).val()!=="");z("filter.size",$("select[name='filter.size.op'] option:selected",bi).val()+$("input[name='filter.size.val']",bi).val()+$("select[name='filter.size.unit'] option:selected",bi).val(),$("input[name='filter.size.val']",bi).val()!=="");if($("input[name='filter.types']:checked",bi).length>0){var bj="";$("input[name='filter.types']:checked",bi).each(function(bl,bm){bj+=$(bm).val()});ae("filter.types",bj)}else{ap("filter.types")}bi.dialog("close");aw()});$(".filter-reset",bi).button().click(function(bj){E(bj);ap("filter.name","filter.size","filter.types");bi.dialog("close");aw()});bi.submit(function(){return false});bi.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:bd.attr("title")||bd.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bi.remove()}}).show()})})}function I(bg,bf,be){$("#abortdialog").remove();var bd=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",bd).button().click(function(bh){if(bg.readyState!=4){bg.abort()}bd.hide().remove();if(be){be.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(bg.readyState>2){return}bd.appendTo($("body")).show();var bh=window.setInterval(function(){if(bg.readyState==4){bd.hide().remove();window.clearInterval(bh)}},200);$("body").data("abortdialoginterval",bh)},bf||2500));return bd}function aV(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function p(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var bf="";var bd=$("*[accesskey]").get().sort(function(bh,bg){var bi=$(bh).attr("accesskey");var bj=$(bg).attr("accesskey");return bi<bj?-1:bi>bj?1:0});var be=[];$.each(bd,function(bh,bg){var bi=$(bg);var bj=bi.attr("accesskey");if(!be[bj]){bf+='<li tabindex="0" role="definition">'+bj+": "+(bi.attr("aria-label")||bi.attr("title")||bi.attr("data-tooltip")||bi.html())+"</li>";be[bj]=true}else{console.log("found accesskey "+bj+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+bf+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function a2(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function y(){ae("visibletablecolumns",$("#fileListTable th[data-name]:visible").map(function(){return $(this).data("name")}).get().join(","),1);$("body").trigger("settingchanged",{setting:"visibletablecolumns",value:ae("visibletablecolumns")})}function aU(bf,be){var bd=$("#fileListTable th[data-name="+bf+"]").toggleClass("hidden",!be).toggle(be).prop("cellIndex");$("#fileListTable td:nth-child("+(bd+1)+")").toggleClass("hidden",!be).toggle(be);y()}function a(bf){E(bf);var bd=$(this);if(bd.hasClass("disabled")){return}if(bd.hasClass("table-sort")){var be=a0();w(bd.data("name"),be.name==bd.data("name")?-be.sortorder:1)}else{if(bd.hasClass("table-sort-this-asc")){w(bd.closest("th").data("name"),1)}else{if(bd.hasClass("table-sort-this-desc")){w(bd.closest("th").data("name"),-1)}else{if(bd.hasClass("table-column-hide-this")){aU(bd.closest("th:not(.table-column-not-hide)").data("name"),false)}else{if(bd.hasClass("table-column")){aU(bd.data("name"))}}}}}}function aQ(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",E).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable th[data-name].sorter-false").each(function(bf,be){$(".action.table-sort."+$(be).data("name")).addClass("hidden").hide()});$(".action.table-sort.fileactions").hide()});bd();function bd(){var be=a0();$(".action.table-sort .symbol").removeClass("descending ascending");$(".action.table-sort."+be.name+" .symbol").addClass(be.sortorder==1?"descending":"ascending");$(".action.table-column .symbol").removeClass("column-hidden");$(".action.table-column").addClass("hidden disabled");$("#fileListTable th[data-name]").each(function(bg,bf){$(".action.table-column."+$(bf).data("name")).removeClass("hidden").toggleClass("disabled",$(bf).hasClass("table-column-not-hide")).find(".symbol").toggleClass("column-hidden",$(bf).is(":not(:visible)"))})}$("body").on("settingchanged",function(be,bf){if(bf.setting=="order"||bf.setting=="visibletablecolumns"){bd()}})}function W(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",G).on("dblclick.popupmenu",E).MyKeyboardEventHandler();aQ();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){a2()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content",contextmenuAnchorElement:true})});$("body").off(".popupmenu").on("click.popupmenu",function(){a2()}).on("keydown.popupmenu",function(bd){if(bd.which==27){a2()}});$("#filler").on("contextmenu",function(bd){if(bd.which==3){if(bd.originalEvent.detail===1){E(bd)}a2()}})}function al(bd){var be=$("#fileList");return $.get($.MyStringHelper.addMissingSlash(be.data("uri")),{ajax:"getFileListEntry",template:be.data("entrytemplate"),file:bd},function(bf){try{var bg=$(bf);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(bd)+"']",be);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:bg});row.replaceWith(bg)}else{bg.appendTo(be)}ax();bg.focus()}catch(bh){aw()}})}function aZ(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(be,bd){if(bd.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!bd.value);$("#flt").trigger("fileListViewChanged")}else{if(bd.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!bd.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",ae("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",ae("settings.show.dotfolders")=="no")}function aO(){var bd=ae("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bh,bg){var bf=$(this);if(bf.data("thumb")!=bf.data("icon")){var be=bf.data("thumb");var bi=bf.data("icon");var bj=$("#emptyimage").attr("src");bf.attr("src",bd?(be===""?bj:be):(bi===""?bj:bi));bf.toggleClass("thumbnail",bd)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(be,bd){if(bd.setting=="settings.enable.thumbnails"){aO()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var bd=$(this);var be=bd.data("icon");bd.removeClass("thumbnail").attr("src",be!==""?be:$("#emptyimage").attr("src"))})})}function n(be,bd){var bg=ar();var bf=$.get(window.location.pathname,be,function(bh){bg.remove();P(bh);bd(bh)});I(bf)}function aA(be,bd){var bg=ar();var bf=$.post(window.location.pathname,be,function(bh){bg.remove();P(bh);bd(bh)});I(bf)}function ac(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:ar,changeUri:L,concatUri:$.MyStringHelper.concatUri,confirmDialog:K,cookie:ae,fixElementPosition:Z,getDialog:n,getDialogByPost:aA,getSelectedFiles:aE,getSelectedRows:m,handleJSONResponse:P,handleWindowResize:t,hidePopupMenu:a2,initFileList:ax,initPopupMenu:W,initTabs:ag,initUpload:ao,notify:aP,notifyError:a5,notifyInfo:b,notifyWarn:aY,preventDefault:E,preventDefaultImmediatly:ay,postAction:a1,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:al,removeAbortDialog:aV,renderAbortDialog:I,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:ap,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:z,toggleRowSelection:a9,uncheckSelectedRows:ak,updateFileList:aw}}function am(){$.fn.MyTooltip.defaults.helphandler=aG;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){aG.call(this,$(this).data("help"))})}function aG(be){var bd=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:be,width:"99%",height:"99%"}).text(be)).dialog({width:bd.width()/2,height:bd.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
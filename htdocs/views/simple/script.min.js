var ToolBox={};$(function(){a7();W();aA();N();g();ah();av();r();R();aO();X();aC();aD();a9();f();e();C();J();aK();o();Q();af();aw();d();aT();a0();c();aN();a5();a8();ag();ac();am();$.ajaxSetup({traditional:true});$(document).ajaxError(function(bg,bh,bf,be){console.log(bg);console.log(bh);console.log(bf);console.log(be);if(bh&&bh.statusText&&bh.statusText!="abort"){a6(bh.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(be,bg,bf){be.cache=true});ax($("#flt").attr("data-uri"));function ag(be){if(!be){be=$(document)}$(".tabsel",be).on("click keyup",function(bh){if(bh.type=="keyup"&&bh.keyCode!=32&&bh.keyCode!=13){return}E(bh);var bf=$(this);$(".tabsel.activetabsel",be).removeClass("activetabsel");bf.addClass("activetabsel");$(".tab.showtab",be).removeClass("showtab");var bg=$(".tab."+bf.data("group"),be).addClass("showtab");$(":focusable:visible:first",bg).focus()})}function a8(){if(!ae("settings.show.statusbar")){ae("settings.show.statusbar","no");ae("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",ae("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(bf){$(this).prop("checked",true);E(bf)});function be(){var bg=$("#fileListTable");var bf=$("#statusbar");$(".filecount",bf).html(bg.attr("data-filecounter"));$(".dircount",bf).html(bg.attr("data-dircounter"));$(".sum",bf).html(bg.attr("data-sumcounter"));$(".foldersize",bf).attr("title",$.MyStringHelper.renderByteSizes(bg.data("foldersize"))).html($.MyStringHelper.renderByteSize(bg.data("foldersize")));$(".selfilecount",bf).html(bg.attr("data-fileselcounter"));$(".seldircount",bf).html(bg.attr("data-dirselcounter"));$(".selsum",bf).html(bg.attr("data-sumselcounter"));$(".selfoldersize",bf).attr("title",$.MyStringHelper.renderByteSizes(bg.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(bg.attr("data-folderselsize")));$(".selected-files-stats",bf).toggle(bg.attr("data-fileselcounter")!==0||bg.attr("data-dirselcounter")!==0)}be();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",be);$("body").on("notify",function(bf,bg){$("#statusbar .notify").attr("title",bg.msg).removeClass("error message warning").addClass(bg.type).html(bg.msg).MyTooltip()});$("body").on("settingchanged",function(bf,bg){if(bg.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",bg.value)}});$("#statusbar").MyTooltip()}function aN(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aT(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(bg){var bf=this.tabIndex||1;var be=$(this);if(be.is(":focus")){if(bg.keyCode==32){V.call(this,bg)}else{if(bg.keyCode==13){L($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(be.attr("data-file")))),be.attr("data-type")=="file")}else{if(bg.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(T(be)){O(be)}}else{ab()}}else{if(bg.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(bg.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(bg.keyCode==45){$(".paste").trigger("click")}}}}}}}if(bg.keyCode==38&&bf>-1){E(bg);if(T(be)&&(bg.shiftKey||bg.altKey||bg.ctrlKey||bg.metaKey)){ba(be,true);$("#flt").trigger("fileListSelChanged")}be.prevAll(":focusable:first").focus();aj()}else{if(bg.keyCode==40){E(bg);if(T(be)&&(bg.shiftKey||bg.altKey||bg.ctrlKey||bg.metaKey)){ba(be,true);$("#flt").trigger("fileListSelChanged")}be.nextAll(":focusable:first").focus();aj()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",p);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(bg){E(bg);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var bf=$("#flt").data("TableConfigDialog");if(bf){i($(bf))}else{if($("#tableconfigdialogtemplate").length>0){var be=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",be);i($(be))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(bh){if(bh.error){P(bh)}$("#flt").data("TableConfigDialog",bh);i($(bh))})}}}).MyKeyboardEventHandler()})}function i(bf){var bh=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(bk,bj){return $(bk).attr("data-name")});$.each(bh,function(bj,bk){bf.find("input[name='visiblecolumn'][value='"+bk+"']").prop("checked",true)});bf.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bj){E(bj)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bj,bk){bf.find("input[name='sortingcolumn'][value='"+$(bk).attr("data-name")+"']").prop("disabled",true).click(function(bl){E(bl)}).closest("li").addClass("disabled")});var bi=ae("order")?ae("order").split("_"):"name_asc".split("_");var bg=bi[0];var be=bi[1]||"asc";bf.find("input[name='sortingcolumn'][value='"+bg+"']").prop("checked",true);bf.find("input[name='sortingorder'][value='"+be+"']").prop("checked",true);bf.find("input[value='fileactions']").closest("li").hide();bf.find("input[name='save']").button().click(function(bo){var bn=bh.slice(0);var bj=$.map($("input[name='visiblecolumn']:checked"),function(bs,br){return $(bs).attr("value")});var bl=[];for(var bm=bn.length-1;bm>=0;bm--){if($.inArray(bn[bm],bj)==-1){bl.push(bn[bm]);bn.splice(bm,1)}}var bk=[];$.each(bj,function(br,bs){if($.inArray(bs,bn)==-1){bk.push(bs);bn.push(bs)}});var bq=bf.find("input[name='sortingcolumn']:checked").attr("value");var bp=bf.find("input[name='sortingorder']:checked").attr("value");if(bj.sort().join(",")!=bh.sort().join(",")){$.each(bk,function(br,bs){aV(bs,true)});$.each(bl,function(br,bs){aV(bs,false)})}w(bq,bp=="desc"?-1:1);bf.dialog("close")});bf.find("input[name='cancel']").button().click(function(bj){E(bj);bf.dialog("close");return false});bf.find("#tableconfigform").submit(function(bj){return false});bf.dialog({modal:true,width:"auto",title:bf.attr("data-title")||bf.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");bf.dialog("destroy")}})}function aS(be){if(be){E(be)}var bg=$(this).hasClass("collapsed");var bf=$(this).hasClass("iconsonly");if(!bg&&!bf){bf=true}else{if(bf){bf=false;bg=true}else{bg=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",bg).toggleClass("sidebar-iconsonly",bf);$(".action.collapse-sidebar").toggleClass("collapsed",bg).toggleClass("iconsonly",bf);if(!bf&&!bg){ap("sidebar")}else{ae("sidebar",bf?"iconsonly":bg?"false":"true")}t()}function aw(){$(".action.collapse-sidebar").click(aS).MyKeyboardEventHandler().MyTooltip();if(ae("sidebar")&&ae("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ae("sidebar")=="false").toggleClass("sidebar-iconsonly",ae("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",ae("sidebar")=="false").toggleClass("iconsonly",ae("sidebar")=="iconsonly");t()}$(".action.collapse-head").click(function(be){E(be);$(".action.collapse-head").toggleClass("collapsed");var bf=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!bf);$(".collapse-head-listener").toggleClass("head-collapsed",bf);z("head","false",bf,1);t()}).MyTooltip().MyKeyboardEventHandler();if(ae("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function af(){$(".action.autorefreshmenu").dblclick(function(be){E(be);ax()});aJ($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aJ($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aJ($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(ae("autorefresh")!==""&&parseInt(ae("autorefresh"))>0){aX(parseInt(ae("autorefresh")))}});$(".action.setautorefresh").click(function(be){E(be);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){ax();return}ae("autorefresh",$(this).attr("data-value"));aX(parseInt($(this).attr("data-value")))}).on("keyup",function(be){if(be.keyCode==32||be.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(be){E(be);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ap("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(be){if(be.keyCode==32||be.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(bf){E(bf);if($(this).hasClass("disabled")){return}var be=$("#autorefresh");if(be.data("timer")!=null){window.clearInterval(be.data("timer"));be.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{aX(be.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(be){if(be.keyCode==32||be.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(bf,be){ae("autorefreshtimerpos",JSON.stringify(Z("#autorefreshtimer",be.offset)))}});if(ae("autorefreshtimerpos")){Z("#autorefreshtimer",JSON.parse(ae("autorefreshtimerpos")))}}function Z(bi,be){var bh=$(bi);var bf=$(window);var bg={left:Math.min(Math.max(be.left,0),bf.width()-bh.outerWidth()+bf.scrollLeft()),top:Math.min(Math.max(be.top,0),bf.height()-bh.outerHeight()+bf.scrollTop())};bh.offset(bg);return bg}function Y(be){var bg=$(".autorefreshtimer");var bh=bg.attr("data-template")||"%sm %ss";var bf=Math.floor(be/60);var bi=be%60;if(bi<10){bi="0"+bi}bg.html(bh.replace("%s",bf).replace("%s",bi))}function aX(bf){var be=$("#autorefresh");if(be.data("timer")!=null){window.clearInterval(be.data("timer"))}be.data("timeout",bf);Y(bf);be.data("timer",window.setInterval(function(){var bg=be.data("timeout")-1;Y(bg);be.data("timeout",bg);if(bg<0){window.clearInterval(be.data("timer"));be.data("timer",null);Y(0);be.trigger("stopped");ax()}},1000));be.trigger("started")}function Q(){var be=$("#settings");be.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",be).each(function(bg,bf){$(bf).prop("checked",ae($(bf).prop("name"))!="no").click(function(bh){if(ae($(this).prop("name")+".keep")){ae($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{z($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",be).change(function(){if($(this).prop("name")=="settings.lang"){ae($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{ae($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(bh,bf){var bi=$(bf);var bg=bi.prop("name");if(bg=="settings.lang"){bg=bg.replace(/^settings\./,"")}$("option[value='"+ae(bg)+"']",bi).prop("selected",true)})}})}function a7(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(be){if(be.keyCode==13||be.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(be){E(be);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function o(){$("#flt").on("fileListChanged",t).on("fileListViewChanged",t);$(window).resize(t);t()}function t(){var be=$(window).width()-$("#nav").width();$("#content").width(be);$("#controls").width(be);$("body").trigger("windowResized")}function J(){$(".action.changeuri").off(".changeuri").on("click.changeuri",bd);$(".action.refresh").off(".refresh").on("click.refresh",function(be){E(be);ax();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",bd);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var be=$(this);if(!be.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=be.data("href")?be.data("href"):be.attr("href")}})})}function bd(be){E(be);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){L($(this).data("href")||$(this).attr("href"))}return false}function C(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(be){$("#fileList tr:not(:hidden).unselectable-no").each(function(bf,bg){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(be){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(be){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function aA(){$("#flt").on("bookmarksChanged",q).on("bookmarksChanged",x).on("fileListChanged",function(){q();x()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aM)}function aJ(be,bf){$.each(be,function(bi,bh){var bg=$(bh);if(bg.hasClass("hideit")){bg.toggle(!bf)}if(bg.hasClass("button")){bg.button("option","disabled",bf)}if(!bg.hasClass("notab")){bg.attr("tabindex",bf?-1:0)}bg.toggleClass("disabled",bf)})}function x(){var bi=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var be=false;var bh=0;var bg=0;while(ae("bookmark"+bg)!=null){if(ae("bookmark"+bg)==bi){be=true}if(ae("bookmark"+bg)!="-"){bh++}bg++}$(".action.addbookmark").button("option","disabled",be);aJ($(".action.rmbookmark"),!be);aJ($(".action.bookmarksortpath"),bh<2);aJ($(".action.bookmarksorttime"),bh<2);aJ($(".action.rmallbookmarks"),bh===0);var bf=ae("bookmarksort")==null?"time-desc":ae("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(bf=="path"||bf=="path-desc"||bf=="time"||bf=="time-desc"){$("#bookmarks .action.bookmarksort"+bf.replace(/-desc/,"")+" ."+bf).show()}}function q(){var bj=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(bk,bl){$(bl).remove()});var bi=[];var bg=0;while(ae("bookmark"+bg)!=null){if(ae("bookmark"+bg)!="-"){bi.push({path:ae("bookmark"+bg),time:parseInt(ae("bookmark"+bg+"time"))})}bg++}var bh=ae("bookmarksort")?ae("bookmarksort"):"time-desc";var be=1;if(bh.indexOf("-desc")>0){be=-1;bh=bh.replace(/-desc/,"")}bi.sort(function(bl,bk){if(bh=="path"){return be*bl[bh].localeCompare(bk[bh])}else{return be*(bk[bh]-bl[bh])}});var bf=$("#bookmarktemplate").html();$.each(bi,function(bk,bm){var bl=unescape(bm.path);$("<li>"+bf.replace(/\$bookmarkpath/g,bm.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(bl,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aM).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",bm.path).attr("data-htmltooltip",$.MyStringHelper.simpleEscape(bl)+"%0D"+(new Date(parseInt(bm.time)))).attr("tabindex",bm.path==bj?-1:0).toggleClass("disabled",bm.path==bj).find(".action.rmsinglebookmark").click(aM).MyKeyboardEventHandler()})}function k(bf){var be=0;while(ae("bookmark"+be)!=null&&ae("bookmark"+be)!=bf){be++}if(ae("bookmark"+be)==bf){ae("bookmark"+be,"-",1)}$("#flt").trigger("bookmarksChanged")}function aM(bh){E(bh);if($(this).hasClass("disabled")){return}var be=$(this);var bg=$("#fileList").attr("data-uri");if(be.hasClass("addbookmark")){var bf=0;while(ae("bookmark"+bf)!=null&&ae("bookmark"+bf)!="-"&&ae("bookmark"+bf)!=""&&ae("bookmark"+bf)!=bg){bf++}ae("bookmark"+bf,bg,1);ae("bookmark"+bf+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(be.hasClass("dyn-bookmark")){L(be.attr("data-bookmark"));be.closest("ul").hide()}else{if(be.hasClass("rmbookmark")){k(bg)}else{if(be.hasClass("rmallbookmarks")){var bf=0;while(ae("bookmark"+bf)!=null){ap("bookmark"+bf,"bookmark"+bf+"time");bf++}$("#flt").trigger("bookmarksChanged")}else{if(be.hasClass("rmsinglebookmark")){k($(this).attr("data-bookmark"))}else{if(be.hasClass("bookmarksortpath")){ae("bookmarksort",ae("bookmarksort")=="path"||ae("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(be.hasClass("bookmarksorttime")){ae("bookmarksort",ae("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aD(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",aq).on("fileListViewChanged",aq)}function aq(){var bg=$("#selstats");var be=bg.data("selstats");var bf=aL();$("#fileListTable").attr("data-fileselcounter",bf.fileselcounter).attr("data-dirselcounter",bf.dirselcounter).attr("data-folderselsize",bf.folderselsize).attr("data-sumselcounter",bf.sumselcounter);$("#flt").trigger("selectionCounterUpdated");bg.html(be.replace(/\$filecount/g,bf.fileselcounter).replace(/\$dircount/g,bf.dirselcounter).replace(/\$sum/g,bf.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(bf.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(bf.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(bf.folderselsize)).MyTooltip()}function aO(){$("#pathinputform").submit(function(be){return false});$("#pathinputform input[name='uri']").keydown(function(be){if(be.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(be.keyCode==13){E(be);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();L($(this).val())}}});$(".action.changedir").button().click(function(be){E(be);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(be){E(be);$("#pathinput").hide();$("#quicknav").show();L($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function X(){$("form#filterbox").submit(function(be){return false});$("form#filterbox input").keyup(A).change(A).autocomplete({minLength:1,select:A,close:A});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(be){E(be);$("form#filterbox input").val("");A();$(this).addClass("invisible")});$("#flt").on("fileListChanged",A).on("fileListChanged",function(){var be=$.map($("#fileList tr"),function(bg,bf){return $(bg).attr("data-file")});$("form#filterbox input").autocomplete({source:function(bg,bf){try{var bi=new RegExp(bg.term);bf($.grep(be,function(bj){return bi.test(bj)}))}catch(bh){bf($.grep(be,function(bj){return bj.indexOf(bg.term)>-1}))}}})})}function A(){var be=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var bg=new RegExp(be,"i");if(be===""||$(this).attr("data-file").match(bg)){$(this).show()}else{$(this).hide()}}catch(bf){if(be===""||$(this).attr("data-file").toLowerCase().indexOf(be.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function v(bf,bg){if(!bg){bg=bf}var be=bg.loaded/bg.total*100;$("#progress .bar").css("width",be.toFixed(2)+"%").html(parseInt(be)+"% ("+$.MyStringHelper.renderByteSize(bg.loaded)+"/"+$.MyStringHelper.renderByteSize(bg.total)+"); "+bf.done+"/"+bf.uploads)}function ao(bg,bi,bf,bh){$("#flt").on("fileListChanged",function(){bg.fileupload("option","url",$("#fileList").attr("data-uri"))});var be={aborted:false,transports:[],done:0,failed:0,uploads:0};bg.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:bh,singleFileUploads:true,autoUpload:false,add:function(bm,bl){if(!be.aborted){var bn=bl.submit();var bk=bl.files[0].name;be.transports.push(bn);var bj=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+bk).addClass("fileprogress");$("<div></div>").click(function(bo){E(bo);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bj).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:bk,transport:bn});$("<div></div>").appendTo(bj).addClass("fileprogressbar running").html(bl.files[0].name+" ("+$.MyStringHelper.renderByteSize(bl.files[0].size)+"): 0%");be.uploads++;return true}return false},done:function(bk,bj){$("#progress [id='fpb"+bj.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bj.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bj.result.message?"done":"failed").css("width","100%").html(bj.result&&bj.result.error?bj.result.error:bj.result.message?bj.result.message:bj.files[0].name);if(bj.result.message){be.done++}else{be.failed++}v(be)},fail:function(bk,bj){$("#progress [id='fpb"+bj.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bj.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bj.textStatus+": "+$.map(bj.files,function(bl,bm){return bl.name}).join(", "));be.failed++;v(be);console.log(bj)},stop:function(bk,bj){v(be);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){ax()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(bk,bj){be.transports=[];be.aborted=false;be.files=[];be.uploads=0;be.failed=0;be.done=0;return true},start:function(bl,bk){var bj=[];bj.push({text:$("#close").html(),disabled:true});bj.push({text:$("#cancel").html(),click:function(){if(be.aborted){return}be.aborted=true;$.each(be.transports,function(bm,bn){if(bn&&bn.abort){bn.abort($("#uploadaborted").html())}});be.transports=[]}});$("#progress").dialog({modal:true,title:bf,height:370,width:500,buttons:bj,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(bl,bk){var bj=parseInt(bk.loaded/bk.total*100)+"%";$("div[id='fpb"+bk.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bj).html(bk.files[0].name+" ("+$.MyStringHelper.renderByteSize(bk.files[0].size)+"): "+bj)},progressall:function(bk,bj){be.total=bj.total;be.loaded=bj.loaded;v(be,bj)},submit:function(bk,bj){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",ae("settings.confirm.upload")=="no"||!U(bj)||window.confirm(bi))}$("#file-upload-form-relapath").val(bj.files[0].relativePath||(bj.files[0].webkitRelativePath&&bj.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function U(bf){for(var be=0;be<bf.files.length;be++){var bg;if(bf.files[be].relativePath&&bf.files[be].relativePath!=""){bg=bf.files[be].relativePath.split(/[\\\/]/)[0]+"/"}else{if(bf.files[be].webkitRelativePath&&bf.files[be].webkitRelativePath!=""){bg=bf.files[be].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(bg&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(bg)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(bf.files[be].name)+"']").length>0){return true}}}return false}function aC(){ao($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(be){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(be){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(be){$("#fileList").addClass("draghover")}).on("dragleave",function(be){$("#fileList").removeClass("draghover")}).on("drop",function(be){$("#fileList").removeClass("hover")})}function K(bg,be){var bf;if(be.setting){bg+='<div class="confirmdialogsetting"><input type="checkbox" name="'+be.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";bf=ae(be.setting)}$("#confirmdialog").html(bg).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(be.setting){z(be.setting,bf,bf&&bf!=="",1)}$("#confirmdialog").dialog("close");if(be.cancel){be.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(be.confirm){be.confirm()}}}],open:function(){if(be.setting){$("input[name='"+be.setting+"']",$(this)).click(function(bh){z(be.setting,"no",!$(this).is(":checked"),1)}).prop("checked",ae(be.setting)!="no")}},close:function(){if(be.cancel){be.cancel()}}}).show()}function bb(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function m(bf){var be=$("#fileList tr.selected:visible");if(be.length==0){be=$(bf).closest("tr[data-file]")}if(be.length==0){be=$("#fileList tr:visible:focus")}return be}function aF(be){return $.map(m(be),function(bf,bg){return $(bf).attr("data-file")})}function aY(bf){E(bf);var be=$(this);if(be.hasClass("disabled")){return}var bg=be.closest("tr");if(be.hasClass("rename")){aU(bg)}else{if(be.hasClass("delete")){O(bg)}else{$("body").trigger("fileActionEvent",{obj:be,event:bf,file:bg.attr("data-file"),selected:[bg.data("file")],row:bg})}}}function g(){$("#fileactions").on("click dblclick",function(be){E(be);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aY).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",au).on("mouseleave.fileAction",l)}).on("beforeFileListChange replaceRow",l);h();$("body").on("settingchanged",h)}function h(be,bf){$("#fileactions").toggleClass("hidefileactions",ae("settings.show.fileactions")=="no").toggleClass("hidelabels",ae("settings.show.fileactionlabels")=="no").toggleClass("showalways",ae("settings.show.fileactionalways")=="no")}function au(bf){var be=$(this);if($("#fileactions",be).length===0){$(".action.changeuri.filename",be).after($("#fileactions"))}}function l(be){$("#fileactions").appendTo($(".template"))}function aK(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(bg,bf){var be=$(bf);if(!be.attr("href")){be.data("fancybox-href",be.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(be){return(be.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(bg,bf){var be=$(bf);if(!be.attr("href")){be.data("fancybox-href",be.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function ay(){var bf=$("#fileListTable");var be=$("#fileList");ad();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",V).off("dblclick.initFileList").on("dblclick.initFileList",function(bg){L($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:D,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:bb,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(bh){var bg=$(bh.currentTarget);return $(bh.currentTarget).clone().width(bg.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:M,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bj,bg){var bh=$(bg);$("<div/>").prependTo(bh).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(bh).html("&nbsp;").addClass("columnResizeHandle right");at(bh,ae(bh.prop("id")+".width"));var bi=0;$(bg).on("click.initFileList",function(bl){var bk=$(this);bi++;if(bi==1){window.setTimeout(function(){if(bi==1){if(!bk.hasClass("sorter-false")){aI.call(bk,bl)}}else{at(bk,bk.width()==bk.data("origWidth")?"minimum":"default")}bi=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(bg,bh){startPos=parseInt(bh.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(bg,bh){$(this).removeAttr("style");at(column,column.width())},drag:function(bg,bh){if(handlePos=="right"){column.width(startWidth+bh.offset.left-startPos)}else{column.width(startWidth+startPos-bh.offset.left)}}});aj();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function at(bg,be){var bf=bg.prop("id")+".width";var bh=be;var bi=bg.data("origWidth");if(bi===undefined){bg.data("origWidth",bg.width())}if(bh===undefined){bg.addClass("column-width-default");return}else{if(bh==="default"){bh=bi}else{if(bh==="minimum"){bh=1}}}bg.width(bh);bg.toggleClass("column-width-default",bh==bi).toggleClass("column-width-minimum",bh==1);z(bf,bh,bh!=bi);return bg}function aj(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var be=window.getSelection();if(be&&be.removeAllRanges){be.removeAllRanges()}}}}function M(bf,bg){var bi=bg.draggable.prop("cellIndex");var be=$(this).prop("cellIndex");if(bi+1==be){return false}var bh=$("#fileListTable thead th");bh.eq(bi).detach().insertBefore(bh.eq(be));$("#fileList tr").each(function(){var bj=$(this).children("td");bj.eq(bi).detach().insertBefore(bj.eq(be))});y();return true}function w(bg,be){var bf=$("#fileListTable thead th[data-name='"+bg+"']:not(.sorter-false)");if(bf.length==0){return}ae("order",bg+(be==1?"_asc":"_desc"),1);j(bf.prop("cellIndex"),be);s(bf.data("sorttype")||"string",bf.data("sort"),be,bf.prop("cellIndex"),"data-file");$("body").trigger("settingchanged",{setting:"order",value:ae("order")})}function a1(){var be=ae("order").split("_");if(!be){return{name:"data-file",sortorder:1}}return{name:be[0],sortorder:be[1]&&be[1]=="desc"?-1:1}}function ad(){if(lts=a1()){w(lts.name,lts.sortorder)}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aI)}function aI(){var be=a1();w($(this).data("name"),be.name==$(this).data("name")?-be.sortorder:1)}function j(be,bf){var bg=$("#fileListTable");bg.data("tablesorter-lastclickedcolumn",be);bg.data("tablesorter-sortorder",bf);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(be).addClass(bf==1?"tablesorter-up":"tablesorter-down")}function s(bg,bi,bf,be,bh){$("#fileListTable tbody").MyFileTableSorter(bg,bi,bf,be,bh)}function O(be){be.fadeTo("slow",0.5);K($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(be.attr("data-displayname")))),{confirm:function(){var bf=be.attr("data-file");H(be);var bh=ar();var bg=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:bf},function(bi){bh.remove();if(bi.error){ax()}P(bi)});I(bg)},cancel:function(){be.fadeTo("fast",1)}})}function P(be){if(be.error){a6(be.error)}if(be.warn){aZ(be.warn)}if(be.message){b(be.message)}if(be.quicknav){$("#quicknav").html(be.quicknav).MyTooltip();$("#quicknav a").click(function(bf){E(bf);L($(this).attr("href"))})}}function u(bi,bf,be){var bh=ar();var bg=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:be,file:bf},function(bj){if(bj.message){var bk=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:be,template:$("#fileList").attr("data-entrytemplate")},function(bl){try{var bm=$(bl);var bo=$("tr[data-file='"+be+"']");if(bo.length>0){bo.remove()}$("#flt").trigger("replaceRow",{row:bi,newrow:bm});bi.replaceWith(bm);bi=bm;ay();bm.focus()}catch(bn){ax()}bh.remove()});I(bk)}else{bh.remove()}P(bj)});I(bg)}function aU(bg){var bf=bg.closest("tr[data-file]").data("file");var be=bf.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:bg.find("td.filename"),defaultValue:be,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(bi){var bh=bi.value.replace(/\//g,"");if(bh==be){return}if(ae("settings.confirm.rename")!="no"){K($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(bf)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(bh)),{confirm:function(){u(bg,bf,bh)},setting:"settings.confirm.rename"})}else{u(bg,bf,bh)}}})}function aQ(be,bf){console.log("notify["+be+"]: "+bf);if(ae("settings.messages."+be)=="no"){return}noty({text:bf,type:be,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:be,msg:bf})}function a6(be){aQ("error",be)}function b(be){aQ("message",be)}function aZ(be){aQ("warning",be)}function ba(bf,be){if(!bf){return}bf.toggleClass("selected",be);bf.find(".selectbutton").prop("checked",bf.hasClass("selected"))}function T(be){return be.attr("data-file")!=".."&&!be.hasClass("unselectable-yes")}function V(bg){var bk=$("#fileListTable");if(T($(this))){var bj=this.rowIndex;var be=bj;if((bg.shiftKey||bg.metaKey||bg.altKey)&&bk.data("lastSelectedRowIndex")){be=bk.data("lastSelectedRowIndex");if(be<bj){var bi=be;be=bj;bj=bi}for(var bf=bj+1;bf<be;bf++){var bh=$("#fileList tr:visible").filter(function(){return this.rowIndex==bf});if(bh.length===0){continue}ba(bh);bh=bh.next()}}ba($(this));bk.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function a9(){$(".dialog.action").click(aG)}function aG(bf){E(bf);if($(this).hasClass("disabled")){return}var be=$(this);be.addClass("disabled");var bg=$("#"+be.attr("data-action"));if(bg.attr("title")){bg.data("title",bg.attr("title"))}bg.attr("title",bg.data("title"));bg.dialog({modal:true,width:"auto",open:function(){if(bg.data("initHandler")){bg.data("initHandler").init()}},close:function(){be.removeClass("disabled")},dialogClass:be.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function N(){bc();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",a4).on("fileListViewChanged",a4)}function bc(){aJ($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function a4(){var bf=aL();var bg=$("#fileListTable");var be=bg.hasClass("iswriteable-no")?":not(.access-writeable)":"";be+=bg.hasClass("isreadable-no")?":not(.access-readable)":"";be+=bg.hasClass("unselectable-no")?":not(.access-selectable)":"";aJ($(".access-writeable"),bg.hasClass("iswriteable-no"));aJ($(".access-readable"),bg.hasClass("isreadable-no"));aJ($(".access-selectable"),bg.hasClass("unselectable-yes"));aJ($(".sel-none"+be),bf.sumselcounter!==0);aJ($(".sel-one"+be),bf.sumselcounter!=1);aJ($(".sel-multi"+be),bf.sumselcounter===0);aJ($(".sel-noneorone"+be),bf.sumselcounter>1);aJ($(".sel-none.sel-dir"+be),bf.fileselcounter!==0);aJ($(".sel-one.sel-dir"+be),bf.fileselcounter>0||bf.dirselcounter!=1);aJ($(".sel-multi.sel-dir"+be),bf.fileselcounter>0||bf.dirselcounter===0);aJ($(".sel-noneorone.sel-dir"+be),bf.fileselcounter>0||bf.dirselcounter>1);aJ($(".sel-noneormulti.sel-dir"+be),bf.fileselcounter>0);aJ($(".sel-none.sel-file"+be),bf.fileselcounter!==0);aJ($(".sel-one.sel-file"+be),bf.dirselcounter>0||bf.fileselcounter!=1);aJ($(".sel-multi.sel-file"+be),bf.dirselcounter>0||bf.fileselcounter===0);aJ($(".sel-noneorone.sel-file"+be),bf.dirselcounter>0||bf.fileselcounter>1);aJ($(".sel-noneormulti.sel-file"+be),bf.dirselcounter>0)}function av(){$("#flt").on("fileListChanged",ai).on("fileListViewChanged",ai)}function F(be){if(!be){be=$("#fileListTable")}if(be&&be.attr){be.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aE(){var bf=$("#fileListTable");F(bf);var be=aL();bf.attr("data-dircounter",be.dircounter);bf.attr("data-filecounter",be.filecounter);bf.attr("data-foldersize",be.foldersize);bf.attr("data-sumcounter",be.sumcounter);$("#flt").trigger("counterUpdated")}function aL(){var bf=[];bf.dircounter=$("#fileList tr.is-subdir-yes:visible").length;bf.filecounter=$("#fileList tr.is-file:visible").length;bf.sumcounter=bf.dircounter+bf.filecounter;bf.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;bf.fileselcounter=$("#fileList tr.selected.is-file:visible").length;bf.sumselcounter=bf.dirselcounter+bf.fileselcounter;var be=0;var bg=0;$("#fileList tr:visible").each(function(bi,bj){var bh=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){bg+=bh}be+=bh});bf.foldersize=be;bf.folderselsize=bg;return bf}function ai(){var bg=$("#headerName");var bh=$("#fileListTable");var bf=$("#headerSize");aE();if(bg.length>0&&!bg.attr("data-title")){bg.attr("data-title",bg.attr("title"))}if(bf.length>0&&!bf.attr("data-title")){bf.attr("data-title",bf.attr("title"))}if(bg.length>0){bg.attr("title",bg.attr("data-title").replace(/\$filecount/,bh.attr("data-filecounter")).replace(/\$dircount/,bh.attr("data-dircounter")).replace(/\$sum/,parseInt(bh.attr("data-dircounter"))+parseInt(bh.attr("data-filecounter"))))}var be=parseInt(bh.attr("data-foldersize"));if(bf.length>0){bf.attr("title",bf.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(be)))}}function a5(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var be=history.location||document.location;ax(be.pathname)})}function L(bf,be){try{if(!be){if(window.history.pushState){window.history.pushState({path:bf},"",bf);ax(bf)}else{ax(bf)}return}}catch(bg){console.log(bg)}if(!be){ar()}window.location.href=bf}function ax(be,bg){if(!be){be=$("#fileList").attr("data-uri")}if(!be){be=window.location.href}if(!bg){bg={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var bf=$.now();$("#flt").data("timestamp",bf);$.get(be,bg,function(bh){if($("#flt").data("timestamp")!=bf){return}$("#flt").trigger("beforeFileListChange").show().html(bh.content).attr("data-uri",be);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+be.replace(/\/[^\/]+\/\.\.$/,"/"));ay();P(bh)})}function H(be){$("#flt").trigger("beforeFileListChange");be.remove();$("#flt").trigger("fileListChanged")}function B(bg,be,bh,bf){var bj=ar();var bi=$.post(bh,{srcuri:be,action:bg,files:bf.join("@/@")},function(bk){if(bk.message&&bg=="cut"){H($("#fileList tr[data-file='"+bf.join("'],#fileList tr[data-file='")+"']"))}bj.remove();if(bk.error){ax()}P(bk)});I(bi)}function D(bh,bj){var be=bj.draggable.closest("tr");var bk=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var bf=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(bk==$.MyStringHelper.concatUri(bf,encodeURIComponent($.MyStringHelper.stripSlash(be.attr("data-file"))))+"/"){return}var bi=bh.shiftKey||bh.altKey||bh.ctrlKey||bh.metaKey?"copy":"cut";var bg=be.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bn,bm){return $(bn).attr("data-file")}):new Array(be.attr("data-file"));if(ae("settings.confirm.dnd")!="no"){var bl=$("#paste"+bi+"confirm").html();bl=bl.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bg.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bf))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(bk))).replace(/\\n/g,"<br/>");K(bl,{confirm:function(){B(bi,bf,bk,bg)},setting:"settings.confirm.dnd"})}else{B(bi,bf,bk,bg)}}function ar(){return $("<div></div>").prependTo("body").addClass("overlay")}function an(bh,bi,bg){for(var bf in bi){var be=bi[bf];if(typeof be==="object"){an(bh,be,bf)}else{if(bg){bh.append($("<input/>").prop("name",bg).prop("value",be).prop("type","hidden"))}else{bh.append($("<input/>").prop("name",bf).prop("value",be).prop("type","hidden"))}}}return bh}function a2(bf){var be=$("<form/>").appendTo("body");be.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");an(be,bf);be.submit();be.remove()}function ab(bg){var bf=$(this);var be=m(this);be.fadeTo("slow",0.5);K(be.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(be.first().attr("data-file")))),{confirm:function(){var bi=ar();if(be.length===0){be=bf.closest("tr")}var bh=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(be,function(bj,bk){return $(bj).attr("data-file")})},function(bj){bi.remove();H(be);ak();if(bj.error){ax()}P(bj)});I(bh)},cancel:function(){be.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ak(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function aa(bg,be,bh,bf){var bj=ar();var bi=$.post(bh,{action:bg,files:bf,srcuri:be},function(bk){if(ae("clpaction")=="cut"){ap("clpfiles","clpaction","clpuri")}bj.remove();ax();P(bk)});I(bi)}function G(be){E(be);var bl=$(this);if(bl.hasClass("disabled")){return}if(bl.hasClass("delete")){ab.call(this,be)}else{if(bl.hasClass("rename")){aU(bl.closest("tr"))}else{if(bl.hasClass("cut")||bl.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var bh=$.map(m(bl),function(bo,bn){return $(bo).attr("data-file")});ae("clpfiles",bh.join("@/@"));ae("clpaction",bl.hasClass("cut")?"cut":"copy");ae("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(bl.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}S();ak()}else{if(bl.hasClass("paste")){var bf=ae("clpfiles");var bi=ae("clpaction");var bk=ae("clpuri");var bj=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(ae("settings.confirm.paste")!="no"){var bg=$("#paste"+bi+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(bk)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(bj)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(bf.split("@/@").join(", ")));K(bg,{confirm:function(){aa(bi,bk,bj,bf)},setting:"settings.confirm.paste"})}else{aa(bi,bk,bj,bf)}}else{if(bl.attr("href")!==undefined&&bl.attr("href")!="#"){window.location.href=bl.attr("href")}else{if(bl.attr("data-href")!==undefined&&bl.attr("data-href")!="#"){window.location.href=bl.attr("data-href")}else{var bm=bl.closest("tr");$("body").trigger("fileActionEvent",{obj:bl,event:be,file:bm.attr("data-file"),row:bm,selected:aF(this)})}}}}}}}function ae(bg,bh,be){var bf=new Date();bf.setTime(bf.getTime()+315360000000);if(bh){return Cookies.set(bg,bh,{path:$("#flt").attr("data-baseuri"),secure:true,expires:be?bf:undefined})}return Cookies.get(bg)}function ap(){for(var be=0;be<arguments.length;be++){Cookies.remove(arguments[be],{path:$("#flt").attr("data-baseuri"),secure:true})}}function z(bg,bh,be,bf){if(be){ae(bg,bh,bf)}else{ap(bg)}}function ah(){S();$("#flt").on("fileListChanged",S)}function S(){var bi=ae("clpaction");var be=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var bg=ae("clpuri");var bh=ae("clpfiles");var bf=(!bh||bh===""||bg==be||$("#fileListTable").hasClass("iswriteable-no"));aJ($(".action.paste"),bf);if(bg==be&&bi=="cut"){$.each(bh.split("@/@"),function(bj,bk){$("[data-file='"+bk+"']").addClass("cutted").fadeTo("fast",0.5)})}}function R(){$("#nav .action").click(G).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function r(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(G).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var be={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(bf){$("#flt").disableSelection();if(bf){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(be,{changeEvent:function(bg){var bf=$(this);$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:bg.value},function(bh){if(!bh.error&&bh.message){al(bg.value)}P(bh)})}}));$(".action.create-file").MyInplaceEditor($.extend(be,{changeEvent:function(bg){var bf=$(this);$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:bg.value},function(bh){if(!bh.error&&bh.message){al(bg.value)}P(bh)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(be,{changeEvent:function(bf){var bg=m(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:bf.value,file:bg.attr("data-file")},function(bh){if(!bh.error&&bh.message){al(bf.value)}P(bh)})}}))}function E(be){if(be.preventDefault){be.preventDefault()}else{be.returnValue=false}if(be.stopPropagation){be.stopPropagation()}}function az(be){E(be);if(be.stopImmediatePropagation){be.stopImmediatePropagation()}}function f(){$(".action.viewfilter").click(function(bg){E(bg);if($(this).hasClass("disabled")){return}var be=$(this);$(".action.viewfilter").addClass("disabled");var bh=$("#fileList").attr("data-uri");var bf=be.attr("data-template");$.get(bh,{ajax:"getViewFilterDialog",template:bf},function(bi){var bj=$(bi);$("input[name='filter.size.val']",bj).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bj).button().click(function(bl){E(bl);z("filter.name",$("select[name='filter.name.op'] option:selected",bj).val()+" "+$("input[name='filter.name.val']",bj).val(),$("input[name='filter.name.val']",bj).val()!=="");z("filter.size",$("select[name='filter.size.op'] option:selected",bj).val()+$("input[name='filter.size.val']",bj).val()+$("select[name='filter.size.unit'] option:selected",bj).val(),$("input[name='filter.size.val']",bj).val()!=="");if($("input[name='filter.types']:checked",bj).length>0){var bk="";$("input[name='filter.types']:checked",bj).each(function(bm,bn){bk+=$(bn).val()});ae("filter.types",bk)}else{ap("filter.types")}bj.dialog("close");ax()});$(".filter-reset",bj).button().click(function(bk){E(bk);ap("filter.name","filter.size","filter.types");bj.dialog("close");ax()});bj.submit(function(){return false});bj.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:be.attr("title")||be.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bj.remove()}}).show()})})}function I(bh,bg,bf){$("#abortdialog").remove();var be=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",be).button().click(function(bi){if(bh.readyState!=4){bh.abort()}be.hide().remove();if(bf){bf.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(bh.readyState>2){return}be.appendTo($("body")).show();var bi=window.setInterval(function(){if(bh.readyState==4){be.hide().remove();window.clearInterval(bi)}},200);$("body").data("abortdialoginterval",bi)},bg||2500));return be}function aW(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function p(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var bg="";var be=$("*[accesskey]").get().sort(function(bi,bh){var bj=$(bi).attr("accesskey");var bk=$(bh).attr("accesskey");return bj<bk?-1:bj>bk?1:0});var bf=[];$.each(be,function(bi,bh){var bj=$(bh);var bk=bj.attr("accesskey");if(!bf[bk]){bg+='<li tabindex="0" role="definition">'+bk+": "+(bj.attr("aria-label")||bj.attr("title")||bj.attr("data-tooltip")||bj.html())+"</li>";bf[bk]=true}else{console.log("found accesskey "+bk+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+bg+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function a3(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function y(){ae("visibletablecolumns",$("#fileListTable th[data-name]:visible").map(function(){return $(this).data("name")}).get().join(","),1);$("body").trigger("settingchanged",{setting:"visibletablecolumns",value:ae("visibletablecolumns")})}function aV(bh,bf){var bi=$("#fileListTable th[data-name="+bh+"]");var bg=bf===undefined?!bi.is(":visible"):bf;var be=bi.toggleClass("hidden",!bg).toggle(bg).prop("cellIndex");$("#fileListTable td:nth-child("+(be+1)+")").toggleClass("hidden",!bg).toggle(bg);y()}function a(bg){E(bg);var be=$(this);if(be.hasClass("disabled")){return}if(be.hasClass("table-sort")){var bf=a1();w(be.data("name"),bf.name==be.data("name")?-bf.sortorder:1)}else{if(be.hasClass("table-sort-this-asc")){w(be.closest("th").data("name"),1)}else{if(be.hasClass("table-sort-this-desc")){w(be.closest("th").data("name"),-1)}else{if(be.hasClass("table-column-hide-this")){aV(be.closest("th:not(.table-column-not-hide)").data("name"),false)}else{if(be.hasClass("table-column")){aV(be.data("name"))}else{if(be.hasClass("table-column-width-default")){at(be.closest("th"),"default")}else{if(be.hasClass("table-column-width-minimum")){at(be.closest("th"),"minimum")}}}}}}}}function aR(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",E).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable th[data-name].sorter-false").each(function(bg,bf){$(".action.table-sort."+$(bf).data("name")).addClass("hidden").hide()});$(".action.table-sort.fileactions").hide()});be();function be(){var bf=a1();$(".action.table-sort .symbol").removeClass("descending ascending");$(".action.table-sort."+bf.name+" .symbol").addClass(bf.sortorder==1?"descending":"ascending");$(".action.table-column .symbol").removeClass("column-hidden");$(".action.table-column").addClass("hidden disabled");$("#fileListTable th[data-name]").each(function(bh,bg){$(".action.table-column."+$(bg).data("name")).removeClass("hidden").toggleClass("disabled",$(bg).hasClass("table-column-not-hide")).find(".symbol").toggleClass("column-hidden",$(bg).is(":not(:visible)"))})}$("body").on("settingchanged",function(bf,bg){if(bg.setting=="order"||bg.setting=="visibletablecolumns"){be()}})}function W(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",G).on("dblclick.popupmenu",E).MyKeyboardEventHandler();aR();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){a3()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content",contextmenuAnchorElement:true})});$("body").off(".popupmenu").on("click.popupmenu",function(){a3()}).on("keydown.popupmenu",function(be){if(be.which==27){a3()}});$("#filler").on("contextmenu",function(be){if(be.which==3){if(be.originalEvent.detail===1){E(be)}a3()}})}function al(be){var bf=$("#fileList");return $.get($.MyStringHelper.addMissingSlash(bf.data("uri")),{ajax:"getFileListEntry",template:bf.data("entrytemplate"),file:be},function(bg){try{var bh=$(bg);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(be)+"']",bf);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:bh});row.replaceWith(bh)}else{bh.appendTo(bf)}ay();bh.focus()}catch(bi){ax()}})}function a0(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(bf,be){if(be.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!be.value);$("#flt").trigger("fileListViewChanged")}else{if(be.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!be.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",ae("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",ae("settings.show.dotfolders")=="no")}function aP(){var be=ae("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bi,bh){var bg=$(this);if(bg.data("thumb")!=bg.data("icon")){var bf=bg.data("thumb");var bj=bg.data("icon");var bk=$("#emptyimage").attr("src");bg.attr("src",be?(bf===""?bk:bf):(bj===""?bk:bj));bg.toggleClass("thumbnail",be)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(bf,be){if(be.setting=="settings.enable.thumbnails"){aP()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var be=$(this);var bf=be.data("icon");be.removeClass("thumbnail").attr("src",bf!==""?bf:$("#emptyimage").attr("src"))})})}function n(bf,be){var bh=ar();var bg=$.get(window.location.pathname,bf,function(bi){bh.remove();P(bi);be(bi)});I(bg)}function aB(bf,be){var bh=ar();var bg=$.post(window.location.pathname,bf,function(bi){bh.remove();P(bi);be(bi)});I(bg)}function ac(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:ar,changeUri:L,concatUri:$.MyStringHelper.concatUri,confirmDialog:K,cookie:ae,fixElementPosition:Z,getDialog:n,getDialogByPost:aB,getSelectedFiles:aF,getSelectedRows:m,handleJSONResponse:P,handleWindowResize:t,hidePopupMenu:a3,initFileList:ay,initPopupMenu:W,initTabs:ag,initUpload:ao,notify:aQ,notifyError:a6,notifyInfo:b,notifyWarn:aZ,preventDefault:E,preventDefaultImmediatly:az,postAction:a2,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:al,removeAbortDialog:aW,renderAbortDialog:I,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:ap,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:z,toggleRowSelection:ba,uncheckSelectedRows:ak,updateFileList:ax}}function am(){$.fn.MyTooltip.defaults.helphandler=aH;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){aH.call(this,$(this).data("help"))})}function aH(bf){var be=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:bf,width:"99%",height:"99%"}).text(bf)).dialog({width:be.width()/2,height:be.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
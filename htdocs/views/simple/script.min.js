var ToolBox={};$(function(){aQ();P();am();G();g();Y();ai();q();K();aA();Q();ao();ap();aS();f();e();x();D();aw();n();J();W();aj();d();aF();aK();c();S();az();aO();aR();X();V();ad();$.ajaxSetup({traditional:true});$(document).ajaxError(function(aY,aZ,aX,aW){console.log(aY);console.log(aZ);console.log(aX);console.log(aW);if(aZ&&aZ.statusText&&aZ.statusText!="abort"){aP(aZ.statusText)}$.MyPageBlocker("remove")}).ajaxSuccess(function(aX,aZ,aW,aY){if(aZ.getResponseHeader("X-Login-Required")){window.alert($("#login-session").text());window.location.href=aZ.getResponseHeader("X-Login-Required")}});$.ajaxPrefilter("script",function(aW,aY,aX){aW.cache=true});ak($("#flt").attr("data-uri"));function S(){var aW=$.MyCookie("settings.filelisttable.view");if(aW){$("#flt").addClass(aW);$(".action.flt-view-change."+aW).addClass("toggle-on")}else{$("#flt").addClass($(".action.flt-view-default").data("view"));$(".action.flt-view-default").addClass("toggle-on")}$(".action.flt-view-change").on("click",function(){var aX=$(this);$.MyCookie("settings.filelisttable.view",aX.data("view"));$("body").trigger("settingchanged",{setting:"settings.filelisttable.view",value:aX.data("view")})});$("body").on("settingchanged",function(aX,aY){if(aY.setting=="settings.filelisttable.view"){$(".action.flt-view-change").removeClass("toggle-on");$(".action.flt-view-change."+aY.value).addClass("toggle-on");$(".action.flt-view-change").each(function(){$("#flt").removeClass($(this).data("view"))});$("#flt").addClass(aY.value)}})}function X(aW){if(!aW){aW=$(document)}$(".tabsel",aW).on("click keyup",function(aZ){if(aZ.type=="keyup"&&aZ.keyCode!=32&&aZ.keyCode!=13){return}$.MyPreventDefault(aZ);var aX=$(this);$(".tabsel.activetabsel",aW).removeClass("activetabsel");aX.addClass("activetabsel");$(".tab.showtab",aW).removeClass("showtab");var aY=$(".tab."+aX.data("group"),aW).addClass("showtab");$(":focusable:visible:first",aY).focus()})}function aR(){if(!$.MyCookie("settings.show.statusbar")){$.MyCookie("settings.show.statusbar","no");$.MyCookie("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",$.MyCookie("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(aX){$(this).prop("checked",true);$.MyPreventDefault(aX)});function aW(){var aY=$("#fileListTable");var aX=$("#statusbar");$(".filecount",aX).html(aY.attr("data-filecounter"));$(".dircount",aX).html(aY.attr("data-dircounter"));$(".sum",aX).html(aY.attr("data-sumcounter"));$(".foldersize",aX).attr("title",$.MyStringHelper.renderByteSizes(aY.data("foldersize"))).html($.MyStringHelper.renderByteSize(aY.data("foldersize")));$(".selfilecount",aX).html(aY.attr("data-fileselcounter"));$(".seldircount",aX).html(aY.attr("data-dirselcounter"));$(".selsum",aX).html(aY.attr("data-sumselcounter"));$(".selfoldersize",aX).attr("title",$.MyStringHelper.renderByteSizes(aY.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(aY.attr("data-folderselsize")));$(".selected-files-stats",aX).toggle(aY.attr("data-fileselcounter")!==0||aY.attr("data-dirselcounter")!==0)}aW();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",aW);$("body").on("notify",function(aX,aY){$("#statusbar .notify").attr("title",aY.msg).removeClass("error message warning").addClass(aY.type).html(aY.msg).MyTooltip()});$("body").on("settingchanged",function(aX,aY){if(aY.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",aY.value)}});$("#statusbar").MyTooltip()}function az(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aF(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(aY){var aX=this.tabIndex||1;var aW=$(this);if(aW.is(":focus")){if(aY.keyCode==32){O.call(this,aY)}else{if(aY.keyCode==13){F($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(aW.attr("data-file")))),aW.attr("data-type")=="file")}else{if(aY.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(M(aW)){H(aW)}}else{U()}}else{if(aY.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(aY.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(aY.keyCode==45){$(".paste").trigger("click")}}}}}}}if(aY.keyCode==38&&aX>-1){$.MyPreventDefault(aY);if(M(aW)&&(aY.shiftKey||aY.altKey||aY.ctrlKey||aY.metaKey)){aT(aW,true);$("#flt").trigger("fileListSelChanged")}aW.prevAll(":focusable:first").focus();aa()}else{if(aY.keyCode==40){$.MyPreventDefault(aY);if(M(aW)&&(aY.shiftKey||aY.altKey||aY.ctrlKey||aY.metaKey)){aT(aW,true);$("#flt").trigger("fileListSelChanged")}aW.nextAll(":focusable:first").focus();aa()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",o);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(aY){$.MyPreventDefault(aY);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var aX=$("#flt").data("TableConfigDialog");if(aX){i($(aX))}else{if($("#tableconfigdialogtemplate").length>0){var aW=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",aW);i($(aW))}else{$.MyPost($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(aZ){if(aZ.error){I(aZ)}$("#flt").data("TableConfigDialog",aZ);i($(aZ))})}}}).MyKeyboardEventHandler()})}function i(aX){var aZ=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(a2,a1){return $(a2).attr("data-name")});$.each(aZ,function(a1,a2){aX.find("input[name='visiblecolumn'][value='"+a2+"']").prop("checked",true)});aX.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(a1){$.MyPreventDefault(a1)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(a1,a2){aX.find("input[name='sortingcolumn'][value='"+$(a2).attr("data-name")+"']").prop("disabled",true).click(function(a3){$.MyPreventDefault(a3)}).closest("li").addClass("disabled")});var a0=$.MyCookie("order")?$.MyCookie("order").split("_"):"name_asc".split("_");var aY=a0[0];var aW=a0[1]||"asc";aX.find("input[name='sortingcolumn'][value='"+aY+"']").prop("checked",true);aX.find("input[name='sortingorder'][value='"+aW+"']").prop("checked",true);aX.find("input[value='fileactions']").closest("li").hide();aX.find("input[name='save']").button().click(function(a1){var a5=aZ.slice(0);var a9=$.map($("input[name='visiblecolumn']:checked"),function(bb,ba){return $(bb).attr("value")});var a8=[];for(var a4=a5.length-1;a4>=0;a4--){if($.inArray(a5[a4],a9)==-1){a8.push(a5[a4]);a5.splice(a4,1)}}var a2=[];$.each(a9,function(ba,bb){if($.inArray(bb,a5)==-1){a2.push(bb);a5.push(bb)}});var a6=aX.find("input[name='sortingcolumn']:checked").attr("value");var a3=aX.find("input[name='sortingorder']:checked").attr("value");var a7=$("#fileListTable");if(a9.sort().join(",")!=aZ.sort().join(",")){$.each(a2,function(ba,bb){$.MyTableManager.toggleTableColumn(a7,bb,true)});$.each(a8,function(ba,bb){$.MyTableManager.toggleTableColumn(a7,bb,false)})}$.MyTableManager.sortTable(a7,a6,a3=="desc"?-1:1);aX.dialog("close")});aX.find("input[name='cancel']").button().click(function(a1){$.MyPreventDefault(a1);aX.dialog("close");return false});aX.find("#tableconfigform").submit(function(a1){return false});aX.dialog({modal:true,width:"auto",title:aX.attr("data-title")||aX.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");aX.dialog("destroy")}})}function aE(aW){if(aW){$.MyPreventDefault(aW)}var aY=$(this).hasClass("collapsed");var aX=$(this).hasClass("iconsonly");if(!aY&&!aX){aX=true}else{if(aX){aX=false;aY=true}else{aY=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",aY).toggleClass("sidebar-iconsonly",aX);$(".action.collapse-sidebar").toggleClass("collapsed",aY).toggleClass("iconsonly",aX);if(!aX&&!aY){$.MyCookie.rmCookies("sidebar")}else{$.MyCookie("sidebar",aX?"iconsonly":aY?"false":"true")}r()}function aj(){$(".action.collapse-sidebar").click(aE).MyKeyboardEventHandler().MyTooltip();if($.MyCookie("sidebar")&&$.MyCookie("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",$.MyCookie("sidebar")=="false").toggleClass("sidebar-iconsonly",$.MyCookie("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",$.MyCookie("sidebar")=="false").toggleClass("iconsonly",$.MyCookie("sidebar")=="iconsonly");r()}$(".action.collapse-head").click(function(aW){$.MyPreventDefault(aW);$(".action.collapse-head").toggleClass("collapsed");var aX=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!aX);$(".collapse-head-listener").toggleClass("head-collapsed",aX);$.MyCookie.toggleCookie("head","false",aX,1);r()}).MyTooltip().MyKeyboardEventHandler();if($.MyCookie("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function W(){$(".autorefreshmenu").on("dblclick",function(){ak()});av($(".action.autorefreshrunning, .autorefreshtimer"),true);$(document).on("mycountdowntimer-started",function(aX,aW){av($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running");R(aW.timeout)}).on("mycountdowntimer-paused",function(aX,aW){R(aW.timeout);$(".action.autorefreshtoggle").removeClass("running")}).on("mycountdowntimer-stopped",function(){av($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")}).on("mycountdowntimer-elapsed",function(aX,aW){R(aW.timeout)}).on("mycountdowntimer-lapsed",function(){R(0);ak()});$("#flt").on("fileListChanged",function(){if($.MyCookie("autorefresh")!==""&&parseInt($.MyCookie("autorefresh"),10)>0){$(document).MyCountdownTimer("start",parseInt($.MyCookie("autorefresh"),10))}});$(".action.setautorefresh").click(function(aW){if($(this).attr("data-value")==="now"){ak();return}$.MyCookie("autorefresh",$(this).attr("data-value"));$(document).MyCountdownTimer("start",parseInt($(this).data("value"),10))});$(".action.autorefreshclear").click(function(aW){if($(this).hasClass("disabled")){return}$(document).MyCountdownTimer("stop");$.MyCookie.rmCookies("autorefresh")});$(".action.autorefreshtoggle").click(function(aW){if($(this).hasClass("disabled")){return}$(document).MyCountdownTimer("toggle")});$("#autorefreshtimer").MyFixedElementDragger()}function R(aW){var aY=$(".autorefreshtimer");var aZ=aY.attr("data-template")||"%sm %ss";var aX=Math.floor(aW/60);var a0=aW%60;if(a0<10){a0="0"+a0}aY.html(aZ.replace("%s",aX).replace("%s",a0))}function J(){var aW=$("#settings");aW.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",aW).each(function(aY,aX){$(aX).prop("checked",$.MyCookie($(aX).prop("name"))!="no").click(function(aZ){if($.MyCookie($(this).prop("name")+".keep")){$.MyCookie($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{$.MyCookie.toggleCookie($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",aW).change(function(){if($(this).prop("name")=="settings.lang"){$.MyCookie($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{$.MyCookie($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(aZ,aX){var a0=$(aX);var aY=a0.prop("name");if(aY=="settings.lang"){aY=aY.replace(/^settings\./,"")}$("option[value='"+$.MyCookie(aY)+"']",a0).prop("selected",true)})}})}function aQ(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(aW){if(aW.keyCode==13||aW.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(aW){$.MyPreventDefault(aW);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function n(){$("#flt").on("fileListChanged",r).on("fileListViewChanged",r);$(window).resize(r);r()}function r(){var aW=$(window).width()-$("#nav").width();$("#content").width(aW);$("#controls").width(aW);$("body").trigger("windowResized")}function D(){$(".home-button[data-href], .logout-button[data-href], .contact-button[data-href], .link-button[data-href], .help-button[data-href]").off("click").attr("tabindex",0).on("click",function(){window.open($(this).data("href"),$(this).data("target")||"_self")});$(".action.changeuri").off(".changeuri").on("click.changeuri",aV);$(".action.refresh").off(".refresh").on("click.refresh",function(aW){$.MyPreventDefault(aW);ak();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",aV);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var aW=$(this);if(!aW.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=aW.data("href")?aW.data("href"):aW.attr("href")}})})}function aV(aW){$.MyPreventDefault(aW);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){F($(this).data("href")||$(this).attr("href")||$(this).data("uri"))}return false}function x(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(aW){$("#fileList tr:not(:hidden).unselectable-no").each(function(aX,aY){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(aW){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(aW){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function am(){$("#flt").on("bookmarksChanged",p).on("bookmarksChanged fileListSelChanged",u).on("fileListChanged",function(){p();u()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(ay)}function av(aW,aX){$.each(aW,function(a0,aZ){var aY=$(aZ);if(aY.hasClass("hideit")){aY.toggle(!aX)}if(aY.hasClass("button")){aY.button("option","disabled",aX)}if(!aY.hasClass("notab")){aY.attr("tabindex",aX?-1:0)}aY.toggleClass("disabled",aX)})}function u(){var a0=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var aW=false;var aZ=0;var aY=0;while($.MyCookie("bookmark"+aY)!=null){if($.MyCookie("bookmark"+aY)==a0){aW=true}if($.MyCookie("bookmark"+aY)!="-"){aZ++}aY++}av($(".action.addbookmark"),aW);av($(".action.bookmarksortpath"),aZ<2);av($(".action.bookmarksorttime"),aZ<2);av($(".action.rmallbookmarks"),aZ===0);var aX=$.MyCookie("bookmarksort")==null?"time-desc":$.MyCookie("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(aX=="path"||aX=="path-desc"||aX=="time"||aX=="time-desc"){$(".action.bookmarksort"+aX.replace(/-desc/,"")+" ."+aX).show()}}function p(){var a1=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(a2,a3){$(a3).remove()});var a0=[];var aY=0;while($.MyCookie("bookmark"+aY)!=null){if($.MyCookie("bookmark"+aY)!="-"){a0.push({path:$.MyCookie("bookmark"+aY),time:parseInt($.MyCookie("bookmark"+aY+"time"))})}aY++}var aZ=$.MyCookie("bookmarksort")?$.MyCookie("bookmarksort"):"time-desc";var aW=1;if(aZ.indexOf("-desc")>0){aW=-1;aZ=aZ.replace(/-desc/,"")}a0.sort(function(a3,a2){if(aZ=="path"){return aW*a3[aZ].localeCompare(a2[aZ])}else{return aW*(a2[aZ]-a3[aZ])}});var aX=$(".bookmarktemplate").first().html();$.each(a0,function(a2,a4){var a3=unescape(a4.path);$("<li>"+aX.replace(/\$bookmarkpath/g,a4.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(a3,20))))+"</li>").clone(false).insertAfter($(".bookmarktemplate")).click(ay).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",a4.path).attr("data-htmltooltip",$.MyStringHelper.simpleEscape(a3)+"%0D"+(new Date(parseInt(a4.time)))).attr("tabindex",a4.path==a1?-1:0).toggleClass("disabled",a4.path==a1).find(".action.rmsinglebookmark").click(ay).MyKeyboardEventHandler()})}function j(aX){var aW=0;while($.MyCookie("bookmark"+aW)!=null&&$.MyCookie("bookmark"+aW)!=aX){aW++}if($.MyCookie("bookmark"+aW)==aX){$.MyCookie("bookmark"+aW,"-",1)}$("#flt").trigger("bookmarksChanged")}function ay(aZ){$.MyPreventDefault(aZ);if($(this).hasClass("disabled")){return}var aW=$(this);var aY=$("#fileList").attr("data-uri");if(aW.hasClass("addbookmark")){var aX=0;while($.MyCookie("bookmark"+aX)!=null&&$.MyCookie("bookmark"+aX)!="-"&&$.MyCookie("bookmark"+aX)!=""&&$.MyCookie("bookmark"+aX)!=aY){aX++}$.MyCookie("bookmark"+aX,aY,1);$.MyCookie("bookmark"+aX+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(aW.hasClass("dyn-bookmark")){F(aW.attr("data-bookmark"));aW.closest("ul").hide()}else{if(aW.hasClass("rmbookmark")){j(aY)}else{if(aW.hasClass("rmallbookmarks")){var aX=0;while($.MyCookie("bookmark"+aX)!=null){$.MyCookie.rmCookies("bookmark"+aX,"bookmark"+aX+"time");aX++}$("#flt").trigger("bookmarksChanged")}else{if(aW.hasClass("rmsinglebookmark")){j($(this).attr("data-bookmark"))}else{if(aW.hasClass("bookmarksortpath")){$.MyCookie("bookmarksort",$.MyCookie("bookmarksort")=="path"||$.MyCookie("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(aW.hasClass("bookmarksorttime")){$.MyCookie("bookmarksort",$.MyCookie("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function ap(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",ag).on("fileListViewChanged",ag)}function ag(){var aY=$("#selstats");var aW=aY.data("selstats");var aX=ax();$("#fileListTable").attr("data-fileselcounter",aX.fileselcounter).attr("data-dirselcounter",aX.dirselcounter).attr("data-folderselsize",aX.folderselsize).attr("data-sumselcounter",aX.sumselcounter);$("#flt").trigger("selectionCounterUpdated");aY.html(aW.replace(/\$filecount/g,aX.fileselcounter).replace(/\$dircount/g,aX.dirselcounter).replace(/\$sum/g,aX.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(aX.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(aX.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(aX.folderselsize)).MyTooltip()}function aA(){$("#pathinputform").submit(function(aW){return false});$("#pathinputform input[name='uri']").keydown(function(aW){if(aW.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(aW.keyCode==13){$.MyPreventDefault(aW);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();F($(this).val())}}});$(".action.changedir").button().click(function(aW){$.MyPreventDefault(aW);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(aW){$.MyPreventDefault(aW);$("#pathinput").hide();$("#quicknav").show();F($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function Q(){$("form#filterbox").submit(function(aW){return false});$("form#filterbox input").keyup(v).change(v).autocomplete({minLength:1,select:v,close:v});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(aW){$.MyPreventDefault(aW);$("form#filterbox input").val("");v();$(this).addClass("invisible")});$("#flt").on("fileListChanged",v).on("fileListChanged",function(){var aW=$.map($("#fileList tr"),function(aY,aX){return $(aY).attr("data-file")});$("form#filterbox input").autocomplete({source:function(aY,aX){try{var a0=new RegExp(aY.term);aX($.grep(aW,function(a1){return a0.test(a1)}))}catch(aZ){aX($.grep(aW,function(a1){return a1.indexOf(aY.term)>-1}))}}})})}function v(){var aW=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var aY=new RegExp(aW,"i");if(aW===""||$(this).attr("data-file").match(aY)){$(this).show()}else{$(this).hide()}}catch(aX){if(aW===""||$(this).attr("data-file").toLowerCase().indexOf(aW.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function t(aX,aY){if(!aY){aY=aX}var aW=aY.loaded/aY.total*100;$("#progress .bar").css("width",aW.toFixed(2)+"%").html(parseInt(aW)+"% ("+$.MyStringHelper.renderByteSize(aY.loaded)+"/"+$.MyStringHelper.renderByteSize(aY.total)+"); "+aX.done+"/"+aX.uploads)}function af(aY,a0,aX,aZ){$("#flt").on("fileListChanged",function(){aY.fileupload("option","url",$("#fileList").attr("data-uri"))});var aW={aborted:false,transports:[],done:0,failed:0,uploads:0};aY.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:aZ,singleFileUploads:true,autoUpload:false,add:function(a4,a3){if(!aW.aborted){var a5=a3.submit();var a2=a3.files[0].name;aW.transports.push(a5);var a1=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+a2).addClass("fileprogress");$("<div></div>").click(function(a6){$.MyPreventDefault(a6);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(a1).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:a2,transport:a5});$("<div></div>").appendTo(a1).addClass("fileprogressbar running").html(a3.files[0].name+" ("+$.MyStringHelper.renderByteSize(a3.files[0].size)+"): 0%");aW.uploads++;return true}return false},done:function(a2,a1){$("#progress [id='fpb"+a1.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a1.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(a1.result.message?"done":"failed").css("width","100%").html(a1.result&&a1.result.error?a1.result.error:a1.result.message?a1.result.message:a1.files[0].name);if(a1.result.message){aW.done++}else{aW.failed++}t(aW)},fail:function(a2,a1){$("#progress [id='fpb"+a1.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a1.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(a1.textStatus+": "+$.map(a1.files,function(a3,a4){return a3.name}).join(", "));aW.failed++;t(aW);console.log(a1)},stop:function(a2,a1){t(aW);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){ak()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(a2,a1){aW.transports=[];aW.aborted=false;aW.files=[];aW.uploads=0;aW.failed=0;aW.done=0;return true},start:function(a3,a2){var a1=[];a1.push({text:$("#close").html(),disabled:true});a1.push({text:$("#cancel").html(),click:function(){if(aW.aborted){return}aW.aborted=true;$.each(aW.transports,function(a4,a5){if(a5&&a5.abort){a5.abort($("#uploadaborted").html())}});aW.transports=[]}});$("#progress").dialog({modal:true,title:aX,height:370,width:500,buttons:a1,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(a3,a2){var a1=parseInt(a2.loaded/a2.total*100)+"%";$("div[id='fpb"+a2.files[0].name+"'] .fileprogressbar","#progress .info").css("width",a1).html(a2.files[0].name+" ("+$.MyStringHelper.renderByteSize(a2.files[0].size)+"): "+a1)},progressall:function(a2,a1){aW.total=a1.total;aW.loaded=a1.loaded;t(aW,a1)},submit:function(a2,a1){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",$.MyCookie("settings.confirm.upload")=="no"||!N(a1)||window.confirm(a0))}$("#file-upload-form-relapath").val(a1.files[0].relativePath||(a1.files[0].webkitRelativePath&&a1.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");$("#file-upload-form-token").val($("#token").val());return $(this).data("ask.confirm")}})}function N(aX){for(var aW=0;aW<aX.files.length;aW++){var aY;if(aX.files[aW].relativePath&&aX.files[aW].relativePath!=""){aY=aX.files[aW].relativePath.split(/[\\\/]/)[0]+"/"}else{if(aX.files[aW].webkitRelativePath&&aX.files[aW].webkitRelativePath!=""){aY=aX.files[aW].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(aY&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(aY)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(aX.files[aW].name)+"']").length>0){return true}}}return false}function ao(){af($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(aW){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(aW){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(aW){$("#fileList").addClass("draghover")}).on("dragleave",function(aW){$("#fileList").removeClass("draghover")}).on("drop",function(aW){$("#fileList").removeClass("hover")})}function E(aY,aW){var aX;if(aW.setting){aY+='<div class="confirmdialogsetting"><input type="checkbox" name="'+aW.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";aX=$.MyCookie(aW.setting)}$("#confirmdialog").html(aY).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(aW.setting){$.MyCookie.toggleCookie(aW.setting,aX,aX&&aX!=="",1)}$("#confirmdialog").dialog("close");if(aW.cancel){aW.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(aW.confirm){aW.confirm()}}}],open:function(){if(aW.setting){$("input[name='"+aW.setting+"']",$(this)).click(function(aZ){$.MyCookie.toggleCookie(aW.setting,"no",!$(this).is(":checked"),1)}).prop("checked",$.MyCookie(aW.setting)!="no")}},close:function(){if(aW.cancel){aW.cancel()}}}).show()}function aU(){return $("#fileList tr.isreadable-yes.unselectable-no.selected:visible div.filename")}function l(aX){var aW=$("#fileList tr.selected:visible");if(aW.length===0){aW=$(aX).closest("tr[data-file]")}if(aW.length===0){aW=$("#fileList tr:visible:focus")}if(aW.length===0){aW=$("#fileList tr:visible #popupmenu").closest("tr[data-file]")}if(aW.length===0){aW=$("#fileList tr:visible #fileactions").closest("tr[data-file]")}return aW}function ar(aW){return $.map(l(aW),function(aX){return $(aX).attr("data-file")})}function aI(aX){$.MyPreventDefault(aX);var aW=$(this);if(aW.hasClass("disabled")){return}var aY=aW.closest("tr[data-file]");if(aY.length===0){aY=l(this).shift()}if(aW.hasClass("rename")){aG(aY)}else{if(aW.hasClass("delete")){H(aY)}else{$("body").trigger("fileActionEvent",{obj:aW,event:aX,file:aY.attr("data-file"),selected:[aY.data("file")],row:aY})}}}function g(){$("#fileactions").on("click dblclick",function(aW){$.MyPreventDefault(aW);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").addClass("focus").on("click dblclick",aI).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",ah).on("mouseleave.fileAction",k)}).on("beforeFileListChange replaceRow",k);h();$("body").on("settingchanged",h)}function h(aW,aX){$("#fileactions").toggleClass("hidefileactions",$.MyCookie("settings.show.fileactions")=="no").toggleClass("hidelabels",$.MyCookie("settings.show.fileactionlabels")=="no").toggleClass("showalways",$.MyCookie("settings.show.fileactionalways")=="no")}function ah(aX){var aW=$(this);if($("#fileactions",aW).length===0){$(".action.changeuri.filename",aW).after($("#fileactions"))}$("#fileList tr.focus").removeClass("focus");aW.addClass("focus");aN(aX,{focus:true})}function k(aW){$("#fileactions").appendTo($(".template"))}function aw(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(aY,aX){var aW=$(aX);if(!aW.attr("href")){aW.data("fancybox-href",aW.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(aW){return(aW.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(aY,aX){var aW=$(aX);if(!aW.attr("href")){aW.data("fancybox-href",aW.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function al(){var aX=$("#fileListTable");var aW=$("#fileList");$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",O).off("dblclick.initFileList").on("dblclick.initFileList",function(aY){F($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:y,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:aU,zIndex:200,scope:"fileList",revert:true});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable").MyTableManager();aa();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function aa(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var aW=window.getSelection();if(aW&&aW.removeAllRanges){aW.removeAllRanges()}}}}function H(aW){aW.fadeTo("slow",0.5);E($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(aW.attr("data-displayname")))),{confirm:function(){var aX=aW.attr("data-file");B(aW);var aY=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:aX},function(aZ){if(aZ.error){ak()}I(aZ)});C(aY)},cancel:function(){aW.fadeTo("fast",1)}})}function I(aW){if(aW.error){aP(aW.error)}if(aW.warn){aJ(aW.warn)}if(aW.message){b(aW.message)}if(aW.quicknav){$("#quicknav").html(aW.quicknav).MyTooltip();$("#quicknav a").click(function(aX){$.MyPreventDefault(aX);F($(this).attr("href"))})}}function s(aZ,aX,aW){var aY=$.MyPost($("#fileList").attr("data-uri"),{rename:"yes",newname:aW,file:aX},function(a0){if(a0.message){$.MyPost($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:aW,template:$("#fileList").attr("data-entrytemplate")},function(a1){try{var a2=$(a1);var a4=$("tr[data-file='"+aW+"']");if(a4.length>0){a4.remove()}$("#flt").trigger("replaceRow",{row:aZ,newrow:a2});aZ.replaceWith(a2);aZ=a2;al();a2.focus()}catch(a3){ak()}},true)}I(a0)});C(aY)}function aG(aY){var aX=aY.closest("tr[data-file]").data("file");var aW=aX.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:aY.find("td.filename"),defaultValue:aW,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(a0){var aZ=a0.value.replace(/\//g,"");if(aZ==aW){return}if($.MyCookie("settings.confirm.rename")!="no"){E($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(aX)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(aZ)),{confirm:function(){s(aY,aX,aZ)},setting:"settings.confirm.rename"})}else{s(aY,aX,aZ)}}})}function aC(aW,aX){console.log("notify["+aW+"]: "+aX);if($.MyCookie("settings.messages."+aW)=="no"){return}noty({text:aX,type:aW,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:aW,msg:aX})}function aP(aW){aC("error",aW)}function b(aW){aC("message",aW)}function aJ(aW){aC("warning",aW)}function aT(aX,aW){if(!aX){return}aX.toggleClass("selected",aW);aX.find(".selectbutton").prop("checked",aX.hasClass("selected"))}function M(aW){return aW.attr("data-file")!=".."&&!aW.hasClass("unselectable-yes")}function O(aY){var a2=$("#fileListTable");if(M($(this))){var a1=this.rowIndex;var aW=a1;if((aY.shiftKey||aY.metaKey||aY.altKey)&&a2.data("lastSelectedRowIndex")){aW=a2.data("lastSelectedRowIndex");if(aW<a1){var a0=aW;aW=a1;a1=a0}for(var aX=a1+1;aX<aW;aX++){var aZ=$("#fileList tr:visible").filter(function(){return this.rowIndex==aX});if(aZ.length===0){continue}aT(aZ);aZ=aZ.next()}}aT($(this));a2.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function aS(){$(".dialog.action").click(at)}function at(aX){$.MyPreventDefault(aX);if($(this).hasClass("disabled")){return}var aW=$(this);aW.addClass("disabled");var aY=$("#"+aW.attr("data-action"));if(aY.attr("title")){aY.data("title",aY.attr("title"))}aY.attr("title",aY.data("title"));aY.dialog({modal:true,width:"auto",open:function(){if(aY.data("initHandler")){aY.data("initHandler").init()}},close:function(){aW.removeClass("disabled")},dialogClass:aW.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function G(){aN();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",aN).on("fileListViewChanged",aN)}function aN(aY,a0){var aX=ax(a0&&a0.focus);var a1=$("#fileListTable");var aZ=a0&&a0.focus?".focus":":not(.focus)";var aW=aZ;aW+=a1.hasClass("iswriteable-no")?":not(.access-writeable)":"";aW+=a1.hasClass("isreadable-no")?":not(.access-readable)":"";aW+=a1.hasClass("unselectable-no")?":not(.access-selectable)":"";av($(".access-writeable"+aZ),a1.hasClass("iswriteable-no"));av($(".access-readable"+aZ),a1.hasClass("isreadable-no"));av($(".access-selectable"+aZ),a1.hasClass("unselectable-yes"));av($(".sel-none"+aW),aX.sumselcounter!==0);av($(".sel-one"+aW),aX.sumselcounter!=1);av($(".sel-multi"+aW),aX.sumselcounter===0);av($(".sel-noneorone"+aW),aX.sumselcounter>1);av($(".sel-none.sel-dir"+aW),aX.fileselcounter!==0);av($(".sel-one.sel-dir"+aW),aX.fileselcounter>0||aX.dirselcounter!=1);av($(".sel-multi.sel-dir"+aW),aX.fileselcounter>0||aX.dirselcounter===0);av($(".sel-noneorone.sel-dir"+aW),aX.fileselcounter>0||aX.dirselcounter>1);av($(".sel-noneormulti.sel-dir"+aW),aX.fileselcounter>0);av($(".sel-none.sel-file"+aW),aX.fileselcounter!==0);av($(".sel-one.sel-file"+aW),aX.dirselcounter>0||aX.fileselcounter!=1);av($(".sel-multi.sel-file"+aW),aX.dirselcounter>0||aX.fileselcounter===0);av($(".sel-noneorone.sel-file"+aW),aX.dirselcounter>0||aX.fileselcounter>1);av($(".sel-noneormulti.sel-file"+aW),aX.dirselcounter>0);av($(".sel-one-suffix"+aW),true);av($(".sel-one-mime"+aW),true);av($(".sel-one-filename"+aW),true);if(aX.sumselcounter===1&&aX.fileselcounter===1){if(aX.selectedmimetypes!=""){$(".sel-one-mime"+aW).each(function(){var a2=$(this);av(a2,a2.data("mime")==undefined||aX.selectedmimetypes.match(a2.data("mime"))===null)})}if(aX.selectedsuffixes!=""){$(".sel-one-suffix"+aW).each(function(){var a2=$(this);av(a2,a2.data("suffix")==undefined||aX.selectedsuffixes.match(a2.data("suffix"))===null)})}$(".sel-one-filename"+aW).each(function(){var a2=$(this);av(a2,a2.data("filename")==undefined||aX.selectedfilenames.match(a2.data("filename"))===null)})}}function ai(){$("#flt").on("fileListChanged",Z).on("fileListViewChanged",Z)}function z(aW){if(!aW){aW=$("#fileListTable")}if(aW&&aW.attr){aW.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aq(){var aX=$("#fileListTable");z(aX);var aW=ax();aX.attr("data-dircounter",aW.dircounter);aX.attr("data-filecounter",aW.filecounter);aX.attr("data-foldersize",aW.foldersize);aX.attr("data-sumcounter",aW.sumcounter);$("#flt").trigger("counterUpdated")}function ax(aW){var aY=[];var a0=aW?".focus":".selected:visible";aY.focus=aW;aY.dircounter=$("#fileList tr.is-subdir-yes:visible").length;aY.filecounter=$("#fileList tr.is-file:visible").length;aY.sumcounter=aY.dircounter+aY.filecounter;aY.dirselcounter=$("#fileList tr.is-subdir-yes"+a0).length;aY.fileselcounter=$("#fileList tr.is-file"+a0).length;aY.sumselcounter=aY.dirselcounter+aY.fileselcounter;var a1=$("#fileList tr.is-file"+a0);aY.selectedmimetypes=a1.map(function(){return $(this).data("mime")}).get().sort().join(",").replace(/([^,]+)(,\1)*/g,"$1");aY.selectedsuffixes=a1.map(function(){return $(this).data("file").toLocaleLowerCase().match(/\.\w+$/)!=null?$(this).data("file").split(".").pop():""}).get().sort().join(",").replace(/([^,]+)(,\1)*/g,"$1");aY.selectedfilenames=a1.map(function(){return $(this).data("file").toLocaleLowerCase()}).get().sort().join("/");var aX=0;var aZ=0;$("#fileList tr:visible").each(function(a3,a4){var a2=parseInt($(this).attr("data-size"));if($(this).is(a0)){aZ+=a2}aX+=a2});aY.foldersize=aX;aY.folderselsize=aZ;return aY}function Z(){var aY=$("#headerName");var aZ=$("#fileListTable");var aX=$("#headerSize");aq();if(aY.length>0&&!aY.attr("data-title")){aY.attr("data-title",aY.attr("title"))}if(aX.length>0&&!aX.attr("data-title")){aX.attr("data-title",aX.attr("title"))}if(aY.length>0){aY.attr("title",aY.attr("data-title").replace(/\$filecount/,aZ.attr("data-filecounter")).replace(/\$dircount/,aZ.attr("data-dircounter")).replace(/\$sum/,parseInt(aZ.attr("data-dircounter"))+parseInt(aZ.attr("data-filecounter"))))}var aW=parseInt(aZ.attr("data-foldersize"));if(aX.length>0){aX.attr("title",aX.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(aW)))}}function aO(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var aW=history.location||document.location;ak(aW.pathname)})}function F(aX,aW){try{if(!aW){if(window.history.pushState){window.history.pushState({path:aX},"",aX);ak(aX)}else{ak(aX)}return}}catch(aY){console.log(aY)}if(!aW){$.MyPageBlocker()}window.location.href=aX}function ak(aW,aY){if(!aW){aW=$("#fileList").attr("data-uri")}if(!aW){aW=window.location.href}if(!aY){aY={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var aX=$.now();$("#flt").data("timestamp",aX);$.MyPost(aW,aY,function(aZ){if($("#flt").data("timestamp")!=aX){return}$("#flt").trigger("beforeFileListChange").show().html(aZ.content).attr("data-uri",aW);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+aW.replace(/\/[^\/]+\/\.\.$/,"/"));al();I(aZ)},true)}function B(aW){$("#flt").trigger("beforeFileListChange");aW.remove();$("#flt").trigger("fileListChanged")}function w(aY,aW,aZ,aX){var a0=$.MyPost(aZ,{srcuri:aW,action:aY,files:aX.join("@/@")},function(a1){if(a1.message&&aY=="cut"){B($("#fileList tr[data-file='"+aX.join("'],#fileList tr[data-file='")+"']"))}if(a1.error){ak()}I(a1)});C(a0)}function y(aZ,a1){var aW=a1.draggable.closest("tr");var a2=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var aX=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(a2==$.MyStringHelper.concatUri(aX,encodeURIComponent($.MyStringHelper.stripSlash(aW.attr("data-file"))))+"/"){return}var a0=aZ.shiftKey||aZ.altKey||aZ.ctrlKey||aZ.metaKey?"copy":"cut";var aY=aW.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(a5,a4){return $(a5).attr("data-file")}):new Array(aW.attr("data-file"));if($.MyCookie("settings.confirm.dnd")!="no"){var a3=$("#paste"+a0+"confirm").html();a3=a3.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(aY.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(aX))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a2))).replace(/\\n/g,"<br/>");E(a3,{confirm:function(){w(a0,aX,a2,aY)},setting:"settings.confirm.dnd"})}else{w(a0,aX,a2,aY)}}function ae(aZ,a0,aY){for(var aX in a0){var aW=a0[aX];if(typeof aW==="object"){ae(aZ,aW,aX)}else{if(aY){aZ.append($("<input/>").prop("name",aY).prop("value",aW).prop("type","hidden"))}else{aZ.append($("<input/>").prop("name",aX).prop("value",aW).prop("type","hidden"))}}}return aZ}function aL(aX){var aW=$("<form/>").appendTo("body");aW.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");aW.append($("#token").clone().removeAttr("id"));ae(aW,aX);aW.submit();aW.remove()}function U(aY){var aX=$(this);var aW=l(this);aW.fadeTo("slow",0.5);E(aW.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(aW.first().attr("data-file")))),{confirm:function(){if(aW.length===0){aW=aX.closest("tr")}var aZ=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(aW,function(a0,a1){return $(a0).attr("data-file")})},function(a0){B(aW);ab();if(a0.error){ak()}I(a0)});C(aZ)},cancel:function(){aW.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ab(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function T(aY,aW,aZ,aX){var a0=$.MyPost(aZ,{action:aY,files:aX,srcuri:aW},function(a1){if($.MyCookie("clpaction")=="cut"){$.MyCookie.rmCookies("clpfiles","clpaction","clpuri")}if(aX.split("@/@").length==1){ac(aX)}else{ak()}I(a1)});C(a0)}function A(aW){$.MyPreventDefault(aW);var a3=$(this);if(a3.hasClass("disabled")){return}if(a3.hasClass("delete")){U.call(this,aW)}else{if(a3.hasClass("rename")){aG(a3.closest("tr"))}else{if(a3.hasClass("cut")||a3.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var aZ=$.map(l(a3),function(a6,a5){return $(a6).attr("data-file")});$.MyCookie("clpfiles",aZ.join("@/@"));$.MyCookie("clpaction",a3.hasClass("cut")?"cut":"copy");$.MyCookie("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(a3.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}L();ab()}else{if(a3.hasClass("paste")){var aX=$.MyCookie("clpfiles");var a0=$.MyCookie("clpaction");var a2=$.MyCookie("clpuri");var a1=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if($.MyCookie("settings.confirm.paste")!="no"){var aY=$("#paste"+a0+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(a2)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(a1)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(aX.split("@/@").join(", ")));E(aY,{confirm:function(){T(a0,a2,a1,aX)},setting:"settings.confirm.paste"})}else{T(a0,a2,a1,aX)}}else{if(a3.attr("href")!==undefined&&a3.attr("href")!="#"){window.open(a3.attr("href"),a3.attr("target")||"_self")}else{var a4=l(a3);$("body").trigger("fileActionEvent",{obj:a3,event:aW,file:a4.attr("data-file"),row:a4,selected:ar(this)})}}}}}}function Y(){L();$("#flt").on("fileListChanged",L)}function L(){var a0=$.MyCookie("clpaction");var aW=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var aY=$.MyCookie("clpuri");var aZ=$.MyCookie("clpfiles");var aX=(!aZ||aZ===""||aY==aW||$("#fileListTable").hasClass("iswriteable-no"));av($(".action.paste"),aX);if(aY==aW&&a0=="cut"){$.each(aZ.split("@/@"),function(a1,a2){$("[data-file='"+a2+"']").addClass("cutted").fadeTo("fast",0.5)})}}function K(){$("#nav .action").click(A).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function q(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(A).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var aW={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(aX){$("#flt").disableSelection();if(aX){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(aW,{changeEvent:function(aY){var aX=$(this);$.MyPost($("#fileList").attr("data-uri"),{mkcol:"yes",colname:aY.value},function(aZ){if(!aZ.error&&aZ.message){ac(aY.value)}I(aZ)})}}));$(".action.create-file").MyInplaceEditor($.extend(aW,{changeEvent:function(aY){var aX=$(this);$.MyPost($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:aY.value},function(aZ){if(!aZ.error&&aZ.message){ac(aY.value)}I(aZ)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(aW,{changeEvent:function(aX){var aY=l(this);$.MyPost($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:aX.value,file:aY.attr("data-file")},function(aZ){if(!aZ.error&&aZ.message){ac(aX.value)}I(aZ)})}}))}function f(){$(".action.viewfilter").click(function(aY){$.MyPreventDefault(aY);if($(this).hasClass("disabled")){return}var aW=$(this);$(".action.viewfilter").addClass("disabled");var aZ=$("#fileList").attr("data-uri");var aX=aW.attr("data-template");$.MyPost(aZ,{ajax:"getViewFilterDialog",template:aX},function(a0){var a1=$(a0);$("input[name='filter.size.val']",a1).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",a1).button().click(function(a3){$.MyPreventDefault(a3);$.MyCookie.toggleCookie("filter.name",$("select[name='filter.name.op'] option:selected",a1).val()+" "+$("input[name='filter.name.val']",a1).val(),$("input[name='filter.name.val']",a1).val()!=="");$.MyCookie.toggleCookie("filter.size",$("select[name='filter.size.op'] option:selected",a1).val()+$("input[name='filter.size.val']",a1).val()+$("select[name='filter.size.unit'] option:selected",a1).val(),$("input[name='filter.size.val']",a1).val()!=="");if($("input[name='filter.types']:checked",a1).length>0){var a2="";$("input[name='filter.types']:checked",a1).each(function(a4,a5){a2+=$(a5).val()});$.MyCookie("filter.types",a2)}else{$.MyCookie.rmCookies("filter.types")}a1.dialog("close");ak()});$(".filter-reset",a1).button().click(function(a2){$.MyPreventDefault(a2);$.MyCookie.rmCookies("filter.name","filter.size","filter.types");a1.dialog("close");ak()});a1.submit(function(){return false});a1.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:aW.attr("title")||aW.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");a1.remove()}}).show()})})}function C(aZ,aY,aX){$("#abortdialog").remove();var aW=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",aW).button().click(function(a0){if(aZ.readyState!=4){aZ.abort()}aW.hide().remove();if(aX){aX.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(aZ.readyState>2){return}aW.appendTo($("body")).show();var a0=window.setInterval(function(){if(aZ.readyState==4){aW.hide().remove();window.clearInterval(a0)}},200);$("body").data("abortdialoginterval",a0)},aY||2500));return aW}function aH(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function o(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var aY="";var aW=$("*[accesskey]").get().sort(function(a0,aZ){var a1=$(a0).attr("accesskey");var a2=$(aZ).attr("accesskey");return a1<a2?-1:a1>a2?1:0});var aX=[];$.each(aW,function(a0,aZ){var a1=$(aZ);var a2=a1.attr("accesskey");if(!aX[a2]){aY+='<li tabindex="0" role="definition">'+a2+": "+(a1.attr("aria-label")||a1.attr("title")||a1.attr("data-tooltip")||a1.html())+"</li>";aX[a2]=true}else{console.log("found accesskey "+a2+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+aY+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function aM(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(aY){$.MyPreventDefault(aY);var aW=$(this);if(aW.hasClass("disabled")){return}if(aW.hasClass("table-sort")){var aX=$.MyTableManager.getLastTableSort();$.MyTableManager.sortTable(aW.closest("table"),aW.data("name"),aX.name==aW.data("name")?-aX.sortorder:1)}else{if(aW.hasClass("table-sort-this-asc")){$.MyTableManager.sortTable(aW.closest("table"),aW.closest("th").data("name"),1)}else{if(aW.hasClass("table-sort-this-desc")){$.MyTableManager.sortTable(aW.closest("table"),aW.closest("th").data("name"),-1)}else{if(aW.hasClass("table-column-hide-this")){$.MyTableManager.toggleTableColumn(aW.closest("table"),aW.closest("th:not(.table-column-not-hide)").data("name"),false)}else{if(aW.hasClass("table-column")){$.MyTableManager.toggleTableColumn(aW.closest("table"),aW.data("name"))}else{if(aW.hasClass("table-column-width-default")){$.MyTableManager.setTableColumnWidth(aW.closest("th"),"default")}else{if(aW.hasClass("table-column-width-minimum")){$.MyTableManager.setTableColumnWidth(aW.closest("th"),"minimum")}}}}}}}}function aD(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable th[data-name].sorter-false").each(function(aY,aX){$(".action.table-sort."+$(aX).data("name")).addClass("hidden").hide()});$(".action.table-sort.fileactions").hide()});aW();function aW(){var aX=$.MyTableManager.getLastTableSort();$(".action.table-sort .symbol").removeClass("descending ascending");$(".action.table-sort."+aX.name+" .symbol").addClass(aX.sortorder==1?"descending":"ascending");$(".action.table-column .symbol").removeClass("column-hidden");$(".action.table-column").addClass("hidden disabled");$("#fileListTable th[data-name]").each(function(aZ,aY){$(".action.table-column."+$(aY).data("name")).removeClass("hidden").toggleClass("disabled",$(aY).hasClass("table-column-not-hide")).find(".symbol").toggleClass("column-hidden",$(aY).is(":not(:visible)"))})}$("body").on("settingchanged",function(aX,aY){if(aY.setting=="order"||aY.setting=="visibletablecolumns"){aW()}})}function P(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",A).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();aD();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){aM()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content",contextmenuAnchorElement:true})});$("#filler").on("contextmenu",function(aW){if(aW.which==3){if(aW.originalEvent.detail===1){$.MyPreventDefault(aW)}aM()}})}function ac(aW){var aX=$("#fileList");return $.MyPost($.MyStringHelper.addMissingSlash(aX.data("uri")),{ajax:"getFileListEntry",template:aX.data("entrytemplate"),file:aW},function(aY){try{var aZ=$(aY);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(aW)+"']",aX);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:aZ});row.replaceWith(aZ)}else{aZ.appendTo(aX)}al();aZ.focus()}catch(a0){ak()}},true)}function aK(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(aX,aW){if(aW.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!aW.value);$("#flt").trigger("fileListViewChanged")}else{if(aW.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!aW.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",$.MyCookie("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",$.MyCookie("settings.show.dotfolders")=="no")}function aB(){var aW=$.MyCookie("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(a0,aZ){var aY=$(this);if(aY.data("thumb")!=aY.data("icon")){var aX=aY.data("thumb");var a1=aY.data("icon");var a2=$("#emptyimage").attr("src");aY.attr("src",aW?(aX===""?a2:aX):(a1===""?a2:a1));aY.toggleClass("thumbnail",aW)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(aX,aW){if(aW.setting=="settings.enable.thumbnails"){aB()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var aW=$(this);var aX=aW.data("icon");aW.removeClass("thumbnail").attr("src",aX!==""?aX:$("#emptyimage").attr("src"))})})}function m(aX,aW){var aY=$.MyGet(window.location.pathname,aX,function(aZ){I(aZ);aW(aZ)});C(aY)}function an(aX,aW){var aY=$.MyPost(window.location.pathname,aX,function(aZ){I(aZ);aW(aZ)});C(aY)}function V(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:$.MyPageBlocker,changeUri:F,concatUri:$.MyStringHelper.concatUri,confirmDialog:E,cookie:$.MyCookie,getDialog:m,getDialogByPost:an,getSelectedFiles:ar,getSelectedRows:l,handleJSONResponse:I,handleWindowResize:r,hidePopupMenu:aM,initFileList:al,initPopupMenu:P,initTabs:X,initUpload:af,notify:aC,notifyError:aP,notifyInfo:b,notifyWarn:aJ,preventDefault:$.MyPreventDefault,preventDefaultImmediatly:$.MyPreventDefaultImmediatly,postAction:aL,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:ac,removeAbortDialog:aH,renderAbortDialog:C,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:$.MyCookie.rmCookies,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:$.MyCookie.toggleCookie,toggleRowSelection:aT,uncheckSelectedRows:ab,updateFileList:ak}}function ad(){$.fn.MyTooltip.defaults.helphandler=au;$(".contexthelp").MyContextHelp();$(".action.guide").click(function(){au.call(this,$(this).data("help"))})}function au(aX){var aW=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:aX,width:"99%",height:"99%"}).text(aX)).dialog({width:aW.width()/2,height:aW.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
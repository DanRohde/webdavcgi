var ToolBox={};$(function(){aU();Q();ap();H();g();aa();al();q();L();aD();R();ar();at();aW();f();e();y();E();az();n();K();Y();am();d();aI();aO();c();aC();aS();aV();Z();W();af();$.ajaxSetup({traditional:true});$(document).ajaxError(function(a3,a4,a2,a1){console.log(a3);console.log(a4);console.log(a2);console.log(a1);if(a4&&a4.statusText&&a4.statusText!="abort"){aT(a4.statusText)}$("div.overlay").remove()}).ajaxSuccess(function(a2,a4,a1,a3){if(a4.getResponseHeader("X-Login-Required")){window.alert($("#login-session").text());window.location.href=a4.getResponseHeader("X-Login-Required")}});$.ajaxPrefilter("script",function(a1,a3,a2){a1.cache=true});an($("#flt").attr("data-uri"));function Z(a1){if(!a1){a1=$(document)}$(".tabsel",a1).on("click keyup",function(a4){if(a4.type=="keyup"&&a4.keyCode!=32&&a4.keyCode!=13){return}$.MyPreventDefault(a4);var a2=$(this);$(".tabsel.activetabsel",a1).removeClass("activetabsel");a2.addClass("activetabsel");$(".tab.showtab",a1).removeClass("showtab");var a3=$(".tab."+a2.data("group"),a1).addClass("showtab");$(":focusable:visible:first",a3).focus()})}function aV(){if(!X("settings.show.statusbar")){X("settings.show.statusbar","no");X("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",X("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(a2){$(this).prop("checked",true);$.MyPreventDefault(a2)});function a1(){var a3=$("#fileListTable");var a2=$("#statusbar");$(".filecount",a2).html(a3.attr("data-filecounter"));$(".dircount",a2).html(a3.attr("data-dircounter"));$(".sum",a2).html(a3.attr("data-sumcounter"));$(".foldersize",a2).attr("title",$.MyStringHelper.renderByteSizes(a3.data("foldersize"))).html($.MyStringHelper.renderByteSize(a3.data("foldersize")));$(".selfilecount",a2).html(a3.attr("data-fileselcounter"));$(".seldircount",a2).html(a3.attr("data-dirselcounter"));$(".selsum",a2).html(a3.attr("data-sumselcounter"));$(".selfoldersize",a2).attr("title",$.MyStringHelper.renderByteSizes(a3.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(a3.attr("data-folderselsize")));$(".selected-files-stats",a2).toggle(a3.attr("data-fileselcounter")!==0||a3.attr("data-dirselcounter")!==0)}a1();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",a1);$("body").on("notify",function(a2,a3){$("#statusbar .notify").attr("title",a3.msg).removeClass("error message warning").addClass(a3.type).html(a3.msg).MyTooltip()});$("body").on("settingchanged",function(a2,a3){if(a3.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",a3.value)}});$("#statusbar").MyTooltip()}function aC(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aI(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(a3){var a2=this.tabIndex||1;var a1=$(this);if(a1.is(":focus")){if(a3.keyCode==32){P.call(this,a3)}else{if(a3.keyCode==13){G($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(a1.attr("data-file")))),a1.attr("data-type")=="file")}else{if(a3.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(N(a1)){I(a1)}}else{V()}}else{if(a3.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(a3.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(a3.keyCode==45){$(".paste").trigger("click")}}}}}}}if(a3.keyCode==38&&a2>-1){$.MyPreventDefault(a3);if(N(a1)&&(a3.shiftKey||a3.altKey||a3.ctrlKey||a3.metaKey)){aX(a1,true);$("#flt").trigger("fileListSelChanged")}a1.prevAll(":focusable:first").focus();ac()}else{if(a3.keyCode==40){$.MyPreventDefault(a3);if(N(a1)&&(a3.shiftKey||a3.altKey||a3.ctrlKey||a3.metaKey)){aX(a1,true);$("#flt").trigger("fileListSelChanged")}a1.nextAll(":focusable:first").focus();ac()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",o);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(a3){$.MyPreventDefault(a3);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var a2=$("#flt").data("TableConfigDialog");if(a2){i($(a2))}else{if($("#tableconfigdialogtemplate").length>0){var a1=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",a1);i($(a1))}else{$.MyPost($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(a4){if(a4.error){J(a4)}$("#flt").data("TableConfigDialog",a4);i($(a4))})}}}).MyKeyboardEventHandler()})}function i(a2){var a4=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(a7,a6){return $(a7).attr("data-name")});$.each(a4,function(a6,a7){a2.find("input[name='visiblecolumn'][value='"+a7+"']").prop("checked",true)});a2.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(a6){$.MyPreventDefault(a6)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(a6,a7){a2.find("input[name='sortingcolumn'][value='"+$(a7).attr("data-name")+"']").prop("disabled",true).click(function(a8){$.MyPreventDefault(a8)}).closest("li").addClass("disabled")});var a5=X("order")?X("order").split("_"):"name_asc".split("_");var a3=a5[0];var a1=a5[1]||"asc";a2.find("input[name='sortingcolumn'][value='"+a3+"']").prop("checked",true);a2.find("input[name='sortingorder'][value='"+a1+"']").prop("checked",true);a2.find("input[value='fileactions']").closest("li").hide();a2.find("input[name='save']").button().click(function(a6){var ba=a4.slice(0);var be=$.map($("input[name='visiblecolumn']:checked"),function(bg,bf){return $(bg).attr("value")});var bd=[];for(var a9=ba.length-1;a9>=0;a9--){if($.inArray(ba[a9],be)==-1){bd.push(ba[a9]);ba.splice(a9,1)}}var a7=[];$.each(be,function(bf,bg){if($.inArray(bg,ba)==-1){a7.push(bg);ba.push(bg)}});var bb=a2.find("input[name='sortingcolumn']:checked").attr("value");var a8=a2.find("input[name='sortingorder']:checked").attr("value");var bc=$("#fileListTable");if(be.sort().join(",")!=a4.sort().join(",")){$.each(a7,function(bf,bg){$.MyTableManager.toggleTableColumn(bc,bg,true)});$.each(bd,function(bf,bg){$.MyTableManager.toggleTableColumn(bc,bg,false)})}$.MyTableManager.sortTable(bc,bb,a8=="desc"?-1:1);a2.dialog("close")});a2.find("input[name='cancel']").button().click(function(a6){$.MyPreventDefault(a6);a2.dialog("close");return false});a2.find("#tableconfigform").submit(function(a6){return false});a2.dialog({modal:true,width:"auto",title:a2.attr("data-title")||a2.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");a2.dialog("destroy")}})}function aH(a1){if(a1){$.MyPreventDefault(a1)}var a3=$(this).hasClass("collapsed");var a2=$(this).hasClass("iconsonly");if(!a3&&!a2){a2=true}else{if(a2){a2=false;a3=true}else{a3=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",a3).toggleClass("sidebar-iconsonly",a2);$(".action.collapse-sidebar").toggleClass("collapsed",a3).toggleClass("iconsonly",a2);if(!a2&&!a3){ai("sidebar")}else{X("sidebar",a2?"iconsonly":a3?"false":"true")}r()}function am(){$(".action.collapse-sidebar").click(aH).MyKeyboardEventHandler().MyTooltip();if(X("sidebar")&&X("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",X("sidebar")=="false").toggleClass("sidebar-iconsonly",X("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",X("sidebar")=="false").toggleClass("iconsonly",X("sidebar")=="iconsonly");r()}$(".action.collapse-head").click(function(a1){$.MyPreventDefault(a1);$(".action.collapse-head").toggleClass("collapsed");var a2=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!a2);$(".collapse-head-listener").toggleClass("head-collapsed",a2);v("head","false",a2,1);r()}).MyTooltip().MyKeyboardEventHandler();if(X("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function Y(){$(".action.autorefreshmenu").dblclick(function(a1){$.MyPreventDefault(a1);an()});ay($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){ay($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){ay($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(X("autorefresh")!==""&&parseInt(X("autorefresh"))>0){aL(parseInt(X("autorefresh")))}});$(".action.setautorefresh").click(function(a1){$.MyPreventDefault(a1);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){an();return}X("autorefresh",$(this).attr("data-value"));aL(parseInt($(this).attr("data-value")))}).on("keyup",function(a1){if(a1.keyCode==32||a1.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(a1){$.MyPreventDefault(a1);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ai("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(a1){if(a1.keyCode==32||a1.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(a2){$.MyPreventDefault(a2);if($(this).hasClass("disabled")){return}var a1=$("#autorefresh");if(a1.data("timer")!=null){window.clearInterval(a1.data("timer"));a1.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{aL(a1.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(a1){if(a1.keyCode==32||a1.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(a2,a1){X("autorefreshtimerpos",JSON.stringify(T("#autorefreshtimer",a1.offset)))}});if(X("autorefreshtimerpos")){T("#autorefreshtimer",JSON.parse(X("autorefreshtimerpos")))}}function T(a5,a1){var a4=$(a5);var a2=$(window);var a3={left:Math.min(Math.max(a1.left,0),a2.width()-a4.outerWidth()+a2.scrollLeft()),top:Math.min(Math.max(a1.top,0),a2.height()-a4.outerHeight()+a2.scrollTop())};a4.offset(a3);return a3}function S(a1){var a3=$(".autorefreshtimer");var a4=a3.attr("data-template")||"%sm %ss";var a2=Math.floor(a1/60);var a5=a1%60;if(a5<10){a5="0"+a5}a3.html(a4.replace("%s",a2).replace("%s",a5))}function aL(a2){var a1=$("#autorefresh");if(a1.data("timer")!=null){window.clearInterval(a1.data("timer"))}a1.data("timeout",a2);S(a2);a1.data("timer",window.setInterval(function(){var a3=a1.data("timeout")-1;S(a3);a1.data("timeout",a3);if(a3<0){window.clearInterval(a1.data("timer"));a1.data("timer",null);S(0);a1.trigger("stopped");an()}},1000));a1.trigger("started")}function K(){var a1=$("#settings");a1.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",a1).each(function(a3,a2){$(a2).prop("checked",X($(a2).prop("name"))!="no").click(function(a4){if(X($(this).prop("name")+".keep")){X($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{v($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",a1).change(function(){if($(this).prop("name")=="settings.lang"){X($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{X($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(a4,a2){var a5=$(a2);var a3=a5.prop("name");if(a3=="settings.lang"){a3=a3.replace(/^settings\./,"")}$("option[value='"+X(a3)+"']",a5).prop("selected",true)})}})}function aU(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(a1){if(a1.keyCode==13||a1.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(a1){$.MyPreventDefault(a1);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function n(){$("#flt").on("fileListChanged",r).on("fileListViewChanged",r);$(window).resize(r);r()}function r(){var a1=$(window).width()-$("#nav").width();$("#content").width(a1);$("#controls").width(a1);$("body").trigger("windowResized")}function E(){$(".home-button[data-href], .logout-button[data-href], .contact-button[data-href], .link-button[data-href], .help-button[data-href]").off("click").attr("tabindex",0).on("click",function(){window.open($(this).data("href"),$(this).data("target")||"_self")});$(".action.changeuri").off(".changeuri").on("click.changeuri",a0);$(".action.refresh").off(".refresh").on("click.refresh",function(a1){$.MyPreventDefault(a1);an();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",a0);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var a1=$(this);if(!a1.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=a1.data("href")?a1.data("href"):a1.attr("href")}})})}function a0(a1){$.MyPreventDefault(a1);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){G($(this).data("href")||$(this).attr("href")||$(this).data("uri"))}return false}function y(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(a1){$("#fileList tr:not(:hidden).unselectable-no").each(function(a2,a3){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(a1){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(a1){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function ap(){$("#flt").on("bookmarksChanged",p).on("bookmarksChanged",u).on("fileListChanged",function(){p();u()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aB)}function ay(a1,a2){$.each(a1,function(a5,a4){var a3=$(a4);if(a3.hasClass("hideit")){a3.toggle(!a2)}if(a3.hasClass("button")){a3.button("option","disabled",a2)}if(!a3.hasClass("notab")){a3.attr("tabindex",a2?-1:0)}a3.toggleClass("disabled",a2)})}function u(){var a5=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var a1=false;var a4=0;var a3=0;while(X("bookmark"+a3)!=null){if(X("bookmark"+a3)==a5){a1=true}if(X("bookmark"+a3)!="-"){a4++}a3++}$(".action.addbookmark").button("option","disabled",a1);ay($(".action.rmbookmark"),!a1);ay($(".action.bookmarksortpath"),a4<2);ay($(".action.bookmarksorttime"),a4<2);ay($(".action.rmallbookmarks"),a4===0);var a2=X("bookmarksort")==null?"time-desc":X("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(a2=="path"||a2=="path-desc"||a2=="time"||a2=="time-desc"){$("#bookmarks .action.bookmarksort"+a2.replace(/-desc/,"")+" ."+a2).show()}}function p(){var a6=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(a7,a8){$(a8).remove()});var a5=[];var a3=0;while(X("bookmark"+a3)!=null){if(X("bookmark"+a3)!="-"){a5.push({path:X("bookmark"+a3),time:parseInt(X("bookmark"+a3+"time"))})}a3++}var a4=X("bookmarksort")?X("bookmarksort"):"time-desc";var a1=1;if(a4.indexOf("-desc")>0){a1=-1;a4=a4.replace(/-desc/,"")}a5.sort(function(a8,a7){if(a4=="path"){return a1*a8[a4].localeCompare(a7[a4])}else{return a1*(a7[a4]-a8[a4])}});var a2=$("#bookmarktemplate").html();$.each(a5,function(a7,a9){var a8=unescape(a9.path);$("<li>"+a2.replace(/\$bookmarkpath/g,a9.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(a8,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aB).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",a9.path).attr("data-htmltooltip",$.MyStringHelper.simpleEscape(a8)+"%0D"+(new Date(parseInt(a9.time)))).attr("tabindex",a9.path==a6?-1:0).toggleClass("disabled",a9.path==a6).find(".action.rmsinglebookmark").click(aB).MyKeyboardEventHandler()})}function j(a2){var a1=0;while(X("bookmark"+a1)!=null&&X("bookmark"+a1)!=a2){a1++}if(X("bookmark"+a1)==a2){X("bookmark"+a1,"-",1)}$("#flt").trigger("bookmarksChanged")}function aB(a4){$.MyPreventDefault(a4);if($(this).hasClass("disabled")){return}var a1=$(this);var a3=$("#fileList").attr("data-uri");if(a1.hasClass("addbookmark")){var a2=0;while(X("bookmark"+a2)!=null&&X("bookmark"+a2)!="-"&&X("bookmark"+a2)!=""&&X("bookmark"+a2)!=a3){a2++}X("bookmark"+a2,a3,1);X("bookmark"+a2+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(a1.hasClass("dyn-bookmark")){G(a1.attr("data-bookmark"));a1.closest("ul").hide()}else{if(a1.hasClass("rmbookmark")){j(a3)}else{if(a1.hasClass("rmallbookmarks")){var a2=0;while(X("bookmark"+a2)!=null){ai("bookmark"+a2,"bookmark"+a2+"time");a2++}$("#flt").trigger("bookmarksChanged")}else{if(a1.hasClass("rmsinglebookmark")){j($(this).attr("data-bookmark"))}else{if(a1.hasClass("bookmarksortpath")){X("bookmarksort",X("bookmarksort")=="path"||X("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(a1.hasClass("bookmarksorttime")){X("bookmarksort",X("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function at(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",aj).on("fileListViewChanged",aj)}function aj(){var a3=$("#selstats");var a1=a3.data("selstats");var a2=aA();$("#fileListTable").attr("data-fileselcounter",a2.fileselcounter).attr("data-dirselcounter",a2.dirselcounter).attr("data-folderselsize",a2.folderselsize).attr("data-sumselcounter",a2.sumselcounter);$("#flt").trigger("selectionCounterUpdated");a3.html(a1.replace(/\$filecount/g,a2.fileselcounter).replace(/\$dircount/g,a2.dirselcounter).replace(/\$sum/g,a2.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(a2.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(a2.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(a2.folderselsize)).MyTooltip()}function aD(){$("#pathinputform").submit(function(a1){return false});$("#pathinputform input[name='uri']").keydown(function(a1){if(a1.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(a1.keyCode==13){$.MyPreventDefault(a1);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();G($(this).val())}}});$(".action.changedir").button().click(function(a1){$.MyPreventDefault(a1);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(a1){$.MyPreventDefault(a1);$("#pathinput").hide();$("#quicknav").show();G($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function R(){$("form#filterbox").submit(function(a1){return false});$("form#filterbox input").keyup(w).change(w).autocomplete({minLength:1,select:w,close:w});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(a1){$.MyPreventDefault(a1);$("form#filterbox input").val("");w();$(this).addClass("invisible")});$("#flt").on("fileListChanged",w).on("fileListChanged",function(){var a1=$.map($("#fileList tr"),function(a3,a2){return $(a3).attr("data-file")});$("form#filterbox input").autocomplete({source:function(a3,a2){try{var a5=new RegExp(a3.term);a2($.grep(a1,function(a6){return a5.test(a6)}))}catch(a4){a2($.grep(a1,function(a6){return a6.indexOf(a3.term)>-1}))}}})})}function w(){var a1=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var a3=new RegExp(a1,"i");if(a1===""||$(this).attr("data-file").match(a3)){$(this).show()}else{$(this).hide()}}catch(a2){if(a1===""||$(this).attr("data-file").toLowerCase().indexOf(a1.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function t(a2,a3){if(!a3){a3=a2}var a1=a3.loaded/a3.total*100;$("#progress .bar").css("width",a1.toFixed(2)+"%").html(parseInt(a1)+"% ("+$.MyStringHelper.renderByteSize(a3.loaded)+"/"+$.MyStringHelper.renderByteSize(a3.total)+"); "+a2.done+"/"+a2.uploads)}function ah(a3,a5,a2,a4){$("#flt").on("fileListChanged",function(){a3.fileupload("option","url",$("#fileList").attr("data-uri"))});var a1={aborted:false,transports:[],done:0,failed:0,uploads:0};a3.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:a4,singleFileUploads:true,autoUpload:false,add:function(a9,a8){if(!a1.aborted){var ba=a8.submit();var a7=a8.files[0].name;a1.transports.push(ba);var a6=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+a7).addClass("fileprogress");$("<div></div>").click(function(bb){$.MyPreventDefault(bb);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(a6).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:a7,transport:ba});$("<div></div>").appendTo(a6).addClass("fileprogressbar running").html(a8.files[0].name+" ("+$.MyStringHelper.renderByteSize(a8.files[0].size)+"): 0%");a1.uploads++;return true}return false},done:function(a7,a6){$("#progress [id='fpb"+a6.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a6.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(a6.result.message?"done":"failed").css("width","100%").html(a6.result&&a6.result.error?a6.result.error:a6.result.message?a6.result.message:a6.files[0].name);if(a6.result.message){a1.done++}else{a1.failed++}t(a1)},fail:function(a7,a6){$("#progress [id='fpb"+a6.files[0].name+"'] .cancel").remove();$("div[id='fpb"+a6.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(a6.textStatus+": "+$.map(a6.files,function(a8,a9){return a8.name}).join(", "));a1.failed++;t(a1);console.log(a6)},stop:function(a7,a6){t(a1);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){an()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(a7,a6){a1.transports=[];a1.aborted=false;a1.files=[];a1.uploads=0;a1.failed=0;a1.done=0;return true},start:function(a8,a7){var a6=[];a6.push({text:$("#close").html(),disabled:true});a6.push({text:$("#cancel").html(),click:function(){if(a1.aborted){return}a1.aborted=true;$.each(a1.transports,function(a9,ba){if(ba&&ba.abort){ba.abort($("#uploadaborted").html())}});a1.transports=[]}});$("#progress").dialog({modal:true,title:a2,height:370,width:500,buttons:a6,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(a8,a7){var a6=parseInt(a7.loaded/a7.total*100)+"%";$("div[id='fpb"+a7.files[0].name+"'] .fileprogressbar","#progress .info").css("width",a6).html(a7.files[0].name+" ("+$.MyStringHelper.renderByteSize(a7.files[0].size)+"): "+a6)},progressall:function(a7,a6){a1.total=a6.total;a1.loaded=a6.loaded;t(a1,a6)},submit:function(a7,a6){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",X("settings.confirm.upload")=="no"||!O(a6)||window.confirm(a5))}$("#file-upload-form-relapath").val(a6.files[0].relativePath||(a6.files[0].webkitRelativePath&&a6.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");$("#file-upload-form-token").val($("#token").val());return $(this).data("ask.confirm")}})}function O(a2){for(var a1=0;a1<a2.files.length;a1++){var a3;if(a2.files[a1].relativePath&&a2.files[a1].relativePath!=""){a3=a2.files[a1].relativePath.split(/[\\\/]/)[0]+"/"}else{if(a2.files[a1].webkitRelativePath&&a2.files[a1].webkitRelativePath!=""){a3=a2.files[a1].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(a3&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(a3)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(a2.files[a1].name)+"']").length>0){return true}}}return false}function ar(){ah($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(a1){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(a1){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(a1){$("#fileList").addClass("draghover")}).on("dragleave",function(a1){$("#fileList").removeClass("draghover")}).on("drop",function(a1){$("#fileList").removeClass("hover")})}function F(a3,a1){var a2;if(a1.setting){a3+='<div class="confirmdialogsetting"><input type="checkbox" name="'+a1.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";a2=X(a1.setting)}$("#confirmdialog").html(a3).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(a1.setting){v(a1.setting,a2,a2&&a2!=="",1)}$("#confirmdialog").dialog("close");if(a1.cancel){a1.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(a1.confirm){a1.confirm()}}}],open:function(){if(a1.setting){$("input[name='"+a1.setting+"']",$(this)).click(function(a4){v(a1.setting,"no",!$(this).is(":checked"),1)}).prop("checked",X(a1.setting)!="no")}},close:function(){if(a1.cancel){a1.cancel()}}}).show()}function aY(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function l(a2){var a1=$("#fileList tr.selected:visible");if(a1.length==0){a1=$(a2).closest("tr[data-file]")}if(a1.length==0){a1=$("#fileList tr:visible:focus")}return a1}function av(a1){return $.map(l(a1),function(a2,a3){return $(a2).attr("data-file")})}function aM(a2){$.MyPreventDefault(a2);var a1=$(this);if(a1.hasClass("disabled")){return}var a3=a1.closest("tr");if(a1.hasClass("rename")){aJ(a3)}else{if(a1.hasClass("delete")){I(a3)}else{$("body").trigger("fileActionEvent",{obj:a1,event:a2,file:a3.attr("data-file"),selected:[a3.data("file")],row:a3})}}}function g(){$("#fileactions").on("click dblclick",function(a1){$.MyPreventDefault(a1);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aM).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",ak).on("mouseleave.fileAction",k)}).on("beforeFileListChange replaceRow",k);h();$("body").on("settingchanged",h)}function h(a1,a2){$("#fileactions").toggleClass("hidefileactions",X("settings.show.fileactions")=="no").toggleClass("hidelabels",X("settings.show.fileactionlabels")=="no").toggleClass("showalways",X("settings.show.fileactionalways")=="no")}function ak(a2){var a1=$(this);if($("#fileactions",a1).length===0){$(".action.changeuri.filename",a1).after($("#fileactions"))}}function k(a1){$("#fileactions").appendTo($(".template"))}function az(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(a3,a2){var a1=$(a2);if(!a1.attr("href")){a1.data("fancybox-href",a1.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(a1){return(a1.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(a3,a2){var a1=$(a2);if(!a1.attr("href")){a1.data("fancybox-href",a1.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function ao(){var a2=$("#fileListTable");var a1=$("#fileList");$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",P).off("dblclick.initFileList").on("dblclick.initFileList",function(a3){G($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:z,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:aY,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable").MyTableManager();ac();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function ac(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var a1=window.getSelection();if(a1&&a1.removeAllRanges){a1.removeAllRanges()}}}}function I(a1){a1.fadeTo("slow",0.5);F($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(a1.attr("data-displayname")))),{confirm:function(){var a2=a1.attr("data-file");C(a1);var a3=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:a2},function(a4){if(a4.error){an()}J(a4)});D(a3)},cancel:function(){a1.fadeTo("fast",1)}})}function J(a1){if(a1.error){aT(a1.error)}if(a1.warn){aN(a1.warn)}if(a1.message){b(a1.message)}if(a1.quicknav){$("#quicknav").html(a1.quicknav).MyTooltip();$("#quicknav a").click(function(a2){$.MyPreventDefault(a2);G($(this).attr("href"))})}}function s(a4,a2,a1){var a3=$.MyPost($("#fileList").attr("data-uri"),{rename:"yes",newname:a1,file:a2},function(a5){if(a5.message){var a6=$.MyPost($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:a1,template:$("#fileList").attr("data-entrytemplate")},function(a7){try{var a8=$(a7);var ba=$("tr[data-file='"+a1+"']");if(ba.length>0){ba.remove()}$("#flt").trigger("replaceRow",{row:a4,newrow:a8});a4.replaceWith(a8);a4=a8;ao();a8.focus()}catch(a9){an()}},1);D(a6)}J(a5)});D(a3)}function aJ(a3){var a2=a3.closest("tr[data-file]").data("file");var a1=a2.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:a3.find("td.filename"),defaultValue:a1,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(a5){var a4=a5.value.replace(/\//g,"");if(a4==a1){return}if(X("settings.confirm.rename")!="no"){F($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(a2)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(a4)),{confirm:function(){s(a3,a2,a4)},setting:"settings.confirm.rename"})}else{s(a3,a2,a4)}}})}function aF(a1,a2){console.log("notify["+a1+"]: "+a2);if(X("settings.messages."+a1)=="no"){return}noty({text:a2,type:a1,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:a1,msg:a2})}function aT(a1){aF("error",a1)}function b(a1){aF("message",a1)}function aN(a1){aF("warning",a1)}function aX(a2,a1){if(!a2){return}a2.toggleClass("selected",a1);a2.find(".selectbutton").prop("checked",a2.hasClass("selected"))}function N(a1){return a1.attr("data-file")!=".."&&!a1.hasClass("unselectable-yes")}function P(a3){var a7=$("#fileListTable");if(N($(this))){var a6=this.rowIndex;var a1=a6;if((a3.shiftKey||a3.metaKey||a3.altKey)&&a7.data("lastSelectedRowIndex")){a1=a7.data("lastSelectedRowIndex");if(a1<a6){var a5=a1;a1=a6;a6=a5}for(var a2=a6+1;a2<a1;a2++){var a4=$("#fileList tr:visible").filter(function(){return this.rowIndex==a2});if(a4.length===0){continue}aX(a4);a4=a4.next()}}aX($(this));a7.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function aW(){$(".dialog.action").click(aw)}function aw(a2){$.MyPreventDefault(a2);if($(this).hasClass("disabled")){return}var a1=$(this);a1.addClass("disabled");var a3=$("#"+a1.attr("data-action"));if(a3.attr("title")){a3.data("title",a3.attr("title"))}a3.attr("title",a3.data("title"));a3.dialog({modal:true,width:"auto",open:function(){if(a3.data("initHandler")){a3.data("initHandler").init()}},close:function(){a1.removeClass("disabled")},dialogClass:a1.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function H(){aZ();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",aR).on("fileListViewChanged",aR)}function aZ(){ay($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function aR(){var a2=aA();var a3=$("#fileListTable");var a1=a3.hasClass("iswriteable-no")?":not(.access-writeable)":"";a1+=a3.hasClass("isreadable-no")?":not(.access-readable)":"";a1+=a3.hasClass("unselectable-no")?":not(.access-selectable)":"";ay($(".access-writeable"),a3.hasClass("iswriteable-no"));ay($(".access-readable"),a3.hasClass("isreadable-no"));ay($(".access-selectable"),a3.hasClass("unselectable-yes"));ay($(".sel-none"+a1),a2.sumselcounter!==0);ay($(".sel-one"+a1),a2.sumselcounter!=1);ay($(".sel-multi"+a1),a2.sumselcounter===0);ay($(".sel-noneorone"+a1),a2.sumselcounter>1);ay($(".sel-none.sel-dir"+a1),a2.fileselcounter!==0);ay($(".sel-one.sel-dir"+a1),a2.fileselcounter>0||a2.dirselcounter!=1);ay($(".sel-multi.sel-dir"+a1),a2.fileselcounter>0||a2.dirselcounter===0);ay($(".sel-noneorone.sel-dir"+a1),a2.fileselcounter>0||a2.dirselcounter>1);ay($(".sel-noneormulti.sel-dir"+a1),a2.fileselcounter>0);ay($(".sel-none.sel-file"+a1),a2.fileselcounter!==0);ay($(".sel-one.sel-file"+a1),a2.dirselcounter>0||a2.fileselcounter!=1);ay($(".sel-multi.sel-file"+a1),a2.dirselcounter>0||a2.fileselcounter===0);ay($(".sel-noneorone.sel-file"+a1),a2.dirselcounter>0||a2.fileselcounter>1);ay($(".sel-noneormulti.sel-file"+a1),a2.dirselcounter>0)}function al(){$("#flt").on("fileListChanged",ab).on("fileListViewChanged",ab)}function A(a1){if(!a1){a1=$("#fileListTable")}if(a1&&a1.attr){a1.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function au(){var a2=$("#fileListTable");A(a2);var a1=aA();a2.attr("data-dircounter",a1.dircounter);a2.attr("data-filecounter",a1.filecounter);a2.attr("data-foldersize",a1.foldersize);a2.attr("data-sumcounter",a1.sumcounter);$("#flt").trigger("counterUpdated")}function aA(){var a2=[];a2.dircounter=$("#fileList tr.is-subdir-yes:visible").length;a2.filecounter=$("#fileList tr.is-file:visible").length;a2.sumcounter=a2.dircounter+a2.filecounter;a2.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;a2.fileselcounter=$("#fileList tr.selected.is-file:visible").length;a2.sumselcounter=a2.dirselcounter+a2.fileselcounter;var a1=0;var a3=0;$("#fileList tr:visible").each(function(a5,a6){var a4=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){a3+=a4}a1+=a4});a2.foldersize=a1;a2.folderselsize=a3;return a2}function ab(){var a3=$("#headerName");var a4=$("#fileListTable");var a2=$("#headerSize");au();if(a3.length>0&&!a3.attr("data-title")){a3.attr("data-title",a3.attr("title"))}if(a2.length>0&&!a2.attr("data-title")){a2.attr("data-title",a2.attr("title"))}if(a3.length>0){a3.attr("title",a3.attr("data-title").replace(/\$filecount/,a4.attr("data-filecounter")).replace(/\$dircount/,a4.attr("data-dircounter")).replace(/\$sum/,parseInt(a4.attr("data-dircounter"))+parseInt(a4.attr("data-filecounter"))))}var a1=parseInt(a4.attr("data-foldersize"));if(a2.length>0){a2.attr("title",a2.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(a1)))}}function aS(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var a1=history.location||document.location;an(a1.pathname)})}function G(a2,a1){try{if(!a1){if(window.history.pushState){window.history.pushState({path:a2},"",a2);an(a2)}else{an(a2)}return}}catch(a3){console.log(a3)}if(!a1){$.MyPageBlocker()}window.location.href=a2}function an(a1,a3){if(!a1){a1=$("#fileList").attr("data-uri")}if(!a1){a1=window.location.href}if(!a3){a3={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var a2=$.now();$("#flt").data("timestamp",a2);$.MyPost(a1,a3,function(a4){if($("#flt").data("timestamp")!=a2){return}$("#flt").trigger("beforeFileListChange").show().html(a4.content).attr("data-uri",a1);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+a1.replace(/\/[^\/]+\/\.\.$/,"/"));ao();J(a4)},true)}function C(a1){$("#flt").trigger("beforeFileListChange");a1.remove();$("#flt").trigger("fileListChanged")}function x(a3,a1,a4,a2){var a5=$.MyPost(a4,{srcuri:a1,action:a3,files:a2.join("@/@")},function(a6){if(a6.message&&a3=="cut"){C($("#fileList tr[data-file='"+a2.join("'],#fileList tr[data-file='")+"']"))}if(a6.error){an()}J(a6)});D(a5)}function z(a4,a6){var a1=a6.draggable.closest("tr");var a7=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var a2=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(a7==$.MyStringHelper.concatUri(a2,encodeURIComponent($.MyStringHelper.stripSlash(a1.attr("data-file"))))+"/"){return}var a5=a4.shiftKey||a4.altKey||a4.ctrlKey||a4.metaKey?"copy":"cut";var a3=a1.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(ba,a9){return $(ba).attr("data-file")}):new Array(a1.attr("data-file"));if(X("settings.confirm.dnd")!="no"){var a8=$("#paste"+a5+"confirm").html();a8=a8.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a3.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a2))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a7))).replace(/\\n/g,"<br/>");F(a8,{confirm:function(){x(a5,a2,a7,a3)},setting:"settings.confirm.dnd"})}else{x(a5,a2,a7,a3)}}function ag(a4,a5,a3){for(var a2 in a5){var a1=a5[a2];if(typeof a1==="object"){ag(a4,a1,a2)}else{if(a3){a4.append($("<input/>").prop("name",a3).prop("value",a1).prop("type","hidden"))}else{a4.append($("<input/>").prop("name",a2).prop("value",a1).prop("type","hidden"))}}}return a4}function aP(a2){var a1=$("<form/>").appendTo("body");a1.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");ag(a1,a2);a1.submit();a1.remove()}function V(a3){var a2=$(this);var a1=l(this);a1.fadeTo("slow",0.5);F(a1.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(a1.first().attr("data-file")))),{confirm:function(){if(a1.length===0){a1=a2.closest("tr")}var a4=$.MyPost($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(a1,function(a5,a6){return $(a5).attr("data-file")})},function(a5){C(a1);ad();if(a5.error){an()}J(a5)});D(a4)},cancel:function(){a1.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ad(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function U(a3,a1,a4,a2){var a5=$.MyPost(a4,{action:a3,files:a2,srcuri:a1},function(a6){if(X("clpaction")=="cut"){ai("clpfiles","clpaction","clpuri")}an();J(a6)});D(a5)}function B(a1){$.MyPreventDefault(a1);var a8=$(this);if(a8.hasClass("disabled")){return}if(a8.hasClass("delete")){V.call(this,a1)}else{if(a8.hasClass("rename")){aJ(a8.closest("tr"))}else{if(a8.hasClass("cut")||a8.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var a4=$.map(l(a8),function(bb,ba){return $(bb).attr("data-file")});X("clpfiles",a4.join("@/@"));X("clpaction",a8.hasClass("cut")?"cut":"copy");X("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(a8.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}M();ad()}else{if(a8.hasClass("paste")){var a2=X("clpfiles");var a5=X("clpaction");var a7=X("clpuri");var a6=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(X("settings.confirm.paste")!="no"){var a3=$("#paste"+a5+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(a7)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(a6)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(a2.split("@/@").join(", ")));F(a3,{confirm:function(){U(a5,a7,a6,a2)},setting:"settings.confirm.paste"})}else{U(a5,a7,a6,a2)}}else{if(a8.attr("href")!==undefined&&a8.attr("href")!="#"){window.open(a8.attr("href"),a8.attr("target")||"_self")}else{var a9=a8.closest("tr");$("body").trigger("fileActionEvent",{obj:a8,event:a1,file:a9.attr("data-file"),row:a9,selected:av(this)})}}}}}}function X(a3,a4,a1){var a2=new Date();a2.setTime(a2.getTime()+315360000000);if(a4){return Cookies.set(a3,a4,{path:$("#flt").attr("data-baseuri"),secure:true,expires:a1?a2:undefined})}return Cookies.get(a3)}function ai(){for(var a1=0;a1<arguments.length;a1++){Cookies.remove(arguments[a1],{path:$("#flt").attr("data-baseuri"),secure:true})}}function v(a3,a4,a1,a2){if(a1){X(a3,a4,a2)}else{ai(a3)}}function aa(){M();$("#flt").on("fileListChanged",M)}function M(){var a5=X("clpaction");var a1=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var a3=X("clpuri");var a4=X("clpfiles");var a2=(!a4||a4===""||a3==a1||$("#fileListTable").hasClass("iswriteable-no"));ay($(".action.paste"),a2);if(a3==a1&&a5=="cut"){$.each(a4.split("@/@"),function(a6,a7){$("[data-file='"+a7+"']").addClass("cutted").fadeTo("fast",0.5)})}}function L(){$("#nav .action").click(B).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function q(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(B).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var a1={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(a2){$("#flt").disableSelection();if(a2){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(a1,{changeEvent:function(a3){var a2=$(this);$.MyPost($("#fileList").attr("data-uri"),{mkcol:"yes",colname:a3.value},function(a4){if(!a4.error&&a4.message){ae(a3.value)}J(a4)})}}));$(".action.create-file").MyInplaceEditor($.extend(a1,{changeEvent:function(a3){var a2=$(this);$.MyPost($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:a3.value},function(a4){if(!a4.error&&a4.message){ae(a3.value)}J(a4)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(a1,{changeEvent:function(a2){var a3=l(this);$.MyPost($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:a2.value,file:a3.attr("data-file")},function(a4){if(!a4.error&&a4.message){ae(a2.value)}J(a4)})}}))}function f(){$(".action.viewfilter").click(function(a3){$.MyPreventDefault(a3);if($(this).hasClass("disabled")){return}var a1=$(this);$(".action.viewfilter").addClass("disabled");var a4=$("#fileList").attr("data-uri");var a2=a1.attr("data-template");$.MyPost(a4,{ajax:"getViewFilterDialog",template:a2},function(a5){var a6=$(a5);$("input[name='filter.size.val']",a6).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",a6).button().click(function(a8){$.MyPreventDefault(a8);v("filter.name",$("select[name='filter.name.op'] option:selected",a6).val()+" "+$("input[name='filter.name.val']",a6).val(),$("input[name='filter.name.val']",a6).val()!=="");v("filter.size",$("select[name='filter.size.op'] option:selected",a6).val()+$("input[name='filter.size.val']",a6).val()+$("select[name='filter.size.unit'] option:selected",a6).val(),$("input[name='filter.size.val']",a6).val()!=="");if($("input[name='filter.types']:checked",a6).length>0){var a7="";$("input[name='filter.types']:checked",a6).each(function(a9,ba){a7+=$(ba).val()});X("filter.types",a7)}else{ai("filter.types")}a6.dialog("close");an()});$(".filter-reset",a6).button().click(function(a7){$.MyPreventDefault(a7);ai("filter.name","filter.size","filter.types");a6.dialog("close");an()});a6.submit(function(){return false});a6.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:a1.attr("title")||a1.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");a6.remove()}}).show()})})}function D(a4,a3,a2){$("#abortdialog").remove();var a1=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",a1).button().click(function(a5){if(a4.readyState!=4){a4.abort()}a1.hide().remove();if(a2){a2.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(a4.readyState>2){return}a1.appendTo($("body")).show();var a5=window.setInterval(function(){if(a4.readyState==4){a1.hide().remove();window.clearInterval(a5)}},200);$("body").data("abortdialoginterval",a5)},a3||2500));return a1}function aK(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function o(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var a3="";var a1=$("*[accesskey]").get().sort(function(a5,a4){var a6=$(a5).attr("accesskey");var a7=$(a4).attr("accesskey");return a6<a7?-1:a6>a7?1:0});var a2=[];$.each(a1,function(a5,a4){var a6=$(a4);var a7=a6.attr("accesskey");if(!a2[a7]){a3+='<li tabindex="0" role="definition">'+a7+": "+(a6.attr("aria-label")||a6.attr("title")||a6.attr("data-tooltip")||a6.html())+"</li>";a2[a7]=true}else{console.log("found accesskey "+a7+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+a3+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function aQ(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(a3){$.MyPreventDefault(a3);var a1=$(this);if(a1.hasClass("disabled")){return}if(a1.hasClass("table-sort")){var a2=$.MyTableManager.getLastTableSort();$.MyTableManager.sortTable(a1.closest("table"),a1.data("name"),a2.name==a1.data("name")?-a2.sortorder:1)}else{if(a1.hasClass("table-sort-this-asc")){$.MyTableManager.sortTable(a1.closest("table"),a1.closest("th").data("name"),1)}else{if(a1.hasClass("table-sort-this-desc")){$.MyTableManager.sortTable(a1.closest("table"),a1.closest("th").data("name"),-1)}else{if(a1.hasClass("table-column-hide-this")){$.MyTableManager.toggleTableColumn(a1.closest("table"),a1.closest("th:not(.table-column-not-hide)").data("name"),false)}else{if(a1.hasClass("table-column")){$.MyTableManager.toggleTableColumn(a1.closest("table"),a1.data("name"))}else{if(a1.hasClass("table-column-width-default")){$.MyTableManager.setTableColumnWidth(a1.closest("th"),"default")}else{if(a1.hasClass("table-column-width-minimum")){$.MyTableManager.setTableColumnWidth(a1.closest("th"),"minimum")}}}}}}}}function aG(){$("#tc_popupmenu .action").off(".popupmenu").on("click.popupmenu",a).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();$("#flt").on("fileListChanged",function(){$("#fileListTable th[data-name].sorter-false").each(function(a3,a2){$(".action.table-sort."+$(a2).data("name")).addClass("hidden").hide()});$(".action.table-sort.fileactions").hide()});a1();function a1(){var a2=$.MyTableManager.getLastTableSort();$(".action.table-sort .symbol").removeClass("descending ascending");$(".action.table-sort."+a2.name+" .symbol").addClass(a2.sortorder==1?"descending":"ascending");$(".action.table-column .symbol").removeClass("column-hidden");$(".action.table-column").addClass("hidden disabled");$("#fileListTable th[data-name]").each(function(a4,a3){$(".action.table-column."+$(a3).data("name")).removeClass("hidden").toggleClass("disabled",$(a3).hasClass("table-column-not-hide")).find(".symbol").toggleClass("column-hidden",$(a3).is(":not(:visible)"))})}$("body").on("settingchanged",function(a2,a3){if(a3.setting=="order"||a3.setting=="visibletablecolumns"){a1()}})}function Q(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",B).on("dblclick.popupmenu",$.MyPreventDefault).MyKeyboardEventHandler();aG();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){aQ()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"});$("#tc_popupmenu li.popup").MyPopup({contextmenu:$("#tc_popupmenu"),contextmenuTarget:$("#fileListTable .fileListHead th"),contextmenuAnchor:"#content",contextmenuAnchorElement:true})});$("body").off(".popupmenu").on("click.popupmenu",function(){aQ()}).on("keydown.popupmenu",function(a1){if(a1.which==27){aQ()}});$("#filler").on("contextmenu",function(a1){if(a1.which==3){if(a1.originalEvent.detail===1){$.MyPreventDefault(a1)}aQ()}})}function ae(a1){var a2=$("#fileList");return $.MyPost($.MyStringHelper.addMissingSlash(a2.data("uri")),{ajax:"getFileListEntry",template:a2.data("entrytemplate"),file:a1},function(a3){try{var a4=$(a3);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(a1)+"']",a2);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:a4});row.replaceWith(a4)}else{a4.appendTo(a2)}ao();a4.focus()}catch(a5){an()}},true)}function aO(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(a2,a1){if(a1.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!a1.value);$("#flt").trigger("fileListViewChanged")}else{if(a1.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!a1.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",X("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",X("settings.show.dotfolders")=="no")}function aE(){var a1=X("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(a5,a4){var a3=$(this);if(a3.data("thumb")!=a3.data("icon")){var a2=a3.data("thumb");var a6=a3.data("icon");var a7=$("#emptyimage").attr("src");a3.attr("src",a1?(a2===""?a7:a2):(a6===""?a7:a6));a3.toggleClass("thumbnail",a1)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(a2,a1){if(a1.setting=="settings.enable.thumbnails"){aE()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var a1=$(this);var a2=a1.data("icon");a1.removeClass("thumbnail").attr("src",a2!==""?a2:$("#emptyimage").attr("src"))})})}function m(a2,a1){var a3=$.MyGet(window.location.pathname,a2,function(a4){J(a4);a1(a4)});D(a3)}function aq(a2,a1){var a3=$.MyPost(window.location.pathname,a2,function(a4){J(a4);a1(a4)});D(a3)}function W(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:$.MyPageBlocker,changeUri:G,concatUri:$.MyStringHelper.concatUri,confirmDialog:F,cookie:X,fixElementPosition:T,getDialog:m,getDialogByPost:aq,getSelectedFiles:av,getSelectedRows:l,handleJSONResponse:J,handleWindowResize:r,hidePopupMenu:aQ,initFileList:ao,initPopupMenu:Q,initTabs:Z,initUpload:ah,notify:aF,notifyError:aT,notifyInfo:b,notifyWarn:aN,preventDefault:$.MyPreventDefault,preventDefaultImmediatly:$.MyPreventDefaultImmediatly,postAction:aP,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:ae,removeAbortDialog:aK,renderAbortDialog:D,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:ai,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:v,toggleRowSelection:aX,uncheckSelectedRows:ad,updateFileList:an}}function af(){$.fn.MyTooltip.defaults.helphandler=ax;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){ax.call(this,$(this).data("help"))})}function ax(a2){var a1=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:a2,width:"99%",height:"99%"}).text(a2)).dialog({width:a1.width()/2,height:a1.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
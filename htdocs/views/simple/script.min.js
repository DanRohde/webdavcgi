var ToolBox={};$(function(){a1();U();ax();L();g();af();ar();r();P();aL();V();az();aA();a3();f();e();A();H();aH();o();O();ad();at();d();aP();aV();c();aK();aZ();a2();ae();aa();ak();$.ajaxSetup({traditional:true});$(document).ajaxError(function(ba,bb,a9,a8){console.log(ba);console.log(bb);console.log(a9);console.log(a8);if(bb&&bb.statusText&&bb.statusText!="abort"){a0(bb.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(a8,ba,a9){a8.cache=true});au($("#flt").attr("data-uri"));function ae(a8){if(!a8){a8=$(document)}$(".tabsel",a8).on("click keyup",function(bb){if(bb.type=="keyup"&&bb.keyCode!=32&&bb.keyCode!=13){return}C(bb);var a9=$(this);$(".tabsel.activetabsel",a8).removeClass("activetabsel");a9.addClass("activetabsel");$(".tab.showtab",a8).removeClass("showtab");var ba=$(".tab."+a9.data("group"),a8).addClass("showtab");$(":focusable:visible:first",ba).focus()})}function a2(){if(!ac("settings.show.statusbar")){ac("settings.show.statusbar","no");ac("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",ac("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(a9){$(this).prop("checked",true);C(a9)});function a8(){var ba=$("#fileListTable");var a9=$("#statusbar");$(".filecount",a9).html(ba.attr("data-filecounter"));$(".dircount",a9).html(ba.attr("data-dircounter"));$(".sum",a9).html(ba.attr("data-sumcounter"));$(".foldersize",a9).attr("title",$.MyStringHelper.renderByteSizes(ba.data("foldersize"))).html($.MyStringHelper.renderByteSize(ba.data("foldersize")));$(".selfilecount",a9).html(ba.attr("data-fileselcounter"));$(".seldircount",a9).html(ba.attr("data-dirselcounter"));$(".selsum",a9).html(ba.attr("data-sumselcounter"));$(".selfoldersize",a9).attr("title",$.MyStringHelper.renderByteSizes(ba.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(ba.attr("data-folderselsize")));$(".selected-files-stats",a9).toggle(ba.attr("data-fileselcounter")!==0||ba.attr("data-dirselcounter")!==0)}a8();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",a8);$("body").on("notify",function(a9,ba){$("#statusbar .notify").attr("title",ba.msg).removeClass("error message warning").addClass(ba.type).html(ba.msg).MyTooltip()});$("body").on("settingchanged",function(a9,ba){if(ba.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",ba.value)}});$("#statusbar").MyTooltip()}function aK(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aP(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(ba){var a9=this.tabIndex||1;var a8=$(this);if(a8.is(":focus")){if(ba.keyCode==32){T.call(this,ba)}else{if(ba.keyCode==13){J($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash(a8.attr("data-file")))),a8.attr("data-type")=="file")}else{if(ba.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(R(a8)){M(a8)}}else{Z()}}else{if(ba.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(ba.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(ba.keyCode==45){$(".paste").trigger("click")}}}}}}}if(ba.keyCode==38&&a9>-1){C(ba);if(R(a8)&&(ba.shiftKey||ba.altKey||ba.ctrlKey||ba.metaKey)){a4(a8,true);$("#flt").trigger("fileListSelChanged")}a8.prevAll(":focusable:first").focus();ah()}else{if(ba.keyCode==40){C(ba);if(R(a8)&&(ba.shiftKey||ba.altKey||ba.ctrlKey||ba.metaKey)){a4(a8,true);$("#flt").trigger("fileListSelChanged")}a8.nextAll(":focusable:first").focus();ah()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",p);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function d(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(ba){C(ba);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var a9=$("#flt").data("TableConfigDialog");if(a9){i($(a9))}else{if($("#tableconfigdialogtemplate").length>0){var a8=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",a8);i($(a8))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(bb){if(bb.error){N(bb)}$("#flt").data("TableConfigDialog",bb);i($(bb))})}}}).MyKeyboardEventHandler()})}function i(a9){var bb=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(be,bd){return $(be).attr("data-name")});$.each(bb,function(bd,be){a9.find("input[name='visiblecolumn'][value='"+be+"']").prop("checked",true)});a9.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bd){C(bd)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bd,be){a9.find("input[name='sortingcolumn'][value='"+$(be).attr("data-name")+"']").prop("disabled",true).click(function(bf){C(bf)}).closest("li").addClass("disabled")});var bc=ac("order")?ac("order").split("_"):"name_asc".split("_");var ba=bc[0];var a8=bc[1]||"asc";a9.find("input[name='sortingcolumn'][value='"+ba+"']").prop("checked",true);a9.find("input[name='sortingorder'][value='"+a8+"']").prop("checked",true);a9.find("input[value='fileactions']").closest("li").hide();a9.find("input[name='save']").button().click(function(be){var bj=bb.slice(0);var bm=$.map($("input[name='visiblecolumn']:checked"),function(bo,bn){return $(bo).attr("value")});var bl=[];for(var bh=bj.length-1;bh>=0;bh--){if($.inArray(bj[bh],bm)==-1){bl.push(bj[bh]);bj.splice(bh,1)}}var bf=[];$.each(bm,function(bn,bo){if($.inArray(bo,bj)==-1){bf.push(bo);bj.push(bo)}});ac("visibletablecolumns",bj.join(","),1);var bk=a9.find("input[name='sortingcolumn']:checked").attr("value");var bg=a9.find("input[name='sortingorder']:checked").attr("value");ac("order",bk+(bg=="desc"?"_desc":""),1);if(bm.sort().join(",")!=bb.sort().join(",")){$.each(bf,function(bo,bp){var bn=$("#fileListTable th[data-name='"+bp+"']").removeClass("hidden").prop("cellIndex");$("#fileList tr").each(function(br,bq){$("td",$(bq)).eq(bn).show()})});$.each(bl,function(bo,bp){var bn=$("#fileListTable th[data-name='"+bp+"']").addClass("hidden").prop("cellIndex");$("#fileList tr").each(function(br,bq){$("td",$(bq)).eq(bn).hide()})})}else{if(bk!=ba||bg!=a8){var bd=$("#fileListTable th[data-name='"+bk+"']");var bi=bg=="desc"?-1:1;j(bd.prop("cellIndex"),bi);if(bd.length>0){s(bd.attr("data-sorttype")||"string",bd.attr("data-sort"),bi,bd.prop("cellIndex"),"data-file")}}}a9.dialog("close")});a9.find("input[name='cancel']").button().click(function(bd){C(bd);a9.dialog("close");return false});a9.find("#tableconfigform").submit(function(bd){return false});a9.dialog({modal:true,width:"auto",title:a9.attr("data-title")||a9.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");a9.dialog("destroy")}})}function aO(a8){if(a8){C(a8)}var ba=$(this).hasClass("collapsed");var a9=$(this).hasClass("iconsonly");if(!ba&&!a9){a9=true}else{if(a9){a9=false;ba=true}else{ba=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ba).toggleClass("sidebar-iconsonly",a9);$(".action.collapse-sidebar").toggleClass("collapsed",ba).toggleClass("iconsonly",a9);if(!a9&&!ba){an("sidebar")}else{ac("sidebar",a9?"iconsonly":ba?"false":"true")}t()}function at(){$(".action.collapse-sidebar").click(aO).MyKeyboardEventHandler().MyTooltip();if(ac("sidebar")&&ac("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ac("sidebar")=="false").toggleClass("sidebar-iconsonly",ac("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",ac("sidebar")=="false").toggleClass("iconsonly",ac("sidebar")=="iconsonly");t()}$(".action.collapse-head").click(function(a8){C(a8);$(".action.collapse-head").toggleClass("collapsed");var a9=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!a9);$(".collapse-head-listener").toggleClass("head-collapsed",a9);x("head","false",a9,1);t()}).MyTooltip().MyKeyboardEventHandler();if(ac("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function ad(){$(".action.autorefreshmenu").dblclick(function(a8){C(a8);au()});aG($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aG($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aG($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(ac("autorefresh")!==""&&parseInt(ac("autorefresh"))>0){aS(parseInt(ac("autorefresh")))}});$(".action.setautorefresh").click(function(a8){C(a8);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){au();return}ac("autorefresh",$(this).attr("data-value"));aS(parseInt($(this).attr("data-value")))}).on("keyup",function(a8){if(a8.keyCode==32||a8.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(a8){C(a8);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));an("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(a8){if(a8.keyCode==32||a8.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(a9){C(a9);if($(this).hasClass("disabled")){return}var a8=$("#autorefresh");if(a8.data("timer")!=null){window.clearInterval(a8.data("timer"));a8.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{aS(a8.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(a8){if(a8.keyCode==32||a8.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(a9,a8){ac("autorefreshtimerpos",JSON.stringify(X("#autorefreshtimer",a8.offset)))}});if(ac("autorefreshtimerpos")){X("#autorefreshtimer",JSON.parse(ac("autorefreshtimerpos")))}}function X(bc,a8){var bb=$(bc);var a9=$(window);var ba={left:Math.min(Math.max(a8.left,0),a9.width()-bb.outerWidth()+a9.scrollLeft()),top:Math.min(Math.max(a8.top,0),a9.height()-bb.outerHeight()+a9.scrollTop())};bb.offset(ba);return ba}function W(a8){var ba=$(".autorefreshtimer");var bb=ba.attr("data-template")||"%sm %ss";var a9=Math.floor(a8/60);var bc=a8%60;if(bc<10){bc="0"+bc}ba.html(bb.replace("%s",a9).replace("%s",bc))}function aS(a9){var a8=$("#autorefresh");if(a8.data("timer")!=null){window.clearInterval(a8.data("timer"))}a8.data("timeout",a9);W(a9);a8.data("timer",window.setInterval(function(){var ba=a8.data("timeout")-1;W(ba);a8.data("timeout",ba);if(ba<0){window.clearInterval(a8.data("timer"));a8.data("timer",null);W(0);a8.trigger("stopped");au()}},1000));a8.trigger("started")}function O(){var a8=$("#settings");a8.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",a8).each(function(ba,a9){$(a9).prop("checked",ac($(a9).prop("name"))!="no").click(function(bb){if(ac($(this).prop("name")+".keep")){ac($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{x($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",a8).change(function(){if($(this).prop("name")=="settings.lang"){ac($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{ac($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(bb,a9){var bc=$(a9);var ba=bc.prop("name");if(ba=="settings.lang"){ba=ba.replace(/^settings\./,"")}$("option[value='"+ac(ba)+"']",bc).prop("selected",true)})}})}function a1(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(a8){if(a8.keyCode==13||a8.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(a8){C(a8);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function o(){$("#flt").on("fileListChanged",t).on("fileListViewChanged",t);$(window).resize(t);t()}function t(){var a8=$(window).width()-$("#nav").width();$("#content").width(a8);$("#controls").width(a8);$("body").trigger("windowResized")}function H(){$(".action.changeuri").off(".changeuri").on("click.changeuri",a7);$(".action.refresh").off(".refresh").on("click.refresh",function(a8){C(a8);au();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",a7);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var a8=$(this);if(!a8.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=a8.data("href")?a8.data("href"):a8.attr("href")}})})}function a7(a8){C(a8);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){J($(this).data("href")||$(this).attr("href"))}return false}function A(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(a8){$("#fileList tr:not(:hidden).unselectable-no").each(function(a9,ba){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(a8){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(a8){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function e(){$("#clock").MyClock()}function ax(){$("#flt").on("bookmarksChanged",q).on("bookmarksChanged",w).on("fileListChanged",function(){q();w()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aJ)}function aG(a8,a9){$.each(a8,function(bc,bb){var ba=$(bb);if(ba.hasClass("hideit")){ba.toggle(!a9)}if(ba.hasClass("button")){ba.button("option","disabled",a9)}if(!ba.hasClass("notab")){ba.attr("tabindex",a9?-1:0)}ba.toggleClass("disabled",a9)})}function w(){var bc=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");var a8=false;var bb=0;var ba=0;while(ac("bookmark"+ba)!=null){if(ac("bookmark"+ba)==bc){a8=true}if(ac("bookmark"+ba)!="-"){bb++}ba++}$(".action.addbookmark").button("option","disabled",a8);aG($(".action.rmbookmark"),!a8);aG($(".action.bookmarksortpath"),bb<2);aG($(".action.bookmarksorttime"),bb<2);aG($(".action.rmallbookmarks"),bb===0);var a9=ac("bookmarksort")==null?"time-desc":ac("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(a9=="path"||a9=="path-desc"||a9=="time"||a9=="time-desc"){$("#bookmarks .action.bookmarksort"+a9.replace(/-desc/,"")+" ."+a9).show()}}function q(){var bd=$.MyStringHelper.concatUri($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(be,bf){$(bf).remove()});var bc=[];var ba=0;while(ac("bookmark"+ba)!=null){if(ac("bookmark"+ba)!="-"){bc.push({path:ac("bookmark"+ba),time:parseInt(ac("bookmark"+ba+"time"))})}ba++}var bb=ac("bookmarksort")?ac("bookmarksort"):"time-desc";var a8=1;if(bb.indexOf("-desc")>0){a8=-1;bb=bb.replace(/-desc/,"")}bc.sort(function(bf,be){if(bb=="path"){return a8*bf[bb].localeCompare(be[bb])}else{return a8*(be[bb]-bf[bb])}});var a9=$("#bookmarktemplate").html();$.each(bc,function(be,bg){var bf=unescape(bg.path);$("<li>"+a9.replace(/\$bookmarkpath/g,bg.path).replace(/\$bookmarktext/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape($.MyStringHelper.trimString(bf,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aJ).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",bg.path).attr("title",$.MyStringHelper.simpleEscape(bf)+" ("+(new Date(parseInt(bg.time)))+")").attr("tabindex",bg.path==bd?-1:0).toggleClass("disabled",bg.path==bd).find(".action.rmsinglebookmark").click(aJ).MyKeyboardEventHandler()})}function k(a9){var a8=0;while(ac("bookmark"+a8)!=null&&ac("bookmark"+a8)!=a9){a8++}if(ac("bookmark"+a8)==a9){ac("bookmark"+a8,"-",1)}$("#flt").trigger("bookmarksChanged")}function aJ(bb){C(bb);if($(this).hasClass("disabled")){return}var a8=$(this);var ba=$("#fileList").attr("data-uri");if(a8.hasClass("addbookmark")){var a9=0;while(ac("bookmark"+a9)!=null&&ac("bookmark"+a9)!="-"&&ac("bookmark"+a9)!=""&&ac("bookmark"+a9)!=ba){a9++}ac("bookmark"+a9,ba,1);ac("bookmark"+a9+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(a8.hasClass("dyn-bookmark")){J(a8.attr("data-bookmark"));a8.closest("ul").hide()}else{if(a8.hasClass("rmbookmark")){k(ba)}else{if(a8.hasClass("rmallbookmarks")){var a9=0;while(ac("bookmark"+a9)!=null){an("bookmark"+a9,"bookmark"+a9+"time");a9++}$("#flt").trigger("bookmarksChanged")}else{if(a8.hasClass("rmsinglebookmark")){k($(this).attr("data-bookmark"))}else{if(a8.hasClass("bookmarksortpath")){ac("bookmarksort",ac("bookmarksort")=="path"||ac("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(a8.hasClass("bookmarksorttime")){ac("bookmarksort",ac("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aA(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",ao).on("fileListViewChanged",ao)}function ao(){var ba=$("#selstats");var a8=ba.data("selstats");var a9=aI();$("#fileListTable").attr("data-fileselcounter",a9.fileselcounter).attr("data-dirselcounter",a9.dirselcounter).attr("data-folderselsize",a9.folderselsize).attr("data-sumselcounter",a9.sumselcounter);$("#flt").trigger("selectionCounterUpdated");ba.html(a8.replace(/\$filecount/g,a9.fileselcounter).replace(/\$dircount/g,a9.dirselcounter).replace(/\$sum/g,a9.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(a9.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(a9.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(a9.folderselsize)).MyTooltip()}function aL(){$("#pathinputform").submit(function(a8){return false});$("#pathinputform input[name='uri']").keydown(function(a8){if(a8.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(a8.keyCode==13){C(a8);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();J($(this).val())}}});$(".action.changedir").button().click(function(a8){C(a8);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(a8){C(a8);$("#pathinput").hide();$("#quicknav").show();J($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function V(){$("form#filterbox").submit(function(a8){return false});$("form#filterbox input").keyup(y).change(y).autocomplete({minLength:1,select:y,close:y});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(a8){C(a8);$("form#filterbox input").val("");y();$(this).addClass("invisible")});$("#flt").on("fileListChanged",y).on("fileListChanged",function(){var a8=$.map($("#fileList tr"),function(ba,a9){return $(ba).attr("data-file")});$("form#filterbox input").autocomplete({source:function(ba,a9){try{var bc=new RegExp(ba.term);a9($.grep(a8,function(bd){return bc.test(bd)}))}catch(bb){a9($.grep(a8,function(bd){return bd.indexOf(ba.term)>-1}))}}})})}function y(){var a8=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var ba=new RegExp(a8,"i");if(a8===""||$(this).attr("data-file").match(ba)){$(this).show()}else{$(this).hide()}}catch(a9){if(a8===""||$(this).attr("data-file").toLowerCase().indexOf(a8.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function v(a9,ba){if(!ba){ba=a9}var a8=ba.loaded/ba.total*100;$("#progress .bar").css("width",a8.toFixed(2)+"%").html(parseInt(a8)+"% ("+$.MyStringHelper.renderByteSize(ba.loaded)+"/"+$.MyStringHelper.renderByteSize(ba.total)+"); "+a9.done+"/"+a9.uploads)}function am(ba,bc,a9,bb){$("#flt").on("fileListChanged",function(){ba.fileupload("option","url",$("#fileList").attr("data-uri"))});var a8={aborted:false,transports:[],done:0,failed:0,uploads:0};ba.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:bb,singleFileUploads:true,autoUpload:false,add:function(bg,bf){if(!a8.aborted){var bh=bf.submit();var be=bf.files[0].name;a8.transports.push(bh);var bd=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+be).addClass("fileprogress");$("<div></div>").click(function(bi){C(bi);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bd).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:be,transport:bh});$("<div></div>").appendTo(bd).addClass("fileprogressbar running").html(bf.files[0].name+" ("+$.MyStringHelper.renderByteSize(bf.files[0].size)+"): 0%");a8.uploads++;return true}return false},done:function(be,bd){$("#progress [id='fpb"+bd.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bd.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bd.result.message?"done":"failed").css("width","100%").html(bd.result&&bd.result.error?bd.result.error:bd.result.message?bd.result.message:bd.files[0].name);if(bd.result.message){a8.done++}else{a8.failed++}v(a8)},fail:function(be,bd){$("#progress [id='fpb"+bd.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bd.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bd.textStatus+": "+$.map(bd.files,function(bf,bg){return bf.name}).join(", "));a8.failed++;v(a8);console.log(bd)},stop:function(be,bd){v(a8);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){au()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(be,bd){a8.transports=[];a8.aborted=false;a8.files=[];a8.uploads=0;a8.failed=0;a8.done=0;return true},start:function(bf,be){var bd=[];bd.push({text:$("#close").html(),disabled:true});bd.push({text:$("#cancel").html(),click:function(){if(a8.aborted){return}a8.aborted=true;$.each(a8.transports,function(bg,bh){if(bh&&bh.abort){bh.abort($("#uploadaborted").html())}});a8.transports=[]}});$("#progress").dialog({modal:true,title:a9,height:370,width:500,buttons:bd,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(bf,be){var bd=parseInt(be.loaded/be.total*100)+"%";$("div[id='fpb"+be.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bd).html(be.files[0].name+" ("+$.MyStringHelper.renderByteSize(be.files[0].size)+"): "+bd)},progressall:function(be,bd){a8.total=bd.total;a8.loaded=bd.loaded;v(a8,bd)},submit:function(be,bd){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",ac("settings.confirm.upload")=="no"||!S(bd)||window.confirm(bc))}$("#file-upload-form-relapath").val(bd.files[0].relativePath||(bd.files[0].webkitRelativePath&&bd.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function S(a9){for(var a8=0;a8<a9.files.length;a8++){var ba;if(a9.files[a8].relativePath&&a9.files[a8].relativePath!=""){ba=a9.files[a8].relativePath.split(/[\\\/]/)[0]+"/"}else{if(a9.files[a8].webkitRelativePath&&a9.files[a8].webkitRelativePath!=""){ba=a9.files[a8].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(ba&&$("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(ba)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+$.MyStringHelper.simpleEscape(a9.files[a8].name)+"']").length>0){return true}}}return false}function az(){am($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(a8){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(a8){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(a8){$("#fileList").addClass("draghover")}).on("dragleave",function(a8){$("#fileList").removeClass("draghover")}).on("drop",function(a8){$("#fileList").removeClass("hover")})}function I(ba,a8){var a9;if(a8.setting){ba+='<div class="confirmdialogsetting"><input type="checkbox" name="'+a8.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";a9=ac(a8.setting)}$("#confirmdialog").html(ba).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(a8.setting){x(a8.setting,a9,a9&&a9!=="",1)}$("#confirmdialog").dialog("close");if(a8.cancel){a8.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(a8.confirm){a8.confirm()}}}],open:function(){if(a8.setting){$("input[name='"+a8.setting+"']",$(this)).click(function(bb){x(a8.setting,"no",!$(this).is(":checked"),1)}).prop("checked",ac(a8.setting)!="no")}},close:function(){if(a8.cancel){a8.cancel()}}}).show()}function a5(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function m(a9){var a8=$("#fileList tr.selected:visible");if(a8.length==0){a8=$(a9).closest("tr[data-file]")}if(a8.length==0){a8=$("#fileList tr:visible:focus")}return a8}function aC(a8){return $.map(m(a8),function(a9,ba){return $(a9).attr("data-file")})}function aT(a9){C(a9);var a8=$(this);if(a8.hasClass("disabled")){return}var ba=a8.closest("tr");if(a8.hasClass("rename")){aQ(ba)}else{if(a8.hasClass("delete")){M(ba)}else{$("body").trigger("fileActionEvent",{obj:a8,event:a9,file:ba.attr("data-file"),selected:[ba.data("file")],row:ba})}}}function g(){$("#fileactions").on("click dblclick",function(a8){C(a8);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",aT).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",aq).on("mouseleave.fileAction",l)}).on("beforeFileListChange replaceRow",l);h();$("body").on("settingchanged",h)}function h(a8,a9){$("#fileactions").toggleClass("hidefileactions",ac("settings.show.fileactions")=="no").toggleClass("hidelabels",ac("settings.show.fileactionlabels")=="no").toggleClass("showalways",ac("settings.show.fileactionalways")=="no")}function aq(a9){var a8=$(this);if($("#fileactions",a8).length===0){$(".action.changeuri.filename",a8).after($("#fileactions"))}}function l(a8){$("#fileactions").appendTo($(".template"))}function aH(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(ba,a9){var a8=$(a9);if(!a8.attr("href")){a8.data("fancybox-href",a8.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(a8){return(a8.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(ba,a9){var a8=$(a9);if(!a8.attr("href")){a8.data("fancybox-href",a8.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function av(){var a9=$("#fileListTable");var a8=$("#fileList");ab();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",T).off("dblclick.initFileList").on("dblclick.initFileList",function(ba){J($.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:B,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:a5,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(bb){var ba=$(bb.currentTarget);return $(bb.currentTarget).clone().width(ba.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:K,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bd,ba){var bb=$(ba);$("<div/>").prependTo(bb).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(bb).html("&nbsp;").addClass("columnResizeHandle right");bb.data("origWidth",bb.width());var be=ac(bb.prop("id")+".width");if(be){bb.width(parseFloat(be))}var bc=0;$(ba).on("click.initFileList",function(bg){var bf=$(this);bc++;if(bc==1){window.setTimeout(function(){if(bc==1){if(!bf.hasClass("sorter-false")){aF.call(bf,bg)}}else{var bh=bf.width()==bf.data("origWidth")?1:bf.data("origWidth");bf.width(bh);x(bf.prop("id")+".width",bh,bh!=bf.data("origWidth"),1)}bc=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(ba,bb){startPos=parseInt(bb.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(ba,bb){$(this).removeAttr("style");ac(column.attr("id")+".width",column.width(),1)},drag:function(ba,bb){if(handlePos=="right"){column.width(startWidth+bb.offset.left-startPos)}else{column.width(startWidth+startPos-bb.offset.left)}}});ah();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function ah(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var a8=window.getSelection();if(a8&&a8.removeAllRanges){a8.removeAllRanges()}}}}function K(a9,ba){var bc=ba.draggable.prop("cellIndex");var a8=$(this).prop("cellIndex");if(bc+1==a8){return false}var bb=$("#fileListTable thead th");bb.eq(bc).detach().insertBefore(bb.eq(a8));$.each($("#fileList tr"),function(){var bd=$(this).children("td");bd.eq(bc).detach().insertBefore(bd.eq(a8))});ac("visibletablecolumns",$.map($("#fileListTable thead th[data-name]:not(.hidden):not(:last)"),function(bd){return $(bd).attr("data-name")}).join(","),1);return true}function ab(){if(ac("order")){var be=ac("order").split("_");var a9=be[0];var ba=be[1]&&be[1]=="desc"?-1:1;var bc=$("#fileListTable thead th[data-name='"+a9+"']:not(.sorter-false)");if(bc.length>0){var bd=bc.attr("data-sort");var bb=bc.attr("data-sorttype")||"string";var a8=bc.prop("cellIndex");j(a8,ba);s(bb,bd,ba,a8,"data-file")}}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aF)}function aF(bb){var be=$("#fileListTable");var bc=be.data("tablesorter-lastclickedcolumn");var a9=be.data("tablesorter-sortorder");var ba=$(this).attr("data-sorttype")||"string";var bd=$(this).attr("data-sort");var a8=$(this).prop("cellIndex");if(!a9){a9=-1}if(bc==a8){a9=-a9}ac("order",$(this).attr("data-name")+(a9==-1?"_desc":""),1);j(a8,a9);s(ba,bd,a9,a8,"data-file")}function j(a8,a9){var ba=$("#fileListTable");ba.data("tablesorter-lastclickedcolumn",a8);ba.data("tablesorter-sortorder",a9);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(a8).addClass(a9==1?"tablesorter-up":"tablesorter-down")}function s(ba,bc,a9,a8,bb){$("#fileListTable tbody").MyFileTableSorter(ba,bc,a9,a8,bb)}function M(a8){a8.fadeTo("slow",0.5);I($("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(a8.attr("data-displayname")))),{confirm:function(){var a9=a8.attr("data-file");F(a8);var bb=ap();var ba=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:a9},function(bc){bb.remove();if(bc.error){au()}N(bc)});G(ba)},cancel:function(){a8.fadeTo("fast",1)}})}function N(a8){if(a8.error){a0(a8.error)}if(a8.warn){aU(a8.warn)}if(a8.message){b(a8.message)}if(a8.quicknav){$("#quicknav").html(a8.quicknav).MyTooltip();$("#quicknav a").click(function(a9){C(a9);J($(this).attr("href"))})}}function u(bc,a9,a8){var bb=ap();var ba=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:a8,file:a9},function(bd){if(bd.message){var be=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:a8,template:$("#fileList").attr("data-entrytemplate")},function(bf){try{var bg=$(bf);var bi=$("tr[data-file='"+a8+"']");if(bi.length>0){bi.remove()}$("#flt").trigger("replaceRow",{row:bc,newrow:bg});bc.replaceWith(bg);bc=bg;av();bg.focus()}catch(bh){au()}bb.remove()});G(be)}else{bb.remove()}N(bd)});G(ba)}function aQ(ba){var a9=ba.closest("tr[data-file]").data("file");var a8=a9.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:ba.find("td.filename"),defaultValue:a8,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(bc){var bb=bc.value.replace(/\//g,"");if(bb==a8){return}if(ac("settings.confirm.rename")!="no"){I($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(a9)).replace(/%s/,$.MyStringHelper.quoteWhiteSpaces(bb)),{confirm:function(){u(ba,a9,bb)},setting:"settings.confirm.rename"})}else{u(ba,a9,bb)}}})}function aN(a8,a9){console.log("notify["+a8+"]: "+a9);if(ac("settings.messages."+a8)=="no"){return}noty({text:a9,type:a8,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:a8,msg:a9})}function a0(a8){aN("error",a8)}function b(a8){aN("message",a8)}function aU(a8){aN("warning",a8)}function a4(a9,a8){if(!a9){return}a9.toggleClass("selected",a8);a9.find(".selectbutton").prop("checked",a9.hasClass("selected"))}function R(a8){return a8.attr("data-file")!=".."&&!a8.hasClass("unselectable-yes")}function T(ba){var be=$("#fileListTable");if(R($(this))){var bd=this.rowIndex;var a8=bd;if((ba.shiftKey||ba.metaKey||ba.altKey)&&be.data("lastSelectedRowIndex")){a8=be.data("lastSelectedRowIndex");if(a8<bd){var bc=a8;a8=bd;bd=bc}for(var a9=bd+1;a9<a8;a9++){var bb=$("#fileList tr:visible").filter(function(){return this.rowIndex==a9});if(bb.length===0){continue}a4(bb);bb=bb.next()}}a4($(this));be.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function a3(){$(".dialog.action").click(aD)}function aD(a9){C(a9);if($(this).hasClass("disabled")){return}var a8=$(this);a8.addClass("disabled");var ba=$("#"+a8.attr("data-action"));if(ba.attr("title")){ba.data("title",ba.attr("title"))}ba.attr("title",ba.data("title"));ba.dialog({modal:true,width:"auto",open:function(){if(ba.data("initHandler")){ba.data("initHandler").init()}},close:function(){a8.removeClass("disabled")},dialogClass:a8.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function L(){a6();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",aY).on("fileListViewChanged",aY)}function a6(){aG($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function aY(){var a9=aI();var ba=$("#fileListTable");var a8=ba.hasClass("iswriteable-no")?":not(.access-writeable)":"";a8+=ba.hasClass("isreadable-no")?":not(.access-readable)":"";a8+=ba.hasClass("unselectable-no")?":not(.access-selectable)":"";aG($(".access-writeable"),ba.hasClass("iswriteable-no"));aG($(".access-readable"),ba.hasClass("isreadable-no"));aG($(".access-selectable"),ba.hasClass("unselectable-yes"));aG($(".sel-none"+a8),a9.sumselcounter!==0);aG($(".sel-one"+a8),a9.sumselcounter!=1);aG($(".sel-multi"+a8),a9.sumselcounter===0);aG($(".sel-noneorone"+a8),a9.sumselcounter>1);aG($(".sel-none.sel-dir"+a8),a9.fileselcounter!==0);aG($(".sel-one.sel-dir"+a8),a9.fileselcounter>0||a9.dirselcounter!=1);aG($(".sel-multi.sel-dir"+a8),a9.fileselcounter>0||a9.dirselcounter===0);aG($(".sel-noneorone.sel-dir"+a8),a9.fileselcounter>0||a9.dirselcounter>1);aG($(".sel-noneormulti.sel-dir"+a8),a9.fileselcounter>0);aG($(".sel-none.sel-file"+a8),a9.fileselcounter!==0);aG($(".sel-one.sel-file"+a8),a9.dirselcounter>0||a9.fileselcounter!=1);aG($(".sel-multi.sel-file"+a8),a9.dirselcounter>0||a9.fileselcounter===0);aG($(".sel-noneorone.sel-file"+a8),a9.dirselcounter>0||a9.fileselcounter>1);aG($(".sel-noneormulti.sel-file"+a8),a9.dirselcounter>0)}function ar(){$("#flt").on("fileListChanged",ag).on("fileListViewChanged",ag)}function D(a8){if(!a8){a8=$("#fileListTable")}if(a8&&a8.attr){a8.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aB(){var a9=$("#fileListTable");D(a9);var a8=aI();a9.attr("data-dircounter",a8.dircounter);a9.attr("data-filecounter",a8.filecounter);a9.attr("data-foldersize",a8.foldersize);a9.attr("data-sumcounter",a8.sumcounter);$("#flt").trigger("counterUpdated")}function aI(){var a9=[];a9.dircounter=$("#fileList tr.is-subdir-yes:visible").length;a9.filecounter=$("#fileList tr.is-file:visible").length;a9.sumcounter=a9.dircounter+a9.filecounter;a9.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;a9.fileselcounter=$("#fileList tr.selected.is-file:visible").length;a9.sumselcounter=a9.dirselcounter+a9.fileselcounter;var a8=0;var ba=0;$("#fileList tr:visible").each(function(bc,bd){var bb=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){ba+=bb}a8+=bb});a9.foldersize=a8;a9.folderselsize=ba;return a9}function ag(){var ba=$("#headerName");var bb=$("#fileListTable");var a9=$("#headerSize");aB();if(ba.length>0&&!ba.attr("data-title")){ba.attr("data-title",ba.attr("title"))}if(a9.length>0&&!a9.attr("data-title")){a9.attr("data-title",a9.attr("title"))}if(ba.length>0){ba.attr("title",ba.attr("data-title").replace(/\$filecount/,bb.attr("data-filecounter")).replace(/\$dircount/,bb.attr("data-dircounter")).replace(/\$sum/,parseInt(bb.attr("data-dircounter"))+parseInt(bb.attr("data-filecounter"))))}var a8=parseInt(bb.attr("data-foldersize"));if(a9.length>0){a9.attr("title",a9.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(a8)))}}function aZ(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var a8=history.location||document.location;au(a8.pathname)})}function J(a9,a8){try{if(!a8){if(window.history.pushState){window.history.pushState({path:a9},"",a9);au(a9)}else{au(a9)}return}}catch(ba){console.log(ba)}if(!a8){ap()}window.location.href=a9}function au(a8,ba){if(!a8){a8=$("#fileList").attr("data-uri")}if(!a8){a8=window.location.href}if(!ba){ba={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var a9=$.now();$("#flt").data("timestamp",a9);$.get(a8,ba,function(bb){if($("#flt").data("timestamp")!=a9){return}$("#flt").trigger("beforeFileListChange").show().html(bb.content).attr("data-uri",a8);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+a8.replace(/\/[^\/]+\/\.\.$/,"/"));av();N(bb)})}function F(a8){$("#flt").trigger("beforeFileListChange");a8.remove();$("#flt").trigger("fileListChanged")}function z(ba,a8,bb,a9){var bd=ap();var bc=$.post(bb,{srcuri:a8,action:ba,files:a9.join("@/@")},function(be){if(be.message&&ba=="cut"){F($("#fileList tr[data-file='"+a9.join("'],#fileList tr[data-file='")+"']"))}bd.remove();if(be.error){au()}N(be)});G(bc)}function B(bb,bd){var a8=bd.draggable.closest("tr");var be=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),encodeURIComponent($.MyStringHelper.stripSlash($(this).attr("data-file")))+"/");var a9=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(be==$.MyStringHelper.concatUri(a9,encodeURIComponent($.MyStringHelper.stripSlash(a8.attr("data-file"))))+"/"){return}var bc=bb.shiftKey||bb.altKey||bb.ctrlKey||bb.metaKey?"copy":"cut";var ba=a8.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bh,bg){return $(bh).attr("data-file")}):new Array(a8.attr("data-file"));if(ac("settings.confirm.dnd")!="no"){var bf=$("#paste"+bc+"confirm").html();bf=bf.replace(/%files%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(ba.join(", ")))).replace(/%srcuri%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(a9))).replace(/%dsturi%/g,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.uri2html(be))).replace(/\\n/g,"<br/>");I(bf,{confirm:function(){z(bc,a9,be,ba)},setting:"settings.confirm.dnd"})}else{z(bc,a9,be,ba)}}function ap(){return $("<div></div>").prependTo("body").addClass("overlay")}function al(bb,bc,ba){for(var a9 in bc){var a8=bc[a9];if(typeof a8==="object"){al(bb,a8,a9)}else{if(ba){bb.append($("<input/>").prop("name",ba).prop("value",a8).prop("type","hidden"))}else{bb.append($("<input/>").prop("name",a9).prop("value",a8).prop("type","hidden"))}}}return bb}function aW(a9){var a8=$("<form/>").appendTo("body");a8.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");al(a8,a9);a8.submit();a8.remove()}function Z(ba){var a9=$(this);var a8=m(this);a8.fadeTo("slow",0.5);I(a8.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,$.MyStringHelper.quoteWhiteSpaces($.MyStringHelper.simpleEscape(a8.first().attr("data-file")))),{confirm:function(){var bc=ap();if(a8.length===0){a8=a9.closest("tr")}var bb=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(a8,function(bd,be){return $(bd).attr("data-file")})},function(bd){bc.remove();F(a8);ai();if(bd.error){au()}N(bd)});G(bb)},cancel:function(){a8.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ai(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function Y(ba,a8,bb,a9){var bd=ap();var bc=$.post(bb,{action:ba,files:a9,srcuri:a8},function(be){if(ac("clpaction")=="cut"){an("clpfiles","clpaction","clpuri")}bd.remove();au();N(be)});G(bc)}function E(a8){C(a8);var bf=$(this);if(bf.hasClass("disabled")){return}if(bf.hasClass("delete")){Z.call(this,a8)}else{if(bf.hasClass("rename")){aQ(bf.closest("tr"))}else{if(bf.hasClass("cut")||bf.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var bb=$.map(m(bf),function(bi,bh){return $(bi).attr("data-file")});ac("clpfiles",bb.join("@/@"));ac("clpaction",bf.hasClass("cut")?"cut":"copy");ac("clpuri",$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/"));if(bf.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}Q();ai()}else{if(bf.hasClass("paste")){var a9=ac("clpfiles");var bc=ac("clpaction");var be=ac("clpuri");var bd=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");if(ac("settings.confirm.paste")!="no"){var ba=$("#paste"+bc+"confirm").html().replace(/%srcuri%/g,$.MyStringHelper.uri2html(be)).replace(/%dsturi%/g,$.MyStringHelper.uri2html(bd)).replace(/\\n/g,"<br/>").replace(/%files%/g,$.MyStringHelper.uri2html(a9.split("@/@").join(", ")));I(ba,{confirm:function(){Y(bc,be,bd,a9)},setting:"settings.confirm.paste"})}else{Y(bc,be,bd,a9)}}else{if(bf.attr("href")!==undefined&&bf.attr("href")!="#"){window.location.href=bf.attr("href")}else{if(bf.attr("data-href")!==undefined&&bf.attr("data-href")!="#"){window.location.href=bf.attr("data-href")}else{var bg=bf.closest("tr");$("body").trigger("fileActionEvent",{obj:bf,event:a8,file:bg.attr("data-file"),row:bg,selected:aC(this)})}}}}}}}function ac(ba,bb,a8){var a9=new Date();a9.setTime(a9.getTime()+315360000000);if(bb){return Cookies.set(ba,bb,{path:$("#flt").attr("data-baseuri"),secure:true,expires:a8?a9:undefined})}return Cookies.get(ba)}function an(){for(var a8=0;a8<arguments.length;a8++){Cookies.remove(arguments[a8],{path:$("#flt").attr("data-baseuri"),secure:true})}}function x(ba,bb,a8,a9){if(a8){ac(ba,bb,a9)}else{an(ba)}}function af(){Q();$("#flt").on("fileListChanged",Q)}function Q(){var bc=ac("clpaction");var a8=$.MyStringHelper.concatUri($("#fileList").attr("data-uri"),"/");var ba=ac("clpuri");var bb=ac("clpfiles");var a9=(!bb||bb===""||ba==a8||$("#fileListTable").hasClass("iswriteable-no"));aG($(".action.paste"),a9);if(ba==a8&&bc=="cut"){$.each(bb.split("@/@"),function(bd,be){$("[data-file='"+be+"']").addClass("cutted").fadeTo("fast",0.5)})}}function P(){$("#nav .action").click(E).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function r(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(E).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var a8={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},cancelEvent:function(){$(this).next().focus()},finalEvent:function(a9){$("#flt").disableSelection();if(a9){$(this).closest("ul").hide()}}};$(".action.create-folder").MyInplaceEditor($.extend(a8,{changeEvent:function(ba){var a9=$(this);$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:ba.value},function(bb){if(!bb.error&&bb.message){aj(ba.value)}N(bb)})}}));$(".action.create-file").MyInplaceEditor($.extend(a8,{changeEvent:function(ba){var a9=$(this);$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:ba.value},function(bb){if(!bb.error&&bb.message){aj(ba.value)}N(bb)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(a8,{changeEvent:function(a9){var ba=m(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:a9.value,file:ba.attr("data-file")},function(bb){if(!bb.error&&bb.message){aj(a9.value)}N(bb)})}}))}function C(a8){if(a8.preventDefault){a8.preventDefault()}else{a8.returnValue=false}if(a8.stopPropagation){a8.stopPropagation()}}function aw(a8){C(a8);if(a8.stopImmediatePropagation){a8.stopImmediatePropagation()}}function f(){$(".action.viewfilter").click(function(ba){C(ba);if($(this).hasClass("disabled")){return}var a8=$(this);$(".action.viewfilter").addClass("disabled");var bb=$("#fileList").attr("data-uri");var a9=a8.attr("data-template");$.get(bb,{ajax:"getViewFilterDialog",template:a9},function(bc){var bd=$(bc);$("input[name='filter.size.val']",bd).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bd).button().click(function(bf){C(bf);x("filter.name",$("select[name='filter.name.op'] option:selected",bd).val()+" "+$("input[name='filter.name.val']",bd).val(),$("input[name='filter.name.val']",bd).val()!=="");x("filter.size",$("select[name='filter.size.op'] option:selected",bd).val()+$("input[name='filter.size.val']",bd).val()+$("select[name='filter.size.unit'] option:selected",bd).val(),$("input[name='filter.size.val']",bd).val()!=="");if($("input[name='filter.types']:checked",bd).length>0){var be="";$("input[name='filter.types']:checked",bd).each(function(bg,bh){be+=$(bh).val()});ac("filter.types",be)}else{an("filter.types")}bd.dialog("close");au()});$(".filter-reset",bd).button().click(function(be){C(be);an("filter.name","filter.size","filter.types");bd.dialog("close");au()});bd.submit(function(){return false});bd.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:a8.attr("title")||a8.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bd.remove()}}).show()})})}function G(bb,ba,a9){$("#abortdialog").remove();var a8=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",a8).button().click(function(bc){if(bb.readyState!=4){bb.abort()}a8.hide().remove();if(a9){a9.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(bb.readyState>2){return}a8.appendTo($("body")).show();var bc=window.setInterval(function(){if(bb.readyState==4){a8.hide().remove();window.clearInterval(bc)}},200);$("body").data("abortdialoginterval",bc)},ba||2500));return a8}function aR(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function p(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var ba="";var a8=$("*[accesskey]").get().sort(function(bd,bc){var be=$(bd).attr("accesskey");var bf=$(bc).attr("accesskey");return be<bf?-1:be>bf?1:0});var a9=[];$.each(a8,function(bc,bb){var bd=$(bb);var be=bd.attr("accesskey");if(!a9[be]){ba+='<li tabindex="0" role="definition">'+be+": "+(bd.attr("aria-label")||bd.attr("title")||bd.attr("data-tooltip")||bd.html())+"</li>";a9[be]=true}else{console.log("found accesskey "+be+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+ba+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function aX(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(a9){var a8=$(this);console.log(a8.attr("class"))}function U(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",E).on("dblclick.popupmenu",C).MyKeyboardEventHandler();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){aX()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"})});$("body").off(".popupmenu").on("click.popupmenu",function(){aX()}).on("keydown.popupmenu",function(a8){if(a8.which==27){aX()}});$("#filler").on("contextmenu",function(a8){if(a8.which==3){if(a8.originalEvent.detail===1){C(a8)}aX()}})}function aj(a8){var a9=$("#fileList");return $.get($.MyStringHelper.addMissingSlash(a9.data("uri")),{ajax:"getFileListEntry",template:a9.data("entrytemplate"),file:a8},function(ba){try{var bb=$(ba);row=$("tr[data-file='"+$.MyStringHelper.simpleEscape(a8)+"']",a9);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:bb});row.replaceWith(bb)}else{bb.appendTo(a9)}av();bb.focus()}catch(bc){au()}})}function aV(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(a9,a8){if(a8.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!a8.value);$("#flt").trigger("fileListViewChanged")}else{if(a8.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!a8.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",ac("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",ac("settings.show.dotfolders")=="no")}function aM(){var a8=ac("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bc,bb){var ba=$(this);if(ba.data("thumb")!=ba.data("icon")){var a9=ba.data("thumb");var bd=ba.data("icon");var be=$("#emptyimage").attr("src");ba.attr("src",a8?(a9===""?be:a9):(bd===""?be:bd));ba.toggleClass("thumbnail",a8)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(a9,a8){if(a8.setting=="settings.enable.thumbnails"){aM()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var a8=$(this);var a9=a8.data("icon");a8.removeClass("thumbnail").attr("src",a9!==""?a9:$("#emptyimage").attr("src"))})})}function n(a9,a8){var bb=ap();var ba=$.get(window.location.pathname,a9,function(bc){bb.remove();N(bc);a8(bc)});G(ba)}function ay(a9,a8){var bb=ap();var ba=$.post(window.location.pathname,a9,function(bc){bb.remove();N(bc);a8(bc)});G(ba)}function aa(){ToolBox={addMissingSlash:$.MyStringHelper.addMissingSlash,blockPage:ap,changeUri:J,concatUri:$.MyStringHelper.concatUri,confirmDialog:I,cookie:ac,fixElementPosition:X,getDialog:n,getDialogByPost:ay,getSelectedFiles:aC,getSelectedRows:m,handleJSONResponse:N,handleWindowResize:t,hidePopupMenu:aX,initFileList:av,initPopupMenu:U,initTabs:ae,initUpload:am,notify:aN,notifyError:a0,notifyInfo:b,notifyWarn:aU,preventDefault:C,preventDefaultImmediatly:aw,postAction:aW,quoteWhiteSpaces:$.MyStringHelper.quoteWhiteSpaces,refreshFileListEntry:aj,removeAbortDialog:aR,renderAbortDialog:G,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:an,simpleEscape:$.MyStringHelper.simpleEscape,stripSlash:$.MyStringHelper.stripSlash,togglecookie:x,toggleRowSelection:a4,uncheckSelectedRows:ai,updateFileList:au}}function ak(){$.fn.MyTooltip.defaults.helphandler=aE;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){aE.call(this,$(this).data("help"))})}function aE(a9){var a8=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:a9,width:"99%",height:"99%"}).text(a9)).dialog({width:a8.width()/2,height:a8.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
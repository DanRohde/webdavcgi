var ToolBox={};$(function(){bb();Z();aF();P();i();an();aA();v();U();aV();ab();aJ();aK();bd();g();f();E();L();aQ();r();T();al();aB();e();aZ();a5();c();aU();a9();bc();am();ah();$.ajaxSetup({traditional:true});$(document).ajaxError(function(bk,bl,bj,bi){console.log(bk);console.log(bl);console.log(bj);console.log(bi);if(bl&&bl.statusText&&bl.statusText!="abort"){ba(bl.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(bi,bk,bj){bi.cache=true});aC($("#flt").attr("data-uri"));function am(bi){if(!bi){bi=$(document)}$(".tabsel",bi).on("click keyup",function(bl){if(bl.type=="keyup"&&bl.keyCode!=32&&bl.keyCode!=13){return}G(bl);var bj=$(this);$(".tabsel.activetabsel",bi).removeClass("activetabsel");bj.addClass("activetabsel");$(".tab.showtab",bi).removeClass("showtab");var bk=$(".tab."+bj.data("group"),bi).addClass("showtab");$(":focusable:visible:first",bk).focus()})}function bc(){if(!ak("settings.show.statusbar")){ak("settings.show.statusbar","no");ak("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",ak("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(bj){$(this).prop("checked",true);G(bj)});function bi(){var bk=$("#fileListTable");var bj=$("#statusbar");$(".filecount",bj).html(bk.attr("data-filecounter"));$(".dircount",bj).html(bk.attr("data-dircounter"));$(".sum",bj).html(bk.attr("data-sumcounter"));$(".foldersize",bj).attr("title",aI(bk.data("foldersize"))).html(a(bk.data("foldersize")));$(".selfilecount",bj).html(bk.attr("data-fileselcounter"));$(".seldircount",bj).html(bk.attr("data-dirselcounter"));$(".selsum",bj).html(bk.attr("data-sumselcounter"));$(".selfoldersize",bj).attr("title",aI(bk.attr("data-folderselsize"))).html(a(bk.attr("data-folderselsize")));$(".selected-files-stats",bj).toggle(bk.attr("data-fileselcounter")!==0||bk.attr("data-dirselcounter")!==0)}bi();$("#flt").on("counterUpdated",bi).on("fileListChanged",bi).on("selectionCounterUpdated",bi);$("body").on("notify",function(bj,bk){$("#statusbar .notify").attr("title",bk.msg).removeClass("error message warning").addClass(bk.type).html(bk.msg).MyTooltip()});$("body").on("settingchanged",function(bj,bk){if(bk.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",bk.value)}});$("#statusbar").MyTooltip()}function aU(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function aZ(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(bk){var bj=this.tabIndex||1;var bi=$(this);if(bi.is(":focus")){if(bk.keyCode==32){Y.call(this,bk)}else{if(bk.keyCode==13){N(l($("#fileList").attr("data-uri"),encodeURIComponent(d(bi.attr("data-file")))),bi.attr("data-type")=="file")}else{if(bk.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(W(bi)){Q(bi)}}else{af()}}else{if(bk.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(bk.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(bk.keyCode==45){$(".paste").trigger("click")}}}}}}}if(bk.keyCode==38&&bj>-1){G(bk);if(W(bi)&&(bk.shiftKey||bk.altKey||bk.ctrlKey||bk.metaKey)){be(bi,true);$("#flt").trigger("fileListSelChanged")}bi.prevAll(":focusable:first").focus();ap()}else{if(bk.keyCode==40){G(bk);if(W(bi)&&(bk.shiftKey||bk.altKey||bk.ctrlKey||bk.metaKey)){be(bi,true);$("#flt").trigger("fileListSelChanged")}bi.nextAll(":focusable:first").focus();ap()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",s);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function e(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(bk){G(bk);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var bj=$("#flt").data("TableConfigDialog");if(bj){k($(bj))}else{if($("#tableconfigdialogtemplate").length>0){var bi=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",bi);k($(bi))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(bl){if(bl.error){S(bl)}$("#flt").data("TableConfigDialog",bl);k($(bl))})}}}).MyKeyboardEventHandler()})}function k(bj){var bl=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(bo,bn){return $(bo).attr("data-name")});$.each(bl,function(bn,bo){bj.find("input[name='visiblecolumn'][value='"+bo+"']").prop("checked",true)});bj.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bn){G(bn)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bn,bo){bj.find("input[name='sortingcolumn'][value='"+$(bo).attr("data-name")+"']").prop("disabled",true).click(function(bp){G(bp)}).closest("li").addClass("disabled")});var bm=ak("order")?ak("order").split("_"):"name_asc".split("_");var bk=bm[0];var bi=bm[1]||"asc";bj.find("input[name='sortingcolumn'][value='"+bk+"']").prop("checked",true);bj.find("input[name='sortingorder'][value='"+bi+"']").prop("checked",true);bj.find("input[value='fileactions']").closest("li").hide();bj.find("input[name='save']").button().click(function(bo){var bt=bl.slice(0);var bw=$.map($("input[name='visiblecolumn']:checked"),function(by,bx){return $(by).attr("value")});var bv=[];for(var br=bt.length-1;br>=0;br--){if($.inArray(bt[br],bw)==-1){bv.push(bt[br]);bt.splice(br,1)}}var bp=[];$.each(bw,function(bx,by){if($.inArray(by,bt)==-1){bp.push(by);bt.push(by)}});ak("visibletablecolumns",bt.join(","),1);var bu=bj.find("input[name='sortingcolumn']:checked").attr("value");var bq=bj.find("input[name='sortingorder']:checked").attr("value");ak("order",bu+(bq=="desc"?"_desc":""),1);if(bw.sort().join(",")!=bl.sort().join(",")){$.each(bp,function(by,bz){var bx=$("#fileListTable th[data-name='"+bz+"']").removeClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bB,bA){$("td",$(bA)).eq(bx).show()})});$.each(bv,function(by,bz){var bx=$("#fileListTable th[data-name='"+bz+"']").addClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bB,bA){$("td",$(bA)).eq(bx).hide()})})}else{if(bu!=bk||bq!=bi){var bn=$("#fileListTable th[data-name='"+bu+"']");var bs=bq=="desc"?-1:1;m(bn.prop("cellIndex"),bs);if(bn.length>0){w(bn.attr("data-sorttype")||"string",bn.attr("data-sort"),bs,bn.prop("cellIndex"),"data-file")}}}bj.dialog("close")});bj.find("input[name='cancel']").button().click(function(bn){G(bn);bj.dialog("close");return false});bj.find("#tableconfigform").submit(function(bn){return false});bj.dialog({modal:true,width:"auto",title:bj.attr("data-title")||bj.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");bj.dialog("destroy")}})}function aY(bi){if(bi){G(bi)}var bk=$(this).hasClass("collapsed");var bj=$(this).hasClass("iconsonly");if(!bk&&!bj){bj=true}else{if(bj){bj=false;bk=true}else{bk=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",bk).toggleClass("sidebar-iconsonly",bj);$(".action.collapse-sidebar").toggleClass("collapsed",bk).toggleClass("iconsonly",bj);if(!bj&&!bk){aw("sidebar")}else{ak("sidebar",bj?"iconsonly":bk?"false":"true")}x()}function aB(){$(".action.collapse-sidebar").click(aY).MyKeyboardEventHandler().MyTooltip();if(ak("sidebar")&&ak("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",ak("sidebar")=="false").toggleClass("sidebar-iconsonly",ak("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",ak("sidebar")=="false").toggleClass("iconsonly",ak("sidebar")=="iconsonly");x()}$(".action.collapse-head").click(function(bi){G(bi);$(".action.collapse-head").toggleClass("collapsed");var bj=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!bj);$(".collapse-head-listener").toggleClass("head-collapsed",bj);B("head","false",bj,1);x()}).MyTooltip().MyKeyboardEventHandler();if(ak("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function al(){$(".action.autorefreshmenu").dblclick(function(bi){G(bi);aC()});aP($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aP($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aP($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(ak("autorefresh")!==""&&parseInt(ak("autorefresh"))>0){a2(parseInt(ak("autorefresh")))}});$(".action.setautorefresh").click(function(bi){G(bi);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){aC();return}ak("autorefresh",$(this).attr("data-value"));a2(parseInt($(this).attr("data-value")))}).on("keyup",function(bi){if(bi.keyCode==32||bi.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(bi){G(bi);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));aw("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bi){if(bi.keyCode==32||bi.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(bj){G(bj);if($(this).hasClass("disabled")){return}var bi=$("#autorefresh");if(bi.data("timer")!=null){window.clearInterval(bi.data("timer"));bi.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{a2(bi.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bi){if(bi.keyCode==32||bi.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(bj,bi){ak("autorefreshtimerpos",JSON.stringify(ad("#autorefreshtimer",bi.offset)))}});if(ak("autorefreshtimerpos")){ad("#autorefreshtimer",JSON.parse(ak("autorefreshtimerpos")))}}function ad(bm,bi){var bl=$(bm);var bj=$(window);var bk={left:Math.min(Math.max(bi.left,0),bj.width()-bl.outerWidth()+bj.scrollLeft()),top:Math.min(Math.max(bi.top,0),bj.height()-bl.outerHeight()+bj.scrollTop())};bl.offset(bk);return bk}function ac(bi){var bk=$(".autorefreshtimer");var bl=bk.attr("data-template")||"%sm %ss";var bj=Math.floor(bi/60);var bm=bi%60;if(bm<10){bm="0"+bm}bk.html(bl.replace("%s",bj).replace("%s",bm))}function a2(bj){var bi=$("#autorefresh");if(bi.data("timer")!=null){window.clearInterval(bi.data("timer"))}bi.data("timeout",bj);ac(bj);bi.data("timer",window.setInterval(function(){var bk=bi.data("timeout")-1;ac(bk);bi.data("timeout",bk);if(bk<0){window.clearInterval(bi.data("timer"));bi.data("timer",null);ac(0);bi.trigger("stopped");aC()}},1000));bi.trigger("started")}function T(){var bi=$("#settings");bi.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",bi).each(function(bk,bj){$(bj).prop("checked",ak($(bj).prop("name"))!="no").click(function(bl){if(ak($(this).prop("name")+".keep")){ak($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{B($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",bi).change(function(){if($(this).prop("name")=="settings.lang"){ak($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{ak($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(bl,bj){var bm=$(bj);var bk=bm.prop("name");if(bk=="settings.lang"){bk=bk.replace(/^settings\./,"")}$("option[value='"+ak(bk)+"']",bm).prop("selected",true)})}})}function bb(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(bi){if(bi.keyCode==13||bi.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(bi){G(bi);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function r(){$("#flt").on("fileListChanged",x).on("fileListViewChanged",x);$(window).resize(x);x()}function x(){var bi=$(window).width()-$("#nav").width();$("#content").width(bi);$("#controls").width(bi);$("body").trigger("windowResized")}function L(){$(".action.changeuri").off(".changeuri").on("click.changeuri",bh);$(".action.refresh").off(".refresh").on("click.refresh",function(bi){G(bi);aC();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",bh);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var bi=$(this);if(!bi.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=bi.data("href")?bi.data("href"):bi.attr("href")}})})}function bh(bi){G(bi);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){N($(this).data("href")||$(this).attr("href"))}return false}function E(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(bi){$("#fileList tr:not(:hidden).unselectable-no").each(function(bj,bk){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(bi){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(bi){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function f(){var bj=$("#clock");if(bj.length===0){return}var bi=bj.attr("data-format");if(!bi){bi="%I:%M:%S"}window.setInterval(function(){function bk(bn){return bn<10?"0"+bn:bn}var bm=new Date();var bl=bi;bl=bl.replace(/\%(H|k)/,bk(bm.getHours())).replace(/\%(I|l)/,bk(bm.getHours()%12===0?12:bm.getHours()%12)).replace(/\%M/,bk(bm.getMinutes())).replace(/\%S/,bk(bm.getSeconds()));bj.html(bl)},bi.match(/%S/)?1000:60000)}function aF(){$("#flt").on("bookmarksChanged",t).on("bookmarksChanged",A).on("fileListChanged",function(){t();A()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aS)}function aP(bi,bj){$.each(bi,function(bm,bl){var bk=$(bl);if(bk.hasClass("hideit")){bk.toggle(!bj)}if(bk.hasClass("button")){bk.button("option","disabled",bj)}if(!bk.hasClass("notab")){bk.attr("tabindex",bj?-1:0)}bk.toggleClass("disabled",bj)})}function A(){var bm=l($("#flt").attr("data-uri"),"/");var bi=false;var bl=0;var bk=0;while(ak("bookmark"+bk)!=null){if(ak("bookmark"+bk)==bm){bi=true}if(ak("bookmark"+bk)!="-"){bl++}bk++}$(".action.addbookmark").button("option","disabled",bi);aP($(".action.rmbookmark"),!bi);aP($(".action.bookmarksortpath"),bl<2);aP($(".action.bookmarksorttime"),bl<2);aP($(".action.rmallbookmarks"),bl===0);var bj=ak("bookmarksort")==null?"time-desc":ak("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(bj=="path"||bj=="path-desc"||bj=="time"||bj=="time-desc"){$("#bookmarks .action.bookmarksort"+bj.replace(/-desc/,"")+" ."+bj).show()}}function t(){var bn=l($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(bo,bp){$(bp).remove()});var bm=[];var bk=0;while(ak("bookmark"+bk)!=null){if(ak("bookmark"+bk)!="-"){bm.push({path:ak("bookmark"+bk),time:parseInt(ak("bookmark"+bk+"time"))})}bk++}var bl=ak("bookmarksort")?ak("bookmarksort"):"time-desc";var bi=1;if(bl.indexOf("-desc")>0){bi=-1;bl=bl.replace(/-desc/,"")}bm.sort(function(bp,bo){if(bl=="path"){return bi*bp[bl].localeCompare(bo[bl])}else{return bi*(bo[bl]-bp[bl])}});var bj=$("#bookmarktemplate").html();$.each(bm,function(bo,bq){var bp=unescape(bq.path);$("<li>"+bj.replace(/\$bookmarkpath/g,bq.path).replace(/\$bookmarktext/,ag(aa(aT(bp,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aS).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",bq.path).attr("title",aa(bp)+" ("+(new Date(parseInt(bq.time)))+")").attr("tabindex",bq.path==bn?-1:0).toggleClass("disabled",bq.path==bn).find(".action.rmsinglebookmark").click(aS).MyKeyboardEventHandler()})}function n(bj){var bi=0;while(ak("bookmark"+bi)!=null&&ak("bookmark"+bi)!=bj){bi++}if(ak("bookmark"+bi)==bj){ak("bookmark"+bi,"-",1)}$("#flt").trigger("bookmarksChanged")}function aS(bl){G(bl);if($(this).hasClass("disabled")){return}var bi=$(this);var bk=$("#fileList").attr("data-uri");if(bi.hasClass("addbookmark")){var bj=0;while(ak("bookmark"+bj)!=null&&ak("bookmark"+bj)!="-"&&ak("bookmark"+bj)!=""&&ak("bookmark"+bj)!=bk){bj++}ak("bookmark"+bj,bk,1);ak("bookmark"+bj+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(bi.hasClass("dyn-bookmark")){N(bi.attr("data-bookmark"));bi.closest("ul").hide()}else{if(bi.hasClass("rmbookmark")){n(bk)}else{if(bi.hasClass("rmallbookmarks")){var bj=0;while(ak("bookmark"+bj)!=null){aw("bookmark"+bj,"bookmark"+bj+"time");bj++}$("#flt").trigger("bookmarksChanged")}else{if(bi.hasClass("rmsinglebookmark")){n($(this).attr("data-bookmark"))}else{if(bi.hasClass("bookmarksortpath")){ak("bookmarksort",ak("bookmarksort")=="path"||ak("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(bi.hasClass("bookmarksorttime")){ak("bookmarksort",ak("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aK(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",ax).on("fileListViewChanged",ax)}function ax(){var bk=$("#selstats");var bi=bk.data("selstats");var bj=aR();$("#fileListTable").attr("data-fileselcounter",bj.fileselcounter).attr("data-dirselcounter",bj.dirselcounter).attr("data-folderselsize",bj.folderselsize).attr("data-sumselcounter",bj.sumselcounter);$("#flt").trigger("selectionCounterUpdated");bk.html(bi.replace(/\$filecount/g,bj.fileselcounter).replace(/\$dircount/g,bj.dirselcounter).replace(/\$sum/g,bj.sumselcounter).replace(/\$folderselsizes/g,aI(bj.folderselsize)).replace(/\$folderselsize/g,a(bj.folderselsize))).attr("title",aI(bj.folderselsize)).MyTooltip()}function aV(){$("#pathinputform").submit(function(bi){return false});$("#pathinputform input[name='uri']").keydown(function(bi){if(bi.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(bi.keyCode==13){G(bi);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();N($(this).val())}}});$(".action.changedir").button().click(function(bi){G(bi);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(bi){G(bi);$("#pathinput").hide();$("#quicknav").show();N($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function ab(){$("form#filterbox").submit(function(bi){return false});$("form#filterbox input").keyup(C).change(C).autocomplete({minLength:1,select:C,close:C});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(bi){G(bi);$("form#filterbox input").val("");C();$(this).addClass("invisible")});$("#flt").on("fileListChanged",C).on("fileListChanged",function(){var bi=$.map($("#fileList tr"),function(bk,bj){return $(bk).attr("data-file")});$("form#filterbox input").autocomplete({source:function(bk,bj){try{var bm=new RegExp(bk.term);bj($.grep(bi,function(bn){return bm.test(bn)}))}catch(bl){bj($.grep(bi,function(bn){return bn.indexOf(bk.term)>-1}))}}})})}function C(){var bi=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var bk=new RegExp(bi,"i");if(bi===""||$(this).attr("data-file").match(bk)){$(this).show()}else{$(this).hide()}}catch(bj){if(bi===""||$(this).attr("data-file").toLowerCase().indexOf(bi.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function z(bj,bk){if(!bk){bk=bj}var bi=bk.loaded/bk.total*100;$("#progress .bar").css("width",bi.toFixed(2)+"%").html(parseInt(bi)+"% ("+a(bk.loaded)+"/"+a(bk.total)+"); "+bj.done+"/"+bj.uploads)}function av(bk,bm,bj,bl){$("#flt").on("fileListChanged",function(){bk.fileupload("option","url",$("#fileList").attr("data-uri"))});var bi={aborted:false,transports:[],done:0,failed:0,uploads:0};bk.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:bl,singleFileUploads:true,autoUpload:false,add:function(bq,bp){if(!bi.aborted){var br=bp.submit();var bo=bp.files[0].name;bi.transports.push(br);var bn=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+bo).addClass("fileprogress");$("<div></div>").click(function(bs){G(bs);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bn).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:bo,transport:br});$("<div></div>").appendTo(bn).addClass("fileprogressbar running").html(bp.files[0].name+" ("+a(bp.files[0].size)+"): 0%");bi.uploads++;return true}return false},done:function(bo,bn){$("#progress [id='fpb"+bn.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bn.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bn.result.message?"done":"failed").css("width","100%").html(bn.result&&bn.result.error?bn.result.error:bn.result.message?bn.result.message:bn.files[0].name);if(bn.result.message){bi.done++}else{bi.failed++}z(bi)},fail:function(bo,bn){$("#progress [id='fpb"+bn.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bn.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bn.textStatus+": "+$.map(bn.files,function(bp,bq){return bp.name}).join(", "));bi.failed++;z(bi);console.log(bn)},stop:function(bo,bn){z(bi);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){aC()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(bo,bn){bi.transports=[];bi.aborted=false;bi.files=[];bi.uploads=0;bi.failed=0;bi.done=0;return true},start:function(bp,bo){var bn=[];bn.push({text:$("#close").html(),disabled:true});bn.push({text:$("#cancel").html(),click:function(){if(bi.aborted){return}bi.aborted=true;$.each(bi.transports,function(bq,br){if(br&&br.abort){br.abort($("#uploadaborted").html())}});bi.transports=[]}});$("#progress").dialog({modal:true,title:bj,height:370,width:500,buttons:bn,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(bp,bo){var bn=parseInt(bo.loaded/bo.total*100)+"%";$("div[id='fpb"+bo.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bn).html(bo.files[0].name+" ("+a(bo.files[0].size)+"): "+bn)},progressall:function(bo,bn){bi.total=bn.total;bi.loaded=bn.loaded;z(bi,bn)},submit:function(bo,bn){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",ak("settings.confirm.upload")=="no"||!X(bn)||window.confirm(bm))}$("#file-upload-form-relapath").val(bn.files[0].relativePath||(bn.files[0].webkitRelativePath&&bn.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function X(bj){for(var bi=0;bi<bj.files.length;bi++){var bk;if(bj.files[bi].relativePath&&bj.files[bi].relativePath!=""){bk=bj.files[bi].relativePath.split(/[\\\/]/)[0]+"/"}else{if(bj.files[bi].webkitRelativePath&&bj.files[bi].webkitRelativePath!=""){bk=bj.files[bi].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(bk&&$("#fileList tr[data-file='"+aa(bk)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+aa(bj.files[bi].name)+"']").length>0){return true}}}return false}function aJ(){av($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(bi){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(bi){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(bi){$("#fileList").addClass("draghover")}).on("dragleave",function(bi){$("#fileList").removeClass("draghover")}).on("drop",function(bi){$("#fileList").removeClass("hover")})}function M(bk,bi){var bj;if(bi.setting){bk+='<div class="confirmdialogsetting"><input type="checkbox" name="'+bi.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";bj=ak(bi.setting)}$("#confirmdialog").html(bk).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(bi.setting){B(bi.setting,bj,bj&&bj!=="",1)}$("#confirmdialog").dialog("close");if(bi.cancel){bi.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(bi.confirm){bi.confirm()}}}],open:function(){if(bi.setting){$("input[name='"+bi.setting+"']",$(this)).click(function(bl){B(bi.setting,"no",!$(this).is(":checked"),1)}).prop("checked",ak(bi.setting)!="no")}},close:function(){if(bi.cancel){bi.cancel()}}}).show()}function bf(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function p(bj){var bi=$("#fileList tr.selected:visible");if(bi.length==0){bi=$(bj).closest("tr[data-file]")}if(bi.length==0){bi=$("#fileList tr:visible:focus")}return bi}function aM(bi){return $.map(p(bi),function(bj,bk){return $(bj).attr("data-file")})}function a3(bj){G(bj);var bi=$(this);if(bi.hasClass("disabled")){return}var bk=bi.closest("tr");if(bi.hasClass("rename")){a0(bk)}else{if(bi.hasClass("delete")){Q(bk)}else{$("body").trigger("fileActionEvent",{obj:bi,event:bj,file:bk.attr("data-file"),selected:[bk.data("file")],row:bk})}}}function i(){$("#fileactions").on("click dblclick",function(bi){G(bi);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",a3).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",az).on("mouseleave.fileAction",o)}).on("beforeFileListChange",o);j();$("body").on("settingchanged",j)}function j(bi,bj){$("#fileactions").toggleClass("hidefileactions",ak("settings.show.fileactions")=="no").toggleClass("hidelabels",ak("settings.show.fileactionlabels")=="no").toggleClass("showalways",ak("settings.show.fileactionalways")=="no")}function az(bj){var bi=$(this);if($("#fileactions",bi).length===0){$(".action.changeuri.filename",bi).after($("#fileactions"))}}function o(bi){$("#fileactions").appendTo($(".template"))}function aQ(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(bk,bj){var bi=$(bj);if(!bi.attr("href")){bi.data("fancybox-href",bi.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(bi){return(bi.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(bk,bj){var bi=$(bj);if(!bi.attr("href")){bi.data("fancybox-href",bi.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function aD(){var bj=$("#fileListTable");var bi=$("#fileList");ai();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",Y).off("dblclick.initFileList").on("dblclick.initFileList",function(bk){N(l($("#fileList").attr("data-uri"),encodeURIComponent(d($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:F,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:bf,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(bl){var bk=$(bl.currentTarget);return $(bl.currentTarget).clone().width(bk.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:O,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bn,bk){var bl=$(bk);$("<div/>").prependTo(bl).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(bl).html("&nbsp;").addClass("columnResizeHandle right");bl.data("origWidth",bl.width());var bo=ak(bl.prop("id")+".width");if(bo){bl.width(parseFloat(bo))}var bm=0;$(bk).on("click.initFileList",function(bq){var bp=$(this);bm++;if(bm==1){window.setTimeout(function(){if(bm==1){if(!bp.hasClass("sorter-false")){aO.call(bp,bq)}}else{var br=bp.width()==bp.data("origWidth")?1:bp.data("origWidth");bp.width(br);B(bp.prop("id")+".width",br,br!=bp.data("origWidth"),1)}bm=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(bk,bl){startPos=parseInt(bl.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(bk,bl){$(this).removeAttr("style");ak(column.attr("id")+".width",column.width(),1)},drag:function(bk,bl){if(handlePos=="right"){column.width(startWidth+bl.offset.left-startPos)}else{column.width(startWidth+startPos-bl.offset.left)}}});ap();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function ap(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var bi=window.getSelection();if(bi&&bi.removeAllRanges){bi.removeAllRanges()}}}}function O(bj,bk){var bm=bk.draggable.prop("cellIndex");var bi=$(this).prop("cellIndex");if(bm+1==bi){return false}var bl=$("#fileListTable thead th");bl.eq(bm).detach().insertBefore(bl.eq(bi));$.each($("#fileList tr"),function(){var bn=$(this).children("td");bn.eq(bm).detach().insertBefore(bn.eq(bi))});ak("visibletablecolumns",$.map($("#fileListTable thead th[data-name]:not(.hidden):not(:last)"),function(bn){return $(bn).attr("data-name")}).join(","),1);return true}function ai(){if(ak("order")){var bo=ak("order").split("_");var bj=bo[0];var bk=bo[1]&&bo[1]=="desc"?-1:1;var bm=$("#fileListTable thead th[data-name='"+bj+"']:not(.sorter-false)");if(bm.length>0){var bn=bm.attr("data-sort");var bl=bm.attr("data-sorttype")||"string";var bi=bm.prop("cellIndex");m(bi,bk);w(bl,bn,bk,bi,"data-file")}}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aO)}function aO(bl){var bo=$("#fileListTable");var bm=bo.data("tablesorter-lastclickedcolumn");var bj=bo.data("tablesorter-sortorder");var bk=$(this).attr("data-sorttype")||"string";var bn=$(this).attr("data-sort");var bi=$(this).prop("cellIndex");if(!bj){bj=-1}if(bm==bi){bj=-bj}ak("order",$(this).attr("data-name")+(bj==-1?"_desc":""),1);m(bi,bj);w(bk,bn,bj,bi,"data-file")}function m(bi,bj){var bk=$("#fileListTable");bk.data("tablesorter-lastclickedcolumn",bi);bk.data("tablesorter-sortorder",bj);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(bi).addClass(bj==1?"tablesorter-up":"tablesorter-down")}function w(bk,bm,bj,bi,bl){$("#fileListTable tbody").each(function(bn,bq){var bp=$(bq).children("tr").get();bp.sort(function(bu,bs){var bx=0;var bt=$(bu);var br=$(bs);var bw=bt.attr(bm)?(bk=="number"?parseInt(bt.attr(bm)):bt.attr(bm)):bu.cells.item(bi).innerHTML.toLowerCase();var bv=br.attr(bm)?(bk=="number"?parseInt(br.attr(bm)):br.attr(bm)):bs.cells.item(bi).innerHTML.toLowerCase();if(bt.attr("data-file").match(/^\.\.?$/)){return -1}if(br.attr("data-file").match(/^\.\.?$/)){return 1}if(bt.attr("data-type")=="dir"&&br.attr("data-type")!="dir"){return -1}if(bt.attr("data-type")!="dir"&&br.attr("data-type")=="dir"){return 1}if(bk=="number"){bx=bw-bv}else{if(bw.localeCompare){bx=bw.localeCompare(bv)}else{bx=(bw<bv?-1:(bw==bv?0:1))}}if(bx===0&&bm!=bl){if(bw.localeCompare){bx=bt.attr(bl).localeCompare(br.attr(bl))}else{bx=bt.attr(bl)<br.attr(bl)?-1:bt.attr(bl)>br.attr(bl)?1:0}}return bj*bx});for(var bo=0;bo<bp.length;bo++){$(bq).append(bp[bo])}})}function l(bj,bi){return(u(bj)+bi).replace(/\/\//g,"/").replace(/\/[^\/]+\/\.\.\//g,"/")}function u(bi){return(bi+"/").replace(/\/\//g,"/")}function Q(bi){bi.fadeTo("slow",0.5);M($("#deletefileconfirm").html().replace(/%s/,ag(aa(bi.attr("data-displayname")))),{confirm:function(){var bj=bi.attr("data-file");J(bi);var bl=ay();var bk=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:bj},function(bm){bl.remove();if(bm.error){aC()}S(bm)});K(bk)},cancel:function(){bi.fadeTo("fast",1)}})}function S(bi){if(bi.error){ba(bi.error)}if(bi.warn){a4(bi.warn)}if(bi.message){b(bi.message)}if(bi.quicknav){$("#quicknav").html(bi.quicknav).MyTooltip();$("#quicknav a").click(function(bj){G(bj);N($(this).attr("href"))})}}function y(bm,bj,bi){var bl=ay();var bk=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:bi,file:bj},function(bn){bm.find(".renamefield").remove();bm.find("td.filename div.hidden div.filename").unwrap();if(bn.message){var bo=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:bi,template:$("#fileList").attr("data-entrytemplate")},function(bp){try{var bq=$(bp);var bs=$("tr[data-file='"+bi+"']");if(bs.length>0){bs.remove()}bm.replaceWith(bq);bm=bq;aD()}catch(br){aC()}bl.remove()});K(bo)}else{bl.remove()}S(bn)});K(bk)}function a0(bl){var bk=bl.find("td.filename");var bi=bl.attr("data-displayname");if($(".renamefield",bk).length>0){return}renamefield=$("#renamefield").html();bk.wrapInner('<div class="hidden"/>').prepend(renamefield);var bj=bk.find(".renamefield input[type=text]");$("#flt").enableSelection();bj.attr("value",bj.attr("value").replace(/\$filename/,bi).replace(/\/$/,"")).focus().select();bj.off("click").on("click",function(bm){G(bm);$(this).focus()}).off("dblclick").on("dblclick",function(bm){G(bm)});bj.keydown(function(bo){var bp=$(this).closest("tr");var bn=$(this).closest("tr").attr("data-file");var bm=$(this).val();if(bo.keyCode==13&&bn!=bm){G(bo);if(ak("settings.confirm.rename")!="no"){M($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,ag(bn)).replace(/%s/,ag(bm)),{confirm:function(){y(bp,bn,bm)},setting:"settings.confirm.rename"})}else{y(bp,bn,bm)}}else{if(bo.keyCode==27||(bo.keyCode==13&&bn==bm)){G(bo);bp.find(".renamefield").remove();bp.find("td.filename div.hidden div.filename").unwrap();$("#flt").disableSelection();bp.focus()}}});bj.focusout(function(bm){bl.find(".renamefield").remove();bl.find("td.filename div.hidden div.filename").unwrap();$("#flt").disableSelection()})}function aX(bi,bj){console.log("notify["+bi+"]: "+bj);if(ak("settings.messages."+bi)=="no"){return}noty({text:bj,type:bi,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:bi,msg:bj})}function ba(bi){aX("error",bi)}function b(bi){aX("message",bi)}function a4(bi){aX("warning",bi)}function be(bj,bi){if(!bj){return}bj.toggleClass("selected",bi);bj.find(".selectbutton").prop("checked",bj.hasClass("selected"))}function W(bi){return bi.attr("data-file")!=".."&&!bi.hasClass("unselectable-yes")}function Y(bk){var bo=$("#fileListTable");if(W($(this))){var bn=this.rowIndex;var bi=bn;if((bk.shiftKey||bk.metaKey||bk.altKey)&&bo.data("lastSelectedRowIndex")){bi=bo.data("lastSelectedRowIndex");if(bi<bn){var bm=bi;bi=bn;bn=bm}for(var bj=bn+1;bj<bi;bj++){var bl=$("#fileList tr:visible").filter(function(){return this.rowIndex==bj});if(bl.length===0){continue}be(bl);bl=bl.next()}}be($(this));bo.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function bd(){$(".dialog.action").click(aN)}function aN(bj){G(bj);if($(this).hasClass("disabled")){return}var bi=$(this);bi.addClass("disabled");var bk=$("#"+bi.attr("data-action"));if(bk.attr("title")){bk.data("title",bk.attr("title"))}bk.attr("title",bk.data("title"));bk.dialog({modal:true,width:"auto",open:function(){if(bk.data("initHandler")){bk.data("initHandler").init()}},close:function(){bi.removeClass("disabled")},dialogClass:bi.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function P(){bg();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",a8).on("fileListViewChanged",a8)}function bg(){aP($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function a8(){var bj=aR();var bk=$("#fileListTable");var bi=bk.hasClass("iswriteable-no")?":not(.access-writeable)":"";bi+=bk.hasClass("isreadable-no")?":not(.access-readable)":"";bi+=bk.hasClass("unselectable-no")?":not(.access-selectable)":"";aP($(".access-writeable"),bk.hasClass("iswriteable-no"));aP($(".access-readable"),bk.hasClass("isreadable-no"));aP($(".access-selectable"),bk.hasClass("unselectable-yes"));aP($(".sel-none"+bi),bj.sumselcounter!==0);aP($(".sel-one"+bi),bj.sumselcounter!=1);aP($(".sel-multi"+bi),bj.sumselcounter===0);aP($(".sel-noneorone"+bi),bj.sumselcounter>1);aP($(".sel-none.sel-dir"+bi),bj.fileselcounter!==0);aP($(".sel-one.sel-dir"+bi),bj.fileselcounter>0||bj.dirselcounter!=1);aP($(".sel-multi.sel-dir"+bi),bj.fileselcounter>0||bj.dirselcounter===0);aP($(".sel-noneorone.sel-dir"+bi),bj.fileselcounter>0||bj.dirselcounter>1);aP($(".sel-noneormulti.sel-dir"+bi),bj.fileselcounter>0);aP($(".sel-none.sel-file"+bi),bj.fileselcounter!==0);aP($(".sel-one.sel-file"+bi),bj.dirselcounter>0||bj.fileselcounter!=1);aP($(".sel-multi.sel-file"+bi),bj.dirselcounter>0||bj.fileselcounter===0);aP($(".sel-noneorone.sel-file"+bi),bj.dirselcounter>0||bj.fileselcounter>1);aP($(".sel-noneormulti.sel-file"+bi),bj.dirselcounter>0)}function aA(){$("#flt").on("fileListChanged",ao).on("fileListViewChanged",ao)}function H(bi){if(!bi){bi=$("#fileListTable")}if(bi&&bi.attr){bi.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aL(){var bj=$("#fileListTable");H(bj);var bi=aR();bj.attr("data-dircounter",bi.dircounter);bj.attr("data-filecounter",bi.filecounter);bj.attr("data-foldersize",bi.foldersize);bj.attr("data-sumcounter",bi.sumcounter);$("#flt").trigger("counterUpdated")}function aR(){var bj=[];bj.dircounter=$("#fileList tr.is-subdir-yes:visible").length;bj.filecounter=$("#fileList tr.is-file:visible").length;bj.sumcounter=bj.dircounter+bj.filecounter;bj.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;bj.fileselcounter=$("#fileList tr.selected.is-file:visible").length;bj.sumselcounter=bj.dirselcounter+bj.fileselcounter;var bi=0;var bk=0;$("#fileList tr:visible").each(function(bm,bn){var bl=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){bk+=bl}bi+=bl});bj.foldersize=bi;bj.folderselsize=bk;return bj}function ao(){var bk=$("#headerName");var bl=$("#fileListTable");var bj=$("#headerSize");aL();if(bk.length>0&&!bk.attr("data-title")){bk.attr("data-title",bk.attr("title"))}if(bj.length>0&&!bj.attr("data-title")){bj.attr("data-title",bj.attr("title"))}if(bk.length>0){bk.attr("title",bk.attr("data-title").replace(/\$filecount/,bl.attr("data-filecounter")).replace(/\$dircount/,bl.attr("data-dircounter")).replace(/\$sum/,parseInt(bl.attr("data-dircounter"))+parseInt(bl.attr("data-filecounter"))))}var bi=parseInt(bl.attr("data-foldersize"));if(bj.length>0){bj.attr("title",bj.attr("data-title").replace(/\$foldersize/,aI(bi)))}}function aa(bi){return $("<div/>").text(bi).html()}function a9(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var bi=history.location||document.location;aC(bi.pathname)})}function N(bj,bi){try{if(!bi){if(window.history.pushState){window.history.pushState({path:bj},"",bj);aC(bj)}else{aC(bj)}return}}catch(bk){console.log(bk)}if(!bi){ay()}window.location.href=bj}function aC(bi,bk){if(!bi){bi=$("#fileList").attr("data-uri")}if(!bi){bi=window.location.href}if(!bk){bk={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var bj=$.now();$("#flt").data("timestamp",bj);$.get(bi,bk,function(bl){if($("#flt").data("timestamp")!=bj){return}$("#flt").trigger("beforeFileListChange").show().html(bl.content).attr("data-uri",bi);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+bi.replace(/\/[^\/]+\/\.\.$/,"/"));aD();S(bl)})}function J(bi){$("#flt").trigger("beforeFileListChange");bi.remove();$("#flt").trigger("fileListChanged")}function D(bk,bi,bl,bj){var bn=ay();var bm=$.post(bl,{srcuri:bi,action:bk,files:bj.join("@/@")},function(bo){if(bo.message&&bk=="cut"){J($("#fileList tr[data-file='"+bj.join("'],#fileList tr[data-file='")+"']"))}bn.remove();if(bo.error){aC()}S(bo)});K(bm)}function F(bl,bn){var bi=bn.draggable.closest("tr");var bo=l($("#fileList").attr("data-uri"),encodeURIComponent(d($(this).attr("data-file")))+"/");var bj=l($("#fileList").attr("data-uri"),"/");if(bo==l(bj,encodeURIComponent(d(bi.attr("data-file"))))+"/"){return}var bm=bl.shiftKey||bl.altKey||bl.ctrlKey||bl.metaKey?"copy":"cut";var bk=bi.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(br,bq){return $(br).attr("data-file")}):new Array(bi.attr("data-file"));if(ak("settings.confirm.dnd")!="no"){var bp=$("#paste"+bm+"confirm").html();bp=bp.replace(/%files%/g,ag(h(bk.join(", ")))).replace(/%srcuri%/g,ag(h(bj))).replace(/%dsturi%/g,ag(h(bo))).replace(/\\n/g,"<br/>");M(bp,{confirm:function(){D(bm,bj,bo,bk)},setting:"settings.confirm.dnd"})}else{D(bm,bj,bo,bk)}}function ay(){return $("<div></div>").prependTo("body").addClass("overlay")}function d(bi){return bi.replace(/\/$/,"")}function au(bl,bm,bk){for(var bj in bm){var bi=bm[bj];if(typeof bi==="object"){au(bl,bi,bj)}else{if(bk){bl.append($("<input/>").prop("name",bk).prop("value",bi).prop("type","hidden"))}else{bl.append($("<input/>").prop("name",bj).prop("value",bi).prop("type","hidden"))}}}return bl}function a6(bj){var bi=$("<form/>").appendTo("body");bi.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");au(bi,bj);bi.submit();bi.remove()}function af(bk){var bj=$(this);var bi=p(this);bi.fadeTo("slow",0.5);M(bi.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,ag(aa(bi.first().attr("data-file")))),{confirm:function(){var bm=ay();if(bi.length===0){bi=bj.closest("tr")}var bl=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(bi,function(bn,bo){return $(bn).attr("data-file")})},function(bn){bm.remove();J(bi);aq();if(bn.error){aC()}S(bn)});K(bl)},cancel:function(){bi.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function aq(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function ae(bk,bi,bl,bj){var bn=ay();var bm=$.post(bl,{action:bk,files:bj,srcuri:bi},function(bo){if(ak("clpaction")=="cut"){aw("clpfiles","clpaction","clpuri")}bn.remove();aC();S(bo)});K(bm)}function I(bi){G(bi);var bp=$(this);if(bp.hasClass("disabled")){return}if(bp.hasClass("delete")){af.call(this,bi)}else{if(bp.hasClass("rename")){a0(bp.closest("tr"))}else{if(bp.hasClass("cut")||bp.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var bl=$.map(p(bp),function(bs,br){return $(bs).attr("data-file")});ak("clpfiles",bl.join("@/@"));ak("clpaction",bp.hasClass("cut")?"cut":"copy");ak("clpuri",l($("#fileList").attr("data-uri"),"/"));if(bp.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}V();aq()}else{if(bp.hasClass("paste")){var bj=ak("clpfiles");var bm=ak("clpaction");var bo=ak("clpuri");var bn=l($("#fileList").attr("data-uri"),"/");if(ak("settings.confirm.paste")!="no"){var bk=$("#paste"+bm+"confirm").html().replace(/%srcuri%/g,h(bo)).replace(/%dsturi%/g,h(bn)).replace(/\\n/g,"<br/>").replace(/%files%/g,h(bj.split("@/@").join(", ")));M(bk,{confirm:function(){ae(bm,bo,bn,bj)},setting:"settings.confirm.paste"})}else{ae(bm,bo,bn,bj)}}else{if(bp.attr("href")!==undefined&&bp.attr("href")!="#"){window.location.href=bp.attr("href")}else{if(bp.attr("data-href")!==undefined&&bp.attr("data-href")!="#"){window.location.href=bp.attr("data-href")}else{var bq=bp.closest("tr");$("body").trigger("fileActionEvent",{obj:bp,event:bi,file:bq.attr("data-file"),row:bq,selected:aM(this)})}}}}}}}function h(bi){return aa(decodeURIComponent(bi))}function ak(bk,bl,bi){var bj=new Date();bj.setTime(bj.getTime()+315360000000);if(bl){return Cookies.set(bk,bl,{path:$("#flt").attr("data-baseuri"),secure:true,expires:bi?bj:undefined})}return Cookies.get(bk)}function aw(){for(var bi=0;bi<arguments.length;bi++){Cookies.remove(arguments[bi],{path:$("#flt").attr("data-baseuri"),secure:true})}}function B(bk,bl,bi,bj){if(bi){ak(bk,bl,bj)}else{aw(bk)}}function aI(bj){var bk="";bk+=bj+" Byte(s)";var bi=bj/1024;if(bi.toFixed(2)>0){bk+=" = "+bi.toFixed(2)+"KB"}bi=bi/1024;if(bi.toFixed(2)>0){bk+=" = "+bi.toFixed(2)+"MB"}bi=bi/1024;if(bi.toFixed(2)>0){bk+=" = "+bi.toFixed(2)+"GB"}bi=bi/1024;if(bi.toFixed(2)>0){bk+=" = "+bi.toFixed(2)+"TB"}return bk}function a(bj){var bk=bj+" Byte(s)";var bi=bj/1024;if(bi.toFixed(2)>0&&bi>1){bk=bi.toFixed(2)+"KB"}bi=bi/1024;if(bi.toFixed(2)>0&&bi>1){bk=bi.toFixed(2)+"MB"}bi=bi/1024;if(bi.toFixed(2)>0&&bi>1){bk=bi.toFixed(2)+"GB"}bi=bi/1024;if(bi.toFixed(2)>0&&bi>1){bk=bi.toFixed(2)+"TB"}return bk}function an(){V();$("#flt").on("fileListChanged",V)}function V(){var bm=ak("clpaction");var bi=l($("#fileList").attr("data-uri"),"/");var bk=ak("clpuri");var bl=ak("clpfiles");var bj=(!bl||bl===""||bk==bi||$("#fileListTable").hasClass("iswriteable-no"));aP($(".action.paste"),bj);if(bk==bi&&bm=="cut"){$.each(bl.split("@/@"),function(bn,bo){$("[data-file='"+bo+"']").addClass("cutted").fadeTo("fast",0.5)})}}function R(bj,bi){bj.click(function(bm){G(bm);var bl=$(this);bl.closest("ul:hidden").show();if(bl.hasClass("disabled")){return}if(bl.data("is-active")){return}bl.data("is-active",true);bl.data("orig-html",bj.html());inplace=$('<div class="inplace"><form method="post" action="#"><input class="inplace input"/></form></div>');var bk=inplace.find("input");inplace.off("click").on("click",function(bn){G(bn);$(this).focus()}).off("dblclick").on("dblclick",function(bn){preventDefeault(bn)});if(bi){bk.val(bi)}$("#flt").enableSelection();bk.keydown(function(bn){if(bn.keyCode==13){G(bn);$("#flt").disableSelection();bl.data("is-active",false);bl.html(bl.data("orig-html"));if((bi&&bk.val()==bi)||(bk.val()==="")){bl.data("value",bk.val()).focus().trigger("unchanged")}else{bl.data("value",bk.val()).trigger("changed")}}else{if(bn.keyCode==27){G(bn);bl.data("is-active",false);$("#flt").disableSelection();bl.html(bl.data("orig-html")).focus();bl.trigger("canceled");bl.data("input-canceled",true)}}}).focusout(function(bn){bl.data("is-active",false);$("#flt").disableSelection();bl.html(bl.data("orig-html"));bl.trigger("canceled")});bl.html(inplace);bk.focus()});return bj}function U(){$("#nav .action").click(I).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function v(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(I).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});R($(".action.create-folder")).on("changed",function(bj){var bi=$(this);bi.closest("ul").hide();$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:bi.data("value")},function(bk){if(!bk.error&&bk.message){ar(bi.data("value"))}S(bk)})});R($(".action.create-file")).on("changed",function(bj){var bi=$(this);bi.closest("ul").hide();$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:bi.data("value")},function(bk){if(!bk.error&&bk.message){ar(bi.data("value"))}S(bk)})});R($(".action.create-symlink")).on("changed",function(bi){$(this).closest("ul").hide();var bj=p(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:$(this).data("value"),file:bj.attr("data-file")},function(bk){if(!bk.error&&bk.message){aC()}S(bk)})})}function G(bi){if(bi.preventDefault){bi.preventDefault()}else{bi.returnValue=false}if(bi.stopPropagation){bi.stopPropagation()}}function aE(bi){G(bi);if(bi.stopImmediatePropagation){bi.stopImmediatePropagation()}}function aT(bj,bi){if(bj.length>bi){bj=bj.substr(0,4)+"..."+bj.substr(bj.length-bi+7,bi-7)}return bj}function g(){$(".action.viewfilter").click(function(bk){G(bk);if($(this).hasClass("disabled")){return}var bi=$(this);$(".action.viewfilter").addClass("disabled");var bl=$("#fileList").attr("data-uri");var bj=bi.attr("data-template");$.get(bl,{ajax:"getViewFilterDialog",template:bj},function(bm){var bn=$(bm);$("input[name='filter.size.val']",bn).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bn).button().click(function(bp){G(bp);B("filter.name",$("select[name='filter.name.op'] option:selected",bn).val()+" "+$("input[name='filter.name.val']",bn).val(),$("input[name='filter.name.val']",bn).val()!=="");B("filter.size",$("select[name='filter.size.op'] option:selected",bn).val()+$("input[name='filter.size.val']",bn).val()+$("select[name='filter.size.unit'] option:selected",bn).val(),$("input[name='filter.size.val']",bn).val()!=="");if($("input[name='filter.types']:checked",bn).length>0){var bo="";$("input[name='filter.types']:checked",bn).each(function(bq,br){bo+=$(br).val()});ak("filter.types",bo)}else{aw("filter.types")}bn.dialog("close");aC()});$(".filter-reset",bn).button().click(function(bo){G(bo);aw("filter.name","filter.size","filter.types");bn.dialog("close");aC()});bn.submit(function(){return false});bn.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:bi.attr("title")||bi.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bn.remove()}}).show()})})}function K(bl,bk,bj){$("#abortdialog").remove();var bi=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",bi).button().click(function(bm){if(bl.readyState!=4){bl.abort()}bi.hide().remove();if(bj){bj.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(bl.readyState>2){return}bi.appendTo($("body")).show();var bm=window.setInterval(function(){if(bl.readyState==4){bi.hide().remove();window.clearInterval(bm)}},200);$("body").data("abortdialoginterval",bm)},bk||2500));return bi}function a1(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function s(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var bk="";var bi=$("*[accesskey]").get().sort(function(bm,bl){var bn=$(bm).attr("accesskey");var bo=$(bl).attr("accesskey");return bn<bo?-1:bn>bo?1:0});var bj=[];$.each(bi,function(bm,bl){var bn=$(bl);var bo=bn.attr("accesskey");if(!bj[bo]){bk+='<li tabindex="0" role="definition">'+bo+": "+(bn.attr("aria-label")||bn.attr("title")||bn.attr("data-tooltip")||bn.html())+"</li>";bj[bo]=true}else{console.log("found accesskey "+bo+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+bk+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function a7(){$("#popupmenu li.popup").MyPopup("close")}function Z(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",function(bi){I.call(this,bi)}).on("dblclick.popupmenu",function(bi){G(bi)}).MyKeyboardEventHandler();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){a7()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"})});$("body").off(".popupmenu").on("click.popupmenu",function(){a7()}).on("keydown.popupmenu",function(bi){if(bi.which==27){a7()}});$("#filler").on("contextmenu",function(){a7()})}function ar(bi){var bj=$("#fileList");return $.get(u(bj.data("uri")),{ajax:"getFileListEntry",template:bj.data("entrytemplate"),file:bi},function(bk){try{var bl=$(bk);row=$("tr[data-file='"+aa(bi)+"']",bj);if(row.length>0){row.replaceWith(bl)}else{bl.appendTo(bj)}aD()}catch(bm){aC()}})}function a5(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(bj,bi){if(bi.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!bi.value);$("#flt").trigger("fileListViewChanged")}else{if(bi.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!bi.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",ak("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",ak("settings.show.dotfolders")=="no")}function aW(){var bi=ak("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bm,bl){var bk=$(this);if(bk.data("thumb")!=bk.data("icon")){var bj=bk.data("thumb");var bn=bk.data("icon");var bo=$("#emptyimage").attr("src");bk.attr("src",bi?(bj===""?bo:bj):(bn===""?bo:bn));bk.toggleClass("thumbnail",bi)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(bj,bi){if(bi.setting=="settings.enable.thumbnails"){aW()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var bi=$(this);var bj=bi.data("icon");bi.removeClass("thumbnail").attr("src",bj!==""?bj:$("#emptyimage").attr("src"))})})}function ag(bi){return bi.replace(/( {2,})/g,'<span class="ws">$1</span>')}function aH(bi){var bj=document.documentElement;if(bi){if(bj.requestFullScreen){bj.requestFullScreen()}else{if(bj.mozRequestFullScreen){bj.mozRequestFullScreen()}else{if(bj.webkitRequestFullscreen){bj.webkitRequestFullscreen()}else{if(bj.webkitRequestFullScreen){bj.webkitRequestFullScreen()}else{if(bj.msRequestFullscreen){bj.msRequestFullscreen()}}}}}}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.webkitCancelFullscreen){document.webkitCancelFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}}}}}}}function aj(bi){$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",bi)}function at(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?true:false}function q(bj,bi){var bl=ay();var bk=$.get(window.location.pathname,bj,function(bm){bl.remove();S(bm);bi(bm)});K(bk)}function aG(bj,bi){var bl=ay();var bk=$.post(window.location.pathname,bj,function(bm){bl.remove();S(bm);bi(bm)});K(bk)}function ah(){ToolBox={addFullscreenChangeListener:aj,addMissingSlash:u,blockPage:ay,changeUri:N,concatUri:l,confirmDialog:M,cookie:ak,fixElementPosition:ad,getDialog:q,getDialogByPost:aG,getSelectedFiles:aM,getSelectedRows:p,handleJSONResponse:S,handleWindowResize:x,hidePopupMenu:a7,initFileList:aD,initPopupMenu:Z,initTabs:am,initUpload:av,isFullscreen:at,notify:aX,notifyError:ba,notifyInfo:b,notifyWarn:a4,preventDefault:G,preventDefaultImmediatly:aE,postAction:a6,quoteWhiteSpaces:ag,refreshFileListEntry:ar,removeAbortDialog:a1,renderAbortDialog:K,renderByteSize:a,renderByteSizes:aI,rmcookies:aw,simpleEscape:aa,stripSlash:d,togglecookie:B,toggleFullscreen:aH,toggleRowSelection:be,uncheckSelectedRows:aq,updateFileList:aC}}});
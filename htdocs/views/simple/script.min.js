var ToolBox={};$(function(){try{bd();Z();aH();Q();j();ao();aC();w();U();aX();ab();aK();aL();bf();h();g();F();M();aS();s();T();am();aD();f();a1();a7();c();aW();bb();be();an()}catch(ai){console.log(ai)}ah();au();$.ajaxSetup({traditional:true});$(document).ajaxError(function(bl,bm,bk,e){console.log(bl);console.log(bm);console.log(bk);console.log(e);if(bm&&bm.statusText&&bm.statusText!="abort"){bc(bm.statusText)}$("div.overlay").remove()});$.ajaxPrefilter("script",function(e,bl,bk){e.cache=true});aE($("#flt").attr("data-uri"));function an(e){if(!e){e=$(document)}$(".tabsel",e).on("click keyup",function(bm){if(bm.type=="keyup"&&bm.keyCode!=32&&bm.keyCode!=13){return}H(bm);var bk=$(this);$(".tabsel.activetabsel",e).removeClass("activetabsel");bk.addClass("activetabsel");$(".tab.showtab",e).removeClass("showtab");var bl=$(".tab."+bk.data("group"),e).addClass("showtab");$(":focusable:visible:first",bl).focus()})}function be(){if(!al("settings.show.statusbar")){al("settings.show.statusbar","no");al("settings.show.statusbar.keep","yes")}$("#statusbar").toggleClass("enabled",al("settings.show.statusbar")=="yes");$("#statusbar .unselectable").off("change").on("change",function(bk){$(this).prop("checked",true);H(bk)});function e(){var bl=$("#fileListTable");var bk=$("#statusbar");$(".filecount",bk).html(bl.attr("data-filecounter"));$(".dircount",bk).html(bl.attr("data-dircounter"));$(".sum",bk).html(bl.attr("data-sumcounter"));$(".foldersize",bk).attr("title",$.MyStringHelper.renderByteSizes(bl.data("foldersize"))).html($.MyStringHelper.renderByteSize(bl.data("foldersize")));$(".selfilecount",bk).html(bl.attr("data-fileselcounter"));$(".seldircount",bk).html(bl.attr("data-dirselcounter"));$(".selsum",bk).html(bl.attr("data-sumselcounter"));$(".selfoldersize",bk).attr("title",$.MyStringHelper.renderByteSizes(bl.attr("data-folderselsize"))).html($.MyStringHelper.renderByteSize(bl.attr("data-folderselsize")));$(".selected-files-stats",bk).toggle(bl.attr("data-fileselcounter")!==0||bl.attr("data-dirselcounter")!==0)}e();$("#flt").on("counterUpdated fileListChanged selectionCounterUpdated",e);$("body").on("notify",function(bk,bl){$("#statusbar .notify").attr("title",bl.msg).removeClass("error message warning").addClass(bl.type).html(bl.msg).MyTooltip()});$("body").on("settingchanged",function(bk,bl){if(bl.setting=="settings.show.statusbar"){$("#statusbar").toggleClass("enabled",bl.value)}});$("#statusbar").MyTooltip()}function aW(){$("#flt").on("fileListChanged",function(){$("#flt,#bookmarks").MyTooltip()}).on("bookmarksChanged",function(){$("#bookmarks").MyTooltip()});$("#nav,#controls,#autorefreshtimer,#popupmenu").MyTooltip()}function a1(){$("#flt").on("fileListChanged",function(){$("#fileList tr").off("keydown.flctr").on("keydown.flctr",function(bl){var bk=this.tabIndex||1;var e=$(this);if(e.is(":focus")){if(bl.keyCode==32){Y.call(this,bl)}else{if(bl.keyCode==13){O(m($("#fileList").attr("data-uri"),encodeURIComponent(d(e.attr("data-file")))),e.attr("data-type")=="file")}else{if(bl.keyCode==46){if($("#fileList tr.selected:visible").length===0){if(W(e)){R(e)}}else{af()}}else{if(bl.keyCode==36){$("#fileList tr:visible").first().focus()}else{if(bl.keyCode==35){$("#fileList tr:visible").last().focus()}else{if(bl.keyCode==45){$(".paste").trigger("click")}}}}}}}if(bl.keyCode==38&&bk>-1){H(bl);if(W(e)&&(bl.shiftKey||bl.altKey||bl.ctrlKey||bl.metaKey)){bg(e,true);$("#flt").trigger("fileListSelChanged")}e.prevAll(":focusable:first").focus();aq()}else{if(bl.keyCode==40){H(bl);if(W(e)&&(bl.shiftKey||bl.altKey||bl.ctrlKey||bl.metaKey)){bg(e,true);$("#flt").trigger("fileListSelChanged")}e.nextAll(":focusable:first").focus();aq()}}});$("#fileList tr[tabindex='1']").focus()});$("#accesskeydetailseventcatcher").on("focus",t);$("#gotofilelisteventcatcher").on("focus",function(){$("#fileList tr:focusable:first").focus()});$("#gotoappsmenueventcatcher").on("focus",function(){$("#apps :focusable:first").focus()});$("#gototoolbareventcatcher").on("focus",function(){$(".toolbar :focusable:first").focus()})}function f(){$("#flt").on("fileListChanged",function(){$(".tableconfigbutton").click(function(bl){H(bl);if($(this).hasClass("disabled")){return}$(".tableconfigbutton").addClass("disabled");var bk=$("#flt").data("TableConfigDialog");if(bk){l($(bk))}else{if($("#tableconfigdialogtemplate").length>0){var e=$("#tableconfigdialogtemplate").html();$("#flt").data("TableConfigDialog",e);l($(e))}else{$.get($("#fileList").attr("data-uri"),{ajax:"getTableConfigDialog",template:$(this).attr("data-template")},function(bm){if(bm.error){S(bm)}$("#flt").data("TableConfigDialog",bm);l($(bm))})}}}).MyKeyboardEventHandler()})}function l(bk){var bm=$.map($("#fileListTable thead th[data-name]:not(.hidden)"),function(bp,bo){return $(bp).attr("data-name")});$.each(bm,function(bo,bp){bk.find("input[name='visiblecolumn'][value='"+bp+"']").prop("checked",true)});bk.find("input[name='visiblecolumn'][value='name']").attr("readonly","readonly").prop("checked",true).click(function(bo){H(bo)}).closest("li").addClass("disabled");$("#fileListTable thead th.sorter-false").each(function(bo,bp){bk.find("input[name='sortingcolumn'][value='"+$(bp).attr("data-name")+"']").prop("disabled",true).click(function(bq){H(bq)}).closest("li").addClass("disabled")});var bn=al("order")?al("order").split("_"):"name_asc".split("_");var bl=bn[0];var e=bn[1]||"asc";bk.find("input[name='sortingcolumn'][value='"+bl+"']").prop("checked",true);bk.find("input[name='sortingorder'][value='"+e+"']").prop("checked",true);bk.find("input[value='fileactions']").closest("li").hide();bk.find("input[name='save']").button().click(function(bp){var bu=bm.slice(0);var bx=$.map($("input[name='visiblecolumn']:checked"),function(bz,by){return $(bz).attr("value")});var bw=[];for(var bs=bu.length-1;bs>=0;bs--){if($.inArray(bu[bs],bx)==-1){bw.push(bu[bs]);bu.splice(bs,1)}}var bq=[];$.each(bx,function(by,bz){if($.inArray(bz,bu)==-1){bq.push(bz);bu.push(bz)}});al("visibletablecolumns",bu.join(","),1);var bv=bk.find("input[name='sortingcolumn']:checked").attr("value");var br=bk.find("input[name='sortingorder']:checked").attr("value");al("order",bv+(br=="desc"?"_desc":""),1);if(bx.sort().join(",")!=bm.sort().join(",")){$.each(bq,function(bz,bA){var by=$("#fileListTable th[data-name='"+bA+"']").removeClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bC,bB){$("td",$(bB)).eq(by).show()})});$.each(bw,function(bz,bA){var by=$("#fileListTable th[data-name='"+bA+"']").addClass("hidden").prop("cellIndex");$("#fileList tr").each(function(bC,bB){$("td",$(bB)).eq(by).hide()})})}else{if(bv!=bl||br!=e){var bo=$("#fileListTable th[data-name='"+bv+"']");var bt=br=="desc"?-1:1;n(bo.prop("cellIndex"),bt);if(bo.length>0){x(bo.attr("data-sorttype")||"string",bo.attr("data-sort"),bt,bo.prop("cellIndex"),"data-file")}}}bk.dialog("close")});bk.find("input[name='cancel']").button().click(function(bo){H(bo);bk.dialog("close");return false});bk.find("#tableconfigform").submit(function(bo){return false});bk.dialog({modal:true,width:"auto",title:bk.attr("data-title")||bk.attr("title"),dialogClass:"tableconfigdialog",height:"auto",close:function(){$(".tableconfigbutton").removeClass("disabled");bk.dialog("destroy")}})}function a0(e){if(e){H(e)}var bl=$(this).hasClass("collapsed");var bk=$(this).hasClass("iconsonly");if(!bl&&!bk){bk=true}else{if(bk){bk=false;bl=true}else{bl=false}}$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",bl).toggleClass("sidebar-iconsonly",bk);$(".action.collapse-sidebar").toggleClass("collapsed",bl).toggleClass("iconsonly",bk);if(!bk&&!bl){ay("sidebar")}else{al("sidebar",bk?"iconsonly":bl?"false":"true")}y()}function aD(){$(".action.collapse-sidebar").click(a0).MyKeyboardEventHandler().MyTooltip();if(al("sidebar")&&al("sidebar")!="true"){$(".collapse-sidebar-listener").toggleClass("sidebar-collapsed",al("sidebar")=="false").toggleClass("sidebar-iconsonly",al("sidebar")=="iconsonly");$(".action.collapse-sidebar").toggleClass("collapsed",al("sidebar")=="false").toggleClass("iconsonly",al("sidebar")=="iconsonly");y()}$(".action.collapse-head").click(function(e){H(e);$(".action.collapse-head").toggleClass("collapsed");var bk=$(this).hasClass("collapsed");$(".collapse-head-collapsible").toggle(!bk);$(".collapse-head-listener").toggleClass("head-collapsed",bk);C("head","false",bk,1);y()}).MyTooltip().MyKeyboardEventHandler();if(al("head")=="false"){$(".action.collapse-head").first().trigger("click")}}function am(){$(".action.autorefreshmenu").dblclick(function(e){H(e);aE()});aR($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefresh").on("started",function(){aR($(".action.autorefreshrunning, .autorefreshtimer"),false);$("#autorefreshtimer").show();$(".action.autorefreshtoggle").addClass("running")}).on("stopped",function(){aR($(".action.autorefreshrunning, .autorefreshtimer"),true);$("#autorefreshtimer").hide();$(".action.autorefreshtoggle").removeClass("running")});$("#flt").on("fileListChanged",function(){if(al("autorefresh")!==""&&parseInt(al("autorefresh"))>0){a4(parseInt(al("autorefresh")))}});$(".action.setautorefresh").click(function(e){H(e);$("#autorefresh ul").addClass("hidden");if($(this).attr("data-value")=="now"){aE();return}al("autorefresh",$(this).attr("data-value"));a4(parseInt($(this).attr("data-value")))}).on("keyup",function(bk){if(bk.keyCode==32||bk.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshclear").click(function(e){H(e);if($(this).hasClass("disabled")){return}window.clearInterval($("#autorefresh").data("timer"));ay("autorefresh");$("#autorefresh").trigger("stopped");$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bk){if(bk.keyCode==32||bk.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$(".action.autorefreshtoggle").click(function(bk){H(bk);if($(this).hasClass("disabled")){return}var e=$("#autorefresh");if(e.data("timer")!=null){window.clearInterval(e.data("timer"));e.data("timer",null);$(".action.autorefreshtoggle").removeClass("running")}else{a4(e.data("timeout"));$(".action.autorefreshtoggle").addClass("running")}$("#autorefresh ul").addClass("hidden")}).on("keyup",function(bk){if(bk.keyCode==32||bk.keyCode==13){$(this).trigger("click");$(".action.autorefreshmenu").trigger("click")}});$("#autorefreshtimer").draggable({stop:function(bl,bk){al("autorefreshtimerpos",JSON.stringify(ad("#autorefreshtimer",bk.offset)))}});if(al("autorefreshtimerpos")){ad("#autorefreshtimer",JSON.parse(al("autorefreshtimerpos")))}}function ad(bo,bk){var bn=$(bo);var bl=$(window);var bm={left:Math.min(Math.max(bk.left,0),bl.width()-bn.outerWidth()+bl.scrollLeft()),top:Math.min(Math.max(bk.top,0),bl.height()-bn.outerHeight()+bl.scrollTop())};bn.offset(bm);return bm}function ac(e){var bl=$(".autorefreshtimer");var bm=bl.attr("data-template")||"%sm %ss";var bk=Math.floor(e/60);var bn=e%60;if(bn<10){bn="0"+bn}bl.html(bm.replace("%s",bk).replace("%s",bn))}function a4(bk){var e=$("#autorefresh");if(e.data("timer")!=null){window.clearInterval(e.data("timer"))}e.data("timeout",bk);ac(bk);e.data("timer",window.setInterval(function(){var bl=e.data("timeout")-1;ac(bl);e.data("timeout",bl);if(bl<0){window.clearInterval(e.data("timer"));e.data("timer",null);ac(0);e.trigger("stopped");aE()}},1000));e.trigger("started")}function T(){var e=$("#settings");e.data("initHandler",{init:function(){$("input[type=checkbox][name^='settings.']",e).each(function(bl,bk){$(bk).prop("checked",al($(bk).prop("name"))!="no").click(function(bm){if(al($(this).prop("name")+".keep")){al($(this).prop("name"),$(this).is(":checked")?"yes":"no",1)}else{C($(this).prop("name"),"no",!$(this).is(":checked"),1)}$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$(this).is(":checked")})})});$("select[name^='settings.']",e).change(function(){if($(this).prop("name")=="settings.lang"){al($(this).prop("name").replace(/^settings./,""),$("option:selected",$(this)).val(),1);window.location.href=window.location.pathname}else{al($(this).prop("name"),$("option:selected",$(this)).val(),1);$("body").trigger("settingchanged",{setting:$(this).prop("name"),value:$("option:selected",$(this)).val()})}}).each(function(bm,bk){var bn=$(bk);var bl=bn.prop("name");if(bl=="settings.lang"){bl=bl.replace(/^settings\./,"")}$("option[value='"+al(bl)+"']",bn).prop("selected",true)})}})}function bd(){$(".accordion").accordion({collapsible:true,active:false});$("#flt").on("fileListChanged",function(){$(".dropdown-hover").off(".dropdown-hover").on("mouseenter.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("mouseleave.dropdown-hover",function(){$(".dropdown-menu",$(this)).hide()}).on("focus.dropdown-hover",function(){$(".dropdown-menu",$(this)).show()}).on("keyup.dropdown-hover",function(bk){if(bk.keyCode==13||bk.keyCode==32){$(".dropdown-menu",$(this)).hide()}});$(".dropdown-click").off(".dropdown-click").on("click.dropdown-click dblclick.dropdown-click",function(bk){H(bk);$(".dropdown-menu",$(this)).toggle()}).MyKeyboardEventHandler({namespace:"dropdown-click"})})}function s(){$("#flt").on("fileListChanged",y).on("fileListViewChanged",y);$(window).resize(y);y()}function y(){var e=$(window).width()-$("#nav").width();$("#content").width(e);$("#controls").width(e);$("body").trigger("windowResized")}function M(){$(".action.changeuri").off(".changeuri").on("click.changeuri",bj);$(".action.refresh").off(".refresh").on("click.refresh",function(e){H(e);aE();return false});$("#flt").on("fileListChanged",function(){$("#fileList .is-dir .action.changeuri").off(".changeuri").on("click.changeuri",bj);$("#fileList .is-file .action.changeuri").off(".changeuri").on("click.changeuri",function(){var e=$(this);if(!e.closest("div.filename").is(".ui-draggable-dragging")){window.location.href=e.data("href")?e.data("href"):e.attr("href")}})})}function bj(e){H(e);if(!$(this).closest("div.filename").is(".ui-draggable-dragging")){O($(this).data("href")||$(this).attr("href"))}return false}function F(){$("#flt").on("fileListChanged",function(){$(".toggleselection").off("click.select").on("click.select",function(e){$("#fileList tr:not(:hidden).unselectable-no").each(function(bk,bl){$(this).toggleClass("selected");$(".selectbutton",$(this)).prop("checked",$(this).hasClass("selected"))});$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectnone").off("click.select").on("click.select",function(e){$("#fileList tr.selected:not(:hidden)").removeClass("selected");$("#fileList tr:not(:hidden) .selectbutton:checked").prop("checked",false);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"});$(".selectall").off("click.select").on("click.select",function(e){$("#fileList tr:not(.selected):not(:hidden).unselectable-no").addClass("selected");$("#fileList tr:not(:hidden).unselectable-no .selectbutton:not(:checked)").prop("checked",true);$("#flt").trigger("fileListSelChanged")}).MyKeyboardEventHandler({namespace:"select"})})}function g(){$("#clock").MyClock()}function aH(){$("#flt").on("bookmarksChanged",u).on("bookmarksChanged",B).on("fileListChanged",function(){u();B()});$(".action.addbookmark,.action.rmbookmark,.action.rmallbookmarks,.action.bookmarksortpath,.action.bookmarksorttime,.action.gotobookmark").click(aU)}function aR(e,bk){$.each(e,function(bn,bm){var bl=$(bm);if(bl.hasClass("hideit")){bl.toggle(!bk)}if(bl.hasClass("button")){bl.button("option","disabled",bk)}if(!bl.hasClass("notab")){bl.attr("tabindex",bk?-1:0)}bl.toggleClass("disabled",bk)})}function B(){var bn=m($("#flt").attr("data-uri"),"/");var e=false;var bm=0;var bl=0;while(al("bookmark"+bl)!=null){if(al("bookmark"+bl)==bn){e=true}if(al("bookmark"+bl)!="-"){bm++}bl++}$(".action.addbookmark").button("option","disabled",e);aR($(".action.rmbookmark"),!e);aR($(".action.bookmarksortpath"),bm<2);aR($(".action.bookmarksorttime"),bm<2);aR($(".action.rmallbookmarks"),bm===0);var bk=al("bookmarksort")==null?"time-desc":al("bookmarksort");$(".action.bookmarksortpath .path").hide();$(".action.bookmarksortpath .path-desc").hide();$(".action.bookmarksorttime .time").hide();$(".action.bookmarksorttime .time-desc").hide();if(bk=="path"||bk=="path-desc"||bk=="time"||bk=="time-desc"){$("#bookmarks .action.bookmarksort"+bk.replace(/-desc/,"")+" ."+bk).show()}}function u(){var bo=m($("#flt").attr("data-uri"),"/");$(".dyn-bookmark").each(function(bp,bq){$(bq).remove()});var bn=[];var bl=0;while(al("bookmark"+bl)!=null){if(al("bookmark"+bl)!="-"){bn.push({path:al("bookmark"+bl),time:parseInt(al("bookmark"+bl+"time"))})}bl++}var bm=al("bookmarksort")?al("bookmarksort"):"time-desc";var e=1;if(bm.indexOf("-desc")>0){e=-1;bm=bm.replace(/-desc/,"")}bn.sort(function(bq,bp){if(bm=="path"){return e*bq[bm].localeCompare(bp[bm])}else{return e*(bp[bm]-bq[bm])}});var bk=$("#bookmarktemplate").html();$.each(bn,function(bp,br){var bq=unescape(br.path);$("<li>"+bk.replace(/\$bookmarkpath/g,br.path).replace(/\$bookmarktext/,ag(aa(aV(bq,20))))+"</li>").insertAfter($("#bookmarktemplate")).click(aU).MyKeyboardEventHandler().addClass("action dyn-bookmark").attr("data-bookmark",br.path).attr("title",aa(bq)+" ("+(new Date(parseInt(br.time)))+")").attr("tabindex",br.path==bo?-1:0).toggleClass("disabled",br.path==bo).find(".action.rmsinglebookmark").click(aU).MyKeyboardEventHandler()})}function o(bk){var e=0;while(al("bookmark"+e)!=null&&al("bookmark"+e)!=bk){e++}if(al("bookmark"+e)==bk){al("bookmark"+e,"-",1)}$("#flt").trigger("bookmarksChanged")}function aU(bm){H(bm);if($(this).hasClass("disabled")){return}var e=$(this);var bl=$("#fileList").attr("data-uri");if(e.hasClass("addbookmark")){var bk=0;while(al("bookmark"+bk)!=null&&al("bookmark"+bk)!="-"&&al("bookmark"+bk)!=""&&al("bookmark"+bk)!=bl){bk++}al("bookmark"+bk,bl,1);al("bookmark"+bk+"time",(new Date()).getTime(),1);$("#flt").trigger("bookmarksChanged")}else{if(e.hasClass("dyn-bookmark")){O(e.attr("data-bookmark"));e.closest("ul").hide()}else{if(e.hasClass("rmbookmark")){o(bl)}else{if(e.hasClass("rmallbookmarks")){var bk=0;while(al("bookmark"+bk)!=null){ay("bookmark"+bk,"bookmark"+bk+"time");bk++}$("#flt").trigger("bookmarksChanged")}else{if(e.hasClass("rmsinglebookmark")){o($(this).attr("data-bookmark"))}else{if(e.hasClass("bookmarksortpath")){al("bookmarksort",al("bookmarksort")=="path"||al("bookmarksort")==null?"path-desc":"path");$("#flt").trigger("bookmarksChanged")}else{if(e.hasClass("bookmarksorttime")){al("bookmarksort",al("bookmarksort")=="time"?"time-desc":"time");$("#flt").trigger("bookmarksChanged")}}}}}}}}function aL(){$("#selstats").data("selstats",$("#selstats").html());$("#flt").on("fileListSelChanged",az).on("fileListViewChanged",az)}function az(){var bl=$("#selstats");var e=bl.data("selstats");var bk=aT();$("#fileListTable").attr("data-fileselcounter",bk.fileselcounter).attr("data-dirselcounter",bk.dirselcounter).attr("data-folderselsize",bk.folderselsize).attr("data-sumselcounter",bk.sumselcounter);$("#flt").trigger("selectionCounterUpdated");bl.html(e.replace(/\$filecount/g,bk.fileselcounter).replace(/\$dircount/g,bk.dirselcounter).replace(/\$sum/g,bk.sumselcounter).replace(/\$folderselsizes/g,$.MyStringHelper.renderByteSizes(bk.folderselsize)).replace(/\$folderselsize/g,$.MyStringHelper.renderByteSize(bk.folderselsize))).attr("title",$.MyStringHelper.renderByteSizes(bk.folderselsize)).MyTooltip()}function aX(){$("#pathinputform").submit(function(e){return false});$("#pathinputform input[name='uri']").keydown(function(e){if(e.keyCode==27){$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show()}else{if(e.keyCode==13){H(e);$("#pathinput").hide();$("#quicknav").show();$(".filterbox").show();O($(this).val())}}});$(".action.changedir").button().click(function(e){H(e);$("#pathinput").toggle();$("#quicknav").toggle();$("#pathinput input[name=uri]").focus().select();$(".filterbox").toggle()});$("#path [data-action='chdir']").button().click(function(e){H(e);$("#pathinput").hide();$("#quicknav").show();O($("#pathinput input[name='uri']").val())});$("#flt").on("fileListChanged",function(){$("#pathinput input[name=uri]").val(decodeURI($("#fileList").attr("data-uri")))})}function ab(){$("form#filterbox").submit(function(e){return false});$("form#filterbox input").keyup(D).change(D).autocomplete({minLength:1,select:D,close:D});$("form#filterbox .action.clearfilter").toggleClass("invisible",$("form#filterbox input").val()==="");$("form#filterbox input").keyup(function(){$("form#filterbox .action.clearfilter").toggleClass("invisible",$(this).val()==="")});$("form#filterbox .action.clearfilter").click(function(e){H(e);$("form#filterbox input").val("");D();$(this).addClass("invisible")});$("#flt").on("fileListChanged",D).on("fileListChanged",function(){var e=$.map($("#fileList tr"),function(bl,bk){return $(bl).attr("data-file")});$("form#filterbox input").autocomplete({source:function(bl,bk){try{var bn=new RegExp(bl.term);bk($.grep(e,function(bo){return bn.test(bo)}))}catch(bm){bk($.grep(e,function(bo){return bo.indexOf(bl.term)>-1}))}}})})}function D(){var e=$("form#filterbox input").val();$("#fileList tr").each(function(){try{var bl=new RegExp(e,"i");if(e===""||$(this).attr("data-file").match(bl)){$(this).show()}else{$(this).hide()}}catch(bk){if(e===""||$(this).attr("data-file").toLowerCase().indexOf(e.toLowerCase())>-1){$(this).show()}else{$(this).hide()}}});$("#flt").trigger("fileListViewChanged");return true}function A(bk,bl){if(!bl){bl=bk}var e=bl.loaded/bl.total*100;$("#progress .bar").css("width",e.toFixed(2)+"%").html(parseInt(e)+"% ("+$.MyStringHelper.renderByteSize(bl.loaded)+"/"+$.MyStringHelper.renderByteSize(bl.total)+"); "+bk.done+"/"+bk.uploads)}function ax(bl,bn,bk,bm){$("#flt").on("fileListChanged",function(){bl.fileupload("option","url",$("#fileList").attr("data-uri"))});var e={aborted:false,transports:[],done:0,failed:0,uploads:0};bl.fileupload({url:$("#fileList").attr("data-uri"),sequentialUploads:false,limitConcurrentUploads:3,dropZone:bm,singleFileUploads:true,autoUpload:false,add:function(br,bq){if(!e.aborted){var bs=bq.submit();var bp=bq.files[0].name;e.transports.push(bs);var bo=$("<div></div>").appendTo("#progress .info").attr("id","fpb"+bp).addClass("fileprogress");$("<div></div>").click(function(bt){H(bt);$(this).data("transport").abort($("#uploadaborted").html()+": "+$(this).data("filename"))}).appendTo(bo).attr("title",$("#cancel").html()).MyTooltip().addClass("cancel").html("&nbsp;").data({filename:bp,transport:bs});$("<div></div>").appendTo(bo).addClass("fileprogressbar running").html(bq.files[0].name+" ("+$.MyStringHelper.renderByteSize(bq.files[0].size)+"): 0%");e.uploads++;return true}return false},done:function(bp,bo){$("#progress [id='fpb"+bo.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bo.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass(bo.result.message?"done":"failed").css("width","100%").html(bo.result&&bo.result.error?bo.result.error:bo.result.message?bo.result.message:bo.files[0].name);if(bo.result.message){e.done++}else{e.failed++}A(e)},fail:function(bp,bo){$("#progress [id='fpb"+bo.files[0].name+"'] .cancel").remove();$("div[id='fpb"+bo.files[0].name+"'] .fileprogressbar","#progress .info").removeClass("running").addClass("failed").css("width","100%").html(bo.textStatus+": "+$.map(bo.files,function(bq,br){return bq.name}).join(", "));e.failed++;A(e);console.log(bo)},stop:function(bp,bo){A(e);$(this).data("ask.confirm",false);$("#progress").dialog("option","beforeClose",function(){return true});$("#progress").dialog("option","close",function(){aE()});$("#progress").dialog("option","buttons",[{text:$("#close").html(),click:function(){$(this).dialog("close")}}])},change:function(bp,bo){e.transports=[];e.aborted=false;e.files=[];e.uploads=0;e.failed=0;e.done=0;return true},start:function(bq,bp){var bo=[];bo.push({text:$("#close").html(),disabled:true});bo.push({text:$("#cancel").html(),click:function(){if(e.aborted){return}e.aborted=true;$.each(e.transports,function(br,bs){if(bs&&bs.abort){bs.abort($("#uploadaborted").html())}});e.transports=[]}});$("#progress").dialog({modal:true,title:bk,height:370,width:500,buttons:bo,dialogClass:"uploaddialog",beforeClose:function(){return false}});$("#progress").show().each(function(){$(this).find(".bar").css("width","0%").html("0%");$(this).find(".info").html("")})},progress:function(bq,bp){var bo=parseInt(bp.loaded/bp.total*100)+"%";$("div[id='fpb"+bp.files[0].name+"'] .fileprogressbar","#progress .info").css("width",bo).html(bp.files[0].name+" ("+$.MyStringHelper.renderByteSize(bp.files[0].size)+"): "+bo)},progressall:function(bp,bo){e.total=bo.total;e.loaded=bo.loaded;A(e,bo)},submit:function(bp,bo){if(!$(this).data("ask.confirm")){$(this).data("ask.confirm",al("settings.confirm.upload")=="no"||!X(bo)||window.confirm(bn))}$("#file-upload-form-relapath").val(bo.files[0].relativePath||(bo.files[0].webkitRelativePath&&bo.files[0].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/")||"");return $(this).data("ask.confirm")}})}function X(bk){for(var e=0;e<bk.files.length;e++){var bl;if(bk.files[e].relativePath&&bk.files[e].relativePath!=""){bl=bk.files[e].relativePath.split(/[\\\/]/)[0]+"/"}else{if(bk.files[e].webkitRelativePath&&bk.files[e].webkitRelativePath!=""){bl=bk.files[e].webkitRelativePath.split(/[\\\/]/).slice(0,-1).join("/")+"/"}}if(bl&&$("#fileList tr[data-file='"+aa(bl)+"']").length>0){return true}else{if($("#fileList tr[data-file='"+aa(bk.files[e].name)+"']").length>0){return true}}}return false}function aK(){ax($("#file-upload-form"),$("#fileuploadconfirm").html(),$("#progress").attr("data-title"),$(document));$(".action.upload").off("click.upload").on("click.upload",function(e){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").removeAttr("directory webkitdirectory mozdirectory").trigger("click")});$(".action.uploaddir.uibutton").button();$(".action.uploaddir").off("click.uploaddir").on("click.uploaddir",function(e){if($(this).hasClass("disabled")){return}$("#file-upload-form input[type=file]").attr({directory:"directory",webkitdirectory:"webkitdirectory",mozdirectory:"mozdirectory"}).trigger("click")});$(document).on("dragenter",function(bk){$("#fileList").addClass("draghover")}).on("dragleave",function(bk){$("#fileList").removeClass("draghover")}).on("drop",function(bk){$("#fileList").removeClass("hover")})}function N(bl,e){var bk;if(e.setting){bl+='<div class="confirmdialogsetting"><input type="checkbox" name="'+e.setting+'"/> '+$("#confirmdialogsetting").html()+"</div>";bk=al(e.setting)}$("#confirmdialog").html(bl).dialog({modal:true,width:500,height:"auto",title:$("#confirmdialog").attr("data-title"),closeText:$("#close").html(),buttons:[{text:$("#cancel").html(),click:function(){if(e.setting){C(e.setting,bk,bk&&bk!=="",1)}$("#confirmdialog").dialog("close");if(e.cancel){e.cancel()}}},{text:"OK",click:function(){$("#confirmdialog").dialog("close");if(e.confirm){e.confirm()}}}],open:function(){if(e.setting){$("input[name='"+e.setting+"']",$(this)).click(function(bm){C(e.setting,"no",!$(this).is(":checked"),1)}).prop("checked",al(e.setting)!="no")}},close:function(){if(e.cancel){e.cancel()}}}).show()}function bh(){return $("#fileList tr.isreadable-yes.unselectable-no").filter(function(){return $(this).hasClass("selected")&&$(this).is(":visible")}).find("div.filename")}function q(bk){var e=$("#fileList tr.selected:visible");if(e.length==0){e=$(bk).closest("tr[data-file]")}if(e.length==0){e=$("#fileList tr:visible:focus")}return e}function aN(e){return $.map(q(e),function(bk,bl){return $(bk).attr("data-file")})}function a5(bk){H(bk);var e=$(this);if(e.hasClass("disabled")){return}var bl=e.closest("tr");if(e.hasClass("rename")){a2(bl)}else{if(e.hasClass("delete")){R(bl)}else{$("body").trigger("fileActionEvent",{obj:e,event:bk,file:bl.attr("data-file"),selected:[bl.data("file")],row:bl})}}}function j(){$("#fileactions").on("click dblclick",function(e){H(e);$(".fileactions-popup").toggle()}).MyKeyboardEventHandler().MyTooltip();$("#fileactions .action").on("click dblclick",a5).MyKeyboardEventHandler();$("#fileactions li.popup").MyPopup();$("#flt").on("fileListChanged",function(){$("#fileList tr.unselectable-no").off(".fileAction").on("mouseenter.fileAction focusin.fileAction",aB).on("mouseleave.fileAction",p)}).on("beforeFileListChange replaceRow",p);k();$("body").on("settingchanged",k)}function k(e,bk){$("#fileactions").toggleClass("hidefileactions",al("settings.show.fileactions")=="no").toggleClass("hidelabels",al("settings.show.fileactionlabels")=="no").toggleClass("showalways",al("settings.show.fileactionalways")=="no")}function aB(bk){var e=$(this);if($("#fileactions",e).length===0){$(".action.changeuri.filename",e).after($("#fileactions"))}}function p(e){$("#fileactions").appendTo($(".template"))}function aS(){$("#flt").on("fileListChanged",function(){$("#fileList tr.isviewable-yes[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","imggallery").each(function(bl,bk){var e=$(bk);if(!e.attr("href")){e.data("fancybox-href",e.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(this.element).html()},helpers:{buttons:{},thumbs:{width:60,height:60,source:function(e){return(e.element).attr("data-href")+"?action=thumb"}}}});$("#fileList tr.isviewable-no[data-mime^='image/'][data-size!='0']:visible .action.changeuri").off("click").attr("data-fancybox-group","wtimggallery").each(function(bl,bk){var e=$(bk);if(!e.attr("href")){e.data("fancybox-href",e.data("href"))}}).fancybox({padding:0,afterShow:function(){$(".fancybox-close").focus()},beforeLoad:function(){this.title=$(".nametext",this.element).html()},helpers:{buttons:{}}})})}function aF(){var bk=$("#fileListTable");var e=$("#fileList");aj();$("#fileList.selectable-false tr").removeClass("unselectable-no").addClass("unselectable-yes");$("#fileList tr.unselectable-yes .selectbutton").attr("disabled","disabled");$("#fileList tr").off("click.initFileList").on("click.initFileList",Y).off("dblclick.initFileList").on("dblclick.initFileList",function(bl){O(m($("#fileList").attr("data-uri"),encodeURIComponent(d($(this).attr("data-file")))),$(this).attr("data-type")=="file")});$("#fileList tr.selected td .selectbutton:not(:checked)").prop("checked",true);$("#flt").disableSelection();$("#fileList:not(.dnd-false) tr.iswriteable-yes[data-type='dir']").droppable({scope:"fileList",tolerance:"pointer",drop:G,hoverClass:"draghover"});$("#fileList:not(.dnd-false) tr.isreadable-yes.unselectable-no div.filename").multiDraggable({getGroup:bh,zIndex:200,scope:"fileList",revert:true,axis:"y"});$("#fileListTable th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(bm){var bl=$(bm.currentTarget);return $(bm.currentTarget).clone().width(bl.width()).addClass("dragged")}});$("#fileListTable th.dragaccept,#fileListTable th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:P,hoverClass:"draghover"});$("#fileListTable th").MyKeyboardEventHandler();$("#fileListTable th:not(.resizable-false)").off("click.initFileList").off("click.tablesorter").each(function(bo,bl){var bm=$(bl);$("<div/>").prependTo(bm).html("&nbsp;").addClass("columnResizeHandle left");$("<div/>").prependTo(bm).html("&nbsp;").addClass("columnResizeHandle right");bm.data("origWidth",bm.width());var bp=al(bm.prop("id")+".width");if(bp){bm.width(parseFloat(bp))}var bn=0;$(bl).on("click.initFileList",function(br){var bq=$(this);bn++;if(bn==1){window.setTimeout(function(){if(bn==1){if(!bq.hasClass("sorter-false")){aQ.call(bq,br)}}else{var bs=bq.width()==bq.data("origWidth")?1:bq.data("origWidth");bq.width(bs);C(bq.prop("id")+".width",bs,bs!=bq.data("origWidth"),1)}bn=0},300)}})});$("#fileListTable .columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(bl,bm){startPos=parseInt(bm.offset.left);column=$(this).closest("th");startWidth=column.width();handlePos=$(this).hasClass("left")?"left":"right"},stop:function(bl,bm){$(this).removeAttr("style");al(column.attr("id")+".width",column.width(),1)},drag:function(bl,bm){if(handlePos=="right"){column.width(startWidth+bm.offset.left-startPos)}else{column.width(startWidth+startPos-bm.offset.left)}}});aq();$("#fileList tr:focusable:visible:first").focus();$("#flt").trigger("fileListChanged")}function aq(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var e=window.getSelection();if(e&&e.removeAllRanges){e.removeAllRanges()}}}}function P(bk,bl){var bn=bl.draggable.prop("cellIndex");var e=$(this).prop("cellIndex");if(bn+1==e){return false}var bm=$("#fileListTable thead th");bm.eq(bn).detach().insertBefore(bm.eq(e));$.each($("#fileList tr"),function(){var bo=$(this).children("td");bo.eq(bn).detach().insertBefore(bo.eq(e))});al("visibletablecolumns",$.map($("#fileListTable thead th[data-name]:not(.hidden):not(:last)"),function(bo){return $(bo).attr("data-name")}).join(","),1);return true}function aj(){if(al("order")){var bp=al("order").split("_");var bk=bp[0];var bl=bp[1]&&bp[1]=="desc"?-1:1;var bn=$("#fileListTable thead th[data-name='"+bk+"']:not(.sorter-false)");if(bn.length>0){var bo=bn.attr("data-sort");var bm=bn.attr("data-sorttype")||"string";var e=bn.prop("cellIndex");n(e,bl);x(bm,bo,bl,e,"data-file")}}$("#fileListTable thead th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablesorter").on("click.tablesorter",aQ)}function aQ(bm){var bp=$("#fileListTable");var bn=bp.data("tablesorter-lastclickedcolumn");var bk=bp.data("tablesorter-sortorder");var bl=$(this).attr("data-sorttype")||"string";var bo=$(this).attr("data-sort");var e=$(this).prop("cellIndex");if(!bk){bk=-1}if(bn==e){bk=-bk}al("order",$(this).attr("data-name")+(bk==-1?"_desc":""),1);n(e,bk);x(bl,bo,bk,e,"data-file")}function n(e,bk){var bl=$("#fileListTable");bl.data("tablesorter-lastclickedcolumn",e);bl.data("tablesorter-sortorder",bk);$("#fileListTable thead th").removeClass("tablesorter-down").removeClass("tablesorter-up").eq(e).addClass(bk==1?"tablesorter-up":"tablesorter-down")}function x(bl,bn,bk,e,bm){$("#fileListTable tbody").MyFileTableSorter(bl,bn,bk,e,bm)}function m(bk,e){return(v(bk)+e).replace(/\/\//g,"/").replace(/\/[^\/]+\/\.\.\//g,"/")}function v(e){return(e+"/").replace(/\/\//g,"/")}function R(e){e.fadeTo("slow",0.5);N($("#deletefileconfirm").html().replace(/%s/,ag(aa(e.attr("data-displayname")))),{confirm:function(){var bk=e.attr("data-file");K(e);var bm=aA();var bl=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:bk},function(bn){bm.remove();if(bn.error){aE()}S(bn)});L(bl)},cancel:function(){e.fadeTo("fast",1)}})}function S(e){if(e.error){bc(e.error)}if(e.warn){a6(e.warn)}if(e.message){b(e.message)}if(e.quicknav){$("#quicknav").html(e.quicknav).MyTooltip();$("#quicknav a").click(function(bk){H(bk);O($(this).attr("href"))})}}function z(bn,bk,e){var bm=aA();var bl=$.post($("#fileList").attr("data-uri"),{rename:"yes",newname:e,file:bk},function(bo){bn.find(".renamefield").remove();bn.find("td.filename div.hidden div.filename").unwrap();if(bo.message){var bp=$.get($("#fileList").attr("data-uri"),{ajax:"getFileListEntry",file:e,template:$("#fileList").attr("data-entrytemplate")},function(bq){try{var br=$(bq);var bt=$("tr[data-file='"+e+"']");if(bt.length>0){bt.remove()}$("#flt").trigger("replaceRow",{row:bn,newrow:br});bn.replaceWith(br);bn=br;aF();br.focus()}catch(bs){aE()}bm.remove()});L(bp)}else{bm.remove()}S(bo)});L(bl)}function a2(bl){var bk=bl.closest("tr[data-file]").data("file");var e=bk.replace(/\/$/,"");$.MyInplaceEditor({editorTarget:bl.find("td.filename"),defaultValue:e,beforeEvent:function(){$("#flt").enableSelection()},finalEvent:function(){$("#flt").disableSelection()},changeEvent:function(bn){var bm=bn.value.replace(/\//g,"");if(bm==e){return}if(al("settings.confirm.rename")!="no"){N($("#movefileconfirm").html().replace(/\\n/g,"<br/>").replace(/%s/,ag(bk)).replace(/%s/,ag(bm)),{confirm:function(){z(bl,bk,bm)},setting:"settings.confirm.rename"})}else{z(bl,bk,bm)}}})}function aZ(e,bk){console.log("notify["+e+"]: "+bk);if(al("settings.messages."+e)=="no"){return}noty({text:bk,type:e,layout:"topCenter",timeout:30000});$("body").trigger("notify",{type:e,msg:bk})}function bc(e){aZ("error",e)}function b(e){aZ("message",e)}function a6(e){aZ("warning",e)}function bg(bk,e){if(!bk){return}bk.toggleClass("selected",e);bk.find(".selectbutton").prop("checked",bk.hasClass("selected"))}function W(e){return e.attr("data-file")!=".."&&!e.hasClass("unselectable-yes")}function Y(bl){var bp=$("#fileListTable");if(W($(this))){var bo=this.rowIndex;var e=bo;if((bl.shiftKey||bl.metaKey||bl.altKey)&&bp.data("lastSelectedRowIndex")){e=bp.data("lastSelectedRowIndex");if(e<bo){var bn=e;e=bo;bo=bn}for(var bk=bo+1;bk<e;bk++){var bm=$("#fileList tr:visible").filter(function(){return this.rowIndex==bk});if(bm.length===0){continue}bg(bm);bm=bm.next()}}bg($(this));bp.data("lastSelectedRowIndex",this.rowIndex);$("#flt").trigger("fileListSelChanged")}}function bf(){$(".dialog.action").click(aO)}function aO(bk){H(bk);if($(this).hasClass("disabled")){return}var e=$(this);e.addClass("disabled");var bl=$("#"+e.attr("data-action"));if(bl.attr("title")){bl.data("title",bl.attr("title"))}bl.attr("title",bl.data("title"));bl.dialog({modal:true,width:"auto",open:function(){if(bl.data("initHandler")){bl.data("initHandler").init()}},close:function(){e.removeClass("disabled")},dialogClass:e.attr("data-action")+"dialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("close")}}]}).show()}function Q(){bi();$(".action.uibutton").button();$("#flt").on("fileListSelChanged",ba).on("fileListViewChanged",ba)}function bi(){aR($(".access-writeable, .access-readable, .access-selectable, .sel-one, .sel-multi"),true)}function ba(){var bk=aT();var bl=$("#fileListTable");var e=bl.hasClass("iswriteable-no")?":not(.access-writeable)":"";e+=bl.hasClass("isreadable-no")?":not(.access-readable)":"";e+=bl.hasClass("unselectable-no")?":not(.access-selectable)":"";aR($(".access-writeable"),bl.hasClass("iswriteable-no"));aR($(".access-readable"),bl.hasClass("isreadable-no"));aR($(".access-selectable"),bl.hasClass("unselectable-yes"));aR($(".sel-none"+e),bk.sumselcounter!==0);aR($(".sel-one"+e),bk.sumselcounter!=1);aR($(".sel-multi"+e),bk.sumselcounter===0);aR($(".sel-noneorone"+e),bk.sumselcounter>1);aR($(".sel-none.sel-dir"+e),bk.fileselcounter!==0);aR($(".sel-one.sel-dir"+e),bk.fileselcounter>0||bk.dirselcounter!=1);aR($(".sel-multi.sel-dir"+e),bk.fileselcounter>0||bk.dirselcounter===0);aR($(".sel-noneorone.sel-dir"+e),bk.fileselcounter>0||bk.dirselcounter>1);aR($(".sel-noneormulti.sel-dir"+e),bk.fileselcounter>0);aR($(".sel-none.sel-file"+e),bk.fileselcounter!==0);aR($(".sel-one.sel-file"+e),bk.dirselcounter>0||bk.fileselcounter!=1);aR($(".sel-multi.sel-file"+e),bk.dirselcounter>0||bk.fileselcounter===0);aR($(".sel-noneorone.sel-file"+e),bk.dirselcounter>0||bk.fileselcounter>1);aR($(".sel-noneormulti.sel-file"+e),bk.dirselcounter>0)}function aC(){$("#flt").on("fileListChanged",ap).on("fileListViewChanged",ap)}function I(e){if(!e){e=$("#fileListTable")}if(e&&e.attr){e.attr("data-filecounter",0).attr("data-dircounter",0).attr("data-foldersize",0).attr("data-sumcounter",0).attr("data-fileselcounter",0).attr("data-dirselcounter",0).attr("data-folderselsize",0).attr("data-sumselcounter",0)}}function aM(){var bk=$("#fileListTable");I(bk);var e=aT();bk.attr("data-dircounter",e.dircounter);bk.attr("data-filecounter",e.filecounter);bk.attr("data-foldersize",e.foldersize);bk.attr("data-sumcounter",e.sumcounter);$("#flt").trigger("counterUpdated")}function aT(){var bk=[];bk.dircounter=$("#fileList tr.is-subdir-yes:visible").length;bk.filecounter=$("#fileList tr.is-file:visible").length;bk.sumcounter=bk.dircounter+bk.filecounter;bk.dirselcounter=$("#fileList tr.selected.is-subdir-yes:visible").length;bk.fileselcounter=$("#fileList tr.selected.is-file:visible").length;bk.sumselcounter=bk.dirselcounter+bk.fileselcounter;var e=0;var bl=0;$("#fileList tr:visible").each(function(bn,bo){var bm=parseInt($(this).attr("data-size"));if($(this).hasClass("selected")){bl+=bm}e+=bm});bk.foldersize=e;bk.folderselsize=bl;return bk}function ap(){var bl=$("#headerName");var bm=$("#fileListTable");var bk=$("#headerSize");aM();if(bl.length>0&&!bl.attr("data-title")){bl.attr("data-title",bl.attr("title"))}if(bk.length>0&&!bk.attr("data-title")){bk.attr("data-title",bk.attr("title"))}if(bl.length>0){bl.attr("title",bl.attr("data-title").replace(/\$filecount/,bm.attr("data-filecounter")).replace(/\$dircount/,bm.attr("data-dircounter")).replace(/\$sum/,parseInt(bm.attr("data-dircounter"))+parseInt(bm.attr("data-filecounter"))))}var e=parseInt(bm.attr("data-foldersize"));if(bk.length>0){bk.attr("title",bk.attr("data-title").replace(/\$foldersize/,$.MyStringHelper.renderByteSizes(e)))}}function aa(e){return $("<div/>").text(e).html()}function bb(){$(window).off("popstate.changeuri").on("popstate.changeuri",function(){var e=history.location||document.location;aE(e.pathname)})}function O(bl,bk){try{if(!bk){if(window.history.pushState){window.history.pushState({path:bl},"",bl);aE(bl)}else{aE(bl)}return}}catch(bm){console.log(bm)}if(!bk){aA()}window.location.href=bl}function aE(e,bl){if(!e){e=$("#fileList").attr("data-uri")}if(!e){e=window.location.href}if(!bl){bl={ajax:"getFileListTable",template:$("#flt").attr("data-template")}}$(".ajax-loader").show();$("#flt").hide();var bk=$.now();$("#flt").data("timestamp",bk);$.get(e,bl,function(bm){if($("#flt").data("timestamp")!=bk){return}$("#flt").trigger("beforeFileListChange").show().html(bm.content).attr("data-uri",e);$(".ajax-loader").hide();$("title").html($("#titleprefix").html()+" "+e.replace(/\/[^\/]+\/\.\.$/,"/"));aF();S(bm)})}function K(e){$("#flt").trigger("beforeFileListChange");e.remove();$("#flt").trigger("fileListChanged")}function E(bl,e,bm,bk){var bo=aA();var bn=$.post(bm,{srcuri:e,action:bl,files:bk.join("@/@")},function(bp){if(bp.message&&bl=="cut"){K($("#fileList tr[data-file='"+bk.join("'],#fileList tr[data-file='")+"']"))}bo.remove();if(bp.error){aE()}S(bp)});L(bn)}function G(bm,bo){var e=bo.draggable.closest("tr");var bp=m($("#fileList").attr("data-uri"),encodeURIComponent(d($(this).attr("data-file")))+"/");var bk=m($("#fileList").attr("data-uri"),"/");if(bp==m(bk,encodeURIComponent(d(e.attr("data-file"))))+"/"){return}var bn=bm.shiftKey||bm.altKey||bm.ctrlKey||bm.metaKey?"copy":"cut";var bl=e.hasClass("selected")?$.map($("#fileList tr.selected:visible"),function(bs,br){return $(bs).attr("data-file")}):new Array(e.attr("data-file"));if(al("settings.confirm.dnd")!="no"){var bq=$("#paste"+bn+"confirm").html();bq=bq.replace(/%files%/g,ag(i(bl.join(", ")))).replace(/%srcuri%/g,ag(i(bk))).replace(/%dsturi%/g,ag(i(bp))).replace(/\\n/g,"<br/>");N(bq,{confirm:function(){E(bn,bk,bp,bl)},setting:"settings.confirm.dnd"})}else{E(bn,bk,bp,bl)}}function aA(){return $("<div></div>").prependTo("body").addClass("overlay")}function d(e){return e.replace(/\/$/,"")}function aw(bm,bn,bl){for(var bk in bn){var e=bn[bk];if(typeof e==="object"){aw(bm,e,bk)}else{if(bl){bm.append($("<input/>").prop("name",bl).prop("value",e).prop("type","hidden"))}else{bm.append($("<input/>").prop("name",bk).prop("value",e).prop("type","hidden"))}}}return bm}function a8(bk){var e=$("<form/>").appendTo("body");e.hide().prop("action",$("#fileList").attr("data-uri")).prop("method","POST");aw(e,bk);e.submit();e.remove()}function af(bl){var bk=$(this);var e=q(this);e.fadeTo("slow",0.5);N(e.length>1?$("#deletefilesconfirm").html():$("#deletefileconfirm").html().replace(/%s/,ag(aa(e.first().attr("data-file")))),{confirm:function(){var bn=aA();if(e.length===0){e=bk.closest("tr")}var bm=$.post($("#fileList").attr("data-uri"),{"delete":"yes",file:$.map(e,function(bo,bp){return $(bo).attr("data-file")})},function(bo){bn.remove();K(e);ar();if(bo.error){aE()}S(bo)});L(bm)},cancel:function(){e.fadeTo("fast",1);$("#fileList tr.selected:not(:visible) .selectbutton").prop("checked",true)}})}function ar(){$("#fileList tr.selected:visible .selectbutton").prop("checked",false);$("#fileList tr.selected:visible").removeClass("selected");$("#fileList tr:visible").first().focus();$("#flt").trigger("fileListSelChanged")}function ae(bl,e,bm,bk){var bo=aA();var bn=$.post(bm,{action:bl,files:bk,srcuri:e},function(bp){if(al("clpaction")=="cut"){ay("clpfiles","clpaction","clpuri")}bo.remove();aE();S(bp)});L(bn)}function J(e){H(e);var bq=$(this);if(bq.hasClass("disabled")){return}if(bq.hasClass("delete")){af.call(this,e)}else{if(bq.hasClass("rename")){a2(bq.closest("tr"))}else{if(bq.hasClass("cut")||bq.hasClass("copy")){$("#fileList tr").removeClass("cutted").fadeTo("fast",1);var bm=$.map(q(bq),function(bt,bs){return $(bt).attr("data-file")});al("clpfiles",bm.join("@/@"));al("clpaction",bq.hasClass("cut")?"cut":"copy");al("clpuri",m($("#fileList").attr("data-uri"),"/"));if(bq.hasClass("cut")){$("#fileList tr.selected").addClass("cutted").fadeTo("slow",0.5)}V();ar()}else{if(bq.hasClass("paste")){var bk=al("clpfiles");var bn=al("clpaction");var bp=al("clpuri");var bo=m($("#fileList").attr("data-uri"),"/");if(al("settings.confirm.paste")!="no"){var bl=$("#paste"+bn+"confirm").html().replace(/%srcuri%/g,i(bp)).replace(/%dsturi%/g,i(bo)).replace(/\\n/g,"<br/>").replace(/%files%/g,i(bk.split("@/@").join(", ")));N(bl,{confirm:function(){ae(bn,bp,bo,bk)},setting:"settings.confirm.paste"})}else{ae(bn,bp,bo,bk)}}else{if(bq.attr("href")!==undefined&&bq.attr("href")!="#"){window.location.href=bq.attr("href")}else{if(bq.attr("data-href")!==undefined&&bq.attr("data-href")!="#"){window.location.href=bq.attr("data-href")}else{var br=bq.closest("tr");$("body").trigger("fileActionEvent",{obj:bq,event:e,file:br.attr("data-file"),row:br,selected:aN(this)})}}}}}}}function i(e){return aa(decodeURIComponent(e))}function al(bl,bm,e){var bk=new Date();bk.setTime(bk.getTime()+315360000000);if(bm){return Cookies.set(bl,bm,{path:$("#flt").attr("data-baseuri"),secure:true,expires:e?bk:undefined})}return Cookies.get(bl)}function ay(){for(var e=0;e<arguments.length;e++){Cookies.remove(arguments[e],{path:$("#flt").attr("data-baseuri"),secure:true})}}function C(bl,bm,e,bk){if(e){al(bl,bm,bk)}else{ay(bl)}}function ao(){V();$("#flt").on("fileListChanged",V)}function V(){var bn=al("clpaction");var e=m($("#fileList").attr("data-uri"),"/");var bl=al("clpuri");var bm=al("clpfiles");var bk=(!bm||bm===""||bl==e||$("#fileListTable").hasClass("iswriteable-no"));aR($(".action.paste"),bk);if(bl==e&&bn=="cut"){$.each(bm.split("@/@"),function(bo,bp){$("[data-file='"+bp+"']").addClass("cutted").fadeTo("fast",0.5)})}}function U(){$("#nav .action").click(J).MyKeyboardEventHandler();$("#nav > ul > li.popup").addClass("popup-click");$("#nav li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$("#nav li.popup").MyPopup("close")})}function w(){$(".toolbar li.uibutton").button();$(".toolbar .action").click(J).MyKeyboardEventHandler();$(".toolbar > li.popup").addClass("popup-click");$(".toolbar li.popup").MyPopup();$("#flt").on("beforeFileListChange fileListSelChanged",function(){$(".toolbar li.popup").MyPopup("close")});var e={actionInterceptor:function(){return $(this).hasClass("disabled")},beforeEvent:function(){$("#flt").enableSelection();$(this).closest("ul.popup:hidden").show()},finalEvent:function(){$("#flt").disableSelection();$(this).closest("ul").hide()}};$(".action.create-folder").MyInplaceEditor($.extend(e,{changeEvent:function(bl){var bk=$(this);$.post($("#fileList").attr("data-uri"),{mkcol:"yes",colname:bl.value},function(bm){if(!bm.error&&bm.message){at(bl.value)}S(bm)})}}));$(".action.create-file").MyInplaceEditor($.extend(e,{changeEvent:function(bl){var bk=$(this);$.post($("#fileList").attr("data-uri"),{createnewfile:"yes",cnfname:bl.value},function(bm){if(!bm.error&&bm.message){at(bl.value)}S(bm)})}}));$(".action.create-symlink").MyInplaceEditor($.extend(e,{changeEvent:function(bk){var bl=q(this);$.post($("#fileList").attr("data-uri"),{createsymlink:"yes",lndst:bk.value,file:bl.attr("data-file")},function(bm){if(!bm.error&&bm.message){aE()}S(bm)})}}))}function H(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}if(e.stopPropagation){e.stopPropagation()}}function aG(e){H(e);if(e.stopImmediatePropagation){e.stopImmediatePropagation()}}function aV(bk,e){if(bk.length>e){bk=bk.substr(0,4)+"..."+bk.substr(bk.length-e+7,e-7)}return bk}function h(){$(".action.viewfilter").click(function(bl){H(bl);if($(this).hasClass("disabled")){return}var e=$(this);$(".action.viewfilter").addClass("disabled");var bm=$("#fileList").attr("data-uri");var bk=e.attr("data-template");$.get(bm,{ajax:"getViewFilterDialog",template:bk},function(bn){var bo=$(bn);$("input[name='filter.size.val']",bo).spinner({min:0,page:10,numberFormat:"n",step:1});$(".filter-apply",bo).button().click(function(bq){H(bq);C("filter.name",$("select[name='filter.name.op'] option:selected",bo).val()+" "+$("input[name='filter.name.val']",bo).val(),$("input[name='filter.name.val']",bo).val()!=="");C("filter.size",$("select[name='filter.size.op'] option:selected",bo).val()+$("input[name='filter.size.val']",bo).val()+$("select[name='filter.size.unit'] option:selected",bo).val(),$("input[name='filter.size.val']",bo).val()!=="");if($("input[name='filter.types']:checked",bo).length>0){var bp="";$("input[name='filter.types']:checked",bo).each(function(br,bs){bp+=$(bs).val()});al("filter.types",bp)}else{ay("filter.types")}bo.dialog("close");aE()});$(".filter-reset",bo).button().click(function(bp){H(bp);ay("filter.name","filter.size","filter.types");bo.dialog("close");aE()});bo.submit(function(){return false});bo.dialog({modal:true,width:"auto",height:"auto",dialogClass:"viewfilterdialog",title:e.attr("title")||e.data("title"),close:function(){$(".action.viewfilter").removeClass("disabled");bo.remove()}}).show()})})}function L(bm,bl,bk){$("#abortdialog").remove();var e=$("<div/>").html($("#abortdialogtemplate").html()).attr("id","abortdialog");$(".action.cancel",e).button().click(function(bn){if(bm.readyState!=4){bm.abort()}e.hide().remove();if(bk){bk.call(this)}});$("body").data("abortdialogtimeout",window.setTimeout(function(){if(bm.readyState>2){return}e.appendTo($("body")).show();var bn=window.setInterval(function(){if(bm.readyState==4){e.hide().remove();window.clearInterval(bn)}},200);$("body").data("abortdialoginterval",bn)},bl||2500));return e}function a3(){window.clearTimeout($("body").data("abortdialogtimeout"));window.clearInterval($("body").data("abortdialoginterval"));$("#abortdialog").hide().remove()}function t(){if($("#accesskeydetails").length>0){$("#accesskeydetails").dialog("destroy").remove();$("#fileList tr:focusable:first").focus();return}var bl="";var e=$("*[accesskey]").get().sort(function(bn,bm){var bo=$(bn).attr("accesskey");var bp=$(bm).attr("accesskey");return bo<bp?-1:bo>bp?1:0});var bk=[];$.each(e,function(bn,bm){var bo=$(bm);var bp=bo.attr("accesskey");if(!bk[bp]){bl+='<li tabindex="0" role="definition">'+bp+": "+(bo.attr("aria-label")||bo.attr("title")||bo.attr("data-tooltip")||bo.html())+"</li>";bk[bp]=true}else{console.log("found accesskey "+bp+" more than on time")}});$('<div id="accesskeydetails" tabindex="-1"/>').html('<ul class="accesskeydetails">'+bl+"</ul>").dialog({title:$(this).attr("title"),width:"auto",height:"auto",dialogClass:"accesskeydialog",buttons:[{text:$("#close").html(),click:function(){$(this).dialog("destroy").remove()}}],open:function(){$("#accesskeydetails li:focusable:first").focus()}})}function a9(){$("#popupmenu li.popup").MyPopup("close");$("#tc_popupmenu li.popup").MyPopup("close")}function a(bk){var e=$(this);console.log(e.attr("class"))}function Z(){$("#popupmenu .action").off(".popupmenu").on("click.popupmenu",J).on("dblclick.popupmenu",H).MyKeyboardEventHandler();$("#flt").off(".popupmenu").on("beforeFileListChange.popupmenu",function(){a9()}).on("fileListChanged.popupmenu",function(){$("#popupmenu li.popup").MyPopup({contextmenu:$("#popupmenu"),contextmenuTarget:$("#fileList tr"),contextmenuAnchor:"#content"})});$("body").off(".popupmenu").on("click.popupmenu",function(){a9()}).on("keydown.popupmenu",function(bk){if(bk.which==27){a9()}});$("#filler").on("contextmenu",function(e){if(e.which==3){if(e.originalEvent.detail===1){H(e)}a9()}})}function at(e){var bk=$("#fileList");return $.get(v(bk.data("uri")),{ajax:"getFileListEntry",template:bk.data("entrytemplate"),file:e},function(bl){try{var bm=$(bl);row=$("tr[data-file='"+aa(e)+"']",bk);if(row.length>0){$("#flt").trigger("replaceRow",{row:row,newrow:bm});row.replaceWith(bm)}else{bm.appendTo(bk)}aF()}catch(bn){aE()}})}function a7(){$("body").off("settingchanged.initDotFilter").on("settingchanged.initDotFilter",function(bl,bk){if(bk.setting=="settings.show.dotfiles"){$("body").toggleClass("hidedotfiles",!bk.value);$("#flt").trigger("fileListViewChanged")}else{if(bk.setting=="settings.show.dotfolders"){$("body").toggleClass("hidedotfolders",!bk.value);$("#flt").trigger("fileListViewChanged")}}});$("body").toggleClass("hidedotfiles",al("settings.show.dotfiles")=="no");$("body").toggleClass("hidedotfolders",al("settings.show.dotfolders")=="no")}function aY(){var e=al("settings.enable.thumbnails")!="no";$("#flt .icon").each(function(bn,bm){var bl=$(this);if(bl.data("thumb")!=bl.data("icon")){var bk=bl.data("thumb");var bo=bl.data("icon");var bp=$("#emptyimage").attr("src");bl.attr("src",e?(bk===""?bp:bk):(bo===""?bp:bo));bl.toggleClass("thumbnail",e)}})}function c(){$("body").off("settingchanged.initThumbnailSwitch").on("settingchanged.initThumbnailSwitch",function(bl,bk){if(bk.setting=="settings.enable.thumbnails"){aY()}});$("#flt").on("fileListChanged",function(){$("#flt img.icon.thumbnail").on("error",function(){var e=$(this);var bk=e.data("icon");e.removeClass("thumbnail").attr("src",bk!==""?bk:$("#emptyimage").attr("src"))})})}function ag(e){return e.replace(/( {2,})/g,'<span class="ws">$1</span>')}function aJ(bk){var bl=document.documentElement;if(bk){if(bl.requestFullScreen){bl.requestFullScreen()}else{if(bl.mozRequestFullScreen){bl.mozRequestFullScreen()}else{if(bl.webkitRequestFullscreen){bl.webkitRequestFullscreen()}else{if(bl.webkitRequestFullScreen){bl.webkitRequestFullScreen()}else{if(bl.msRequestFullscreen){bl.msRequestFullscreen()}}}}}}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.webkitCancelFullscreen){document.webkitCancelFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}}}}}}}function ak(e){$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",e)}function av(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?true:false}function r(bk,e){var bm=aA();var bl=$.get(window.location.pathname,bk,function(bn){bm.remove();S(bn);e(bn)});L(bl)}function aI(bk,e){var bm=aA();var bl=$.post(window.location.pathname,bk,function(bn){bm.remove();S(bn);e(bn)});L(bl)}function ah(){ToolBox={addFullscreenChangeListener:ak,addMissingSlash:v,blockPage:aA,changeUri:O,concatUri:m,confirmDialog:N,cookie:al,fixElementPosition:ad,getDialog:r,getDialogByPost:aI,getSelectedFiles:aN,getSelectedRows:q,handleJSONResponse:S,handleWindowResize:y,hidePopupMenu:a9,initFileList:aF,initPopupMenu:Z,initTabs:an,initUpload:ax,isFullscreen:av,notify:aZ,notifyError:bc,notifyInfo:b,notifyWarn:a6,preventDefault:H,preventDefaultImmediatly:aG,postAction:a8,quoteWhiteSpaces:ag,refreshFileListEntry:at,removeAbortDialog:a3,renderAbortDialog:L,renderByteSize:$.MyStringHelper.renderByteSize,renderByteSizes:$.MyStringHelper.renderByteSizes,rmcookies:ay,simpleEscape:aa,stripSlash:d,togglecookie:C,toggleFullscreen:aJ,toggleRowSelection:bg,uncheckSelectedRows:ar,updateFileList:aE}}function au(){$.fn.MyTooltip.defaults.helphandler=aP;$(".contexthelp").MyTooltip({delay:0,showtimeout:-1,hidetimeout:-1});$(".action.guide").click(function(){aP.call(this,$(this).data("help"))})}function aP(bk){var e=$(window);$("<div/>").append($("<iframe/>").attr({name:"guide",src:bk,width:"99%",height:"99%"}).text(bk)).dialog({width:e.width()/2,height:e.height()/2,title:$(".action.guide").data("title"),dialogClass:"guidedialog"})}});
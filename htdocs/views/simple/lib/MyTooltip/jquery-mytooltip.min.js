(function(a){a.fn.MyTooltip=function(q){var e=a.extend({},a.fn.MyTooltip.defaults,typeof q==="number"?{delay:q}:q);var b=a("body");var n=a(window);var p,g,m;if(!b.data("tooltip")){g=a("<div/>").addClass("tooltip-content");m=a("<div/>").addClass("tooltip-ta");p=a("<div/>").addClass("tooltip").append([a("<div/>").addClass("tooltip-help").attr({tabindex:1}).on("click",function(){e.helphandler.call(p.data("element"),p.data("help"))}).MyKeyboardEventHandler(),g,m]).appendTo(a("body")).hide().on("mouseenter mousemove focus",function(){if(p.data("help")!=undefined){k()}else{j(e.hidetimeout)}}).on("mouseleave blur",function(){j(e.showtimeout)});b.data("tooltip",p)}else{p=b.data("tooltip");g=a(".tooltip-content",p);m=a(".tooltip-ta",p)}d(this.find("[title]"));if(this.attr("title")){d(this)}function h(v,s){var r=v.type=="focus";var x=r?s.offset().left+s.outerWidth()+e.fOffsetX:v.pageX+e.mOffsetX;var w=r?s.offset().top+s.outerHeight()+e.fOffsetY:v.pageY+e.mOffsetY;var u=Math.max(Math.floor(n.width()/2),50);var t=Math.max(Math.floor(n.height()/2),10);p.removeClass("tooltip-left tooltip-right tooltip-top tooltip-bottom");if(x+p.outerWidth()>n.width()){x=(r?s.offset().left-e.fOffsetX:v.pageX-e.mOffsetX)-p.outerWidth();p.addClass("tooltip-right")}else{p.addClass("tooltip-left")}if(w+p.outerHeight()>n.height()){w=(r?s.offset().top-e.fOffsetY:v.pageY-e.mOffsetY)-p.outerHeight();p.addClass("tooltip-top")}else{p.addClass("tooltip-bottom")}return p.css({left:x+"px",top:w+"px","max-height":t+"px","max-width":u+"px"})}function k(){window.clearTimeout(b.data("tttimeout"))}function j(r){k();if(r==0){p.hide()}else{b.data("tttimeout",window.setTimeout(function(){p.hide()},r))}}function c(r){var s=r.attr("title");if(!s){s=r.attr("data-tooltip")}if(!s){s=""}return r.attr("data-tooltip",s).removeAttr("title")}function o(t,s){k();p.hide();c(s);if(s.data("htmltooltip")){g.html(s.data("htmltooltip"))}else{g.text(s.attr("data-tooltip"))}if(g.text()==""){return}var r=s.data("help");if(!r){r=s.parents("[data-help]:first").data("help")}p.toggleClass("help",r!=undefined);if(r!=undefined){p.data("help",r)}else{p.removeData("help")}p.data("element",s);if(e.delay>0){b.data("tttimeout",window.setTimeout(function(){h(t,s).show();j(e.showtimeout)},e.delay))}else{h(t,s).show();j(e.showtimeout)}}function l(r){if(this!=r.target){return}o(r,a(this))}function f(r){if(this!=r.target){return}if(p.is(":visible")&&p.data("help")!=undefined){j(e.showhelptimeout)}else{if(p.is(":visible")&&e.delay==0){h(r,a(this))}else{o(r,a(this))}}}function i(r){if(this!=r.target){return}if(p.is(":visible")&&p.data("help")!=undefined){j(e.hidehelptimeout)}else{j(e.hidetimeout)}}function d(r){r.off(".tooltip").on("mouseenter.tooltip focus.tooltip",l).on("mouseleave.tooltip blur.tooltip",i).on("mousemove.tooltip",f)}return this};a.fn.MyTooltip.handleHelp=function(c){var b=a(window);a("<div/>").append(a("<iframe/>").attr({name:"help",src:c,width:"99%",height:"99%"}).text(c)).dialog({width:b.width()/2,height:b.height()/2,title:a("#help").text(),dialogClass:"helpdialog"})};a.fn.MyTooltip.defaults={delay:500,showtimeout:3000,showhelptimeout:7000,hidetimeout:0,hidehelptimeout:3000,helphandler:a.fn.MyTooltip.handleHelp,mOffsetX:0,mOffsetY:20,fOffsetX:-10,fOffsetY:10}}(jQuery));
(function(e){e.fn.MyTooltip=function(t){function a(e){return e.data("tooltip-settings")?e.data("tooltip-settings"):{}}function f(e,t){var r=e.type=="focus",o=r?t.offset().left+t.outerWidth()+n.fOffsetX:e.pageX+n.mOffsetX,u=r?t.offset().top+t.outerHeight()+n.fOffsetY:e.pageY+n.mOffsetY,a=Math.max(Math.floor(i.width()/2),50),f=Math.max(Math.floor(i.height()/2),10);return s.removeClass("tooltip-left tooltip-right tooltip-top tooltip-bottom"),o+s.outerWidth()>i.width()?(o=(r?t.offset().left+n.fOffsetX:e.pageX+n.mOffsetX)-s.outerWidth(),s.addClass("tooltip-right")):s.addClass("tooltip-left"),u+s.outerHeight()>i.height()?(u=(r?t.offset().top-n.fOffsetY:e.pageY-n.mOffsetY)-s.outerHeight(),s.addClass("tooltip-top")):s.addClass("tooltip-bottom"),s.css({left:o+"px",top:u+"px","max-height":f+"px","max-width":a+"px"})}function l(){window.clearTimeout(r.data("tttimeout"))}function c(e){l();if(e==-1)return;e==0?s.hide():r.data("tttimeout",window.setTimeout(function(){s.hide()},e))}function h(e){var t=e.attr("title");return t||(t=e.attr("data-tooltip")),t||(t=""),e.attr("data-tooltip",t).removeAttr("title")}function p(e,t){l(),s.hide(),h(t),t.data("htmltooltip")?o.html(decodeURIComponent(t.data("htmltooltip"))):o.text(t.attr("data-tooltip"));if(o.text()=="")return;var i=t.data("help");i||(i=t.parents("[data-help]:first").data("help")),s.toggleClass("help",i!=undefined),i!=undefined?s.data("help",i):s.removeData("help"),s.data("element",t),n.delay>0?r.data("tttimeout",window.setTimeout(function(){f(e,t).show(),c(n.showtimeout)},n.delay)):(f(e,t).show(),c(n.showtimeout))}function d(t){if(this!=t.target)return;p(t,e(this))}function v(t){if(this!=t.target)return;s.is(":visible")&&s.data("help")!=undefined?c(n.showhelptimeout):s.is(":visible")&&n.delay==0?f(t,e(this)):p(t,e(this))}function m(e){if(this!=e.target)return;s.is(":visible")&&s.data("help")!=undefined?c(n.hidehelptimeout):c(n.hidetimeout)}function g(e){e.off(".tooltip").on("mouseenter.tooltip focus.tooltip",d).on("mouseleave.tooltip blur.tooltip",m).on("mousemove.tooltip",v)}var n=e.extend({},e.fn.MyTooltip.defaults,typeof t=="number"?{delay:t}:t,a(this)),r=e("body"),i=e(window),s,o,u;return r.data("tooltip")?(s=r.data("tooltip"),o=e(".tooltip-content",s),u=e(".tooltip-ta",s)):(o=e("<div/>").addClass("tooltip-content"),u=e("<div/>").addClass("tooltip-ta"),s=e("<div/>").addClass("tooltip").append([e("<div/>").addClass("tooltip-help").attr({tabindex:1}).on("click",function(){n.helphandler.call(s.data("element"),s.data("help"))}).MyKeyboardEventHandler(),o,u]).appendTo(e("body")).hide().on("mouseenter mousemove focus",function(){s.data("help")!=undefined?l():c(n.hidetimeout)}).on("mouseleave blur",function(){c(n.showtimeout)}),r.data("tooltip",s)),g(this.find("[title],[data-htmltooltip]")),(this.attr("title")||this.attr("data-htmltooltip"))&&g(this),this},e.fn.MyTooltip.handleHelp=function(t){var n=e(window);e("<div/>").append(e("<iframe/>").attr({name:"help",src:t,width:"99%",height:"99%"}).text(t)).dialog({width:n.width()/2,height:n.height()/2,title:e("#help").text(),dialogClass:"helpdialog"})},e.fn.MyTooltip.defaults={delay:500,showtimeout:3e3,showhelptimeout:7e3,hidetimeout:0,hidehelptimeout:3e3,helphandler:e.fn.MyTooltip.handleHelp,mOffsetX:0,mOffsetY:20,fOffsetX:-10,fOffsetY:10}})(jQuery);

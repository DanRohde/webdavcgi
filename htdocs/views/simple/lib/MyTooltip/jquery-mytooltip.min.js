(function(a){a.fn.MyTooltip=function(r){var e=a.extend({},a.fn.MyTooltip.defaults,typeof r==="number"?{delay:r}:r,m(this));var b=a("body");var o=a(window);var q,g,n;if(!b.data("tooltip")){g=a("<div/>").addClass("tooltip-content");n=a("<div/>").addClass("tooltip-ta");q=a("<div/>").addClass("tooltip").append([a("<div/>").addClass("tooltip-help").attr({tabindex:1}).on("click",function(){e.helphandler.call(q.data("element"),q.data("help"))}).MyKeyboardEventHandler(),g,n]).appendTo(a("body")).hide().on("mouseenter mousemove focus",function(){if(q.data("help")!=undefined){k()}else{j(e.hidetimeout)}}).on("mouseleave blur",function(){j(e.showtimeout)});b.data("tooltip",q)}else{q=b.data("tooltip");g=a(".tooltip-content",q);n=a(".tooltip-ta",q)}d(this.find("[title],[data-htmltooltip]"));if(this.attr("title")||this.attr("data-htmltooltip")){d(this)}function m(s){if(!s.data("tooltip-settings")){return{}}return s.data("tooltip-settings")}function h(w,t){var s=w.type=="focus";var y=s?t.offset().left+t.outerWidth()+e.fOffsetX:w.pageX+e.mOffsetX;var x=s?t.offset().top+t.outerHeight()+e.fOffsetY:w.pageY+e.mOffsetY;var v=Math.max(Math.floor(o.width()/2),50);var u=Math.max(Math.floor(o.height()/2),10);q.removeClass("tooltip-left tooltip-right tooltip-top tooltip-bottom");if(y+q.outerWidth()>o.width()){y=(s?t.offset().left-e.fOffsetX:w.pageX-e.mOffsetX)-q.outerWidth();q.addClass("tooltip-right")}else{q.addClass("tooltip-left")}if(x+q.outerHeight()>o.height()){x=(s?t.offset().top-e.fOffsetY:w.pageY-e.mOffsetY)-q.outerHeight();q.addClass("tooltip-top")}else{q.addClass("tooltip-bottom")}return q.css({left:y+"px",top:x+"px","max-height":u+"px","max-width":v+"px"})}function k(){window.clearTimeout(b.data("tttimeout"))}function j(s){k();if(s==-1){return}else{if(s==0){q.hide()}else{b.data("tttimeout",window.setTimeout(function(){q.hide()},s))}}}function c(s){var t=s.attr("title");if(!t){t=s.attr("data-tooltip")}if(!t){t=""}return s.attr("data-tooltip",t).removeAttr("title")}function p(u,t){k();q.hide();c(t);if(t.data("htmltooltip")){g.html(decodeURIComponent(t.data("htmltooltip")))}else{g.text(t.attr("data-tooltip"))}if(g.text()==""){return}var s=t.data("help");if(!s){s=t.parents("[data-help]:first").data("help")}q.toggleClass("help",s!=undefined);if(s!=undefined){q.data("help",s)}else{q.removeData("help")}q.data("element",t);if(e.delay>0){b.data("tttimeout",window.setTimeout(function(){h(u,t).show();j(e.showtimeout)},e.delay))}else{h(u,t).show();j(e.showtimeout)}}function l(s){if(this!=s.target){return}p(s,a(this))}function f(s){if(this!=s.target){return}if(q.is(":visible")&&q.data("help")!=undefined){j(e.showhelptimeout)}else{if(q.is(":visible")&&e.delay==0){h(s,a(this))}else{p(s,a(this))}}}function i(s){if(this!=s.target){return}if(q.is(":visible")&&q.data("help")!=undefined){j(e.hidehelptimeout)}else{j(e.hidetimeout)}}function d(s){s.off(".tooltip").on("mouseenter.tooltip focus.tooltip",l).on("mouseleave.tooltip blur.tooltip",i).on("mousemove.tooltip",f)}return this};a.fn.MyTooltip.handleHelp=function(c){var b=a(window);a("<div/>").append(a("<iframe/>").attr({name:"help",src:c,width:"99%",height:"99%"}).text(c)).dialog({width:b.width()/2,height:b.height()/2,title:a("#help").text(),dialogClass:"helpdialog"})};a.fn.MyTooltip.defaults={delay:500,showtimeout:3000,showhelptimeout:7000,hidetimeout:0,hidehelptimeout:3000,helphandler:a.fn.MyTooltip.handleHelp,mOffsetX:0,mOffsetY:20,fOffsetX:-10,fOffsetY:10}}(jQuery));
(function(c){c.fn.MyTableManager=function(){var e=c("<div/>").addClass("columnResizeHandle left");var g=c("<div/>").addClass("columnResizeHandle right");var h=this;h.find("th.dragaccept").draggable({zIndex:200,scope:"fileListTable",axis:"x",helper:function(j){var i=c(j.currentTarget);return c(j.currentTarget).clone().width(i.width()).addClass("dragged")}});h.find("th.dragaccept, th.dropaccept").droppable({scope:"fileListTable",tolerance:"pointer",drop:f,hoverClass:"draghover"});var d=c.MyTableManager.getLastTableSort();if(d){c.MyTableManager.sortTable(h,d.name,d.sortorder)}h.find("th:not(.sorter-false)").addClass("tablesorter-head").off("click.tablecolumnmanager").on("click.tablecolumnmanager",function(j){if(j.target!=this){return}var i=this;if(i.MyClickCounter===undefined){i.MyClickCounter=1;window.setTimeout(function(){if(i.MyClickCounter==1){var k=c.MyTableManager.getLastTableSort();c.MyTableManager.sortTable(h,c(i).data("name"),k.name==c(i).data("name")?-k.sortorder:1)}delete i.MyClickCounter},250)}else{i.MyClickCounter+=1}});h.find("th:not(.resizable-false)").each(function(){var i=c(this);i.prepend(e.clone(),g.clone());c.MyTableManager.setTableColumnWidth(i,c.MyCookie(i.prop("id")+".width"))}).off("dblclick.tablecolumnmanager").on("dblclick.tablecolumnmanager",function(j){if(j.target!=this){return}var i=c(this);c.MyTableManager.setTableColumnWidth(i,i.width()==i.data("origWidth")?"minimum":"default")});h.find(".columnResizeHandle").draggable({scope:"columnResize",axis:"x",start:function(k,l){var i=c(this);var j=i.closest("th");this.MTCMColumnResize={startPos:parseInt(l.offset.left,10),column:j,startWidth:j.width(),handlePos:i.hasClass("left")?"left":"right"}},stop:function(){var i=c(this);var j=this.MTCMColumnResize;i.removeAttr("style");c.MyTableManager.setTableColumnWidth(j.column,j.column.width())},drag:function(i,k){var j=this.MTCMColumnResize;if(j.handlePos=="right"){j.column.width(j.startWidth+k.offset.left-j.startPos)}else{j.column.width(j.startWidth+j.startPos-k.offset.left)}}});function f(j,k){var m=k.draggable.prop("cellIndex");var i=c(this).prop("cellIndex");if(m+1==i){return false}var l=c("#fileListTable thead th");l.eq(m).detach().insertBefore(l.eq(i));c("#fileList tr").each(function(){var n=c(this).children("td");n.eq(m).detach().insertBefore(n.eq(i))});a(h);return true}return this};c.MyTableManager={setTableColumnWidth:function(f,d){var e=f.prop("id")+".width";var g=d;var h=f.data("origWidth");if(h===undefined){f.data("origWidth",f.width())}if(g===undefined){f.addClass("column-width-default");return f}else{if(g==="default"){g=h}else{if(g==="minimum"){g=1}}}f.width(g);f.toggleClass("column-width-default",g==h).toggleClass("column-width-minimum",g==1);c.MyCookie.toggleCookie(e,g,g!=h);return f},toggleTableColumn:function(i,g,e){var h=i.find("th[data-name="+g+"]");var f=e===undefined?!h.is(":visible"):e;var d=h.toggleClass("hidden",!f).toggle(f).prop("cellIndex");i.find("td:nth-child("+(d+1)+")").toggleClass("hidden",!f).toggle(f);a(i)},getLastTableSort:function(){var d=c.MyCookie("order").split("_");if(!d){return{name:"data-file",sortorder:1}}return{name:d[0],sortorder:d[1]&&d[1]=="desc"?-1:1}},sortTable:function(g,f,d){var e=g.find("th[data-name='"+f+"']:not(.sorter-false)");if(e.length==0){return}g.find("th").removeClass("tablesorter-down tablesorter-up");e.addClass(d==1?"tablesorter-up":"tablesorter-down");b(g,e.data("sorttype")||"string",e.data("sort"),d,e.prop("cellIndex"),"data-file");c.MyCookie("order",f+(d==1?"_asc":"_desc"),1);c("body").trigger("settingchanged",{setting:"order",value:c.MyCookie("order")})}};function b(i,f,k,e,d,g){var j=i.find("tbody tr").get();j.sort(function(o,m){var r=0;var n=c(o);var l=c(m);var q=n.attr(k)?(f=="number"?parseInt(n.attr(k),10):n.attr(k)):o.cells.item(d).innerHTML.toLowerCase();var p=l.attr(k)?(f=="number"?parseInt(l.attr(k),10):l.attr(k)):m.cells.item(d).innerHTML.toLowerCase();if(n.attr("data-file").match(/^\.\.?$/)){return -1}if(l.attr("data-file").match(/^\.\.?$/)){return 1}if(n.attr("data-type")=="dir"&&l.attr("data-type")!="dir"){return -1}if(n.attr("data-type")!="dir"&&l.attr("data-type")=="dir"){return 1}if(f=="number"){r=q-p}else{if(q.localeCompare){r=q.localeCompare(p)}else{r=(q<p?-1:(q==p?0:1))}}if(r===0&&k!=g){if(q.localeCompare){r=n.attr(g).localeCompare(l.attr(g))}else{r=n.attr(g)<l.attr(g)?-1:n.attr(g)>l.attr(g)?1:0}}return e*r});for(var h=0;h<j.length;h++){i.append(j[h])}return i}function a(d){c.MyCookie("visibletablecolumns",d.find("th[data-name]:visible").map(function(){return c(this).data("name")}).get().join(","),1);c("body").trigger("settingchanged",{setting:"visibletablecolumns",value:c.MyCookie("visibletablecolumns")})}}(jQuery));
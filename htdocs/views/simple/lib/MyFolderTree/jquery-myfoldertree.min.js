(function(a){a.fn.MyFolderTree=function(n,d,i){var h=this;var e;if(typeof n=="string"){e=h.data("myfoldertree-settings");if(n=="set-active-node"){h.find(".mft-active-node").removeClass("mft-active-node");var j=h.find(".mft-node").filter(function(o,q){var p=a(q);return d(p,p.data("mftn"))}).addClass("mft-active-node");j.children(".mft-node-label:first").addClass("mft-active-node");j.parents(".mft-collapsed").removeClass("mft-collapsed");if(j.length>0&&j[0].scrollIntoView){j[0].scrollIntoView()}}else{if(n=="add-node-data"){var j=h.find(".mft-node").filter(function(o,q){var p=a(q);return d(p,p.data("mftn"))});if(j.length>0){f(j,j.data("mftn"),false)}}else{if(n=="collapse-all"){if(!d){d=h.find(".mft-node")}d.closest(".mft-node").addClass("mft-collapsed").find(".mft-node").addClass("mft-collapsed")}else{if(n=="expand-all"){if(!d){d=h.find(".mft-node")}f(d,d.data("mftn"),false);d.closest(".mft-node").removeClass("mft-collapsed").find(".mft-node.mft-node-read").removeClass("mft-collapsed")}else{if(n=="reload-node"){if(!d){d=h.find(".mft-node")}b(d.closest(".mft-node"))}}}}}return h}e=a.extend({},a.fn.MyFolderTree.defaults,n);h.data("myfoldertree-settings",e);var g=k(c(e.rootNodes));h.addClass("mft-foldertree").append(g);function k(o){o.find(".mft-node-label").off(".mft").on("click.mft",function(){var p=a(this).closest(".mft-node");var q=p.data("mftn");p.data("mft-clicktimeout",window.setTimeout(function(){if(!p.data("mft-clicktimeout")){return}else{p.removeData("mft-clicktimeout")}e.nodeClickHandler(q);if(e.readOnFolderClick){f(p,q,true)}h.find(".mft-active-node").removeClass("mft-active-node");p.addClass("mft-active-node").children(".mft-node-label:first").addClass("mft-active-node")},300))}).on("dblclick.mft",function(q){var p=a(this).closest(".mft-node");var s=p.data("mftn");window.clearTimeout(p.data("mft-clicktimeout"));p.removeData("mft-clicktimeout");f(p,s);m(p);if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var r=window.getSelection();if(r&&r.removeAllRanges){r.removeAllRanges()}}}});o.find(".mft-node-expander").off(".mft").on("click.mft",function(r){var p=a(this);var q=p.closest(".mft-node");var s=q.data("mftn");f(q,s,false);m(q)}).on("dblclick.mft",function(p){if(!e.rereadOnDblClick){return}b(a(this).closest(".mft-node"))});if(e.droppable){e.droppable.params.over_orig=e.droppable.params.over;e.droppable.params.over=function(q,r){if(even.target!=this){return}var p=a(this).closest(".mft-node");h.data("mft-drop-timeout",window.setTimeout(function(){f(p,p.data("mftn"));m(p,false)},2000));if(e.droppable.params.over_orig){e.droppable.params.over_orig.call(this,q,r)}};e.droppable.params.out_orig=e.droppable.params.out;e.droppable.params.out=function(p,q){window.clearTimeout(h.data("mft-drop-timeout"));if(e.droppable.params.out_orig){e.droppable.params.out_orig.call(this,p,q)}};o.find(e.droppable.selector).droppable(e.droppable.params)}e.initDom(o);return o}function b(o){var p=o.data("mftn");p.read=false;o.children(".mft-list").remove();p.children=[];f(o,p,true,true);m(o,false)}function f(p,q,o,r){if(q.read){return}q.read=true;e.getFolderTree(q,function(s){k(p.append(c(s)));p.addClass("mft-node-read").toggleClass("mft-node-empty",s.length==0);if(o||e.autoExpandOnRead){m(p,false)}},r)}function m(o,p){o.toggleClass("mft-collapsed",p);if(!o.hasClass("mft-collapsed")){a(".mft-node",o).addClass("mft-collapsed")}}function l(q){var o=a("<li/>").addClass("mft-node");var p=a("<div/>").addClass("mft-node-label").text(q.name).attr("tabindex",0);o.append(a("<div/>").addClass("mft-node-expander").attr("tabindex",0)).append(p);if(q.read){o.addClass("mft-node-read")}if(q.classes){o.addClass(q.classes)}if(!q.expand){o.addClass("mft-collapsed")}if(q.title){p.attr("title",q.title)}if(q.help){o.attr("title",q.help)}o.data("mftn",q);if(q.children){o.toggleClass("mft-node-empty",q.read===true&&q.children.length==0).append(c(q.children))}else{o.toggleClass("mft-node-empty",q.read===true)}return o}function c(o){var p=a("<ul/>").addClass("mft-list");p.data("mft",o);for(var q=0;q<o.length;q++){p.append(l(o[q]))}return p}return this};a.fn.MyFolderTree.defaults={rootNodes:[{name:"/",read:true,expand:true,children:[{name:"test1",title:"/test1/"},{name:"test2"}]}],readOnFolderClick:false,autoExpandOnRead:false,rereadOnDblClick:true,getFolderTree:function(c,d){c.children=[];for(var b=0;b<3;b++){c.children.push({name:c.name+"."+b})}d(c.children);return c},nodeClickHandler:function(b){return b},initDom:function(b){return b}}}(jQuery));
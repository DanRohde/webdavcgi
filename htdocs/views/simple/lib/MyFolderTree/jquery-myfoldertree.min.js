(function(a){a.fn.MyFolderTree=function(j){var f=this;var c=a.extend({},a.fn.MyFolderTree.defaults,j);var e=g(b(c.rootNodes));f.addClass("mft-foldertree").append(e);function g(k){k.find(".mft-node-label").off(".mft").on("click.mft",function(){var l=a(this).closest(".mft-node");var m=l.data("mftn");c.nodeClickHandler(m);if(c.readOnFolderClick){d(l,m,true)}});k.find(".mft-node-expander").off(".mft").on("click.mft",function(n){a.MyPreventDefault(n);var l=a(this);var m=l.closest(".mft-node");var o=m.data("mftn");d(m,o,false);i(m)}).on("dblclick.mft",function(m){a.MyPreventDefault(m);if(!c.rereadOnDblClick){return}var l=a(this).closest(".mft-node");var n=l.data("mftn");n.read=false;l.children(".mft-list").remove();n.children=[];d(l,n,true)});if(c.droppable){c.droppable.params.over_orig=c.droppable.params.over;c.droppable.params.over=function(m,n){var l=a(this).closest(".mft-node");f.data("mft-drop-timeout",window.setTimeout(function(){d(l,l.data("mftn"));i(l,false)},2000));if(c.droppable.params.over_orig){c.droppable.params.over_orig.call(this,m,n)}};c.droppable.params.out_orig=c.droppable.params.out;c.droppable.params.out=function(l,m){window.clearTimeout(f.data("mft-drop-timeout"));if(c.droppable.params.out_orig){c.droppable.params.out_orig.call(this,l,m)}};k.find(c.droppable.selector).droppable(c.droppable.params)}c.initDom(k);return k}function d(l,m,k){if(m.read){return}m.read=true;c.getFolderTree(m,function(n){g(l.append(b(n)));if(k||c.autoExpandOnRead){i(l,false)}})}function i(k,l){k.toggleClass("mft-collapsed",l);if(!k.hasClass("mft-collapsed")){a(".mft-node",k).addClass("mft-collapsed")}}function h(m){var k=a("<li/>").addClass("mft-node");var l=a("<div/>").addClass("mft-node-label").text(m.name).attr("tabindex",0);k.append(a("<div/>").addClass("mft-node-expander").attr("tabindex",0)).append(l);if(m.read){k.addClass("mft-node-read")}if(m.classes){k.addClass(m.classes)}if(!m.expand){k.addClass("mft-collapsed")}if(m.title){l.attr("title",m.title)}if(m.help){k.attr("title",m.help)}k.data("mftn",m);if(m.children){k.append(b(m.children))}return k}function b(k){var l=a("<ul/>").addClass("mft-list");l.data("mft",k);for(var m=0;m<k.length;m++){l.append(h(k[m]))}return l}return this};a.fn.MyFolderTree.defaults={rootNodes:[{name:"/",read:true,expand:true,children:[{name:"test1",title:"/test1/"},{name:"test2"}]}],readOnFolderClick:false,autoExpandOnRead:false,rereadOnDblClick:true,getFolderTree:function(c,d){c.children=[];for(var b=0;b<3;b++){c.children.push({name:c.name+"."+b})}d(c.children);return c},nodeClickHandler:function(b){return b},initDom:function(b){return b}}}(jQuery));
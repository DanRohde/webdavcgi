(function(a){a.fn.MyFolderTree=function(m,c,h){var g=this;if(typeof m=="string"){if(m=="set-active-node"){g.find(".mft-active-node").removeClass("mft-active-node");var i=g.find(".mft-node").filter(function(n,p){var o=a(p);return c(o,o.data("mftn"))}).addClass("mft-active-node");i.children(".mft-node-label:first").addClass("mft-active-node");i.parents(".mft-collapsed").removeClass("mft-collapsed")}return g}var d=a.extend({},a.fn.MyFolderTree.defaults,m);g.data("myfoldertree-settings",d);var f=j(b(d.rootNodes));g.addClass("mft-foldertree").append(f);function j(n){n.find(".mft-node-label").off(".mft").on("click.mft",function(){var o=a(this).closest(".mft-node");var p=o.data("mftn");o.data("mft-clicktimeout",window.setTimeout(function(){if(!o.data("mft-clicktimeout")){return}else{o.removeData("mft-clicktimeout")}d.nodeClickHandler(p);if(d.readOnFolderClick){e(o,p,true)}g.find(".mft-active-node").removeClass("mft-active-node");o.addClass("mft-active-node").children(".mft-node-label:first").addClass("mft-active-node")},300))}).on("dblclick.mft",function(p){var o=a(this).closest(".mft-node");var r=o.data("mftn");window.clearTimeout(o.data("mft-clicktimeout"));o.removeData("mft-clicktimeout");e(o,r);l(o);if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var q=window.getSelection();if(q&&q.removeAllRanges){q.removeAllRanges()}}}});n.find(".mft-node-expander").off(".mft").on("click.mft",function(q){var o=a(this);var p=o.closest(".mft-node");var r=p.data("mftn");e(p,r,false);l(p)}).on("dblclick.mft",function(p){if(!d.rereadOnDblClick){return}var o=a(this).closest(".mft-node");var q=o.data("mftn");q.read=false;o.children(".mft-list").remove();q.children=[];e(o,q,true);l(o,false)});if(d.droppable){d.droppable.params.over_orig=d.droppable.params.over;d.droppable.params.over=function(p,q){if(even.target!=this){return}var o=a(this).closest(".mft-node");g.data("mft-drop-timeout",window.setTimeout(function(){e(o,o.data("mftn"));l(o,false)},2000));if(d.droppable.params.over_orig){d.droppable.params.over_orig.call(this,p,q)}};d.droppable.params.out_orig=d.droppable.params.out;d.droppable.params.out=function(o,p){window.clearTimeout(g.data("mft-drop-timeout"));if(d.droppable.params.out_orig){d.droppable.params.out_orig.call(this,o,p)}};n.find(d.droppable.selector).droppable(d.droppable.params)}d.initDom(n);return n}function e(o,p,n){if(p.read){return}p.read=true;d.getFolderTree(p,function(q){j(o.append(b(q)));if(n||d.autoExpandOnRead){l(o,false)}})}function l(n,o){n.toggleClass("mft-collapsed",o);if(!n.hasClass("mft-collapsed")){a(".mft-node",n).addClass("mft-collapsed")}}function k(p){var n=a("<li/>").addClass("mft-node");var o=a("<div/>").addClass("mft-node-label").text(p.name).attr("tabindex",0);n.append(a("<div/>").addClass("mft-node-expander").attr("tabindex",0)).append(o);if(p.read){n.addClass("mft-node-read")}if(p.classes){n.addClass(p.classes)}if(!p.expand){n.addClass("mft-collapsed")}if(p.title){o.attr("title",p.title)}if(p.help){n.attr("title",p.help)}n.data("mftn",p);if(p.children){n.append(b(p.children))}return n}function b(o){var p=a("<ul/>").addClass("mft-list");p.data("mft",o);for(var q=0;q<o.length;q++){p.append(k(o[q]))}return p}return this};a.fn.MyFolderTree.defaults={rootNodes:[{name:"/",read:true,expand:true,children:[{name:"test1",title:"/test1/"},{name:"test2"}]}],readOnFolderClick:false,autoExpandOnRead:false,rereadOnDblClick:true,getFolderTree:function(c,d){c.children=[];for(var b=0;b<3;b++){c.children.push({name:c.name+"."+b})}d(c.children);return c},nodeClickHandler:function(b){return b},initDom:function(b){return b}}}(jQuery));
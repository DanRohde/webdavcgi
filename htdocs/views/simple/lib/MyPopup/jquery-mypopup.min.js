(function(a){a.fn.MyPopup=function(k){var c=this;if(k==="close"){return f()}var g=a.extend({namespace:"popupnavigation",timername:"popupnavigationtimer",contextmenu:undefined,contextmenuTarget:undefined,contextmenuAnchor:undefined,alloworigcontextmenu:true},k);function h(l){var r=a(g.contextmenuAnchor).position();var p=(l.pageX-r.left);var o=(l.pageY-r.top);var n=a(window);var q=c.height();var m=c.width();g.contextmenu.css({top:o+"px",left:p+"px"})}if(g.contextmenu){var b=g.contextmenu;c.data("MyPopup.contextmenu",b);g.contextmenuTarget.off("contextmenu."+g.namespace).on("contextmenu."+g.namespace,function(l){if(l.which==3){if(l.originalEvent.detail===2&&g.alloworigcontextmenu){f();return}i(l);if(b.is(":visible")&&b.parent()[0]==a(this)[0]){f()}else{a("ul.popup:visible",c).hide();b.appendTo(a(this)).css({position:"absolute",opacity:1}).show();h(l)}}})}function i(l){if(l.preventDefault){l.preventDefault()}else{l.returnValue=false}if(l.stopPropagation){l.stopPropagation()}}function f(){a("ul.popup:visible",c).hide();if(c.data("MyPopup.contextmenu")){c.data("MyPopup.contextmenu").hide().appendTo("body")}return c}function d(m,l){if(m.hasClass("disabled")){return m}a("ul.popup:first",m).toggle(l);if(!a("ul.popup:first",m).is(":visible")){a("ul.popup",m).hide()}return m}function j(l){window.clearTimeout(a("body").data(g.timername));return l}function e(l){a("ul.popup:visible",l.siblings("li.popup")).hide();return l}c.filter(":not(.popup-click)").off("."+g.namespace).on("mouseenter."+g.namespace,function(){var l=a(this);j(l);a("body").data(g.timername,window.setTimeout(function(){d(e(l),true)},350))}).on("click."+g.namespace,function(m){i(m);var l=a(this);d(e(j(l)));a(":focusable:first",l).focus()}).on("dblclick."+g.namespace,function(l){i(l)}).MyKeyboardEventHandler();c.filter(".popup-click").off("."+g.namespace).on("click."+g.namespace,function(l){i(l);d(e(a(this)))}).on("dblclick."+g.namespace,function(l){i(l)}).MyKeyboardEventHandler();c.on("focus."+g.namespace,function(){e(a(this))});c.siblings(":not(.popup)").off("."+g.namespace).on("focus."+g.namespace+" click."+g.namespace+" mouseenter."+g.namespace,function(){e(a(this))});c.filter(".popup-click").siblings("li:not(.popup)").off("mouseenter."+g.namespace);return c}}(jQuery));
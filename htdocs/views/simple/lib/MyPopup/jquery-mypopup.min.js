(function(a){a.fn.MyPopup=function(k){if(k==="close"){return f(this)}var g=a.extend({namespace:"popupnavigation",timername:"popupnavigationtimer",contextmenu:undefined,contextmenuTarget:undefined,contextmenuAnchor:undefined},k);function h(s,l){var r=a(g.contextmenuAnchor).position();var p=(l.pageX-r.left);var o=(l.pageY-r.top);var n=a(window);var q=c.height();var m=c.width();if(q+o-n.scrollTop()+r.top>n.height()&&o-q>=a("#top").height()){o-=q}if(m+p-n.scrollLeft()+r.left>n.width()&&p-m>=0){p-=m}s.css({top:o+"px",left:p+"px"})}if(g.contextmenu){this.data("MyPopup.contextmenu",g.contextmenu);var b=g.contextmenu;var c=this;g.contextmenuTarget.off("contextmenu."+g.namespace).on("contextmenu."+g.namespace,function(l){if(l.which==3){i(l);if(b.is(":visible")){f(c)}else{b.appendTo(a(this)).css({position:"absolute",opacity:1}).show();h(b,l)}}})}function i(l){if(l.preventDefault){l.preventDefault()}else{l.returnValue=false}if(l.stopPropagation){l.stopPropagation()}}function f(l){a("ul.popup:visible",l).hide();if(l.data("MyPopup.contextmenu")){l.data("MyPopup.contextmenu").hide().appendTo("body")}return l}function d(m,l){if(m.hasClass("disabled")){return m}a("ul.popup:first",m).toggle(l);if(!a("ul.popup:first",m).is(":visible")){a("ul.popup",m).hide()}return m}function j(l){window.clearTimeout(a("body").data(g.timername));return l}function e(l){a("ul.popup:visible",l.siblings("li.popup")).hide();return l}this.filter(":not(.popup-click)").off("."+g.namespace).on("mouseenter."+g.namespace,function(){var l=a(this);j(l);a("body").data(g.timername,window.setTimeout(function(){d(e(l),true)},350))}).on("click."+g.namespace+" dblclick."+g.namespace,function(m){i(m);var l=a(this);d(e(j(l)));a(":focusable:first",l).focus()}).MyKeyboardEventHandler();this.filter(".popup-click").off("."+g.namespace).on("click."+g.namespace+" dblclick."+g.namespace,function(l){i(l);d(e(a(this)))}).MyKeyboardEventHandler();this.on("focus."+g.namespace,function(){e(a(this))});this.siblings(":not(.popup)").off("."+g.namespace).on("focus."+g.namespace+" click."+g.namespace+" mouseenter."+g.namespace,function(){e(a(this))});this.filter(".popup-click").siblings("li:not(.popup)").off("mouseenter."+g.namespace);return this}}(jQuery));
(function(a){a.fn.MyPopup=function(k){var c=this;if(k==="close"){return f()}var g=a.extend({namespace:"popupnavigation",timername:"popupnavigationtimer",contextmenu:undefined,contextmenuTarget:undefined,contextmenuAnchor:undefined,contextmenuAnchorElement:false,alloworigcontextmenu:true,showEvent:undefined,autohide:true},k);function h(m,l){var p,o,n;if(g.contextmenuAnchorElement){l=a(g.contextmenuAnchor);p=l.offset();o=m.pageX-p.left+l.scrollLeft();n=m.pageY-p.top+l.scrollTop()}else{p=a(g.contextmenuAnchor).position();o=(m.pageX-p.left);n=(m.pageY-p.top)}g.contextmenu.css({top:n+"px",left:o+"px"})}if(g.contextmenu){var b=g.contextmenu;c.data("MyPopup.contextmenu",b);g.contextmenuTarget.off("contextmenu."+g.namespace).on("contextmenu."+g.namespace,function(l){if(l.which==3){if(l.originalEvent.detail===2&&g.alloworigcontextmenu){f();return}if(!g.alloworigcontextmenu){i(l)}if(b.is(":visible")&&b.parent()[0]==a(this)[0]){f()}else{i(l);a(".MyPopup-autohide ul.popup:visible").hide();a("ul.popup:visible",c).hide();b.appendTo(a(this)).css({position:"absolute",opacity:1}).show();h(l,a(this));if(g.showEvent){g.showEvent.call(this)}}}})}function i(l){if(l.preventDefault){l.preventDefault()}else{l.returnValue=false}if(l.stopPropagation){l.stopPropagation()}}function f(){a("ul.popup:visible",c).hide();if(c.data("MyPopup.contextmenu")){c.data("MyPopup.contextmenu").hide().appendTo("body")}return c}function d(m,l){if(m.hasClass("disabled")){return m}a("ul.popup:first",m).toggle(l);if(!a("ul.popup:first",m).is(":visible")){a("ul.popup",m).hide()}return m}function j(l){window.clearTimeout(a("body").data(g.timername));return l}function e(l){j(l);a("ul.popup:visible",l.siblings("li.popup")).hide();return l}c.filter(":not(.popup-click)").off("."+g.namespace).on("mouseenter."+g.namespace,function(){var l=a(this);j(l);a("body").data(g.timername,window.setTimeout(function(){d(e(l),true)},350))}).on("click."+g.namespace,function(m){i(m);a("ul.popup:first:visible",a(".MyPopup-autohide").not(c)).hide();var l=a(this);d(e(j(l)));a(":focusable:first",l).focus()}).on("dblclick."+g.namespace,function(l){i(l)}).MyKeyboardEventHandler();c.filter(".popup-click").off("."+g.namespace).on("click."+g.namespace,function(l){i(l);a("ul.popup:first:visible",a(".MyPopup-autohide").not(c)).hide();d(e(a(this)))}).on("dblclick."+g.namespace,function(l){i(l)}).MyKeyboardEventHandler();c.on("focus."+g.namespace,function(){e(a(this))});c.siblings(":not(.popup)").off("."+g.namespace).on("focus."+g.namespace+" click."+g.namespace+" mouseenter."+g.namespace,function(){e(a(this))});c.filter(".popup-click").siblings("li:not(.popup)").off("mouseenter."+g.namespace);if(g.autohide){c.addClass("MyPopup-autohide");if(g.contextmenu){g.contextmenu.addClass("MyPopup-autohide")}a("body").on("click."+g.namespace+" contextmenu."+g.namespace,function(l){if(a(l.target).closest(c).length!=1){f()}}).on("keydown."+g.namespace,function(l){if(l.keyCode==27){f()}})}return c}}(jQuery));
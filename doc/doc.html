<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta name="keywords" content="WebDAV CGI wrapper UID" />
  <meta name="author" content="Daniel Rohde" />
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8" /> 
  <link rel="stylesheet" type="text/css" href="style.css"/>
  <title>WebDAV CGI - Documentation</title>
</head>

<body>
<div id="content">
<div style="text-align: right; font-size:0.8em;">
<a href="http://sourceforge.net/projects/webdavcgi"><img style="border:0px;" src="http://sflogo.sourceforge.net/sflogo.php?group_id=385775&amp;type=10" width="80" height="15" alt="Get WebDAV CGI at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a></div>
<h1>WebDAV CGI - Documentation</h1>
<div id="toc">
Content of this topic:
<ul>
	<li><a href="#requirements">Requirements</a></li>
	<li><a href="#installation">Installation</a></li>
	<li><a href="#upgrade">Upgrade</a></li>
	<li><a href="#setup">WebDAV CGI Setup</a></li>
	<li><a href="#hints">Hints</a></li>
	<li><a href="#database">Database Setup</a></li>
	<li><a href="#wrapper">UID/GID Wrapper</a></li>
	<li><a href="#foldersharing">Folder Sharing / Group Access</a></li>
	<li><a href="#webinterface">Web interface</a></li>
	<li><a href="doc-simple-view.html">The Simple View Documentation (own topic)</a></li>
	<li><a href="#logout">Web interface and logout button</a></li>
	<li><a href="#caldavcarddav">CalDAV &amp; CardDAV support</a></li>
	<li><a href="#afs">AFS Support</a></li>
	<li><a href="#gfs">GFS Support</a></li>
	<li><a href="#smb">SMB/CIFS Support</a></li>
	<li><a href="#dbb">DBB database backend</a></li>
	<li><a href="#rcs">RCS backend</a></li>
	<li><a href="#ro">Read-only backend RO</a></li>
	<li><a href="#performance">Performance</a></li>
	<li><a href="#speedy">Speedy Support</a></li>
	<!--[<li><a href="#security">Security</a></li>]-->
	<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<a href="index.html"><br/>Back to the WebDAV CGI home</a>

</div>
<h2 id="requirements">Requirements</h2>

<ul>
<li> all required Perl modules: see <a href="#installation">Installation</a> </li>
<li> a <a href="#database">database</a> (SQLite3, PostgreSQL, MySQL, ... (all supported by a Perl DBI driver))</li>
<li> a Web server software (Apache recommended)</li>
<li> a little bit configuration: Apache setup (see <a href="#installation">Installation</a>) and a <a href="#setup">WebDAV CGI Setup</a></li>
<li> WebDAV CGI works only with a UNIX/Linux server (Ubuntu recommended, Windows/MacOS-X not tested and not supported) </li>
</ul>

You do not need mod_dav for the Apache Web server. WebDAV CGI replaces mod_dav completely. 

<h2 id="installation">Installation</h2>
<p>Note: All steps are done with root rights.</p>
<p>Upgrade Note: Please take a look at the <a href="#upgrade">Upgrade</a> section for further information.</p>
<ol>
<li><a href="index.html#download">download WebDAV CGI</a> (note: not necessary for Gentoo)</li>
<li>install required CPAN modules (Debian/Ubuntu package name):
  <ul>
    <li>CGI (included in most Linux dists; older dists need that: libcgi-perl)</li>
    <li>DBI (libdbi-perl) and a database driver, e.g. DBD::SQLite (libdbd-sqlite3-perl) - (since v0.3.0)</li>
    <li>Date::Parse (libtimedate-perl) - (since v0.2.1)</li>
    <li><strike>OSSP::uuid (libossp-uuid-perl or from <a href="http://www.ossp.org/pkg/lib/uuid/">http://www.ossp.org/pkg/lib/uuid/</a>) - (since v0.3.0)</strike> (since v0.8.0 replaced by UUID::Tiny)</li>
    <li>UUID::Tiny (libuuid-tiny-perl) - (since 0.8.0)</li>
    <li>XML::Simple (libxml-simple-perl)</li>
    <li>Quota (libquota-perl) - (since v0.3.4)</li>
    <li>Archive::Zip (libarchive-zip-perl) - (since v0.5.0)</li>
    <li><strike>Image::Magick (perlmagick) - (since v0.5.1)</strike> (since v0.5.3 replaced by Graphics::Magick)</li>
    <li>Graphics::Magick (libgraphics-magick-perl or <a href="http://www.graphicsmagick.org/perl.html">http://www.graphicsmagick.org/perl.html</a>) - (since v0.5.3)</li>
    <li>File::Spec::Link (libfile-copy-link-perl) - (since v0.5.2)</li>
    <li>IO::Compress::Gzip (included in most Linux dists) - (since v0.7.0)</li>
    <li>IO::Compress::Deflate (included in most Linux dists) - (since v0.7.0)</li>
    <li>Module::Load (included in most Linux dists, older need libmodule-load-perl) - (since v0.8.0)</li>
    <li><span style="optional">optional (for SMB backend):</span> Filesys::SmbClient (libfilesys-smbclient-perl) - (since v0.8.0)</li>
    <li><span style="optional">optional (for RCS backend):</span> Rcs (librcs-perl) - (since v0.8.0)</li>
    <li>JSON (libjson-perl) - (since v0.8.5)</li>
    <li>DateTime - (since v0.8.5)</li>
    <li>DateTime::Format::Human::Duration - (since v0.8.5)</li>
  </ul>
   You can do that with '<code>perl -MCPAN -e "install &lt;ModuleName&gt;"</code>' or with '<code>apt-get install &lt;PackageName&gt;</code>'.
   <pre>
## Debian/Ubuntu quick install: 
apt-get install libdbi-perl libdbd-sqlite3-perl libtimedate-perl \
                libuuid-tiny-perl libxml-simple-perl libquota-perl \
                libarchive-zip-perl libgraphics-magick-perl libmodule-load-perl \
                libfile-copy-link-perl libjson-perl libdatetime-perl

perl -MCPAN -e "install DateTime::Format::Human::Duration"

## only for SMB backend users:
apt-get install libfilesys-smbclient-perl

## only for RCS backend users:
apt-get install librcs-perl
   </pre>   
</li>
<li>install additional binaries/packages for a better WebDAV CGI experience:
<ul>
<li> Speedy - increases the performance of WebDAV CGI (Debian/Ubuntu package: speedy-cgi-perl) </li>
<li> Ghostscript - allowes the web interface of WebDAV CGI to generate thumbnails for PDF/PS files (Debian/Ubuntu package: ghostscript) </li>
<li> smbclient (only for SMB backend users) - allowes the web interface to show quota information (Debian/Ubuntu package: smbclient) </li>
<li> kinit (only for SMB and AFS backend users) - allowes you to omit mod_auth_kerberos (Debian/Ubuntu package: krb5-user) </li>
</ul>
<pre>
## Debian/Ubuntu quick install:
apt-get install speedy-cgi-perl ghostscript

## only for SMB backend users:
apt-get install smbclient

## only for SMB and AFS backend users:
apt-get install krb5-user
</pre>
<pre>
## Gentoo quick install:
emerge -va dev-perl/SpeedyCGI
emerge -va app-text/ghostscript-gpl

## only for SMB backend users:
emerge -va net-fs/cifs-utils

## only for SMB and AFS backend users:
emerge -va app-crypt/heimdal
</pre>
</li>
<li>change directory to your preferred installation path, e.g. <code>cd /etc</code></li>
<li>unpack WebDAV CGI: <code>unzip webdavcgi-latest.zip</code> or <code>tar jxf webdavcgi-latest.tar.gz2</code> (Gentoo: <code>emerge -va www-apps/webdavcgi</code>)</li>
<li>change directory to the source base (e.g: <code>cd webdavcgi*</code>) and call <code>bash install.sh</code> to compile all wrappers and to fix file permissions </li>
<li> <a href="#setup">configure webdav.pl</a></li>
<li> <a id="apache"></a>configure your web server:
    <ul>
    <li>you can do that with rewrite rules (recommended)</li>
    <li> or with a handler action (unsupported)</li>
    </ul>
    Examples for Apache 2.x: (you need the Apache rewrite module: <code>a2enmod rewrite</code>) 
    - and don't forget to take a look at the backend specific configurations <a href="#afs">AFS</a>, <a href="#gfs">GFS</a>, <a href="#smb">SMB/CIFS</a>, <a href="#dbb">DBB</a>, or <a href="#rcs">RCS</a>
    <pre>
### EXAMPLE 1: a complete (virtual) server root handled by WebDAV CGI:
ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdavwrapper
# ScriptAlias /logout /etc/webdavcgi/cgi-bin/logout
&lt;Location /webdavcgi&gt;
        AuthType Basic
        AuthName "WebDAV/CalDAV/CardDAV space"
        AuthUserFile /path-to-my-auth-file
        Require valid-user
&lt;/Location&gt;
RewriteEngine On
# RewriteRule /logout - [L]
RewriteRule ^/ /webdavcgi [PT,E=WEBDAVCONF:/etc/webdav.conf,E=PERLLIB:/etc/webdavcgi/lib/perl,L]
    </pre>
<br/>
    <pre>
### EXAMPLE 2: a virtual path /webdav
ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdavwrapper
# ScriptAlias /webdav/logout /etc/webdavcgi/cgi-bin/logout
&lt;Location /webdavcgi&gt;
        AuthType Basic
        AuthName "WebDAV space"
        AuthUserFile /path-to-my-auth-file
        Require valid-user
&lt;/Location&gt;
# if you want to map this to a real path, do that:
# (end setup $VIRTUAL_BASE='/webdav/?' and $DOCUMENT_ROOT in your WebDAV CGI config)
RewriteEngine On
# RewriteRule ^/webdav/logout - [L]
RewriteRule ^/webdav /webdavcgi  [PT,E=WEBDAVCONF:/etc/webdav.conf,E=PERLLIB:/etc/webdavcgi/lib/perl,L]
    </pre>
<br/>
    <pre>
### EXAMPLE 3: a .htaccess file to handle a complete folder with WebDAV CGI:
### Prerequisites: /webdavcgi is a script alias 
##       (ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdavwrapper) and
###      'AllowOverride AuthConfig FileInfo' is set for the current folder
RewriteEngine On
RewriteRule .* /webdavcgi [E=WEBDAVCONF:/etc/webdav.conf,E=PERLLIB:/etc/webdavcgi/lib/perl]

AuthType Basic
AuthName "A protected WebDAV folder"
AuthUserFile /path-to-my-auth-file
Require valid-user
    </pre>
</li>

</ol>
<h2 id="upgrade">Upgrade</h2>
<h3>Upgrading from 0.8.6 to 0.8.7</h3>
<ul>
<li> The classic view and the sidebar view are removed from code base.
	<ul><li> %UI_ICONS configuration variable is obsolete and was removed</li></ul></li>
<li> The complete backend configuration was changed:
<ul>
<li><code>%FSVLINK=(...);</code> was replaced by <code>$BACKEND_CONFIG{FS}{fsvlink}={...};</code></li>
<li><code>%SMB=(...);</code> was replaced by <code>$BACKEND_CONFIG{SMB}={...};</code></li>
<li><code>%RCS=(...);</code> was replaced by <code>$BACKEND_CONFIG{RCS}={...};</code></li>
<li><code>$GFSQUOTA='...';</code> was replaced by <code>$BACKEND_CONFIG{GFS}{quota}='...';</code></li>
<li><code>$AFS_FSCMD='...';</code> was replaced by <code>$BACKEND_CONFIG{AFS}{fscmd}='...';</code></li>
<li><code>$AFSQUOTA='...';</code> was replaced by <code>$BACKEND_CONFIG{AFS}{quota}='...';</code></li>
<li><code>%DBB=(...);</code> was replaced by <code>$BACKEND_CONFIG{DBB}={...};</code></li>
</ul></li>
<li> A extension configuration variable was added: <code>%EXTENSION_CONFIG</code></li>
</ul>
<h3>Upgrading from 0.8.5 to 0.8.6</h3>
<ol>
<li>The Simple View:
<ul>
<li>Home button template was changed: <code>data-action="changeuri"</code> was replaced by <code>class="action changeuri"</code> (see <a href="doc-simple-view.html#hooks">The Simple View Documentation</a>)</li></ul></li>
</ol>
<h3>Upgrading from 0.8.4 to 0.8.5</h3>
<ol>
<li> the SVN repository URL has changed: <code> svn switch --relocate https://webdavcgi.svn.sourceforge.net/svnroot/webdavcgi/trunk http://svn.code.sf.net/p/webdavcgi/code/trunk</code></li>
<li> the default view was changed from 'sidebar' to 'simple' </li>
<li> new Perl modules are needed:
  <ul>
  	<li><code>JSON</code> (Ubuntu/Debian package: libjson-perl)</li>
	<li><code>DateTime</code> (Ubuntu/Debian package: libdatetime-perl</li>
	<li><code>DateTime::Format::Human::Duration</code> (CPAN) </li>
  </ul>
 </li>
<li> SMB backend: the new optional flag 'secure' was added to enable a URL check for allowed servers and shares</li>
</ol>
<h3>Upgrading from 0.8.3 to 0.8.4</h3>
<ol>
<li> The new install.sh script does not copy or link webdav.pl and webdavwrapper to your cgi-bin directory. You can add/change ScriptAliases to use webdav.pl
or a webdavwrapper from your installation src, e.g. 
<pre>ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdavwrapper
RewriteRule ^/ /webdavcgi [PT,L,E=WEBDAVCONF:/etc/webdav.conf,E=PERLLIB:/etc/webdavcgi/lib/perl]
&lt;Location /webdavcgi&gt;
	AuthType Basic
	AuthUserFile /etc/apache2/webabusers
	AuthName "WebDAV/CalDAV/CardDAV space"
	Require valid-user
&lt;/Location&gt;	
</pre>
</li>
<li>AFS backend:
	<ul>
		<li> Speedy support for AFS was added and a mod_auth_kerberos free installation is now possible:
			<ul><li>a new setuid/setgid wrapper was added: helper/webdavwrapper-afs.c (mod_waklog isn't required if you use webdavwrapper-afs.c)</li>
			<li>a PAG script was added: cgi-bin/afswrapper</li> 
			<li>visit <a href="#afs">AFS</a> section for details</li>
		   </ul>
		</li>
	<li>mod_waklog is no longer required for AFS</li>
	</ul>
</li>
<li>SMB backend:
	<ul><li> a wrapper for mod_auth_kerberos free installation was added</li>
	<li>username/password/workgroup authentication support was added</li>
	</ul></li>
</ol>
<h3>Upgrading from 0.8.2 to 0.8.3</h3>
<ol>
<li>changed <code>@UNSELECTABLE_FOLDERS</code> default to <code>()</code> (relevant for AFS backend users)</li>
<li>changed <code>helper/webdavwrapper-smb.c</code> to fix a Kerberos ticket bug (relevant for SMB backend users)</li>
</ol>

<h3>Upgrading from 0.8.1 to 0.8.2</h3>
<ol>
<li> see <a href="#speedy">Speedy support</a> section to improve the WebDAV CGI performance</li>
</ol>
<h3>Upgrading from 0.8.0 to 0.8.1</h3>
<ol>
<li> <code>%AUTOREFRESH</code> was added for the new auto-refresh feature</li>
</ol>
<h3>Upgrading from 0.7.x to &ge;0.8.0</h3>
<ol>
<li> a new Perl module is needed: <code>Module::Load</code> (Ubuntu/Debian package: libmodule-load-perl)</li>
<li> <code>OSSP::uuid</code> Perl module was replaced by <code>UUID::Tiny</code> (Ubuntu/Debian package: libuuid-tiny-perl)</li>
<li> WebDAV CGI comes with some own modules so you need to set a additional Perl library path:
     <ul>
	     <li>add <code>E=PERLLIB:/etc/webdavcgi/lib/perl</code> to your rewrite rule options in the Apache configuration</li>
	     <li>OR add <code>SetEnv PERLLIB /etc/webdavcgi/lib/perl</code> to your Apache configuration (don't forget to activate/install env module, e.g. <code>a2enmod env; /etc/init.d/apache restart</code>) </li>
	     <li>OR change shebang of webdav.pl to <code>#!/usr/bin/perl -I/etc/webdavcgi/lib/perl</code></li>
     </ul>
</li>
<li> <code>$IGNOREFILEPERMISSIONS</code> config variable was removed</li>
<li> <code>$BACKEND</code> variable was added and is required (allowed values: 'FS', 'AFS', 'GFS', 'SMB', 'DBB') </li>
<li> <code>$SHOW_MIME</code> and <code>$SHOW_PERM</code> were removed: use the new options <code>@ALLOWED_TABLE_COLUMNS</code> and <code>@VISIBLE_TABLE_COLUMNS</code> instead</li>
<li> <code>%MIMETYPES</code> format was changed: only a single filename suffix is allowed as a key (instead of a space separted list of suffixes); please use <code>$MIMEFILE</code> instead</li>
<li> <code>@EXTENSIONS</code> parameter was added: contains a list of extensions </li>
<li> <code>$ENABLE_SYSINFO</code> was removed: add <code>'SysInfo'</code> to the <code>@EXTENSIONS</code> list</li>
<li> <code>$ENABLE_PROPERTIES_VIEWER</code> was removed: add <code>'PropertiesViewer'</code> to the <code>@EXTENSIONS</code> list</li>
<li> <code>$ENABLE_SIDEBAR</code> was removed: use <code>@SUPPORTED_VIEWS</code> instead</li>
<li> <code>$MAXLASTMODIFIEDSIZE</code> was removed</li>
<li> <code>$MAXNAVPATHSIZE</code> was added</li>
</ol>
<h3>Upgrading from &le;0.6.x to &ge;0.7.x</h3>
<ol>
<li>two new Perl modules are used by WebDAV CGI: <code>IO::Compress::Gzip</code> and <code>IO::Compress::Deflate</code> (both are integraded in most Linux dists)</li>
<li>WebDAV CGI is no longer a single file distribution therefore:
	<ol>
	<li>unpack the new <a href="index.html#download">installation package</a> in your preferred installlation path, e.g. <code>cd /etc; unzip webdavcgi-0.7.?.zip</code></li>
	<li>link the path for easier upgrades, e.g. <code>ln -s /etc/webdavcgi-0.7.? /etc/webdavcgi</code></li>
	<li>copy the webdav.pl script to your CGI directory and allow execution, e.g. 
<pre>cp /etc/webdavcgi/cgi-bin/webdav.pl /usr/lib/cgi-bin 
chmod a+x /usr/lib/cgi-bin/webdav.pl </pre></li>
	<li>add the <code>$INSTALL_BASE</code> variable to your existing <code>/etc/webdav.conf</code>, e.g. 
		<pre>echo "\$INSTALL_BASE='/etc/webdavcgi/';" >> /etc/webdav.conf</pre></li>
	<li>check your config file and modules, e.g.
<pre>#&gt; perl -c /etc/webdav.conf
webdav.conf syntax OK

#&gt; perl -I/etc/webdavcgi/lib/perl -c /usr/lib/cgi-bin/webdav.pl
webdav.pl syntax OK

#&gt; bash /etc/webdavcgi/checkenv
+++ Checking perl:
  perl /usr/bin/perl
++++ Checking required modules:
  CGI installed
  DBI installed
  POSIX installed
  File::Temp installed
  Date::Parse installed
  UUID::Tiny installed
  XML::Simple installed
  Quota installed
  Archive::Zip installed
  IO::Compress::Gzip installed
  IO::Compress::Deflate installed
  Digest::MD5 installed
  Module::Load installed
++++ Checking optional modules:
  DBD::SQLite installed
  DBD::mysql installed
  DBD::Pg installed
++++ Checking required modules for FS backend:
  File::Spec::Link installed
++++ Checking required modules for AFS backend:
  File::Spec::Link already checked
++++ Checking required modules for GFS backend:
  File::Spec::Link already checked
++++ Checking required modules for SMB backend:
  Filesys::SmbClient installed
++++ Checking required modules for RCS backend:
  Rcs installed
++++ Checking optional binaries:
  smbclient /usr/bin/smbclient
#### Summary:
All modules found.
All binaries found. </pre></li>
	</ol>
</li>
<li>WebDAV CGI has a new Web interface and some configuration defaults were changed and new options were added. See CHANGELOG in your installation path and take a look into webdav.pl for further information.</li>
</ol>



<h2 id="setup">WebDAV CGI Setup</h2>
The WebDAV CGI can be easier upgraded if you use a configuration file instead of changing the setup section of <code>webdav.pl</code>.
<ol>
<li> Create a <code>/etc/webdav.conf</code> with a minimal setup and don't forget to fix file permissions: <br/><code>chmod a+r /etc/webdav.conf</code>:
<pre>
## the install base is needed to find webdav-ui.* and locale files 
## (don't forget the trailing slash):
$INSTALL_BASE = '/etc/webdavcgi/';

## the backend module (supported: FS, AFS, GFS, SMB, DBB, RCS):
$BACKEND = 'FS';

## this is an example if a user starts with home dir (http://mywebdavserver/ -&gt; user home):
$VIRTUAL_BASE = '/';
$DOCUMENT_ROOT = '/home/'.$ENV{REMOTE_USER}.'/';
## if you use a complex home folder structure, try this:
# $DOCUMENT_ROOT=(getpwnam($ENV{REMOTE_USER}))[7].'/';


$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

</pre>
</li>
<li> Please take a look at backend specific configuration sections <a href="#afs">AFS</a>, <a href="#gfs">GFS</a>, <a href="#smb">SMB/CIFS</a>, <a href="#dbb">DBB</a>, <a href="#rcs">RCS</a></li>
<li> If you need to change other options simply copy the parameter from the <code>webdav.pl</code> setup section into your config file.</li>
<li> Don't forget to check the config file syntax: <code>perl -c /etc/webdav.conf</code></li>
<li> <a href="#apache">configure your Apache web server</a></li>
</ol>
<h2 id="hints">Hints</h2>
Apache and webdav.pl setup:
   <ul>
   <li> You can use Apache's <code>'SetEnv VAR VAL'</code> or <code>'RewriteRule ... [E=VAR:VAL]'</code> in conjunction with <code>'$ENV{VAR}'</code> in your config to setup WebDAV CGI. This allows you a path based, virtual host based or user based configuration.</li>
   <li>see <a href="#performance">Performance</a> section for more.</li>
   </ul>

Graphics::Magick does not compile:
<ul>
<li>RedHat/Fedora/CentOS: see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=527143#c2">https://bugzilla.redhat.com/show_bug.cgi?id=527143#c2</a></li>
<li> You can use Image::Magick instead but it makes trouble in conjunction with <a href="#speedy">Speedy</a>: 
<pre>sed -i -e 's@Graphics::Magick@Image::Magick@g' \
                checkenv \
		lib/perl/WebInterface/Renderer.pm</pre>
</li>
</ul>

<h2 id="database">Database Setup</h2>
<h3>Common Instructions</h3>
<ol>
<li> Install the necessary Perl DBI driver (Debian/Ubuntu package: libdbd-...-perl) </li>
<li> Create the database and the schema </li>
<li> Configure WebDAV CGI (<code>$DBI_SRC, $DBI_USER, $DBI_PASS</code>)</li>
</ol>

<h3>SQLite 3</h3>
<ul>
<li> DBI driver for SQLite3: Debian/Ubuntu package: <code>libdbd-sqlite3-perl</code></li>
<li> You can use the auto create feature (<code>$CREATE_DB=1;</code>) </li>
<li> Example config:
<pre>
$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'$ENV{REMOTE_USER}.'.db';
$DBI_USER="";
$DBI_PASS="";
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
</pre>
</li>
</ul>
<h3>PostgreSQL</h3>
<ul>
<li>DBI driver for PostgreSQL: Debian/Ubuntu package: <code>libdbd-pg-perl</code></li>
<li> Disable the auto create feature (<code>$CREATE_DB = 0;</code>) and create the database schema with following statements (the database 'webdavcgi' must exists), e.g:
<pre>
psql webdavcgi &lt;&lt;EOF

CREATE TABLE webdav_locks (basefn VARCHAR(255) NOT NULL, fn VARCHAR(255) NOT NULL, 
			   type VARCHAR(255) NOT NULL, scope VARCHAR(255), 
			   token VARCHAR(255) NOT NULL, depth VARCHAR(255) NOT NULL, 
			   timeout VARCHAR(255) NULL, owner TEXT NULL, 
			   timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE webdav_props (fn VARCHAR(255) NOT NULL, propname VARCHAR(255) NOT NULL, value TEXT);
CREATE INDEX webdav_locks_idx1 ON webdav_locks (fn);
CREATE INDEX webdav_locks_idx2 ON webdav_locks (basefn);
CREATE INDEX webdav_locks_idx3 ON webdav_locks (fn,basefn);
CREATE INDEX webdav_locks_idx4 ON webdav_locks (fn,basefn,token);
CREATE INDEX webdav_props_idx1 ON webdav_props (fn);
CREATE INDEX webdav_props_idx2 ON webdav_props (fn,propname);

EOF

</pre>
</li>
<li> Example config:
<pre>
$DBI_SRC='dbi:Pg:dbname=webdavcgi;host=localhost;port=5432';
$DBI_USER='pguser';
$DBI_PASS='changeme';
$CREATE_DB = 0;
</pre>
</li>
</ul>
<h3>MySQL</h3>
<ul>
<li> DBI driver for MySQL: Debian/Ubuntu-Package: <code>libdbd-mysql-perl</code></li>
<li> Disable the auto create feature (<code>$CREATE_DB = 0;</code>) and create the database schema with following statements (the database 'webdavcgi' must exists), e.g.:
<pre>
mysql -p webdavcgi &lt;&lt;EOF

CREATE TABLE webdav_locks (basefn VARCHAR(255) NOT NULL, fn VARCHAR(255) NOT NULL, 
                           type VARCHAR(255) NOT NULL, scope VARCHAR(255), 
                           token VARCHAR(255) NOT NULL, depth VARCHAR(255) NOT NULL, 
                           timeout VARCHAR(255) NULL, owner TEXT NULL, 
                           timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE webdav_props (fn VARCHAR(255) NOT NULL, propname VARCHAR(255) NOT NULL, value TEXT);
CREATE INDEX webdav_locks_idx1 ON webdav_locks (fn);
CREATE INDEX webdav_locks_idx2 ON webdav_locks (basefn);
CREATE INDEX webdav_locks_idx3 ON webdav_locks (fn,basefn);
CREATE INDEX webdav_locks_idx4 ON webdav_locks (fn,basefn,token);
CREATE INDEX webdav_props_idx1 ON webdav_props (fn);
CREATE INDEX webdav_props_idx2 ON webdav_props (fn,propname);

EOF

</pre>
</li>
<li> Example config:
<pre>
$DBI_SRC='DBI:mysql:database=webdavcgi;host=localhost;port=3306';
$DBI_USER='mysqluser';
$DBI_PASS='changeme';
$CREATE_DB=0;
</pre>
</li>
</ul>

<h2 id="wrapper">UID/GID Wrapper</h2>
If you use the example wrapper (<code>webdavwrapper.c</code>, <code>webdavwrapper-krb.c</code>, <code>webdavwrapper-afs.c</code>) you should consider this:
<ul>
<li> Your operating system have to know all your WebDAV users. The following command should display a complete passwd entry (replace UID with a account name):
<pre>
getent passwd UID

# OR

getent passwd 
# should display all users
</pre>
Configure NSSWITCH (/etc/nsswitch.conf) to make your user accounts usable.
</li>
<li> The owner and group must be root: <code>chown root:root cgi-bin/webdavwrapper*</code></li>
<li> The <code>webdavwrapper</code> binary needs set-user-ID and the set-group-ID bit to change the user ID and the group ID at runtime. Of course it needs also execute flags.
<pre>
chmod ug+s,a+x cgi-bin/webdavwrapper*
</pre>
</li>
</ul>
Attention: for AFS and/or Kerberos support you need <code>webdavwrapper-afs.c</code> or <code>webdavwrapper-krb.c</code> instead of <code>webdavwrapper.c</code> (see <a href="#afs">AFS Support</a> section)

<h2 id="foldersharing">Folder Sharing / Group Access</h2>
There are two ways to share a folder between users of a group (not for AFS users - see AFS note below):
<ol>
<li> Add all users to UNIX/Posix group (/etc/groups, a LDAP group, ...) - recommended:
	<ul>
		<li> create a group, e.g: <code>groupadd GROUP</code></li>
		<li> create a folder to share: <code> mkdir SHAREDFOLDER</code> </li>
		<li> change the group: <code>chgrp GROUP SHAREDFOLDER</code></li>
		<li> set set-GID-flag to the folder and make it readable/executable/writeable for the group: <code>chmod g+srwx SHAREDFOLDER</code></li>
		<li> set the <code>$UMASK</code> parameter in your WebDAV CGI config file: <code>$UMASK = 0002;</code></li>
	</ul>
Attention: You need a single database for all users to share WebDAV locks and properties. If you use a file based database like SQLite you have to use a singe file writeable for all users.

</li>
<li> Use the UID/GID Wrapper to map all users to a common user:
	<ul>
		<li> create a common user, e.g.:<code>adduser USER</code></li>
		<li> create a folder to share: <code> mkdir SHAREDFOLDER</code></li>
		<li> change the owner: <code>chown USER SHAREDFOLDER</code></li>
		<li> set the WEBDAV_USER environment variable: add <code>E=WEBDAV_USER:USER</code> to your Apache rewrite rule option</li>
	</ul>
</li>
</ol>

AFS note: If you use AFS you have to use AFS groups and AFS ACLs to share folders instead of folder permissions because AFS ignores all Linux/UNIX permissions:
<ol>
<li> Create a AFS group and add AFS users to the group. </li>
<li> Set lookup, read, write, delete, insert, and lock rights for that group to the shared folder.</li>
<li> Don't forget to set lookup rights for the AFS group to all upper folders.</li>
</ol>

<h2 id="webinterface">Web interface</h2>
<h3>How to add a new translation</h3>
<div>
Copy the <code>locale/webdav-ui_default.msg</code> to <code>locale/webdav-ui_&lt;MYLANGCODE&gt;.msg</code> and translate all values (leave the keys unchanged; format: <code>key "value"</code>).

</div>
<div>
And don't forget to sent <a href="mailto:d.rohde@cms.hu-berlin.de?subject=WebDAV CGI">me</a> your translation. Thanx :-)
</div>

<h3>How to change CSS styles</h3>
There are many ways to do it:

<ul>
<li> Add a <code>webdav-ui-custom.css</code> to the <code>lib/</code> directory of the WebDAV CGI installation (recommended). Note: webdav.pl delivers this style file with a cache timeout of one week. 
     You can compress the style sheet to speed up file transfers: (<code>gzip webdav-ui-custom.css</code>). If webdav-ui-custom.css and webdav-ui-custom.css.gz exist then the uncompressed version is delivered.</li>
<li> Add the following to your WebDAV CGI configuration file:
<pre>
$CSS .= &lt;&lt;EOF 

	.filelist { font-size: 0.9em; }

EOF
;
</pre>
</li>
<li> Set <code>$CSSURI</code> variable in your WebDAV CGI config, e.g. <code>$CSSURI='http://myserver/mystyle.css';</code></li>
<li> Set the <code>$HTMLHEAD</code> variable in your WebDAV CGI config (e.g. <code>$HTMLHEAD='&lt;link .../&gt;';</code> or <code>$HTMLHEAD='&lt;style&gt;...&lt;/style&gt;';</code>)</li>
<li>...</li>
</ul>
<h3>How to add or change icons</h3>

Here are some examples to do that in the WebDAV CGI configuration file:
<ul>
<li><code>$ICONS{'mymime/type'}='/uripath/to/my/icons/test.gif';</code></li>
<li><code>%ICONS = ( %ICONS, ( 'mymime/type1'=>'/uripath/to/my/icons/test1.gif', 'mymime/type2'=>'/uripath/to/my/icons/test2.gif',   ) );</code></li>
</ul>

<h3>How to customize error messages/documents</h3>
<p>
Two HTTP status codes are supported for customized error documents: '<code>404 Not Found</code>' and '<code>403 Forbidden</code>'
</p>
<p>
You have to  use '.html' or '.txt' extensions for your error documents to determine a correct MIME type.
</p>
<ol>
<li> put your error documents to the <code>$INSTALL_BASE/htdocs</code> folder or wherever you want (should be readable by your users)</li>
<li> add following options to your WebDAV CGI configuration file:
<pre>
$ERROR_DOCS{'404 Not Found'} = "$INSTALL_BASE/htdocs/404.html";
$ERROR_DOCS{'403 Forbidden'} = "$INSTALL_BASE/htdocs/403.html";
</pre>
</li>
</ol>


<h3>How to integrate a WYSIWYG editor</h3>

Here is an example for <a href="http://ckeditor.com/">CKEditor</a>&trade;:
<ol>
<li> <a href="http://ckeditor.com/">Download</a> and install CKEditor&trade; (e.g. into the <code>/srv</code> folder - or use another server)</li>
<li> Configure the web server to access all CKEditor&trade; files, e.g. <code>RewriteRule /ckeditor /srv/ckeditor [PT,L]</code></li>
<li> Configure WebDAV CGI:
<pre>
if ($cgi-&gt;param('edit') &amp;&amp; $cgi-&gt;param('edit') =~ /\.html?$/i) {
	$HTMLHEAD = q@
		  &lt;script type="text/javascript" src="/ckeditor/ckeditor.js"&gt;&lt;/script&gt;
		  &lt;style&gt;.textdataresizer { display: none; }&lt;/style&gt;
	@; 
	my $_lang = $cgi-&gt;param('lang') || $cgi-&gt;cookie('lang') || $LANG;
	$SIGNATURE .= qq@
		&lt;script&gt;
		CKEDITOR.replace('textdata', 
			{ fullPage : true, language: '$_lang', removePlugins: 'save', 
			  baseFloatZIndex: 
			  	(parseInt(getCookie('dragZIndex')) == 'NaN') 
						?  10000 
						:  parseInt(getCookie('dragZIndex'))+1000 
		});
		&lt;/script&gt; 
	@;
}
</pre>
</li>
</ol>
Consider this if you integrate a WYSIWYG editor:
<ol>
 <li>Allow only HTML files to edit with a WYSIWYG editor.</li>
 <li>Disable 'save' button or reconfigure it to submit 'savetextdata'.</li>
 <li>Use the id 'textdata' for the editor replacement.</li>
 <li>Disable the WebDAV CGI integrated resizer if the editor comes with its own (set display to none for style  .textdataresizer).</li>
 <li>Enable full page editing to allow changing complete HTML pages.</li>
 <li>Setup z-index style for editor to a value larger than 'dragZIndex' cookie value.</li>
</ol>

<h3>Variable substitution in $HEADER, $SIGNATURE, $LANGSWITCH, and %ICONS</h3>

Following variables are substituted:
<table>
<tr><td>$CLOCK</td><td>a clock with client time formatted with locale value for key 'vartimeformat'</td></tr>
<tr><td>$ENV{_VAR_}</td><td>value of environment variable _VAR_</td></tr>
<tr><td>$LANG</td><td>current language code</td></tr>
<tr><td>$NOW</td><td>current date formatted with locale value for key 'varnowformat'</td></tr>
<tr><td>$PATH_TRANSLATED</td><td>locale folder name corresponding to the request URI</td></tr>
<tr><td>$REQUEST_URI</td><td>request URI without query string</td></tr>
<tr><td>$TIME</td><td>current time formatted with locale value for key 'vartimeformat'</td></tr>
<tr><td>$TL{_KEY_}</td><td>locale value for key  _KEY_</td></tr>
<tr><td>$USER</td><td>current user id</td></tr>
<tr><td>$VBASE</td><td>virtual host base matching <code>$VIRTUAL_BASE</code></td></tr>
<tr><td>$VHTDOCS</td><td>virtual htdocs path <code>$VHTDOCS</code> to the <code>$INSTALL_BASE/htdocs</code></td></tr>
</table>

<h2 id="logout">Web interface and logout button</h2>
The WebDAV CGI Web interface has no logout button by default. A logout depends on the used authentication type. For a simple HTTP basic authentication you can use the sample logout script (see <code>cgi-bin/logout-dist</code> in your WebDAV CGI source base).

It's quiet easy to integrate a logout button:
<ol>
<li> install logout script,e.g (be in the WebDAV CGI source base): 
<pre>cp cgi-bin/logout-dist cgi-bin/logout
chmod a+rx cgi-bin/logout
ln -s `pwd`/cgi-bin/logout /usr/lib/cgi-bin
</pre></li>
<li> Add a rewrite rule to your Apache configuration, e.g: <code>RewriteRule /logout /usr/lib/cgi-bin/logout [PT,L,E=REALM:WebDAV-CGI,E=HOMEURL:/,E=TIMEOUT:0]</code>
<br/>Note: this rule should precede the webdavwrapper rule</li>
<li> Add the following to your WebDAV CGI config: 
<pre>$HEADER = '&lt;div class="header"&gt;WebDAV CGI - Web interface: You are logged in as &lt;span title="'.`id -a`.'"&gt;'
	.$ENV{REMOTE_USER}.'&lt;/span&gt; (&lt;a href="/logout"&gt;Logout&lt;/a&gt;).&lt;/div&gt;';
</pre>
</li>
</ol>


<h2 id="caldavcarddav">CalDAV &amp; CardDAV support</h2>
<h3>CalDAV</h3>
<div>WebDAV CGI supports CalDAV (calendar and todo sharing). Older clients need only the URL to your CalDAV enabled folder. Newer clients like iPod Touch 4, MacOS X 10.6.x, ... need some configuration efforts:
<ol>
<li> WebDAV CGI script must handle the root context of your Web server (see CardDAV section how to do that).</li>
<li> Setup WebDAV CGI:
<pre>
...
### https://myhost/ -> /home/userid/
$DOCUMENT_ROOT = '/home/'.$ENV{REMOTE_USER}.'/';
$VIRTUAL_BASE = '/';

$ENABLE_CALDAV = 1;

## Note: all listed folders are not CalDAV enabled;
## you must create and use subfolders for calendars:
%CALENDAR_HOME_SET = ( default => '/.calendar/' );

## Create .calendar folder (home set) if it does not exists:
## Note: The home set folder is not a useable calendar folder. 
##       Current clients need subfolders for calendar entries.
mkdir("${DOCUMENT_ROOT}.calendar") 
		unless -e "${DOCUMENT_ROOT}.calendar";
## Create default calendar(s)  (subfolder(s) of the home set):
## Note: Without a default calendar a iPhone, iPod, ... cannot use CalDAV.
foreach my $cal (('calendar','private')) {
	mkdir("${DOCUMENT_ROOT}.calendar/$cal") 
			unless -e "${DOCUMENT_ROOT}.calendar/$cal";
}

...
</pre>
</li>
</ol>
</div>
<h3>CardDAV</h3>
<div>
For CardDAV support (addressbook sharing) the WebDAV CGI script must handle the root context of your Web server. There are several ways to do that if your Web server is not a only used for WebDAV CGI:
<ul>
<li> use a new host name (alias) for your Web server and configure named virutal hosting. 
<pre>
NameVirtualHost *:443
&lt;VirtualHost myvirtualhost:443>
...
&lt;/VirtualHost>
</pre>
</li>
<li> add a new IP to your server and configure IP based virtual hosting.
<pre>
&lt;VirtualHost 10.0.0.0:443>
...
&lt;/VirtualHost>
</pre>
</li>
<li> or bind your Web server to a special port and configure a virtual host for this new port.
<pre>
Listen 8888
&lt;VirtualHost __default__:8888>
...
&lt;/VirtualHost>
</pre>
</li>
</ul>

After that you have to configure WebDAV CGI, e.g:
<pre>
...
### https://myhost/ -> /home/userid/
$DOCUMENT_ROOT = '/home/'.$ENV{REMOTE_USER}.'/';
$VIRTUAL_BASE = '/';

$ENABLE_CARDDAV = 1;

%ADDRESSBOOK_HOME_SET = ( default => '/.addressbook/' );

## create .addressbook folder if it does not exists:
mkdir("${DOCUMENT_ROOT}.addressbook") 
		unless -e "${DOCUMENT_ROOT}.addressbook";

...
</pre>
</div>

<h2 id="afs">AFS Support</h2>
WebDAV CGI can be used as a Web frontend for AFS and as a WebDAV-AFS bridge. It's a complete replacement for <a href="http://filedrawers.org/">filedrawers</a>.

<h3>... without mod_auth_kerberos </h3>
Requirements:

<ol>
<li><a href="http://www.openafs.org/">OpenAFS</a> client installed on your server (Debian/Ubuntu package: openafs-client) and configured with a default realm: <code>/etc/krb5.conf</code>: <code>default_realm = MY.DOMAIN.NAME</code> (<code>kinit &lt;uid_without_domain&gt; ;  aklog</code> should work)</li>
<li> Kerberos client tool kinit (Debian/Ubuntu package: krb5-user)</li>
<li>All users should be visible for the system and have the same password for AFS and your authentication facility like LDAP, RADIUS,... to authenticate your users with kinit and to allow setuid/setgid: <code>getent passwd &lt;uid&gt;</code> should work</li>
<li>The <code>AUTHHEADER</code> environment variable with the HTTP Authorization header value has to be passed to the wrapper: see RewriteRule of the Apache config example.</li>
<li>The <code>TICKET_LIFETIME</code> environment variable value should be a little bit smaller than your Kerberos ticket lifetime.</li>
<li><code>cgi-bin/webdavwrapper-afs</code> (call <code>bash install.sh</code> from your installation directory to compile helper/webdavwrapper-afs.c)</li>
</ol>

Apache example:
<pre>
&lt;Location /webdavcgi&gt;
	AuthName "WebAFS"
	AuthType Basic
	Require valid-user
&lt;/Location&gt;

ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdavwrapper-afs
# ScriptAlias /logout /etc/webdavcgi/cgi-bin/logout
RewriteEngine on
# RewriteRule ^/logout - [L]
RewriteRule ^/ /webdavcgi \
               [PT,L,E=WEBDAVCONF:/etc/webdav.conf,\
	             E=PERLLIB:/etc/webdavcgi/lib/perl,\
		     E=AUTHHEADER:%{HTTP:Authorization},\
                     E=TICKET_LIFETIME:82800]
</pre>
<code>/etc/webdav.conf</code> example: <a href="#afsconf">see next section</a>

<h3>... with mod_auth_kerberos</h3>
Requirements:
<ol>
<li><a href="http://modauthkerb.sf.net/">mod_auth_kerberos</a> installed (Debian/Ubuntu package: libapache2-mod-auth-kerb)</li>
<li>a keytab file for your server (service name: HTTP/&lt;YOUR SERVER NAME&gt;@&lt;YOUR DOMAIN&gt;, e.g. HTTP/webafs.cms.hu-berlin.de@CMS.HU-BERLIN.DE)</li>
<li><a href="http://www.openafs.org/">OpenAFS</a> client installed on your server (Debian/Ubuntu package: openafs-client) and configured (<code>kinit ...; aklog</code> should work)</li>
<li>The <code>TICKET_LIFETIME</code> environment variable value should be a little bit smaller than your Kerberos ticket lifetime.</li>
<li><code>cgi-bin/webdavwrapper-afs</code> (call <code>bash install.sh</code> from your installation directory to compile helper/webdavwrapper-afs.c)</li>
</ol>

Apache example:
<pre>
KrbMethodNegotiate off
KrbMethodK5Passwd on
KrbSaveCredentials on
Krb5Keytab /etc/webafs.keytab

&lt;Location /webdavcgi&gt;
	AuthName "WebAFS"
	AuthType Kerberos
	Require valid-user
&lt;/Location&gt;

ScriptAlias /webdavcgi /etc/webdavcgi/webdavwrapper-afs
RewriteEngine on
RewriteRule  ^/ /webdavcgi [PT,L,E=WEBDAVCONF:/etc/webdav.conf, \
                                 E=PERLLIB:/etc/webdavcgi/lib/perl, \
                                 E=TICKET_LIFETIME:82800]
</pre>

<code id="afsconf">/etc/webdav.conf</code> example:
<pre>
$INSTALL_BASE = '/etc/webdavcgi/';

$BACKEND = 'AFS';

$DOCUMENT_ROOT = '/afs/';
$VIRTUAL_BASE='/';

$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

$BACKEND_CONFIG{AFS}{quota}='/usr/bin/fs listquota $FS';

$ENABLE_AFSACLMANAGER = 1;
$ALLOW_AFSACLCHANGES = 1;

$ENABLE_AFSGROUPMANAGER = 1;
$ALLOW_AFSGROUPCHANGES = 1;

$ALLOW_SEARCH = 0;
$ALLOW_CHANGEPERM = 0;


$MIMEFILE='/etc/mime.types';

</pre>

<h2 id="gfs">GFS Support</h2>
The GFS backend replaces only the quota command.
Requirements:
<ol>
<li> a mounted GFS filesystem </li>
<li> <code>gfs_quota</code> command executable by a user</li>
</ol>
<code>/etc/webdav.conf</code> example:
<pre>
$INSTALL_BASE = '/etc/webdavcgi/';

$BACKEND='GFS';

$DOCUMENT_ROOT = '/mygfsmountpoint/';
$VIRTUAL_BASE = '/';

$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

$BACKEND_CONFIG{GFS}{quota}='/usr/sbin/gfs_quota -f';
</pre>

<h2 id="smb">SMB/CIFS Support</h2>
The SMB backend supports Kerberos and username/password/workgroup authenticated file share access.
<h3>... with mod_auth_kerberos</h3>
Requirements:
<ol>
<li> a Active Directory integrated Windows or Samba file server</li>
<li> <a href="http://modauthkerb.sf.net/">mod_auth_kerberos</a> installed (Debian/Ubuntu: libapache2-mod-auth-kerb)</li>
<li> a keytab file for the kerberos module:
	<ol>
	<li>create a Windows/ADS user account with a good password (e.g. <code>exampleuser</code>)</li>
	<li>disable password change requirements (policies) for your Windows/ADS user account</li>
	<li>create a keytab file as a domain admin on your domain controller:
	<pre>C:&gt;ktpass -princ HTTP/my_www_server_name@MY.EXAMPLE.DOMAIN.ORG -mapuser exampleuser@MY.EXAMPLE.DOMAIN.ORG -pass MySeCreTexampleuserPassw0rd -out keytab.HTTP</pre>
	</li>
	<li>copy the keytab file <code>keytab.HTTP</code> to a Web server path, e.g. <code>/etc/keytab.HTTP</code></li>
	</ol>
</li>
<li> <code>Filesys::SmbClient</code> perl module installed (Debian/Ubuntu package: libfilesys-smbclient-perl)</li>
<li> optional the <code>/usr/bin/smbclient</code> binary for quota information (Debian/Ubuntu package: smbclient)</li>
<li> You <b>must not use a setuid/setgid wrapper</b> because mod_auth_kerberos creates a ticket cache file and the WebDAV CGI script needs read rights for the Kerberos ticket cache.</li>
<li> You need a wrapper if you use Speedy (see <a href="#speedy">Speed Support</a> section) because the SMB backend needs a fresh Kerberos ticket.</li>
<li> unough temporary file space for thumbnails and ZIP upload/download</li>
</ol>

Apache example:
<pre>
ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdav.pl

KrbVerifyKDC off
KrbMethodNegotiate on
KrbMethodK5Passwd on
KrbAuthoritative on
KrbServiceName HTTP
Krb5Keytab /etc/keytab.HTTP
# required:
KrbSaveCredentials on
KrbAuthRealms MY.EXAMPLE.DOMAIN.ORG MYSECOND.EXAMPLE.DOMAIN.ORG

AuthType Kerberos
AuthName "MY.EXAMPLE.DOMAIN.ORG Account"
Require valid-user

RewriteEngine on
RewriteRule  ^/ /webdavcgi [PT,L,E=WEBDAVCONF:/etc/webdav.conf,E=PERLLIB:/etc/webdavcgi/lib/perl]
</pre>
<code>/etc/webdav.conf</code> example: <a href="#smbconf">see next section</a>

<h3>... without mod_auth_kerberos but with Kerberos authentication</h3>
Requirements:
<ol>
<li> a Active Directory integrated Windows or Samba file server</li>
<li> a Apache authentication provider like auth_n_file, mod_authnz_ldap, ... with the same users and synchronized passwords </li>
<li> a <a href="#kerberosconfig">Kerberos configuration</a> file (/etc/krb5.conf) with a default_realm</li>
<li> <code>Filesys::SmbClient</code> perl module installed (Debian/Ubuntu package: libfilesys-smbclient-perl)</li>
<li> optional the <code>/usr/bin/smbclient</code> binary for quota information (Debian/Ubuntu package: smbclient)</li>
<li> Kerberos client tool kinit (Debian/Ubuntu package: krb5-user)</li>
<li> the <code>cgi-bin/smbwrapper</code> script (Speedy compatible): the <code>TICKET_LIFETIME</code> (in seconds) should be a little bit smaller than your Kerberos ticket lifetime</li>
<li> unough temporary file space for thumbnails and ZIP upload/download</li>
</ol>
Kerberos configuration example: <code>/etc/krb5.conf</code>:
<pre id="kerberosconfig">
[libdefaults]
        dns_lookup_realm = true
        dns_lookup_kds = true
        default_realm = MY.EXAMPLE.DOMAIN.ORG
        clockskew = 900
        forwardable = true
        proxiable = true
        allow_weak_crypto = yes
[domain_realms]
	my.example.domain.org = MY.EXAMPLE.DOMAIN.ORG
	.my.example.domain.org = MY.EXAMPLE.DOMAIN.ORG
</pre>
Apache example:
<pre>
ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/smbwrapper

AuthType Basic
AuthName "MY.EXAMPLE.DOMAIN.ORG Account"
Require valid-user

RewriteEngine on
RewriteRule ^/ /webdavcgi [PT,L,E=WEBDAVCONF:/etc/webdav.conf,\
                                E=PERLLIB:/etc/webdavcgi/lib/perl,\
                                E=AUTHHEADER:%{HTTP:Authorization},\
                                E=TICKET_LIFETIME:21600]
</pre>

<code id="smbconf">/etc/webdav.conf</code> example:
<pre>
$INSTALL_BASE = '/etc/webdavcgi/';

$DOCUMENT_ROOT = '/';
$VIRTUAL_BASE = '/';

$BACKEND='SMB';

$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

$SHOW_QUOTA = -x '/usr/bin/smbclient';
$ALLOW_CHANGEPERM = 0;
$ALLOW_SYMLINK = 0;

#### SMB backend setup:
### required entries: defaultdomain, domains, fileserver
### optional entries: sharefilter, usersharefilter, shares, sharealiases
$BACKEND_CONFIG{SMB} = {
  defaultdomain => 'MY.EXAMPLE.DOMAIN.ORG',	#required

  ## allow only configured server names and shares (default: 0)
  secure => 1, # optional

  ## a global share filter (filter out admin shares with trailing $):
  sharefilter => [ qr/\$$/, ],  #optional

  usersharefilter => {  #optional
    ## admin has no matching filter so he can see all shares (overwrites sharefilter):
    myadminexample => [ qr/__NEVER_MATCH/, ],
  }, 

  sharesep => '~', #optional - servername-share separator symbol (default: '~')
  ## don't use a separator symbol like '$', '-', '_', '#', '%', '?', '&amp;', '/', '\', or letters/numbers
  ## good alternative separators are '!', ':', '=', '\'', '"', '`', '+', '*', or '@'

  domains => { #required
    'MY.EXAMPLE.DOMAIN.ORG' => {	#required (multiple domain entries allowed for forrests)
      ## a domain based filter (overwrites sharefilter and userfilter above):
      sharefilter => [ qr/\$$/, ],	#optional
      usersharefilter => {		#optional
        ## a domain based user filter (overwrites all sharefilter and global filter):
        myadminexample => [ qr/__NEVER_MATCH/, ], 
      }, 
      fileserver => {			#required
        'mywindowsfileserver1.my.example.domain.org' => {	#required

          ## a fileserver based share filter (overwrites all domain based filter):
          sharefilter => [ qr/\$/, ],	#optional

          usersharefilter => {		#optional
            ## overwrites all sharefilter and domain based filter
            myadminexample => [ qr/__NEVER_MATCH/ ] 
          }, 

          ## disables all filter and (slow) automatic share detection:
          shares => [ 'MyFirstShare', 'MySecondShare', 'MyThirdShare/start/here' ],	#optional

	  ## defines a initial directory for a share (don't forget the initial '/'):
	  initdir => { 			#optional
	  	'MyFirstShare' => '/starthere', 
		'MySecondShare'=> '/start/here' 
	  },

          sharealiases => {		#optional
            ## shows 'H: (Home)' instead of 
            ## 'mywindowsfileserver1.my.example.domain.org~MyFirstShare' in the Web interface
            'MyFirstShare' => 'H: (Home)/',
            ## shows 'S: (Scratch)' instead of 
            ## 'mywindowsfileserver1.my.example.domain.org~MySecondShare' in the Web interface
            'MySecondShare' => 'S: (Scratch)/',
	    'MyThirdShare/start/here' => 'T: Temp (/start/here/)',
          },
        },
      },
    },
  },
};
</pre>

<h3>... with username/password/workgroup authentication</h3>
Requirements:
<ol>
<li> a Windows or Samba file server </li>
<li> a Apache authentication provider like auth_n_file, mod_authnz_ldap, ... with the same users and synchronized passwords </li>
<li> optional the <code>/usr/bin/smbclient</code> binary for quota information (Debian/Ubuntu package: smbclient)</li>
<li> the <code>cgi-bin/smbwrapper</code> script (Speedy compatible)</li>
<li> unough temporary file space for thumbnails and ZIP upload/download</li>
</ol>
Apache example:
<pre>
ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/smbwrapper

AuthType Basic
AuthName "Workgroup Account"
Require valid-user

RewriteEngine on
RewriteRule ^/ /webdavcgi [PT,L,E=WEBDAVCONF:/etc/webdav.conf,\
                                E=PERLLIB:/etc/webdavcgi/lib/perl,\
                                E=AUTHHEADER:%{HTTP:Authorization},\
                                E=SMBWORKGROUP:Workgroup]
</pre>

<code>/etc/webdav.conf</code> example: <a href="#smbconf">see previous section</a>

<h2 id="dbb">DBB database backend</h2>
<p>The DBB backend module is an example module. It shows the possibility to put all your data to your own backend and not only to file systems.</p>
Features:
<ul>
<li> puts all data to a single database table (binaries too)</li>
<li> the required database table will be created by the backend</li>
</ul>
Requirements:
<ul>
<li> a database driver (DBD perl module; by default SQLite; Ubuntu/Debian package: libdbd-sqlite3-perl) </li>
</ul>
<code>/etc/webdav.conf</code> example:
<pre>
$INSTALL_BASE='/etc/webdavcgi/';
$VIRTUAL_BASE = '/';
$DOCUMENT_ROOT='/';


$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

$THUMBNAIL_CACHEDIR="/tmp";

$ALLOW_CHANGEPERM = 0;
$ALLOW_SYMLINK = 0;

$BACKEND = 'DBB';

$BACKEND_CONFIG{DBB} = {
	dsn => 'dbi:SQLite:dbname=/tmp/webdavcgi-dbdbackend-'.$ENV{REMOTE_USER}.'.db',
	username => '',
	password => '',
};

</pre>
<h2 id="rcs">RCS backend</h2>
<p>
The RCS backend is a showcase for a revision controlled backend. It needs another backend like FS, or SMB to work because it's a simple backend wrapper.
</p>

<div>
How it works:
<ul>
<li> only files are under revision control</li>
<li> the backend creates a revision file with RCS for any uploaded file </li>
<li> a revision file is stored in the <code>rcsdirname</code> folder (e.g. <code>.rcs/test.txt,v</code>) relative to the folder of a file</li>
<li> the RCS backend creates a virtual folder structure (<code>rcsdirname/virtualrcsdir</code>) with revision files, rcs log entries, and revision comparision (diff)</li>
<li> revisions, logs, and diffs are located under <code>rcsdirname/virtualrcsdir/filename/</code> (e.g. <code>.rcs/RCS/test.txt/</code>)</li>
</ul>
</div>
Known issues:
<ul>
<li> if you copy or move files over existing files the overwritten files and revisions are lost</li>
<li> if you delete a folder all containing revisions and files are deleted and lost</li>
</ul>
Requirements:
<ul>
<li> <code>Rcs</code> Perl module (Debian/Ubuntu package: librcs-perl)</li> 
<li> rcs binaries (Debian/Ubuntu package: rcs)</li>
<li> another backend like FS, GFS, AFS, DBB, or SMB and don't forget to configure the other backend</li>
<li> a little bit temporary space for all RCS operations (ci, co, rcsdiff, rlog, zip download) </li>
</ul>

<code>/etc/webdav.conf</code> example:
<pre>
...
$BACKEND = 'RCS';

$BACKEND_CONFIG{RCS} = {
        ## backend used for versioning:
        backend=>'FS',                  # required 

        ## relative path in a directory for revision files 
	## (slashes are not allowed):
        rcsdirname=>'.rcs',             # required

        ## RCS binary path:
        bindir=>'/usr/bin',             # required

        ## a relative virtual path in 'rcsdirname' to access 
	## all revisions, logs and diffs of a file 
	## (slashes are not allowed):
        virtualrcsdir=>'REVISIONS',     # required

	## limits the number of revisions for a file:
	## note: maxrevisions includes the current revision that means:
	## you have to set maxrevisions to 4 if you need access to 3 old revisions
	# maxrevision=>31,              # optional

        ## ignore suffixes (check is case insensitive):
        # ignoresuffixes => [ 'jpg', 'gif', 'png', ],  # optional

        ## allowed suffixes (check is case insensitive):
        # allowedsuffixes => [ 'txt', 'html' ],        # optional

        ## ignore filenames (check is case insensitive):
        # ignorefilenames=> [ '.*~'],   # optional

};
...
</pre>
<h2 id="ro">Read-only backend RO</h2>
<p> The RO backend is a backend wrapper for all other backends and allows only read-only access to files and folders.</p>
<code>webdav.conf</code> example:
<pre>
...
$BACKEND='RO';
$BACKEND_CONFIG{RO}{backend} = 'FS';
...
</pre>
<h2 id="performance">Performance</h2>
<ul>
  <li> Use a fast (local) database.</li>
  <li> Don't use mod_auth_external without auth caching. </li>
  <li> Use load balancing cluster (Attention: use a central, single database for all nodes)</li>
  <li> Disable all features you don't need (take a look at all <code>$ALLOW_...</code> and <code>$ENABLE_...</code> parameters in the WebDAV CGI setup section):
  	<ul>
		<li><code>$ENABLE_LOCK = 0;</code> - disable WebDAV locking support but it is unsafe in conjunction with shared group folders and some clients make trouble.</li>
		<li>Web interface:
			<ul>
			<li><code>$ENABLE_THUMBNAIL=0;</code> - disables thumbnail support</li>
			<li><code>$ENABLE_THUMBNAIL_CACHE=1;</code> - enables the thumbnail cache and reduces CPU usage (only useful if <code>$ENABLE_THUMBNAIL=1;</code>)</li>
			<li><code>$ENABLE_THUMBNAIL_PDFPS=0;</code> - disables thumbnails for PDF/PS documents and reduces CPU usage (only useful if <code>$ENABLE_THUMBNAIL=1;</code></li>
			<li><code>$DISABLE_SEARCH=0;</code> - disables file name search </li>
			</ul>
		</li>
	</ul>
  </li>
  <li> Compression of HTML, JavaScript, and CSS is enabled by default (<code>$ENABLE_COMPRESSION = 1;</code>) but this option can increase your server load.</li>
  <li> Filter and limit large folders (<code>$FILECOUNTLIMIT</code>, <code>$FILECOUNTPERDIRLIMIT</code>, <code>$FILEFILTERPERDIR</code>)</li>
  <li> Limit folder depth for copy/move operations (<code>$LIMIT_FOLDER_DEPTH</code>)</li>
  <li> Change the bufsize for upload/download operations (<code>$BUFSIZE</code>)</li>
  <li> Since WebDAV CGI v0.5.3 you can use <a href="#speedy">Speedy</a> to improve the performance. Attention: You must set "MaxRuns" because perl and/or WebDAV CGI runs out of memory.</li>
  <li> disable <code>$CREATE_DB</code> after first WebDAV access (PROPFIND request). If you use a file based database like SQLite you can enable/disable it automatically: <code>$CREATE_DB = !-e &lt;mydatabasefile.db&gt;</code></li>
  <li>Slow response working with WebDAV resources on Windows Vista or Windows 7: <a href="http://support.microsoft.com/kb/2445570">KB2445570</a></li>
</ul>
<h2 id="speedy">Speedy Support</h2>
<a target="_blank" href="http://daemoninc.com/SpeedyCGI/">Speedy or PersistentPerl</a> allows you to increase the request/response speed of WebDAV CGI. WebDAV CGI is up to 7 times faster with Speedy than without.

<div>

Setup:
<ol>
<li>Install <a target="_blank" href="http://daemoninc.com/SpeedyCGI/">Speedy</a> (Debian/Ubuntu: <code>apt-get install speedy-cgi-perl</code>)</li>
<li>Change the shebang of webdav.pl:
<pre>
OLD: #!/usr/bin/perl
NEW: #!/usr/bin/speedy -- -r50 -M10 -t3600
</pre>
The <code>-r50</code> limits the requests per Speedy process. This is necessary because Perl runs out of memory (you can set it higher but watch your Apache error log). The <code>-M10</code> limits the count of Speedy processes (see <code>man speedy</code>). If you do not use a setuid/setgid wrapper (e.g. if you use the <a href="#smb">SMB backend</a>) you should remove the <code>-M10</code> or set it higher because all your clients using the same Speedy processes and you need one Speedy process per request. The <code>-t3600</code> sets the timeout for a idle Speedy process to one hour. 
</li>
<li> Only for the <a href="#smb">SMB backend</a>:
    <ol>
    <li>Add <code>E=TICKET_LIFETIME:28800</code> to your RewriteRule:
<pre>
RewriteRule ^/ /webdavcgi [PT,L,E=WEBDAVCONF:/etc/webdav.conf, \
                                E=PERLLIB:/etc/webdavcgi/lib/perl, \
                                E=TICKET_LIFETIME:21600]
</pre>
</li>
    	<br/>The ticket (renewal) lifetime depends on your domain controller setup (Kerberos policy of your domain group policy). You can check it (Debian/Ubuntu: <code>apt-get install krb5-user</code>):
<pre>
kinit mydomainaccount@MY.EXAMPLE.DOMAIN.ORG
klist
</pre>
    	</li>
    <li>Change the Apache script aliases:
    <pre>
OLD: ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdav.pl
NEW (with mod_auth_kerberos): ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/webdavwrapper-smb 
NEW (without mod_auth_kerberos): ScriptAlias /webdavcgi /etc/webdavcgi/cgi-bin/smbwrapper

    </pre>
    </li>
    <li>Known issue: every request creates a new service ticket therefore the file size of ticket cache file grows for every request; Solution: reduce the TICKET_LIFETIME to reduce the temporary file space consumption</li>
    </ol>
</li>
<li> That's all and don't forget to check the notes below.</li>
</ol>
Notes:
<ul>
<li>If you change your <code>/etc/webdav.conf</code> you have to touch webdav.pl (<code>touch&nbsp;cgi-bin/webdav.pl</code>) or kill all speedy processes (<code>pkill&nbsp;-f&nbsp;speedy_backend</code>) because Speedy checks only the modification time of webdav.pl.</li>
<li>If you do not use a setuid/setgid wrapper you have to use a single database for all users.</li>
<li>You can increase the performance if you enable persistent database connections in your <code>/etc/webdav.conf</code>: <code>$DBI_PERSISTENT = 1;</code></li>
</ul>

</div>
<!--[
<h2 id="security">Security</h2>

 <code>... work in progress ...</code>
<ul>
  <li> Denial-of-Service (DoS): limits (Apache, WebDAV CGI, Authentication) </li>
  <li> Authentication: strong encryption (https ok, http not), strong passwords</li>
  <li> Up-to-date: OS, Apache (auth module), Perl (CGI)</li>

</ul>
]-->
<h2 id="troubleshooting">Troubleshooting</h2>
<h3>Timeout</h3>
Maybe it helps to increase the <code>Timeout</code> value in your Apache configuration (300 is a good minimum value). 
<br/>
If a larger <code>Timeout</code> value does not fix the problem perhaps the Apache mod_reqtimeout is loaded. You should disable this module (Debian/Ubuntu: <code>a2dismod reqtimeout; /etc/init.d/apache2 restart</code>) or configure it with larger values.
<h3>Apache error log: <code>Request exceeded the limit of X internal redirects due to probable configuration error. Use 'LimitInternalRecursion' to increase the limit if necessary. Use 'LogLevel debug' to get a backtrace. </code></h3>

This is a typical rewrite misconfiguration. 
A common mistake is to take the <code>.htaccess</code> rewrite rule example for the Apache configuration. 
A rule like <code>RewriteRule .* ...</code> in the Apache configuration runs into a 'endless' recursion only stopped by the Apache limit (<code>LimitInternalRecursion</code>). 
Please use a rule like <code>RewriteRule ^/  ...</code> to fix this problem.
In a <code>.htaccess</code> makes the pattern <code>^/</code> no sense because this pattern will never match. 
Rewite rule patterns in a <code>.htaccess</code> have to be relative to the current path therefore <code>.*</code> works fine. 
<br/>
If this does not help put the following to your Apache configuration:
<pre>
RewriteLogLevel 3
RewriteLog /var/log/apache2/rewrite.log
</pre>
and analyze the <code>rewrite.log</code> after a single access to your WebDAV area and don't forget to set the <code>RewriteLogLevel</code> back to <code>0</code> after your debug session.

<h3>404 File Not Found / 500 Internal Server Error / 'Premature end of script headers'</h3>
Please check the following:
<ol>
<li> Apache error log - Apache writes sometimes helpful things into logs</li>
<li> read and execute file permissions of <code>webdavwrapper</code> and <code>webdav.pl</code> and fix it if necessary (owner/group too):
<pre>
chmod a+rx webdav.pl
chmod a+rx,ug+s webdavwrapper
chown root:root webdavwrapper
</pre>

</li>
<li> shebang of <code>webdav.pl</code>: path to the Perl interpreter have to be correct</li>
<li> <code>/etc/webdav.conf</code> syntax (maybe a broken config):
<pre>
#&gt; perl -c /etc/webdav.conf
webdav.conf syntax OK
</pre>
</li>
<li> check your /etc/webdav.conf: wrong <code>$VIRTUAL_BASE</code> or <code>$DOCUMENT_ROOT</code> values are cause for a 404 File Not Found</li>
<li> <code>webdav.pl</code> syntax (maybe a broken config or a missing Perl module): 
<pre>
#&gt; perl -I/etc/webdavcgi/lib/perl -c webdav.pl
webdav.pl syntax OK

#&gt; bash /etc/webdavcgi/checkenv 
+++ Checking perl:
  perl /usr/bin/perl
++++ Checking required modules:
  CGI installed
  DBI installed
  POSIX installed
  File::Temp installed
  Date::Parse installed
  UUID::Tiny installed
  XML::Simple installed
  Quota installed
  Archive::Zip installed
  IO::Compress::Gzip installed
  IO::Compress::Deflate installed
  Digest::MD5 installed
  Module::Load installed
++++ Checking optional modules:
  DBD::SQLite installed
  DBD::mysql installed
  DBD::Pg installed
++++ Checking required modules for FS backend:
  File::Spec::Link installed
++++ Checking required modules for AFS backend:
  File::Spec::Link already checked
++++ Checking required modules for GFS backend:
  File::Spec::Link already checked
++++ Checking required modules for SMB backend:
  Filesys::SmbClient installed
++++ Checking required modules for RCS backend:
  Rcs installed
++++ Checking optional binaries:
  smbclient /usr/bin/smbclient
#### Summary:
All modules found.
All binaries found.
</pre>
</li>
<li> Check your database setup (<code>$DBI_SRC</code>, <code>$DBI_USER</code>, <code>$DBI_PASS</code>).</li>
<li> Call webdav.pl from a shell:
<pre>
#&gt; env WEBDAVCONF=/etc/webdav.conf perl -I/etc/webdavcgi/lib/perl webdav.pl 
DAV: 1, 2, 3, &lt;http://apache.org/dav/propset/fs/1&gt;, extended-mkcol, access-control, calendar-access, calendarserver-private-comments, calendar-auto-schedule, addressbook, bind
MS-Author-Via: DAV
Status: 404 Not Found
Date: Mon, 14 Mar 2011 12:51:35 GMT
Etag: "d41d8cd98f00b204e9800998ecf8427e"
Content-length: 0
Content-Type: text/plain; charset=utf-8
</pre>
</li>
<li> Call webdavwrapper from a shell:
<pre>
#&gt; ./webdavwrapper
Status: 404 Not Found
Content-Type: text/plain

404 Not Found - your wrapper
</pre>
</li>
<li> <a href="mailto:d.rohde@cms.hu-berlin.de?subject=WebDAV CGI">Contact the author</a></li>
</ol>
<h3>FreeBSD/OpenBSD: all LOCK requests result in a segmentation fault error (signal 11)</h3>
In some installations OSSP::uuid module lets Perl crashing with a segmentation fault. A solution is to replace OSSP::uuid with UUID::Tiny (thx Tony Wijnhard):
<ol>
<li> install UUID::Tiny: <code>perl -MCPAN -e 'install UUID::Tiny'</code></li>
<li> replace <code>use OSSP:uuid;</code> with <code>use UUID::Tiny;</code>: <pre>sed -i -e 's@use OSSP::uuid;@use UUID::Tiny;@g' webdav.pl</pre></li>
<li> replace <code>sub getuuid {</code> with <code>sub _unused_getuuid {</code>: <pre>sed -i -e 's@^sub getuuid@sub _unused_getuuid@g' webdav.pl</pre></li>
<li> add a new getuuid routine to webdav.pl: 
<pre>
cat - &gt;&gt;webdav.pl &lt;&lt;'EOF'
sub getuuid {
        my ($fn) = @_;
        my $uuid_ns = create_UUID(UUID_V1, "opaquelocktoken:$fn");
        my $uuid = create_UUID(UUID_V3, $uuid_ns, "$fn".time());
        debug("_LOCK after uuid made in method:");
        return UUID_to_string($uuid);
}
EOF
</pre>
</li>
</ol>


<h3>Web interface: Copy/Cut/Paste and bookmarks do not work as expected.</h3>
WebDAV CGI uses the 'secure' flag for cookies. If you access the Web interface without encryption (http instead of https) all cookie based actions do not work.
<h3>Web interface: missing stylesheets, locales, and/or icons</h3>
<ol>
<li>Check your <code>$INSTALL_BASE</code> variable in your <code>/etc/webdav.conf</code> (maybe you forget the trailing slash?)</li>
<li>Check /etc/webdav.conf syntax: <code>perl -c /etc/webdav.conf</code></li>
<li>Check your Apache rewrite rule: the path to your webdav.conf must be correct:  <code>E=WEBDAVCONF:/etc/webdav.conf</code></li>
</ol>
<h3>Web interface: wrong date/time/number formatting for a language</h3>
WebDAV CGI uses language specific formattings for date/time/numbers. Check your locales 
<pre>
#> locale -a
de_DE.utf8
en_US.utf8
fr_FR.utf8
it_IT.utf8
</pre>
and install missing locales for the language with a wrong date/time/number formatting, e.g. Ubuntu:
<pre>
# add new locale entry to the list:
echo fr_FR.UTF-8 UTF-8 >> /var/lib/locales/supported.d/local
# or add all supported locales (! slows down package installation/updates):
### cp /usr/share/i18n/SUPPORTED /var/lib/locales/supported.d/local

# and don't forget to compile locale definition files:
locale-gen
</pre>
<h3>Slow response working with WebDAV resources on Windows Vista or Windows 7</h3>
<div>
see <a href="http://support.microsoft.com/kb/2445570">http://support.microsoft.com/kb/2445570</a>
</div>
<div>
OR: see <a href="http://en.wikipedia.org/wiki/Web_Proxy_Autodiscovery_Protocol">http://en.wikipedia.org/wiki/Web_Proxy_Autodiscovery_Protocol</a>
</div>

<h3>RedHat/Fedora/CentOS: Graphics::Magick does not compile</h3>
<div>
see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=527143#c2">https://bugzilla.redhat.com/show_bug.cgi?id=527143#c2</a>
</div>

<h3>Apache error log: Permission denied: exec of '.../webdavwrapper' failed</h3>
<div>
<ul>
<li> Check all file and folder permissions (Apache runs with user permissions)</li>
<li> SELinux users should define a policy to allow the execution of webdavwrapper.</li>
</ul>
</div>

<div id="contact">
&copy; ZE CMS, Humboldt-Universit&auml;t zu Berlin | Written 2011-2012 by <a href="mailto:d.rohde@cms.hu-berlin.de?subject=WebDAV CGI">Daniel Rohde</a> </div>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta name="keywords" content="WebDAV CGI wrapper UID" />
  <meta name="author" content="Daniel Rohde" />
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8" /> 
  <link rel="stylesheet" type="text/css" href="style.css"/>
  <title>WebDAV CGI - Documentation</title>
</head>

<body>
<div id="content">
<div style="text-align: right; font-size:0.8em;">
<a href="http://sourceforge.net/project/project_donations.php?group_id=385775">Donate</a>
<a href="http://sourceforge.net/projects/webdavcgi"><img style="border:0px;" src="http://sflogo.sourceforge.net/sflogo.php?group_id=385775&amp;type=10" width="80" height="15" alt="Get WebDAV CGI at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a></div>
<h1>WebDAV CGI - Documentation</h1>
<div id="toc">
Content of this topic:
<ul>
	<li><a href="#requirements">Requirements</a></li>
	<li><a href="#installation">Installation</a></li>
	<li><a href="#setup">WebDAV CGI Setup</a></li>
	<li><a href="#hints">Hints</a></li>
	<li><a href="#database">Database Setup</a></li>
	<li><a href="#wrapper">UID/GID Wrapper</a></li>
	<li><a href="#foldersharing">Folder Sharing / Group Access</a></li>
	<li><a href="#webinterface">Web interface</a></li>
	<li><a href="#logout">Web interface and Logout</a></li>
	<li><a href="#caldavcarddav">CalDAV &amp; CardDAV support</a></li>
	<li><a href="#afs">AFS Support</a></li>
	<li><a href="#performance">Performance</a></li>
	<li><a href="#security">Security</a></li>
	<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<a href="/"><br/>Back to the WebDAV CGI home</a>

</div>
<a id="requirements"></a>
<h2>Requirements</h2>

<ul>
<li> all required Perl modules: see <a href="#installation">Installation</a> </li>
<li> a <a href="#database">database</a> (SQLite3, PostgreSQL, MySQL, ... (all supported by a Perl DBI driver))</a></li>
<li> a little bit configuration: Apache setup (see <a href="#installation">Installation</a>) and a <a href="#setup">WebDAV CGI Setup</a></li>
<li> a Web server software (Apache recommended)</li>
<li> WebDAV CGI works only with a UNIX/Linux server (Ubuntu recommended, Windows/MacOS-X not tested and not supported) </li>
</ul>

You do not need mod_dav for Apache Web server. WebDAV CGI replaces mod_dav completely. 

<a id="installation"></a>
<h2>Installation</h2>
<ol>
<li><a href="index.html#download">download WebDAV CGI</a></li>
<li>install required CPAN modules (Debian/Ubuntu package name):
  <ul>
    <li>CGI (included in most Linux dists; older dists need that: libcgi-perl)</li>
    <li>DBI (libdbi-perl) and a database driver, e.g. DBD::SQLite (libdbd-sqlite3-perl) - (since v0.3.0)</li>
    <li>Date::Parse (libtimedate-perl) - (since v0.2.1)</li>
    <li>OSSP::uuid (libossp-uuid-perl) - (since v0.3.0)</li>
    <li>XML::Simple (libxml-simple-perl)</li>
    <li>Quota (libquota-perl) - (since v0.3.4)</li>
    <li>Archive::Zip (libarchive-zip-perl) - (since v0.5.0)</li>
    <li><strike>Image::Magick (perlmagick) - (since v0.5.1)</strike> (since v0.5.3 replaced by Graphics::Magick)</li>
    <li>Graphics::Magick (libgraphics-magick-perl) - (since v0.5.3)</li>
    <li>File::Spec::Link (CPAN only) - (since v0.5.2)</li>
  </ul>
   You can do that with '<code>perl -MCPAN -e "install &lt;ModuleName&gt;"</code>' or with '<code>apt-get install &lt;PackageName&gt;</code>'.
   <pre>
## Debian/Ubuntu quick install: 
apt-get install libdbi-perl libdbd-sqlite3-perl libtimedate-perl \
                libossp-uuid-perl libxml-simple-perl libquota-perl \
                libarchive-zip-perl libgraphics-magick-perl
perl -MCPAN -e "install File::Spec::Link"
   </pre>
</li>
<li>change directory to your preferred installation path, e.g. <code>cd /etc</code></li>
<li>unpack WebDAV CGI: <code>unzip webdavcgi-latest.zip</code> or <code>tar jtf webdavcgi-latest.tar.gz2</code></li>
<li>change directory <code>cd webdavcgi*</code> and call <code>bash install.sh</code> or install CGI script and wrapper manually <a href="#" title="click here to show install steps" style="text-decoration: none;"  onclick="document.getElementById('maninstall').style.display='block'; return false;">&darr;</a>
	<div id="maninstall" style="display:none">
	<ol>
	<li>compile your wrapper, change the permissions, and put it into your cgi-bin, e.g:
<pre>
gcc -o webdavwrapper webdavwrapper.c
strip webdavwrapper

chown root:root webdavwrapper
chmod ug+s webdavwrapper

cp -p webdavwrapper /usr/lib/cgi-bin/
</pre>
</li>
<li>put the WebDAV CGI <code>webdav.pl</code> into your cgi-bin, e.g:
<pre>
cp webdav.pl /usr/lib/cgi-bin
</pre>
</li>
<li> fix permissions, e.g:
<pre>
chmod a+rx webdav.pl
</pre>
</li>
</ol>
</div>
</li>
<li> <a href="#setup">configure webdav.pl</a></li>
<li>configure your web server:
    <ul>
    <li>you can do that with rewrite rules</li>
    <li> or with a handler action</li>
    </ul>
    Examples for Apache 2.x: (you need the Apache rewrite module: <code>a2enmod rewrite</code>)
    <pre>
### EXAMPLE 1: a .htaccess file to handle a complete folder with WebDAV CGI:
### (Prerequisites: /cgi-bin/webdavwrapper is a script alias and
###      'AllowOverride AuthConfig FileInfo' is set for the current folder)
RewriteEngine On
RewriteRule .* /cgi-bin/webdavwrapper

AuthType Basic
AuthName "A protected WebDAV folder"
AuthUserFile /path-to-my-auth-file
require valid-user
    </pre>
<br/>
    <pre>
### EXAMPLE 2: a complete (virtual) server root handled by WebDAV CGI:
### (you don't need actions, handler, or error documents)
&lt;Location />
        AuthType Basic
        AuthName "WebDAV/CalDAV/CardDAV space"
        AuthUserFile /path-to-my-auth-file
        Require valid-user
&lt;/Location>
RewriteEngine On
RewriteRule ^/icons(.*) /usr/share/apache2/icons$1 [L]
RewriteRule ^/ /cgi-bin/webdavwrapper [PT,L]
    </pre>
<br/>
    <pre>
### EXAMPLE 3: a virtual path /webdav
&lt;Location /webdav>
        AuthType Basic
        AuthName "WebDAV space"
        AuthUserFile /path-to-my-auth-file
        Require valid-user
&lt;/Location>
# if you want to map this to a real path, do that:
# (end setup $VIRTUAL_BASE and $DOCUMENT_ROOT in your WebDAV CGI config)
RewriteEngine On
RewriteRule  ^/webdav /cgi-bin/webdavwrapper  [PT,L]
    </pre>

</li>

</ol>


<a id="setup"></a>
<h2>WebDAV CGI Setup</h2>
The WebDAV CGI can be easier upgraded if you use a configuration file instead of changing the setup section of <code>webdav.pl</code>.
<ol>
<li> Create a <code>webdav.conf</code> with a minimal setup (and don't forget to fix file permissions: <code>chmod a+r webdav.conf</code>):
<pre>
## the install base is needed to find webdav-ui.* and locale files 
## (don't forget the trailing slash):
$INSTALL_BASE = '/etc/webdavcgi/';

## this is an example if a user starts with home dir (http://mywebdavserver/ -&gt; user home):
$VIRTUAL_BASE = '';
$DOCUMENT_ROOT = '/home/'.$ENV{REMOTE_USER}.'/';
## if you use a complex home folder structure, try this:
# $DOCUMENT_ROOT=(getpwnam($ENV{REMOTE_USER}))[7].'/';


$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

$THUMBNAIL_CACHEDIR="/tmp";

</pre>
</li>
<li> If you need to change other options simply copy the parameter from the <code>webdav.pl</code> setup section into your config file.</li>
<li> Don't forget to check the config file syntax: <code>perl -c webdav.conf</code></li>
<li> And last but not least change the <code>$CONFIGFILE</code> value in <code>webdav.pl</code>:
<pre>
$CONFIGFILE = '/path/to/my/config/file';
</pre>
Hint: Since version 0.6.1 it is possible to pass the config file path to webdav.pl with an environment variable using the Apache rewrite rule so you don't need to change webdav.pl:
<pre>
...
RewriteRule ^/ /cgi-bin/webdavwrapper [PT,L,E=WEBDAVCONF:/path/to/my/config/file]
...
</pre>
</li>
</ol>
<a name="hints"></a>
<h2>Hints</h2>
Apache and webdav.pl setup:
   <ul>
   <li> You can use Apache's <code>'SetEnv VAR VAL'</code> or <code>'RewriteRule ... [E=VAR:VAL]'</code> in conjunction with <code>'$ENV{VAR}'</code> in your config to setup WebDAV CGI. This allows you a path based, virtual host based or user based configuration.</li>
   <li>see <a href="#performance">Performance</a> section for more.</li>
   </ul>

Graphics::Magick does not compile:
<ul>
<li> You can use Image::Magick instead but it makes trouble in conjunction with Speedy: 
        <br/><code>sed -i -e 's@Graphics::Magick@Image::Magick@g' webdav.pl</code>
</li>
</ul>

<a id="database"></a>
<h2>Database Setup</h2>
<h3>Common Instructions</h3>
<ol>
<li> Install the necessary Perl DBI driver (Debian/Ubuntu package: libdbd-...-perl) </li>
<li> Create the database and the schema </li>
<li> Configure WebDAV CGI (<code>$DBI_SRC, $DBI_USER, $DBI_PASS</code>)</li>
</ol>

<h3>SQLite 3</h3>
<ul>
<li> DBI driver for SQLite3: Debian/Ubuntu package: <code>libdbd-sqlite3-perl</code></li>
<li> You can use the auto create feature (<code>$CREATE_DB=1;</code>) </li>
<li> Example config:
<pre>
$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'$ENV{REMOTE_USER}.'.db';
$DBI_USER="";
$DBI_PASS="";
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
</pre>
</li>
</ul>
<h3>PostgreSQL</h3>
<ul>
<li>DBI driver for PostgreSQL: Debian/Ubuntu package: <code>libdbd-pg-perl</code></li>
<li> Disable the auto create feature (<code>$CREATE_DB = 0;</code>) and create the database schema with following statements (the database 'webdavcgi' must exists), e.g:
<pre>
psql webdavcgi &lt;&lt;EOF

CREATE TABLE webdav_locks (basefn VARCHAR(255) NOT NULL, fn VARCHAR(255) NOT NULL, 
			   type VARCHAR(255) NOT NULL, scope VARCHAR(255), 
			   token VARCHAR(255) NOT NULL, depth VARCHAR(255) NOT NULL, 
			   timeout VARCHAR(255) NULL, owner TEXT NULL, 
			   timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE webdav_props (fn VARCHAR(255) NOT NULL, propname VARCHAR(255) NOT NULL, value TEXT);
CREATE INDEX webdav_locks_idx1 ON webdav_locks (fn);
CREATE INDEX webdav_locks_idx2 ON webdav_locks (basefn);
CREATE INDEX webdav_locks_idx3 ON webdav_locks (fn,basefn);
CREATE INDEX webdav_locks_idx4 ON webdav_locks (fn,basefn,token);
CREATE INDEX webdav_props_idx1 ON webdav_props (fn);
CREATE INDEX webdav_props_idx2 ON webdav_props (fn,propname);

EOF

</pre>
</li>
<li> Example config:
<pre>
$DBI_SRC='dbi:Pg:dbname=webdavcgi;host=localhost;port=5432';
$DBI_USER='pguser';
$DBI_PASS='changeme';
$CREATE_DB = 0;
</pre>
</li>
</ul>
<h3>MySQL</h3>
<ul>
<li> DBI driver for MySQL: Debian/Ubuntu-Package: <code>libdbd-mysql-perl</code></li>
<li> Disable the auto create feature (<code>$CREATE_DB = 0;</code>) and create the database schema with following statements (the database 'webdavcgi' must exists), e.g.:
<pre>
mysql -p webdavcgi &lt;&lt;EOF

CREATE TABLE webdav_locks (basefn VARCHAR(255) NOT NULL, fn VARCHAR(255) NOT NULL, 
                           type VARCHAR(255) NOT NULL, scope VARCHAR(255), 
                           token VARCHAR(255) NOT NULL, depth VARCHAR(255) NOT NULL, 
                           timeout VARCHAR(255) NULL, owner TEXT NULL, 
                           timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE webdav_props (fn VARCHAR(255) NOT NULL, propname VARCHAR(255) NOT NULL, value TEXT);
CREATE INDEX webdav_locks_idx1 ON webdav_locks (fn);
CREATE INDEX webdav_locks_idx2 ON webdav_locks (basefn);
CREATE INDEX webdav_locks_idx3 ON webdav_locks (fn,basefn);
CREATE INDEX webdav_locks_idx4 ON webdav_locks (fn,basefn,token);
CREATE INDEX webdav_props_idx1 ON webdav_props (fn);
CREATE INDEX webdav_props_idx2 ON webdav_props (fn,propname);

EOF

</pre>
</li>
<li> Example config:
<pre>
$DBI_SRC='DBI:mysql:database=webdavcgi;host=localhost;port=3306';
$DBI_USER='mysqluser';
$DBI_PASS='changeme';
$CREATE_DB=0;
</pre>
</li>
</ul>

<a id="wrapper"></a>
<h2>UID/GID Wrapper</h2>
If you use the example wrapper (<code>webdavwrapper.c</code> or <code>webdavwrapper-krb.c</code>) you should consider this:
<ul>
<li> Your operating system have to know all your WebDAV users. The following command should display a complete passwd entry (replace UID with a account name):
<pre>
getent passwd UID

# OR

getent passwd 
# should display all users
</pre>
Configure NSSWITCH (/etc/nsswitch.conf) to make your user accounts usable.
</li>
<li> The owner and group must be root: <code>chown root:root webdavwrapper</code></li>
<li> The <code>webdavwrapper</code> binary needs set-user-ID and the set-group-ID bit to change the user ID and the group ID at runtime. Of course it needs also execute flags.
<pre>
chmod ug+s,a+x webdavwrapper
</pre>
</li>
</ul>
Attention: for AFS and/or Kerberos support you need the <code>webdavwrapper-krb.c</code> instead of <code>webdavwrapper.c</code> (see <a href="#afs">AFS Support</a> section)

<a id="foldersharing"></a>
<h2>Folder Sharing / Group Access</h2>
There are two ways to share a folder between users of a group:
<ol>
<li> Add all users to UNIX/Posix group (/etc/groups, a LDAP group, ...) - recommended:
	<ul>
		<li> create a group, e.g: <code>groupadd GROUP</code></li>
		<li> create a folder to share: <code> mkdir SHAREDFOLDER</code> </li>
		<li> change the group: <code>chgrp GROUP SHAREDFOLDER</code></li>
		<li> set set-GID-flag to the folder and make it readable/executable/writeable for the group: <code>chmod g+srwx SHAREDFOLDER</code></li>
		<li> set the <code>$UMASK</code> parameter in your WebDAV CGI config file: <code>$UMASK = 0002;</code></li>
	</ul>

</li>
<li> Use the UID/GID Wrapper to map all users to a common user:
	<ul>
		<li> create a common user, e.g.:<code>adduser USER</code></li>
		<li> create a folder to share: <code> mkdir SHAREDFOLDER</code></li>
		<li> change the owner: <code>chown USER SHAREDFOLDER</code></li>
		<li> set the WEBDAV_USER environment variable: add <code>E=WEBDAV_USER:USER</code> to your Apache rewrite rule option</li>
	</ul>
</li>
</ol>

Attention: You need a single database for all users to share WebDAV locks and properties. If you use a file based database like SQLite you have to use a singe file writeable for all users.

<a id="webinterface"></a>
<h2>Web interface</h2>
<h3>How to add a new translation</h3>
Put the following to your WebDAV CGI configuration file:
<pre>
$TRANSLATION{'mylang'} = {
	## copy all key=&gt;val data from 'default' part of %TRANSLATION 
	## in webdav.pl and change the values
	search =&gt; 'Search for file/folder name:', ...
};
</pre>
<h3>How to change CSS styles</h3>

Simply add the following to your configuration file:
<pre>
$CSS .= &lt;&lt;EOF 

	.filelist { font-size: 0.9em; }

EOF
;
</pre>
<a id="logout"></a>
<h2>Web interface and Logout</h2>
The WebDAV CGI Web interface has no logout button by default. A logout depends on the authentication. For a simple HTTP basic authentication you can use the sample logout script (see <a href="/#download">Download section</a>).

It's quiet easy to integrate a logout button:
<ol>
<li> install you logout script (put it into your cgi-bin folder, e.g. <code>cp logout /usr/lib/cgi-bin/</code>)</li>
<li> add a rewrite rule to your Apache configuration, e.g: <code>RewriteRule /logout /usr/lib/cgi-bin/logout [PT,L]</code></li>
<li> add the following to your WebDAV CGI config: 
<pre>$HEADER = '&lt;div class="header"&gt;WebDAV CGI - Web interface: You are logged in as &lt;span title="'.`id -a`.'"&gt;'
	.$ENV{REMOTE_USER}.'</span> (&lt;a href="/logout"&gt;Logout&lt;/a&gt;).&lt;/div&gt;';
</pre>
</li>
</ol>


<a id="caldavcarddav"></a>
<h2>CalDAV &amp; CardDAV support</h2>
<h3>CalDAV</h3>
<div>WebDAV CGI supports CalDAV (calendar and todo sharing). Older clients need only the URL to your CalDAV enabled folder. Newer clients like iPod Touch 4, MacOS X 10.6.x, ... need some configuration efforts:
<ol>
<li> WebDAV CGI script must handle the root context of your Web server (see CardDAV part of this section how to do that).</li>
<li> Setup WebDAV CGI:
<pre>
...
### https://myhost/userid -> /home/userid
$DOCUMENT_ROOT = '/home/';
$VIRTUAL_BASE = '/';

$ENABLE_CALDAV = 1;

%CALENDAR_HOME_SET = ( default => "/$ENV{REMOTE_USER}/.calendar/" );

## create .calendar folder if it does not exists:
mkdir("${DOCUMENT_ROOT}$ENV{REMOTE_USER}/.calendar") 
		unless -e "${DOCUMENT_ROOT}$ENV{REMOTE_USER}/.calendar";

...
</pre>
</li>
</ul>
</div>
<h3>CardDAV</h3>
<div>
For CardDAV support (addressbook sharing) the WebDAV CGI script must handle the root context of your Web server. There are several ways to do that if your Web server is not a only used for WebDAV CGI:
<ul>
<li> use a new host name (alias) for your Web server and configure named virutal hosting.
<pre>
NameVirtualHost *:443
&lt;VirtualHost myvirtualhost:443>
...
&lt;/VirtualHost>
</pre>
</li>
<li> add a new IP to your server and configure IP based virtual hosting.
<pre>
&lt;VirtualHost 10.0.0.0:443>
...
&lt;/VirtualHost>
</pre>
</li>
<li> or bind your Web server to a special port and configure a virtual host for this new port.
<pre>
Listen 8888
&lt;VirtualHost __default__:8888>
...
&lt;/VirtualHost>
</pre>
</li>
</ul>

After that you have to configure WebDAV CGI, e.g:
<pre>
...
### https://myhost/userid -> /home/userid
$DOCUMENT_ROOT = '/home/';
$VIRTUAL_BASE = '/';

$ENABLE_CARDDAV = 1;

%ADDRESSBOOK_HOME_SET = ( default => "/$ENV{REMOTE_USER}/.addressbook/" );

## create .addressbook folder if it does not exists:
mkdir("${DOCUMENT_ROOT}$ENV{REMOTE_USER}/.addressbook") 
		unless -e "${DOCUMENT_ROOT}$ENV{REMOTE_USER}/.addressbook";

...
</pre>
</div>

<a id="afs"></a>
<h2>AFS Support</h2>
WebDAV CGI can be used as a Web frontend for AFS and as a WebDAV-AFS bridge. It's a complete replacement for <a href="http://filedrawers.org/">filedrawers</a>.
<br/>
Requirements:
<ol>
<li><a href="http://modauthkerb.sf.net/">mod_auth_kerberos</a> installed (Debian/Ubuntu package: libapache2-mod-auth-kerb)</li>
<li><a href="http://www.modwaklog.org/">mod_waklog</a> installed</li>
<li><a href="http://www.openafs.org/">OpenAFS</a> client installed on your server (Debian/Ubuntu package: openafs-client) and configured (<code>kinit ...; aklog</code> should work)</li>
<li><a href="http://webdavcgi.sf.net/files/webdavwrapper-krb.c">webdavwrapper-krb.c</a>: <code> gcc -o webdavwrapper webdavwrapper-krb.c && cp webdavwrapper /usr/lib/cgi-bin && chown root:root  /usr/lib/cgi-bin/webdavwrapper; chmod ug+s,a+rx /usr/lib/cgi-bin/webdavwrapper</code>
</ol>

Apache example:
<pre>
KrbMethodNegotiate off
KrbMethodK5Passwd on
KrbSaveCredentials on
Krb5Keytab /etc/webafs.keytab

AuthName "WebAFS"
AuthType Kerberos
require valid-user

WaklogEnabled On
WaklogUseUserTokens On

RewriteRule ^/icons/ - [L]
RewriteRule  ^/ /cgi-bin/webdavwrapper [PT,E=WEBDAVCONF:/usr/lib/cgi-bin/webdav.conf,L]
</pre>

<code>webdav.conf</code> example:
<pre>
$DOCUMENT_ROOT = '/afs/';
$VIRTUAL_BASE='/';

$DBI_SRC='dbi:SQLite:dbname=/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';
$DBI_USER='';
$DBI_PASS=''; 
$CREATE_DB = !-e '/tmp/webdav.'.$ENV{REMOTE_USER}.'.db';

$THUMBNAIL_CACHEDIR="/tmp";

$AFSQUOTA='/usr/bin/fs listquota $FS';

$ENABLE_AFSACLMANAGER = 1;
$ALLOW_AFSACLCHANGES = 1;

$ENABLE_AFSGROUPMANAGER = 1;
$ALLOW_AFSGROUPCHANGES = 1;

$ALLOW_SEARCH = 0;
$ALLOW_CHANGEPERM = 0;
$SHOW_PERM = 0;
$ENABLE_AFS = 1;
$IGNOREFILEPERMISSIONS = 1;

$MIMEFILE='/etc/mime.types';

</pre>


<a id="performance"></a>
<h2>Performance</h2>
<ul>
  <li> Use a fast (local) database.</li>
  <li> Don't use mod_auth_external without auth caching. </li>
  <li> Use load balancing cluster (Attention: use a central, single database for all nodes)</li>
  <li> Disable all features you don't need (take a look at all <code>$ALLOW_...</code> and <code>$ENABLE_...</code> parameters in the WebDAV CGI setup section):
  	<ul>
		<li><code>$ENABLE_LOCK = 0;</code> - disable WebDAV locking support but it is unsafe in conjunction with shared group folders and some clients make trouble.</li>
		<li>Web interface:
			<ul>
			<li><code>$ENABLE_THUMBNAIL=0;</code> - disables thumbnail support</li>
			<li><code>$ENABLE_THUMBNAIL_CACHE=1;</code> - enables the thumbnail cache and reduces CPU usage (only useful if <code>$ENABLE_THUMBNAIL=1;</code>)</li>
			<li><code>$ENABLE_THUMBNAIL_PDFPS=0;</code> - disables thumbnails for PDF/PS documents and reduces CPU usage (only useful if <code>$ENABLE_THUMBNAIL=1;</code></li>
			<li><code>$DISABLE_SEARCH=0;</code> - disables file name search </li>
			</ul>
		</li>
	</ul>
  </li>
  <li> Filter and limit large folders (<code>$FILECOUNTLIMIT</code>, <code>$FILECOUNTPERDIRLIMIT</code>, <code>$FILEFILTERPERDIR</code>)</li>
  <li> Limit folder depth for copy/move operations (<code>$LIMIT_FOLDER_DEPTH</code>)</li>
  <li> Change the bufsize for upload/download operations (<code>$BUFSIZE</code>)</li>
  <li> Since WebDAV CGI v0.5.3 you can use Speedy to improve the performance. Attention: You must set "MaxRuns" because perl and/or WebDAV CGI runs out of memory.</li>
  <li> disable <code>$CREATE_DB</code> after first WebDAV access (PROPFIND request). If you use a file based database like SQLite you can enable/disable it automatically: <code>$CREATE_DB = !-e &lt;mydatabasefile.db&gt;</code></li>
</ul>
<a id="security"></a>
<h2>Security</h2>

 <code>... work in progress ...</code>
<ul>
  <li> Denial-of-Service (DoS): limits (Apache, WebDAV CGI, Authentication) </li>
  <li> Authentication: strong encryption (https ok, http not), strong passwords</li>
  <li> Up-to-date: OS, Apache (auth module), Perl (CGI)</li>

</ul>

<a id="troubleshooting"></a>
<h2>Troubleshooting</h2>
<h3>Timeout</h3>
Maybe it helps to increase the <code>Timeout</code> value in your Apache configuration (300 is a good minimum value). 
<br/>
If a larger <code>Timeout</code> value does not fix the problem perhaps the Apache mod_reqtimeout is loaded. You should disable this module (Debian/Ubuntu: <code>a2dismod reqtimeout; /etc/init.d/apache2 restart</code>) or configure it with larger values.

<h3>Not Found / 500 Internal Server Error / 'Premature end of script headers'</h3>
Please check the following:
<ol>
<li> Apache error log - Apache writes sometimes helpful things into logs</li>
<li> read and execute file permissions of <code>webdavwrapper</code> and <code>webdav.pl</code> and fix it if necessary (owner/group too):
<pre>
chmod a+rx webdav.pl
chmod a+rx,ug+s webdavwrapper
chown root:root webdavwrapper
</pre>

</li>
<li> shebang of <code>webdav.pl</code>: path to the Perl interpreter have to be correct</li>
<li> <code>webdav.conf</code> syntax (maybe a broken config):
<pre>
#&gt; perl -c webdav.conf
webdav.conf syntax OK
</pre>
</li>
<li> <code>webdav.pl</code> syntax (maybe a broken config or a missing Perl module): 
<pre>
#&gt; perl -c webdav.pl
webdav.pl syntax OK
</pre>
</li>
<li> Check your database setup (<code>$DBI_SRC</code>, <code>$DBI_USER</code>, <code>$DBI_PASS</code>).</li>
<li> Call webdav.pl from a shell:
<pre>
#&gt; ./webdav.pl
DAV: 1, 2, 3, <http://apache.org/dav/propset/fs/1>, extended-mkcol, access-control, calendar-access, calendarserver-private-comments, calendar-auto-schedule, addressbook, bind
MS-Author-Via: DAV
Status: 404 Not Found
Date: Mon, 14 Mar 2011 12:51:35 GMT
Etag: "d41d8cd98f00b204e9800998ecf8427e"
Content-length: 0
Content-Type: text/plain; charset=utf-8
</pre>
</li>
<li> Call webdavwrapper from a shell:
<pre>
#&gt; ./webdavwrapper
Status: 404 Not Found
Content-Type: text/plain

404 Not Found - your wrapper
</pre>
</li>
</ol>

<h3>Web interface: Copy/Cut/Paste and bookmarks do not work as expected.</h3>
WebDAV CGI uses the 'secure' flag for cookies. If you access the Web interface without encryption (http instead of https) all cookie based actions do not work.
<div id="contact">
&copy; ZE CMS, Humboldt-Universit&auml;t zu Berlin | Written 2011 by <a href="mailto:d.rohde@cms.hu-berlin.de?subject=WebDAV CGI">Daniel Rohde</a> </div>
</div>
</body>
</html>

